<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ceph常用命令 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="cephfs"><meta name=description content="测试上传/下载对象 存取故据时，客户端必须首先连接至RAD05集群上某存储地，而后根据对像名称由相关的中CRUSH规则完成数据对象寻址。于是为了测试集群的数据存储功能，首先创建一个用于测试的存储池mypool，并设定其PG数量为16个。
sh 1 ceph osd pool create mypool 16 16 而后，即可将测试文件上传至存储池中。例如下面的rados put命令将/etc/hosts
rados
lspool 显示存储池
rmpool 删除存储池
mkpool 创建存储池
rados mkpool mypool 32 32
sh 1 2 rados mkpool {name} {pgnum} {pgpnum} rados mkpool test 32 32 sh 1 2 $ ceph osd pool create testpool 32 32 pool 'testpool' created 列出存储池
text 1 2 3 4 5 6 7 8 9 $ ceph osd pool ls mypool rbdpool testpool $ rados lspools mypool rbdpool testpool 而后即可将测试文件上传到存储池中，例如将rados put命令将/etc/issue文件上传至testpool存储池，对象名称仍然较保留文件名issue，而rados ls可以列出指定存储池中的数据对象"><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="ceph常用命令"><meta property="og:description" content="测试上传/下载对象 存取故据时，客户端必须首先连接至RAD05集群上某存储地，而后根据对像名称由相关的中CRUSH规则完成数据对象寻址。于是为了测试集群的数据存储功能，首先创建一个用于测试的存储池mypool，并设定其PG数量为16个。
sh 1 ceph osd pool create mypool 16 16 而后，即可将测试文件上传至存储池中。例如下面的rados put命令将/etc/hosts
rados
lspool 显示存储池
rmpool 删除存储池
mkpool 创建存储池
rados mkpool mypool 32 32
sh 1 2 rados mkpool {name} {pgnum} {pgpnum} rados mkpool test 32 32 sh 1 2 $ ceph osd pool create testpool 32 32 pool 'testpool' created 列出存储池
text 1 2 3 4 5 6 7 8 9 $ ceph osd pool ls mypool rbdpool testpool $ rados lspools mypool rbdpool testpool 而后即可将测试文件上传到存储池中，例如将rados put命令将/etc/issue文件上传至testpool存储池，对象名称仍然较保留文件名issue，而rados ls可以列出指定存储池中的数据对象"><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-13T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-13T23:10:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="ceph常用命令"><meta name=twitter:description content="测试上传/下载对象 存取故据时，客户端必须首先连接至RAD05集群上某存储地，而后根据对像名称由相关的中CRUSH规则完成数据对象寻址。于是为了测试集群的数据存储功能，首先创建一个用于测试的存储池mypool，并设定其PG数量为16个。
sh 1 ceph osd pool create mypool 16 16 而后，即可将测试文件上传至存储池中。例如下面的rados put命令将/etc/hosts
rados
lspool 显示存储池
rmpool 删除存储池
mkpool 创建存储池
rados mkpool mypool 32 32
sh 1 2 rados mkpool {name} {pgnum} {pgpnum} rados mkpool test 32 32 sh 1 2 $ ceph osd pool create testpool 32 32 pool 'testpool' created 列出存储池
text 1 2 3 4 5 6 7 8 9 $ ceph osd pool ls mypool rbdpool testpool $ rados lspools mypool rbdpool testpool 而后即可将测试文件上传到存储池中，例如将rados put命令将/etc/issue文件上传至testpool存储池，对象名称仍然较保留文件名issue，而rados ls可以列出指定存储池中的数据对象"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"ceph常用命令","item":"https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ceph常用命令","name":"ceph常用命令","description":"测试上传/下载对象 存取故据时，客户端必须首先连接至RAD05集群上某存储地，而后根据对像名称由相关的中CRUSH规则完成数据对象寻址。于是为了测试集群的数据存储功能，首先创建一个用于测试的存储池mypool，并设定其PG数量为16个。\nsh 1 ceph osd pool create mypool 16 16 而后，即可将测试文件上传至存储池中。例如下面的rados put命令将/etc/hosts\nrados\nlspool 显示存储池\nrmpool 删除存储池\nmkpool 创建存储池\nrados mkpool mypool 32 32\nsh 1 2 rados mkpool {name} {pgnum} {pgpnum} rados mkpool test 32 32 sh 1 2 $ ceph osd pool create testpool 32 32 pool \u0026#39;testpool\u0026#39; created 列出存储池\ntext 1 2 3 4 5 6 7 8 9 $ ceph osd pool ls mypool rbdpool testpool $ rados lspools mypool rbdpool testpool 而后即可将测试文件上传到存储池中，例如将rados put命令将/etc/issue文件上传至testpool存储池，对象名称仍然较保留文件名issue，而rados ls可以列出指定存储池中的数据对象","keywords":["cephfs"],"articleBody":"测试上传/下载对象 存取故据时，客户端必须首先连接至RAD05集群上某存储地，而后根据对像名称由相关的中CRUSH规则完成数据对象寻址。于是为了测试集群的数据存储功能，首先创建一个用于测试的存储池mypool，并设定其PG数量为16个。\nsh 1 ceph osd pool create mypool 16 16 而后，即可将测试文件上传至存储池中。例如下面的rados put命令将/etc/hosts\nrados\nlspool 显示存储池\nrmpool 删除存储池\nmkpool 创建存储池\nrados mkpool mypool 32 32\nsh 1 2 rados mkpool {name} {pgnum} {pgpnum} rados mkpool test 32 32 sh 1 2 $ ceph osd pool create testpool 32 32 pool 'testpool' created 列出存储池\ntext 1 2 3 4 5 6 7 8 9 $ ceph osd pool ls mypool rbdpool testpool $ rados lspools mypool rbdpool testpool 而后即可将测试文件上传到存储池中，例如将rados put命令将/etc/issue文件上传至testpool存储池，对象名称仍然较保留文件名issue，而rados ls可以列出指定存储池中的数据对象\nsh 1 2 3 4 rados put issue /etc/issue --pool=testpool $ rados ls --pool=testpool # --pool 指定放入那个存储池中去 issue 而ceph osd map可查看获取到存储池中数据对象的具体位置信息（数据和元数据怎么映射存储的)\nsh 1 2 3 4 ceph osd map testpool issue $ ceph osd map mypool passwd osdmap e36 pool 'mypool' (1) object 'passwd' -\u003e pg 1.27292a34 (1.14) -\u003e up ([0,3,2], p0) acting ([0,3,2], p0) mypool存储池中的对象passwd被放在pg上1.27292a34 1为存储池编号.后面的编号可以理解为pg的位图。是pg的编号；up ([0,3,2], p0)正常可访问编号0、3、2，副本型存储池，crush算法计算得到，0为主osd。活动集acting ([0,3,2], p0)，此组pg(pg 1.27292a34 (1.14))之下所有的osd([0,3,2])都处于正常活动状态。\n删除数据对象 text 1 ceph osd pool rm testpool --yes-i-really-really-mean-it 删除存储池命令存在数据丢失的风险，Ceph于是默认禁止此类操作。管理员需要在ceph.conf配置文件中启用支持删除存储池的操作后，方可使用如下命令删除存储池。\nbash 1 rados rm issue --pool=mypool ceph集群的访问接口 Ceph块设备接口 Ceph块设备，也称为RADOS块设备（简称RBD），是一种基于RADOS存储系统支持超配，（thin-provisioned）、可伸缩的条带化数据存储系统，它通过librbd库与OSD进行交互。RBD为KVM等虚拟化技术和云OS（如OpenStack和CloudStack）提供高可用和无限扩展性的存储后端，这些系统以来与libvirt和QEMU实用程序与RBD进行集。\n在集群部署完成以后，就具有了RBD接口，RBD接口关键是在客户端的配置。服务端本身可以直接使用。只需创建出存储池，在存储池中就可以创建块设备。块设备主要表现为存储池当中的镜像或映像文件（image）。\n客户端基于librbd库即可将RADOS存储集群用作块设备，不过，用于rbd的存储池需要实现启用rbd功能并进行初始化。例如，创建一个名为rbddata的存储池，在启动rbd功能后对其进行初始化\n对于rbdpool而言，创建完成后并不能直接使用，因为三种应用程序需要单独进行启用。相关存储池的应用才可以。\nsh 1 ceph osd pool create rbpool 64 ## 指明pg数量 sh 1 2 3 4 5 # 默认情况下是裸池 $ ceph osd pool application enable rbdpool rbd enabled application 'rbd' on pool 'rbdpool' osd pool application enable {--yes-i-really-mean-it} enable use of an application [cephfs,rbd,rgw] on pool sh 1 2 rbd pool init -p rbddata 不过，rbd存储池并不能直接用于块设备，而是需要事先在其中按需创建映像（image），以及可用映像、创建快照、将映像回滚到快照和查看快照等管理操作。\n创建名为img1的映像\nsh 1 rbd create rbdpool/img --size 1G sh 1 2 3 $ rbd ls -p rbdpool img img1 显示映像的相关信息，rbd info\nsh 1 2 3 4 5 6 7 8 9 10 11 $ rbd info rbdpool/img rbd image 'img': size 1 GiB in 256 objects order 22 (4 MiB objects) id: 38bb6b8b4567 block_name_prefix: rbd_data.38bb6b8b4567 format: 2 features: layering, exclusive-lock, object-map, fast-diff, deep-flatten op_features: flags: create_timestamp: Fri Jun 14 17:08:48 2019 在客户端主机上，用户通过内核级的rbd驱动识别相关设备，即可对其进行分区、创建文件系统并挂载使用。\nRank 层级 MDS MDS在哪台服务器 上 Pool 两个存储池，存储池都位于同一个ceph集群之上，所以看到的空间大小是一样的。\n检查集群状态 命令：ceph-s\n输出信息：\n集群ID 集群运行状况 监视器地图版本号和监视器仲裁的状态 OSD map版本号和OSD的状态 归置组map版本 归置组和存储池数量 所存储数据理论上的数量和所存储对象的数量 所存储数据的总量 获取集群的即时状态 ceph pg stat ceph osd pool stat ceph df ceph df detail ceph df\n输出两端内容：GLOBAL和POOLS\nGLOBAL：存储量概览 POOLS：存储池列表和每个存储池的理论用量，但出不反应副本、克隆数据或快照 GLOBAL段\nsize 集群的整体存储容量 AVAIL 集群中可以使用的可用空间容量 RAW USED 已用的原始存储量 % RAW USED：已用的原始存储量百分比，将此数字与 full ratio和near full ratio搭配使用，可确保您不会用完集群的容量。 检查OSD和Mon的状态 可通过执行以下命令来检查OSD，以确保它们已启动里正在运行\nceph osd stat ceph osd dump 还可以根据OSD在CRUSH map中的位置查看OSD ceph osd tree Ceph将列显CRUSH树及主机它的OSD、OSD是否已启动及其权重 text 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ ceph osd tree ID CLASS WEIGHT TYPE NAME STATUS REWEIGHT PRI-AFF -1 0.09775 root default -3 0.03897 host stor01 0 hdd 0.01949 osd.0 up 1.00000 1.00000 7 hdd 0.01949 osd.7 up 1.00000 1.00000 -5 0.01959 host stor02 1 hdd 0.00980 osd.1 up 1.00000 1.00000 6 hdd 0.00980 osd.6 up 1.00000 1.00000 -7 0.01959 host stor03 2 hdd 0.00980 osd.2 up 1.00000 1.00000 5 hdd 0.00980 osd.5 up 1.00000 1.00000 -9 0.01959 host stor04 3 hdd 0.00980 osd.3 up 1.00000 1.00000 4 hdd 0.00980 osd.4 up 1.00000 1.00000 集群中存在多个Mon主机时，应该在启动集群之后读取或写入数据之前检查Mon的种裁状态：事实上，管理员也应该定期检查这种仲裁结果。\n显示监视器映射：ceph mon stat命令或者ceph mon dump text 1 2 $ ceph mon stat e3: 3 mons at {stor01=10.0.0.4:6789/0,stor02=10.0.0.5:6789/0,stor03=10.0.0.6:6789/0}, election epoch 20, leader 0 stor01, quorum 0,1,2 stor01,stor02,stor03 显示伸裁状态：ceph quorum status 使用管理套接字 每一个socket文件能够用来直接通过它管理对应的sock背后的守护进程。\nCeph的管理套接字接口常用于查询守护进程。\n套接字默认保存于/var/run/ceph目录 此接口的使用不能以远程方式进程 命令的使用格式\nsh 1 ceph --admin-daemon /var/run/ceph/{socket-name} 获取使用帮助：\ntext 1 ceph --admin-daemon /var/run/ceph/{socket-name} 停止或重启Ceph集群 停止 告知Ceph集群不要将osd标记为out，命令ceph osd set noout 按如下顺序停止守护进程和节点 存储客户端 网关，例如NFS Ganesha或对象网关 元数据服务器 Ceph OSD Ceph Manager Ceph Monitor 启动 以与停止过程相反的顺序启动节点 Ceph Monitor Ceph Manager Ceph OSD 元数据服务器 网关，例如NFS Ganesha或对象网关 存储客户端 删除noout标志，命令ceph osd unset noout Ceph的配置文件 配置文件结构 ceph配置文件使用ini语法格式 ceph在启动时会依次查找多个不同位置的配置文件，如后找的配置文件与前面发生冲突，会覆盖此前的配置信息 注释可通过\"#\",\";\" 配置文件主要有以下几个配置项所组成 [global]:全局配置,影响ceph存储集群中的所有守护进程 [osd]: 影响Ceph存储集群中的所有ceph-osd守护进程并覆盖全局中的相同设置 [mon]: 影响ceph存储集群中的所有ceph-mon守护进程并覆盖全局中的相同设置 [client]: 影响所有客户端，例如，挂载ceph块设备，ceph对象网关等 每一个独立的配置项是对所有选项生效的，如[mon]，如有需要对单独的选项进行配置可以使用[mon.id]加上id进行标识。\n您可以通过输入由.分隔的类型来指定守护程序的特定实例的配置，您可以指定该实例。 并通过实例ID\nceph osd守护进程的实例id总是数字，但它可能是ceph monitors的字母数字\n例如[mon.a]、[mon.b]、[mon.0]等 按顺序包含的默认ceph配置文件位置\n$CEPH_CONF环境变量指定的文件路径路径\n-c /path/ceph.conf 使用-c的命令行选项传递给ceph各应用程序或守护进程的命令行选项\n/etc/ceph/ceph.conf\n~/.ceph/config\n./ceph.conf 用户当前工作目录\n在配置文件配置时，还可以使用元变量来引用配置文件中的其他信息或引用ceph集群中的元数据信息做变量替换的。称作元参数或元变量\n常用的元参数\ncluster: 当前Ceph集群的名称 $type: 当前服务的类型名称，可能会展开为OSD或mon $id: 进程的标识符，例如对osd.0来说，其标识符为0 $host：守护进程所在的主机的主机名 $name: 其值为$type.$id 进程的运行时配置\n在进程的运行当中，设定osd、mon、mgr等工作特性。\n要查看运行时配置，请登录Ceph节点并执行：\ntext 1 ceph daemon {daemon-type}.{id} config show 获取帮助信息\nsh 1 ceph daemon {daemon-type}.{id} help 在运行时获取特定配置设置\nsh 1 2 3 4 5 ceph daemon {daemon-type}.{id} config get {parameter} # 例如： ceph daemon osd.0 config get public_addr 在运行时设置特定配置\n设置运行时配置有两种常用方法：\n使用Ceph mmonitor ceph tell {daemon-type}.{daemon id or *} injectargs --{name} {value} [--{name}} {value}] 例如：ceph tell osd.0 injectargs '--debug-osd 0/5' 使用 administration socket ceph daemon {daemon-type}.{id} set {name} {type} 例如：ceph osd.0 config set debug_osd 0/5 ","wordCount":"659","inLanguage":"zh","datePublished":"2023-09-13T00:00:00Z","dateModified":"2024-02-13T23:10:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ceph常用命令</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-09-13</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>659 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>4 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/storage/>#Storage</a>
<a href=https://www.oomkill.com/tags/troubleshooting/>#Troubleshooting</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><ul><li><a href=#%e6%b5%8b%e8%af%95%e4%b8%8a%e4%bc%a0%e4%b8%8b%e8%bd%bd%e5%af%b9%e8%b1%a1 aria-label=测试上传/下载对象>测试上传/下载对象</a><li><a href=#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae%e5%af%b9%e8%b1%a1 aria-label=删除数据对象>删除数据对象</a></ul><li><a href=#ceph%e9%9b%86%e7%be%a4%e7%9a%84%e8%ae%bf%e9%97%ae%e6%8e%a5%e5%8f%a3 aria-label=ceph集群的访问接口>ceph集群的访问接口</a><ul><li><a href=#ceph%e5%9d%97%e8%ae%be%e5%a4%87%e6%8e%a5%e5%8f%a3 aria-label=Ceph块设备接口>Ceph块设备接口</a><li><a href=#%e6%a3%80%e6%9f%a5%e9%9b%86%e7%be%a4%e7%8a%b6%e6%80%81 aria-label=检查集群状态>检查集群状态</a><li><a href=#%e8%8e%b7%e5%8f%96%e9%9b%86%e7%be%a4%e7%9a%84%e5%8d%b3%e6%97%b6%e7%8a%b6%e6%80%81 aria-label=获取集群的即时状态>获取集群的即时状态</a><li><a href=#%e6%a3%80%e6%9f%a5osd%e5%92%8cmon%e7%9a%84%e7%8a%b6%e6%80%81 aria-label=检查OSD和Mon的状态>检查OSD和Mon的状态</a><li><a href=#%e4%bd%bf%e7%94%a8%e7%ae%a1%e7%90%86%e5%a5%97%e6%8e%a5%e5%ad%97 aria-label=使用管理套接字>使用管理套接字</a><li><a href=#%e5%81%9c%e6%ad%a2%e6%88%96%e9%87%8d%e5%90%afceph%e9%9b%86%e7%be%a4 aria-label=停止或重启Ceph集群>停止或重启Ceph集群</a><ul><li><a href=#%e5%81%9c%e6%ad%a2 aria-label=停止>停止</a><li><a href=#%e5%90%af%e5%8a%a8 aria-label=启动>启动</a></ul><li><a href=#ceph%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=Ceph的配置文件>Ceph的配置文件</a><ul><li><a href=#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84 aria-label=配置文件结构>配置文件结构</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h4 id=测试上传下载对象>测试上传/下载对象<a hidden class=anchor aria-hidden=true href=#测试上传下载对象>#</a></h4><p>存取故据时，客户端必须首先连接至RAD05集群上某存储地，而后根据对像名称由相关的中CRUSH规则完成数据对象寻址。于是为了测试集群的数据存储功能，首先创建一个用于测试的存储池mypool，并设定其PG数量为16个。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ceph osd pool create mypool <span class=m>16</span> <span class=m>16</span></span></span></code></pre></td></tr></table></div></div></div></div><p>而后，即可将测试文件上传至存储池中。例如下面的<code>rados put</code>命令将/etc/hosts</p><p>rados</p><p>lspool 显示存储池</p><p>rmpool 删除存储池</p><p>mkpool 创建存储池</p><p>rados mkpool mypool 32 32</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>rados mkpool <span class=o>{</span>name<span class=o>}</span> <span class=o>{</span>pgnum<span class=o>}</span> <span class=o>{</span>pgpnum<span class=o>}</span>
</span></span><span class=line><span class=cl>rados mkpool <span class=nb>test</span> <span class=m>32</span> <span class=m>32</span></span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ceph osd pool create testpool <span class=m>32</span> <span class=m>32</span>
</span></span><span class=line><span class=cl>pool <span class=s1>&#39;testpool&#39;</span> created</span></span></code></pre></td></tr></table></div></div></div></div><p>列出存储池</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ceph osd pool ls
</span></span><span class=line><span class=cl>mypool
</span></span><span class=line><span class=cl>rbdpool
</span></span><span class=line><span class=cl>testpool
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ rados lspools  
</span></span><span class=line><span class=cl>mypool
</span></span><span class=line><span class=cl>rbdpool
</span></span><span class=line><span class=cl>testpool</span></span></code></pre></td></tr></table></div></div></div></div><p>而后即可将测试文件上传到存储池中，例如将<code>rados put</code>命令将<code>/etc/issue</code>文件上传至testpool存储池，对象名称仍然较保留文件名issue，而<code>rados ls</code>可以列出指定存储池中的数据对象</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>rados put issue /etc/issue --pool<span class=o>=</span>testpool    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ rados ls --pool<span class=o>=</span>testpool  <span class=c1># --pool 指定放入那个存储池中去</span>
</span></span><span class=line><span class=cl>issue</span></span></code></pre></td></tr></table></div></div></div></div><p>而<font color=#f8070d size=3><code>ceph osd map</code></font>可查看获取到存储池中数据对象的具体位置信息（数据和元数据怎么映射存储的)</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ceph osd map testpool issue
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ceph osd map mypool passwd
</span></span><span class=line><span class=cl>osdmap e36 pool <span class=s1>&#39;mypool&#39;</span> <span class=o>(</span>1<span class=o>)</span> object <span class=s1>&#39;passwd&#39;</span> -&gt; pg 1.27292a34 <span class=o>(</span>1.14<span class=o>)</span> -&gt; up <span class=o>([</span>0,3,2<span class=o>]</span>, p0<span class=o>)</span> acting <span class=o>([</span>0,3,2<span class=o>]</span>, p0<span class=o>)</span></span></span></code></pre></td></tr></table></div></div></div></div><p>    mypool存储池中的对象<code>passwd</code>被放在pg上<code>1.27292a34</code> 1为存储池编号<code>.</code>后面的编号可以理解为pg的位图。是pg的编号；<code>up ([0,3,2], p0)</code>正常可访问编号0、3、2，副本型存储池，crush算法计算得到，0为主osd。活动集<code>acting ([0,3,2], p0)</code>，此组pg(<code>pg 1.27292a34 (1.14)</code>)之下所有的osd(<code>[0,3,2]</code>)都处于正常活动状态。</p><h4 id=删除数据对象>删除数据对象<a hidden class=anchor aria-hidden=true href=#删除数据对象>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ceph osd pool rm testpool --yes-i-really-really-mean-it</span></span></code></pre></td></tr></table></div></div></div></div><p>    删除存储池命令存在数据丢失的风险，Ceph于是默认禁止此类操作。管理员需要在<font color=#f8070d size=3><code>ceph.conf</code></font>配置文件中启用支持删除存储池的操作后，方可使用如下命令删除存储池。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rados rm issue --pool<span class=o>=</span>mypool</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=ceph集群的访问接口>ceph集群的访问接口<a hidden class=anchor aria-hidden=true href=#ceph集群的访问接口>#</a></h3><h4 id=ceph块设备接口>Ceph块设备接口<a hidden class=anchor aria-hidden=true href=#ceph块设备接口>#</a></h4><p>Ceph块设备，也称为RADOS块设备（简称RBD），是一种基于RADOS存储系统支持超配，（thin-provisioned）、可伸缩的条带化数据存储系统，它通过librbd库与OSD进行交互。RBD为KVM等虚拟化技术和云OS（如OpenStack和CloudStack）提供高可用和无限扩展性的存储后端，这些系统以来与libvirt和QEMU实用程序与RBD进行集。</p><p>在集群部署完成以后，就具有了RBD接口，RBD接口关键是在客户端的配置。服务端本身可以直接使用。只需创建出存储池，在存储池中就可以创建块设备。块设备主要表现为存储池当中的镜像或映像文件（image）。</p><p>客户端基于librbd库即可将RADOS存储集群用作块设备，不过，用于rbd的存储池需要实现启用rbd功能并进行初始化。例如，创建一个名为rbddata的存储池，在启动rbd功能后对其进行初始化</p><p>对于rbdpool而言，创建完成后并不能直接使用，因为三种应用程序需要单独进行启用。相关存储池的应用才可以。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ceph osd pool create rbpool <span class=m>64</span> <span class=c1>## 指明pg数量</span></span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 默认情况下是裸池</span>
</span></span><span class=line><span class=cl>$ ceph osd pool application <span class=nb>enable</span> rbdpool rbd
</span></span><span class=line><span class=cl>enabled application <span class=s1>&#39;rbd&#39;</span> on pool <span class=s1>&#39;rbdpool&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>osd pool application <span class=nb>enable</span> &lt;poolname&gt; &lt;app&gt; <span class=o>{</span>--yes-i-really-mean-it<span class=o>}</span>             <span class=nb>enable</span> use of an application &lt;app&gt; <span class=o>[</span>cephfs,rbd,rgw<span class=o>]</span> on pool &lt;poolname&gt;</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd pool init -p rbddata</span></span></code></pre></td></tr></table></div></div></div></div><p>不过，rbd存储池并不能直接用于块设备，而是需要事先在其中按需创建映像（image），以及可用映像、创建快照、将映像回滚到快照和查看快照等管理操作。</p><p>创建名为img1的映像</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>rbd create rbdpool/img --size 1G</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ rbd ls -p rbdpool
</span></span><span class=line><span class=cl>img
</span></span><span class=line><span class=cl>img1</span></span></code></pre></td></tr></table></div></div></div></div><p>显示映像的相关信息，<code>rbd info</code></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ rbd info rbdpool/img
</span></span><span class=line><span class=cl>rbd image <span class=s1>&#39;img&#39;</span>:
</span></span><span class=line><span class=cl>        size <span class=m>1</span> GiB in <span class=m>256</span> objects
</span></span><span class=line><span class=cl>        order <span class=m>22</span> <span class=o>(</span><span class=m>4</span> MiB objects<span class=o>)</span>
</span></span><span class=line><span class=cl>        id: 38bb6b8b4567
</span></span><span class=line><span class=cl>        block_name_prefix: rbd_data.38bb6b8b4567
</span></span><span class=line><span class=cl>        format: <span class=m>2</span>
</span></span><span class=line><span class=cl>        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten
</span></span><span class=line><span class=cl>        op_features: 
</span></span><span class=line><span class=cl>        flags: 
</span></span><span class=line><span class=cl>        create_timestamp: Fri Jun <span class=m>14</span> 17:08:48 <span class=m>2019</span></span></span></code></pre></td></tr></table></div></div></div></div><p>在客户端主机上，用户通过内核级的rbd驱动识别相关设备，即可对其进行分区、创建文件系统并挂载使用。</p><p>Rank 层级
MDS MDS在哪台服务器 上
Pool 两个存储池，存储池都位于同一个ceph集群之上，所以看到的空间大小是一样的。</p><h4 id=检查集群状态>检查集群状态<a hidden class=anchor aria-hidden=true href=#检查集群状态>#</a></h4><p>命令：ceph-s</p><p>输出信息：</p><ul><li>集群ID</li><li>集群运行状况</li><li>监视器地图版本号和监视器仲裁的状态</li><li>OSD map版本号和OSD的状态</li><li>归置组map版本</li><li>归置组和存储池数量</li><li>所存储数据理论上的数量和所存储对象的数量</li><li>所存储数据的总量</li></ul><h4 id=获取集群的即时状态>获取集群的即时状态<a hidden class=anchor aria-hidden=true href=#获取集群的即时状态>#</a></h4><ul><li>ceph pg stat</li><li>ceph osd pool stat</li><li>ceph df</li><li>ceph df detail</li></ul><p>ceph df</p><p>输出两端内容：GLOBAL和POOLS</p><ul><li>GLOBAL：存储量概览</li><li>POOLS：存储池列表和每个存储池的理论用量，但出不反应副本、克隆数据或快照</li></ul><p>GLOBAL段</p><ul><li>size 集群的整体存储容量</li><li>AVAIL 集群中可以使用的可用空间容量</li><li>RAW USED 已用的原始存储量</li><li>% RAW USED：已用的原始存储量百分比，将此数字与 full ratio和near full ratio搭配使用，可确保您不会用完集群的容量。</li><li></li></ul><h4 id=检查osd和mon的状态>检查OSD和Mon的状态<a hidden class=anchor aria-hidden=true href=#检查osd和mon的状态>#</a></h4><p>可通过执行以下命令来检查OSD，以确保它们已启动里正在运行</p><ul><li><code>ceph osd stat</code></li><li><code>ceph osd dump</code>
还可以根据OSD在CRUSH map中的位置查看OSD</li><li><code>ceph osd tree</code><ul><li>Ceph将列显CRUSH树及主机它的OSD、OSD是否已启动及其权重</li></ul></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ceph osd tree
</span></span><span class=line><span class=cl>ID CLASS WEIGHT  TYPE NAME       STATUS REWEIGHT PRI-AFF 
</span></span><span class=line><span class=cl>-1       0.09775 root default                            
</span></span><span class=line><span class=cl>-3       0.03897     host stor01                         
</span></span><span class=line><span class=cl> 0   hdd 0.01949         osd.0       up  1.00000 1.00000 
</span></span><span class=line><span class=cl> 7   hdd 0.01949         osd.7       up  1.00000 1.00000 
</span></span><span class=line><span class=cl>-5       0.01959     host stor02                         
</span></span><span class=line><span class=cl> 1   hdd 0.00980         osd.1       up  1.00000 1.00000 
</span></span><span class=line><span class=cl> 6   hdd 0.00980         osd.6       up  1.00000 1.00000 
</span></span><span class=line><span class=cl>-7       0.01959     host stor03                         
</span></span><span class=line><span class=cl> 2   hdd 0.00980         osd.2       up  1.00000 1.00000 
</span></span><span class=line><span class=cl> 5   hdd 0.00980         osd.5       up  1.00000 1.00000 
</span></span><span class=line><span class=cl>-9       0.01959     host stor04                         
</span></span><span class=line><span class=cl> 3   hdd 0.00980         osd.3       up  1.00000 1.00000 
</span></span><span class=line><span class=cl> 4   hdd 0.00980         osd.4       up  1.00000 1.00000 </span></span></code></pre></td></tr></table></div></div></div></div><p>集群中存在多个Mon主机时，应该在启动集群之后读取或写入数据之前检查Mon的种裁状态：事实上，管理员也应该定期检查这种仲裁结果。</p><ul><li>显示监视器映射：<code>ceph mon stat</code>命令或者<code>ceph mon dump</code></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ceph mon stat
</span></span><span class=line><span class=cl>e3: 3 mons at {stor01=10.0.0.4:6789/0,stor02=10.0.0.5:6789/0,stor03=10.0.0.6:6789/0}, election epoch 20, leader 0 stor01, quorum 0,1,2 stor01,stor02,stor03</span></span></code></pre></td></tr></table></div></div></div></div><ul><li>显示伸裁状态：<code>ceph quorum status</code></li></ul><h4 id=使用管理套接字>使用管理套接字<a hidden class=anchor aria-hidden=true href=#使用管理套接字>#</a></h4><p>每一个socket文件能够用来直接通过它管理对应的sock背后的守护进程。</p><p>Ceph的管理套接字接口常用于查询守护进程。</p><ul><li>套接字默认保存于<code>/var/run/ceph</code>目录</li><li>此接口的使用不能以远程方式进程</li></ul><p>命令的使用格式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ceph --admin-daemon /var/run/ceph/<span class=o>{</span>socket-name<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>获取使用帮助：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ceph --admin-daemon /var/run/ceph/{socket-name}</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=停止或重启ceph集群>停止或重启Ceph集群<a hidden class=anchor aria-hidden=true href=#停止或重启ceph集群>#</a></h4><h5 id=停止>停止<a hidden class=anchor aria-hidden=true href=#停止>#</a></h5><ul><li>告知Ceph集群不要将osd标记为out，命令<code>ceph osd set noout</code></li><li>按如下顺序停止守护进程和节点<ul><li>存储客户端</li><li>网关，例如NFS Ganesha或对象网关</li><li>元数据服务器</li><li>Ceph OSD</li><li>Ceph Manager</li><li>Ceph Monitor</li></ul></li></ul><h5 id=启动>启动<a hidden class=anchor aria-hidden=true href=#启动>#</a></h5><ul><li>以与停止过程相反的顺序启动节点</li><li>Ceph Monitor</li><li>Ceph Manager</li><li>Ceph OSD</li><li>元数据服务器</li><li>网关，例如NFS Ganesha或对象网关</li><li>存储客户端</li><li>删除noout标志，命令<code>ceph osd unset noout</code></li></ul><h4 id=ceph的配置文件>Ceph的配置文件<a hidden class=anchor aria-hidden=true href=#ceph的配置文件>#</a></h4><h5 id=配置文件结构>配置文件结构<a hidden class=anchor aria-hidden=true href=#配置文件结构>#</a></h5><ul><li>ceph配置文件使用ini语法格式</li><li>ceph在启动时会依次查找多个不同位置的配置文件，如后找的配置文件与前面发生冲突，会覆盖此前的配置信息</li><li>注释可通过"#",";"</li><li>配置文件主要有以下几个配置项所组成<ul><li><code>[global]</code>:全局配置,影响ceph存储集群中的所有守护进程</li><li><code>[osd]</code>: 影响Ceph存储集群中的所有ceph-osd守护进程并覆盖全局中的相同设置</li><li><code>[mon]</code>: 影响ceph存储集群中的所有ceph-mon守护进程并覆盖全局中的相同设置</li><li><code>[client]</code>: 影响所有客户端，例如，挂载ceph块设备，ceph对象网关等</li></ul></li></ul><p>每一个独立的配置项是对所有选项生效的，如<code>[mon]</code>，如有需要对单独的选项进行配置可以使用<code>[mon.id]</code>加上id进行标识。</p><ul><li><p>您可以通过输入由<code>.</code>分隔的类型来指定守护程序的特定实例的配置，您可以指定该实例。 并通过实例ID</p></li><li><p>ceph osd守护进程的实例id总是数字，但它可能是<code>ceph monitors</code>的字母数字</p><ul><li>例如<code>[mon.a]</code>、<code>[mon.b]</code>、<code>[mon.0]</code>等</li></ul></li><li><p>按顺序包含的默认ceph配置文件位置</p></li><li><p>$CEPH_CONF环境变量指定的文件路径路径</p></li><li><p><code>-c</code> /path/ceph.conf 使用<code>-c</code>的命令行选项传递给ceph各应用程序或守护进程的命令行选项</p></li><li><p><code>/etc/ceph/ceph.conf</code></p></li><li><p><code>~/.ceph/config</code></p></li><li><p><code>./ceph.conf</code> 用户当前工作目录</p></li></ul><p>在配置文件配置时，还可以使用元变量来引用配置文件中的其他信息或引用ceph集群中的元数据信息做变量替换的。称作元参数或元变量</p><blockquote><p>常用的元参数</p></blockquote><ul><li><code>cluster</code>: 当前Ceph集群的名称</li><li><code>$type</code>: 当前服务的类型名称，可能会展开为OSD或mon</li><li><code>$id</code>: 进程的标识符，例如对osd.0来说，其标识符为0</li><li><code>$host</code>：守护进程所在的主机的主机名</li><li><code>$name</code>: 其值为<code>$type.$id</code></li></ul><p>进程的运行时配置</p><p>在进程的运行当中，设定<code>osd</code>、<code>mon</code>、<code>mgr</code>等工作特性。</p><p>要查看运行时配置，请登录Ceph节点并执行：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ceph daemon {daemon-type}.{id} config show</span></span></code></pre></td></tr></table></div></div></div></div><p>获取帮助信息</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ceph daemon <span class=o>{</span>daemon-type<span class=o>}</span>.<span class=o>{</span>id<span class=o>}</span> help</span></span></code></pre></td></tr></table></div></div></div></div><p>在运行时获取特定配置设置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ceph daemon <span class=o>{</span>daemon-type<span class=o>}</span>.<span class=o>{</span>id<span class=o>}</span> config get <span class=o>{</span>parameter<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 例如：</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph daemon osd.0 config get public_addr</span></span></code></pre></td></tr></table></div></div></div></div><p>在运行时设置特定配置</p><p>设置运行时配置有两种常用方法：</p><ul><li>使用Ceph mmonitor<ul><li><code>ceph tell {daemon-type}.{daemon id or *} injectargs --{name} {value} [--{name}} {value}]</code></li><li>例如：<code>ceph tell osd.0 injectargs '--debug-osd 0/5'</code></li></ul></li><li>使用 administration socket<ul><li><code>ceph daemon {daemon-type}.{id} set {name} {type}</code></li><li>例如：<code>ceph osd.0 config set debug_osd 0/5</code></li></ul></li></ul></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：ceph常用命令</p><p>文章链接：<a href=https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/ target=_blank>https://www.oomkill.com/2023/09/11-1-ceph-common-cmd/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2023/09/6-1-ceph-rebalance/><span>Ceph重新平衡 - Rebalance</span></a></li><li><a href=/2023/08/acquaintance-stroage/><span>存储概念 - 存储类型对比</span></a></li><li><a href=/2023/07/02-1-install-ceph-with-cephadm/><span>使用cephadm纯离线安装Ceph集群</span></a></li><li><a href=/2023/05/nginx-proxy_pass/><span>踩坑nginx proxy_pass GET 参数传递</span></a></li><li><a href=/2023/05/ngx-in-docker-500/><span>解决nginx在docker中报错 [rewrite or internal redirection cycle while internally redirecting to "/index.html]</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/storage/>Storage</a></li><li><a href=https://www.oomkill.com/tags/troubleshooting/>Troubleshooting</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2023/09/ch26-kube-proxy-clustercidr/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>kube-proxy参数ClusterCIDR做什么</span>
</a><a class=next href=https://www.oomkill.com/2023/09/6-1-ceph-rebalance/><span class=title></span>
<span>Ceph重新平衡 - Rebalance&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/11-1-ceph-common-cmd","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>