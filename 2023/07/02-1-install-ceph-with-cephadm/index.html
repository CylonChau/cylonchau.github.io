<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>使用cephadm纯离线安装Ceph集群 | Cylon&#39;s Collection</title>
<meta name="keywords" content="Install Ceph with cephadm on Centos7, 在Centos7上使用cephadm安装ceph集群, cephadm, ceph">
<meta name="description" content="使用cephadm纯离线安装Ceph集群 - Cylon&#39;s Collection">
<meta name="author" content="cylon">
<link rel="canonical" href="https://www.oomkill.com/2023/07/02-1-install-ceph-with-cephadm/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.41a8706089174fae1769fc26da4d1d354fa88083db604a95688ff58852dd9006.css" integrity="sha256-QahwYIkXT64Xafwm2k0dNU&#43;ogIPbYEqVaI/1iFLdkAY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.oomkill.com/favicon.ico">
<link rel="apple-touch-icon" href="https://www.oomkill.com/apple-touch-icon.png">

<meta name="twitter:title" content="使用cephadm纯离线安装Ceph集群 | Cylon&#39;s Collection" />
<meta name="twitter:description" content="" />
<meta property="og:title" content="使用cephadm纯离线安装Ceph集群 | Cylon&#39;s Collection" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.oomkill.com/2023/07/02-1-install-ceph-with-cephadm/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2023-07-30T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2023-08-25T23:10:36&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.oomkill.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "使用cephadm纯离线安装Ceph集群",
      "item": "https://www.oomkill.com/2023/07/02-1-install-ceph-with-cephadm/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "使用cephadm纯离线安装Ceph集群 | Cylon's Collection",
  "name": "使用cephadm纯离线安装Ceph集群",
  "description": "",
  "keywords": [
    "Install Ceph with cephadm on Centos7", "在Centos7上使用cephadm安装ceph集群", "cephadm", "ceph"
  ],
  "wordCount" : "3090",
  "inLanguage": "zh",
  "datePublished": "2023-07-30T00:00:00Z",
  "dateModified": "2023-08-25T23:10:36+08:00",
  "author":{
    "@type": "Person",
    "name": "cylon"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.oomkill.com/2023/07/02-1-install-ceph-with-cephadm/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cylon's Collection",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.oomkill.com/favicon.ico"
    }
  }
}
</script><script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.oomkill.com" accesskey="h" title="Cylon&#39;s Collection (Alt + H)">Cylon&#39;s Collection</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.oomkill.com/archives/" title="归档"
                >归档
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/tags/" title="标签"
                >标签
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/search/" title="搜索 (Alt &#43; /)"data-no-instant accesskey=/
                >搜索
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/about/" title="关于"
                >关于
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header"><h1 class="post-title">使用cephadm纯离线安装Ceph集群</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2023-07-30</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>Edited on 2023-08-25</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="https://www.oomkill.com/tags/storage/">storage</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>7 分钟</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%bc%80%e7%af%87%e5%b8%b8%e4%be%8b---%e6%a6%82%e8%bf%b0" aria-label="开篇常例 - 概述">开篇常例 - 概述</a></li>
                <li>
                    <a href="#requirements" aria-label="REQUIREMENTS">REQUIREMENTS</a></li>
                <li>
                    <a href="#step-1-%e9%85%8d%e7%bd%ae%e8%8a%82%e7%82%b9" aria-label="Step 1 配置节点">Step 1 配置节点</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%baceph%e7%94%a8%e6%88%b7%e5%8f%af%e9%80%89" aria-label="创建ceph用户(可选)">创建ceph用户(可选)</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e9%85%8d%e7%bd%ae-ntp-%e6%9c%8d%e5%8a%a1%e5%8f%af%e9%80%89" aria-label="安装配置 NTP 服务(可选)">安装配置 NTP 服务(可选)</a></li>
                <li>
                    <a href="#%e5%85%b3%e9%97%ad-selinux" aria-label="关闭 SELInux">关闭 SELInux</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae-hosts-%e6%96%87%e4%bb%b6" aria-label="配置 Hosts 文件">配置 Hosts 文件</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96" aria-label="安装依赖">安装依赖</a></li></ul>
                </li>
                <li>
                    <a href="#step2-%e4%b8%8b%e8%bd%bd-cephadm-%e5%b9%b6-%e4%bf%ae%e6%94%b9-cephadm-%e9%95%9c%e5%83%8f%e5%9c%b0%e5%9d%80" aria-label="Step2 下载 cephadm 并 修改 cephadm 镜像地址">Step2 下载 cephadm 并 修改 cephadm 镜像地址</a><ul>
                        
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96-cephadm-%e8%84%9a%e6%9c%ac" aria-label="获取 cephadm 脚本">获取 cephadm 脚本</a></li>
                <li>
                    <a href="#run-docker-registry" aria-label="Run docker registry">Run docker registry</a></li></ul>
                </li>
                <li>
                    <a href="#step-3-%e5%bc%95%e5%af%bc%e4%b8%80%e4%b8%aa%e6%96%b0%e9%9b%86%e7%be%a4" aria-label="Step 3 引导一个新集群">Step 3 引导一个新集群</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%a7%8b%e5%bc%95%e5%af%bc%e4%b8%80%e4%b8%aa%e6%96%b0%e7%9a%84-ceph-%e9%9b%86%e7%be%a4" aria-label="开始引导一个新的 ceph 集群">开始引导一个新的 ceph 集群</a></li>
                <li>
                    <a href="#%e5%90%91-ceph-%e9%9b%86%e7%be%a4%e5%af%bc%e5%85%a5-osd-node" aria-label="向 ceph 集群导入 osd node">向 ceph 集群导入 osd node</a></li>
                <li>
                    <a href="#troubleshooting" aria-label="Troubleshooting">Troubleshooting</a><ul>
                        
                <li>
                    <a href="#typeerror-__init__-missing-2-required-positional-arguments-hostname-and-addr" aria-label="TypeError: init() missing 2 required positional arguments: &amp;lsquo;hostname&amp;rsquo; and &amp;lsquo;addr&amp;rsquo;">TypeError: <strong>init</strong>() missing 2 required positional arguments: &lsquo;hostname&rsquo; and &lsquo;addr&rsquo;</a></li></ul>
                </li>
                <li>
                    <a href="#reference" aria-label="Reference">Reference</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    





<div class="copyrightTopBlock">
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <div class="articleSuffix-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
</div>
<br><h2 id="开篇常例---概述">开篇常例 - 概述<a hidden class="anchor" aria-hidden="true" href="#开篇常例---概述">¶</a></h2>
<p>Ceph 是一个广泛使用的开源存储平台。  它提供高性能、可靠性和可扩展性。  Ceph 分布式存储系统提供了对象存储、块存储和文件级存储。  Ceph 旨在提供无单点故障的分布式存储系统。</p>
<p>在本教程中，将通过 ceph-adm 方式在 CentOS 7 上安装和构建 Ceph 集群。该实验的 Ceph 集群需要以下 Ceph 组件：</p>
<ul>
<li><strong>Ceph OSD (ceph-osd)</strong>  -  处理数据存储、数据复制和恢复；通常一个Ceph集群至少需要两台 OSD 服务器 。</li>
<li><strong>Ceph Monitor (ceph-mon)</strong>  -  监视集群状态、OSD 映射和 CRUSH 映射，我们在这里与 cephadm 或 OSD 公用一个节点</li>
<li><strong>Ceph 元数据服务器 (ceph-mds)</strong>  -  这是使用 CephFS 所需的组件。</li>
</ul>
<p>有了上面的条件，我们实验环境所需要的节点如下：</p>
<ul>
<li>三台服务器节点，CentOS 7</li>
</ul>
<blockquote>
<p>注：CentOS 7 可安装最高级别的 ceph 版本就是 O 版</p>
</blockquote>
<p>本教程中的服务器将使用以下主机名和 IP 地址：</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>cephadmin</td>
<td>10.0.0.20</td>
<td>作为 ceph 管理节点，以管理与部署 ceph 集群</td>
</tr>
<tr>
<td>osd01</td>
<td>10.0.0.21</td>
<td></td>
</tr>
<tr>
<td>osd02</td>
<td>10.0.0.22</td>
<td></td>
</tr>
<tr>
<td><em>any</em></td>
<td><em>any</em></td>
<td>作为 Ceph Client 的角色</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注：所有 OSD 节点都需要两个分区，一个根（/）分区和一个空分区，稍后用作 Ceph 数据存储。</p>
</blockquote>
<h2 id="requirements">REQUIREMENTS<a hidden class="anchor" aria-hidden="true" href="#requirements">¶</a></h2>
<p>使用 <em>cephadm</em> 安装 ceph 集群，所需要的先决条件如下:</p>
<p>必要条件：</p>
<ul>
<li>Python 3，因为 cephadm 是一个 python3 脚本，所以需要每个节点都需要安装 python3</li>
<li>Systemd</li>
<li>Podman or Docker：cephadm 安装的集群是一种以 “容器方式” 运行在对应的 ceph node 之上</li>
<li>LVM2：ceph OSD 是通过 LVM 来使用的，所以需要在每个 OSD 节点之上安装 LVM2</li>
</ul>
<p>非必要条件：</p>
<ul>
<li>chrony or NTP：ceph 强依赖每个节点之上的时间</li>
<li>Internet</li>
<li>域名解析：ceph 集群对于 ceph node 来说是通过 <code>hostname.random_str</code> 识别的的</li>
</ul>
<h2 id="step-1-配置节点">Step 1 配置节点<a hidden class="anchor" aria-hidden="true" href="#step-1-配置节点">¶</a></h2>
<p>此步骤，将配置所有 3 个节点，为安装 Ceph 集群做好准备。  建议在所有节点上按照并运行以下所有命令。  并确保所有节点上都安装了 ssh-server。</p>
<h3 id="创建ceph用户可选">创建ceph用户(可选)<a hidden class="anchor" aria-hidden="true" href="#创建ceph用户可选">¶</a></h3>
<pre><code class="language-bash">useradd -d /home/cephuser -m cephuser 
echo 1|passwd cephuser --stdin
</code></pre>
<p>创建新用户后，我们需要为“cephuser” 配置 sudo。  他必须能够以 root 身份运行命令并无需密码即可获得 root 权限。</p>
<p>运行以下命令为用户创建  sudoers 文件并使用  sed  编辑 /etc/sudoers 文件。</p>
<pre><code class="language-bash">echo &quot;cephuser ALL = (root) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/cephuser
chmod 0440 /etc/sudoers.d/cephuser
sed -i s'/Defaults requiretty/#Defaults requiretty'/g /etc/sudoers
</code></pre>
<blockquote>
<p>Note：上述 通过 ceph-deploy 需要配置，cephadm 中没有强制</p>
</blockquote>
<h3 id="安装配置-ntp-服务可选">安装配置 NTP 服务(可选)<a hidden class="anchor" aria-hidden="true" href="#安装配置-ntp-服务可选">¶</a></h3>
<p>因为分布式存储需要依赖时间，所以需要对所有 OSD 节点的时间保持一致，这里时间同步的软件可以随意选择，</p>
<pre><code class="language-bash">yum install -y ntp ntpdate ntp-doc
ntpdate 0.us.pool.ntp.org
hwclock --systohc
systemctl enable ntpd.service
systemctl start ntpd.service
</code></pre>
<blockquote>
<p>可以不准备，随意启动一个服务即可，否则安装会出现如下提示</p>
</blockquote>
<pre><code class="language-bash">$ cephadm bootstrap --mon-ip cephadmin

Verifying podman|docker is present...
Verifying lvm2 is present...
Verifying time synchronization is in place...
No time sync service is running; checked for ['chrony.service', 'chronyd.service', 'systemd-timesyncd.service', 'ntpd.service', 'ntp.service', 'ntpsec.service', 'openntpd.service']
Installing packages ['chrony']...
Enabling unit chronyd.service
No time sync service is running; checked for ['chrony.service', 'chronyd.service', 'systemd-timesyncd.service', 'ntpd.service', 'ntp.service', 'ntpsec.service', 'openntpd.service']
Repeating the final host check...
docker (/usr/bin/docker) is present
systemctl is present
lvcreate is present
Unit chronyd.service is enabled and running
Host looks OK
Cluster fsid: 19c90bda-2fb8-11ee-9128-000c293e5d57
Address: cephadmin is not a valid IP address
Verifying IP cephadmin port 3300 ...
Address: cephadmin is not a valid IP address
Verifying IP cephadmin port 6789 ...
Address: cephadmin is not a valid IP address
Cannot infer CIDR network for mon IP `cephadmin` : 'cephadmin' does not appear to be an IPv4 or IPv6 address
Cannot infer CIDR network for mon IP `cephadmin` : 'cephadmin' does not appear to be an IPv4 or IPv6 address
ERROR: Cannot infer CIDR network. Pass --skip-mon-network to configure it later
</code></pre>
<h3 id="关闭-selinux">关闭 SELInux<a hidden class="anchor" aria-hidden="true" href="#关闭-selinux">¶</a></h3>
<p>在所有 Ceph Node 节点上关闭 SELInux，可以根据下面命令使用 sed 操作</p>
<pre><code class="language-bash">sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
</code></pre>
<h3 id="配置-hosts-文件">配置 Hosts 文件<a hidden class="anchor" aria-hidden="true" href="#配置-hosts-文件">¶</a></h3>
<p>这里主机名可以根据自己选择进行，如果你有 DNS 服务，那么也可以通过注册在 DNS 内的服务进行</p>
<pre><code class="language-bash">$ tee &gt;&gt; /etc/hosts &lt;&lt; EOF
10.0.0.20        ceph-octopus-cephadm
10.0.0.21        ceph-octopus-01
10.0.0.22        ceph-octopus-02
EOF
</code></pre>
<h3 id="安装依赖">安装依赖<a hidden class="anchor" aria-hidden="true" href="#安装依赖">¶</a></h3>
<pre><code class="language-bash"># centos 7
yum install -y python3 lvm2 docker-ce
# centos 8
dnf install -y python3 lvm2 podman
</code></pre>
<h2 id="step2-下载-cephadm-并-修改-cephadm-镜像地址">Step2 下载 cephadm 并 修改 cephadm 镜像地址<a hidden class="anchor" aria-hidden="true" href="#step2-下载-cephadm-并-修改-cephadm-镜像地址">¶</a></h2>
<h3 id="获取-cephadm-脚本">获取 cephadm 脚本<a hidden class="anchor" aria-hidden="true" href="#获取-cephadm-脚本">¶</a></h3>
<p>步骤参考了 ceph 官方安装手册 <sup><a href="#1">[1]</a></sup> ，需要注意的是 <em>cephadm</em> 脚本也是需要按照版本来的</p>
<pre><code class="language-bash">curl --silent --remote-name --location https://github.com/ceph/ceph/raw/octopus/src/cephadm/cephadm
chmod +x cephadm
</code></pre>
<p>这个步骤主要是为了使 cephadm 可以正常的拉去 ceph 镜像，你可以通过 <code>docker load</code> 方式导入到 ceph node 之上，但是 ceph 镜像必须通过私有镜像进行拉取（存在 reposig 认证）其他 ceph 组件（prometheus, node-exporter..）可以通过 <code>docker load</code> 导入</p>
<p>cephadm 最上面几行写明了要拉去镜像的镜像仓库地址，可以在有互联网机器上下载好，push 到私有镜像仓库中，如果没有私有镜像仓库，可以 run 一个 docker registry ，这个步骤是强制的；其他组件是可以通过 <code>docker load</code> 方式获得</p>
<pre><code class="language-python">$ head -20 cephadm 
#!/usr/bin/python3

# Default container images -----------------------------------------------------
DEFAULT_IMAGE = 'quay.io/ceph/ceph:v15'
DEFAULT_IMAGE_IS_MASTER = False
DEFAULT_PROMETHEUS_IMAGE = 'quay.io/prometheus/prometheus:v2.18.1'
DEFAULT_NODE_EXPORTER_IMAGE = 'quay.io/prometheus/node-exporter:v0.18.1'
DEFAULT_ALERT_MANAGER_IMAGE = 'quay.io/prometheus/alertmanager:v0.20.0'
DEFAULT_GRAFANA_IMAGE = 'quay.io/ceph/ceph-grafana:6.7.4'
# ------------------------------------------------------------------------------

LATEST_STABLE_RELEASE = 'octopus'
DATA_DIR = '/var/lib/ceph'
LOG_DIR = '/var/log/ceph'
LOCK_DIR = '/run/cephadm'
LOGROTATE_DIR = '/etc/logrotate.d'
UNIT_DIR = '/etc/systemd/system'
LOG_DIR_MODE = 0o770
DATA_DIR_MODE = 0o700
CONTAINER_INIT=False
</code></pre>
<h3 id="run-docker-registry">Run docker registry<a hidden class="anchor" aria-hidden="true" href="#run-docker-registry">¶</a></h3>
<p>拉去 docker registry</p>
<pre><code class="language-bash">docker pull registry
</code></pre>
<p>镜像保存路径放置在当前工作目录中</p>
<blockquote>
<p>Note: 如果你没有独立的私有镜像仓库，那么请保留 docker registry，直到你不对 ceph 集群进行扩展</p>
</blockquote>
<p>执行下面命令，运行 docker registry</p>
<pre><code class="language-bash">docker run \
  --detach \
  --name registry \
  --hostname registry \
  --volume $(pwd)/registry:/var/lib/registry/docker/registry \
  --publish 5000:5000 \
  --restart unless-stopped \
  registry:latest
</code></pre>
<p>在所有 ceph node 之上执行下面命令，需要自行替换 <code>registry_host</code> 部分</p>
<blockquote>
<p>现象：https://xxx:5000/v2/: http: server gave HTTP response to HTTPS client</p>
</blockquote>
<pre><code class="language-bash">tee /etc/docker/daemon.json &lt;&lt; EOF
{
    &quot;insecure-registries&quot;: [&quot;registry_host:5000&quot;]
}
EOF
</code></pre>
<h2 id="step-3-引导一个新集群">Step 3 引导一个新集群<a hidden class="anchor" aria-hidden="true" href="#step-3-引导一个新集群">¶</a></h2>
<p>在上面步骤都完成后，可以直接去引导一个新集群了</p>
<p>可以选择性执行下面步骤</p>
<blockquote>
<p>这里是安装 ceph 客户端时需要用到的，例如 ceph-common, ceph-fuse 都会用到这些</p>
</blockquote>
<pre><code class="language-bash">$ ./cephadm add-repo --release octopus
</code></pre>
<p>cephadm 命令能够：</p>
<ul>
<li>引导一个新集群</li>
<li>使用 ceph cli 启动容器化的 shell</li>
<li>用于调试容器化的 ceph daemon</li>
</ul>
<p>O 版的安装命令是通过 github 下载，要注意的是，每个版本号的 cephadm 命令不通用</p>
<pre><code class="language-bash"># curl --silent --remote-name --location https://github.com/ceph/ceph/raw/pacific/src/cephadm/cephadm
# chmod +x cephadm
# ./cephadm add-repo --release octopus
# install命令旨在将 cephadm 安装到环境变量中
# ./cephadm install 
</code></pre>
<h2 id="开始引导一个新的-ceph-集群">开始引导一个新的 ceph 集群<a hidden class="anchor" aria-hidden="true" href="#开始引导一个新的-ceph-集群">¶</a></h2>
<p>创建 Ceph 集群的第一步是在 Ceph 集群的管理几点上执行命令 <code>cephadm bootstrap</code>，这个命令的行为会创建 Ceph 集群中的第一个 &ldquo;monitor&rdquo; 守护进程，这需要提供一个 “IP地址” 而不可以是 “域名”。</p>
<p>这里将 ceph monitor 部署在管理节点上了，以节省 Node 数量</p>
<pre><code class="language-bash">$ cephadm bootstrap --mon-ip 10.0.0.20

Verifying podman|docker is present...
Verifying lvm2 is present...
Verifying time synchronization is in place...
Unit chronyd.service is enabled and running
Repeating the final host check...
docker (/usr/bin/docker) is present
systemctl is present
lvcreate is present
Unit chronyd.service is enabled and running
Host looks OK
Cluster fsid: 420ccab4-2fb8-11ee-9f5c-000c293e5d57
Verifying IP 10.0.0.20 port 3300 ...
Verifying IP 10.0.0.20 port 6789 ...
Mon IP `10.0.0.20` is in CIDR network `10.0.0.0/24`
Mon IP `10.0.0.20` is in CIDR network `10.0.0.0/24`
Internal network (--cluster-network) has not been provided, OSD replication will default to the public_network
Pulling container image quay.io/ceph/ceph:v17...
Non-zero exit code 1 from /usr/bin/docker pull quay.io/ceph/ceph:v17
/usr/bin/docker: stderr Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
ERROR: Failed command: /usr/bin/docker pull quay.io/ceph/ceph:v17
[root@cephadmin ~]# systemctl start docker 
[root@cephadmin ~]# cephadm bootstrap --mon-ip 10.0.0.20
Verifying podman|docker is present...
Verifying lvm2 is present...
Verifying time synchronization is in place...
Unit chronyd.service is enabled and running
Repeating the final host check...
docker (/usr/bin/docker) is present
systemctl is present
lvcreate is present
Unit chronyd.service is enabled and running
Host looks OK
Cluster fsid: 4d128cbe-2fb8-11ee-8326-000c293e5d57
Verifying IP 10.0.0.20 port 3300 ...
Verifying IP 10.0.0.20 port 6789 ...
Mon IP `10.0.0.20` is in CIDR network `10.0.0.0/24`
Mon IP `10.0.0.20` is in CIDR network `10.0.0.0/24`
Internal network (--cluster-network) has not been provided, OSD replication will default to the public_network
Pulling container image quay.io/ceph/ceph:v17...
Ceph version: ceph version 17.2.6 (d7ff0d10654d2280e08f1ab989c7cdf3064446a5) quincy (stable)
Extracting ceph user uid/gid from container image...
Creating initial keys...
Creating initial monmap...
Creating mon...
Waiting for mon to start...
Waiting for mon...
mon is available
Assimilating anything we can from ceph.conf...
Generating new minimal ceph.conf...
Restarting the monitor...
Setting mon public_network to 10.0.0.0/24
Wrote config to /etc/ceph/ceph.conf
Wrote keyring to /etc/ceph/ceph.client.admin.keyring
Creating mgr...
Verifying port 9283 ...
Waiting for mgr to start...
Waiting for mgr...
mgr not available, waiting (1/15)...
mgr not available, waiting (2/15)...
mgr not available, waiting (3/15)...
mgr not available, waiting (4/15)...
mgr is available
Enabling cephadm module...
Waiting for the mgr to restart...
Waiting for mgr epoch 5...
mgr epoch 5 is available
Setting orchestrator backend to cephadm...
Generating ssh key...
Wrote public SSH key to /etc/ceph/ceph.pub
Adding key to root@localhost authorized_keys...
Adding host cephadmin...
Deploying mon service with default placement...
Deploying mgr service with default placement...
Deploying crash service with default placement...
Deploying prometheus service with default placement...
Deploying grafana service with default placement...
Deploying node-exporter service with default placement...
Deploying alertmanager service with default placement...
Enabling the dashboard module...
Waiting for the mgr to restart...
Waiting for mgr epoch 9...
mgr epoch 9 is available
Generating a dashboard self-signed certificate...
Creating initial admin user...
Fetching dashboard port number...
Ceph Dashboard is now available at:

	     URL: https://cephadmin:8443/
	    User: admin
	Password: eqlf3jh1i1

Enabling client.admin keyring and conf on hosts with &quot;admin&quot; label
Saving cluster configuration to /var/lib/ceph/4d128cbe-2fb8-11ee-8326-000c293e5d57/config directory
Enabling autotune for osd_memory_target
You can access the Ceph CLI as following in case of multi-cluster or non-default config:

	sudo /usr/local/bin/cephadm shell --fsid 4d128cbe-2fb8-11ee-8326-000c293e5d57 -c /etc/ceph/ceph.conf -k /etc/ceph/ceph.client.admin.keyring

Or, if you are only running a single cluster on this host:

	sudo /usr/local/bin/cephadm shell 

Please consider enabling telemetry to help improve Ceph:

	ceph telemetry on

For more information see:

	https://docs.ceph.com/docs/master/mgr/telemetry/

Bootstrap complete.
</code></pre>
<p>成功后会看到 ceph dashboard 的界面，默认密码会输出到控制台，第一次登陆会要求修改默认密码</p>
<p>在安装将生成一个最小的 <code>ceph.conf</code> 仅适用于引导阶段的配置文件，通过进入 mon 容器查看</p>
<pre><code class="language-bash">$ docker exec -it ceph-350494de-d23f-11ea-be85-525400d32681-mon.mon0 cat /etc/ceph/ceph.conf # 
</code></pre>
<h2 id="向-ceph-集群导入-osd-node">向 ceph 集群导入 osd node<a hidden class="anchor" aria-hidden="true" href="#向-ceph-集群导入-osd-node">¶</a></h2>
<p>向每个 node 导入 ssh key，下面的操作是通过进入管理容器执行的</p>
<pre><code class="language-bash">ssh-copy-id -f -i /etc/ceph/ceph.pub root@*&lt;new-host&gt;*
</code></pre>
<p>添加一个主机到 ceph 集群</p>
<pre><code class="language-bash">ceph orch host add *newhost*
</code></pre>
<p>部署一个新的 mon，你可以给新加入的主机打上标签</p>
<pre><code class="language-bash"># ceph orch host label add *&lt;hostname&gt;* mon
ceph orch apply mon *&lt;number-of-monitors&gt;*
</code></pre>
<p>向集群部署新的组件</p>
<pre><code class="language-bash">ceph orch apply mon *&lt;number-of-monitors&gt;*
ceph orch apply mon *&lt;host1,host2,host3,...&gt;*
</code></pre>
<p>部署 osd damon 在新的主机之上</p>
<pre><code class="language-bash">ceph orch daemon add osd *&lt;host&gt;*:*&lt;device-path&gt;*
ceph orch daemon add osd host1:/dev/sdb
</code></pre>
<p>这是可以列出正在管理的服务器 <code>cephadm</code> 使用 <code>host ls</code> 命令：</p>
<pre><code class="language-bash">ceph orch host ls 
</code></pre>
<p>到此，如果你只使用 RDB 块存储，这里已经部署完成了，如果需要选择使用 文件存储 CephFS，或者对象存储 RGW，可以在另外部署相应的组件，部署的组件是根据按需使用进行部署</p>
<p>osd device 命令也可以列出对应的设备</p>
<pre><code class="language-bash">ceph orch device ls 
</code></pre>
<p>在 Ceph 中一切存储的基础都是基于 RADOS 集群</p>
<h2 id="troubleshooting">Troubleshooting<a hidden class="anchor" aria-hidden="true" href="#troubleshooting">¶</a></h2>
<h3 id="typeerror-__init__-missing-2-required-positional-arguments-hostname-and-addr">TypeError: <strong>init</strong>() missing 2 required positional arguments: &lsquo;hostname&rsquo; and &lsquo;addr&rsquo;<a hidden class="anchor" aria-hidden="true" href="#typeerror-__init__-missing-2-required-positional-arguments-hostname-and-addr">¶</a></h3>
<p>现象：实际上输入了 <em>hostname</em> 和 <em>addr</em> 也是出现这个问题</p>
<pre><code class="language-bash">$ ceph orch host add ceph-octopus-01
Error EINVAL: Traceback (most recent call last):
  File &quot;/usr/share/ceph/mgr/mgr_module.py&quot;, line 1756, in _handle_command
    return self.handle_command(inbuf, cmd)
  File &quot;/usr/share/ceph/mgr/orchestrator/_interface.py&quot;, line 171, in handle_command
    return dispatch[cmd['prefix']].call(self, cmd, inbuf)
  File &quot;/usr/share/ceph/mgr/mgr_module.py&quot;, line 462, in call
    return self.func(mgr, **kwargs)
  File &quot;/usr/share/ceph/mgr/orchestrator/_interface.py&quot;, line 107, in &lt;lambda&gt;
    wrapper_copy = lambda *l_args, **l_kwargs: wrapper(*l_args, **l_kwargs)  # noqa: E731
  File &quot;/usr/share/ceph/mgr/orchestrator/_interface.py&quot;, line 96, in wrapper
    return func(*args, **kwargs)
  File &quot;/usr/share/ceph/mgr/orchestrator/module.py&quot;, line 356, in _add_host
    return self._apply_misc([s], False, Format.plain)
  File &quot;/usr/share/ceph/mgr/orchestrator/module.py&quot;, line 1092, in _apply_misc
    raise_if_exception(completion)
  File &quot;/usr/share/ceph/mgr/orchestrator/_interface.py&quot;, line 225, in raise_if_exception
    e = pickle.loads(c.serialized_exception)
TypeError: __init__() missing 2 required positional arguments: 'hostname' and 'addr'
</code></pre>
<p>首先先将公钥分发到对应的 CEPH NODE 之上</p>
<pre><code class="language-bash">export CEPH_HOSTNAME=root@ceph-octopus-01
# 获取公钥
ceph cephadm get-pub-key &gt; /etc/ceph/ceph.pub

# 分发公钥到对应 ceph node
ssh-copy-id -f -i /etc/ceph/ceph.pub ${CEPH_HOSTNAME}

# 尝试使用私钥是否可以连接到 ceph node
ceph cephadm get-ssh-config &gt; ssh_config
ceph config-key get mgr/cephadm/ssh_identity_key &gt; ~/cephadm_private_key
chmod 0600 ~/cephadm_private_key
ssh -F ssh_config -i ~/cephadm_private_key ${CEPH_HOSTNAME}
</code></pre>
<p>我解决的方式：实际上版本不对，更新版本就恢复了</p>
<h2 id="reference">Reference<a hidden class="anchor" aria-hidden="true" href="#reference">¶</a></h2>
<blockquote>
<p><sup id="1">[1]</sup> <a href="https://docs.ceph.com/en/octopus/cephadm/install/#install-cephadm" target="_blank"
   rel="noopener nofollow noreferrer" ><em><strong>install-cephadm</strong></em></a></p>
<p><sup id="2">[2]</sup> <a href="https://ldapwiki.com/wiki/Common%20Object%20Request%20Broker%20Architecture" target="_blank"
   rel="noopener nofollow noreferrer" ><em><strong>Object Request Broker Architecture</strong></em></a></p>
<p><sup id="3">[3]</sup> <a href="https://ldapwiki.com/wiki/Cooperation%20for%20Open%20Systems%20Interconnection%20Networking%20in%20Europe" target="_blank"
   rel="noopener nofollow noreferrer" ><em><strong>Cooperation for Open Systems Interconnection Networking in Europe</strong></em></a></p>
</blockquote>


    
    


<div class="copyrightBlock" >
    <div class="articleSuffix-bg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <p>链接：<a href="https://www.oomkill.com/2023/07/02-1-install-ceph-with-cephadm/" target="_blank">https://www.oomkill.com/2023/07/02-1-install-ceph-with-cephadm/</a></p>
    <p style="margin-bottom: 0px;">版权：本作品采用<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">「署名-非商业性使用-相同方式共享 4.0 国际」</a> 许可协议进行许可。</p>
    </div>
</div>
  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://www.oomkill.com/2023/08/picgo-configure/">
    <span class="title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline>
      </polyline></svg>&nbsp; </span>
    
    <span>picgo &#43; github 给 typora做图床</span>
  </a>
  <a class="next" href="https://www.oomkill.com/2023/07/blackbox_exporter-in-k8s/" >
    <span class="title"> </span>
    
    <span>在 Kubernetes 集群中使用 blackbox exporter监控外部IP&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg></span>
  </a>
</nav>

  </footer>

  
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
  </div>
  
  
  
  
    <div class="comments-separator"></div>
    

<h3 class="relatedContentTitle" >相关阅读</h3>
<ul class="relatedContent">
	
	<li><a href="/2019/06/07-1-cephx/"><span>Ceph安全 - CephX</span></a></li>
	
	<li><a href="/2019/06/01-1-ceph-acquaintance/"><span>Ceph概念 - 初识Ceph</span></a></li>
	
	<li><a href="/2019/06/08-1-ceph-crush/"><span>Ceph算法 - crush</span></a></li>
	
	<li><a href="/2019/06/01-2-cloud-base/"><span>Cloud基础设施 - 初识Ceph</span></a></li>
	
	<li><a href="/2019/11/02-2-install-ceph-with-ceph-deploy/"><span>Ceph集群安装 - ceph-deploy</span></a></li>
	
</ul>

  

  
    
      <div class="comments-separator"></div>
<div class="comments">
    <script>
    function loadComment() {
        let theme = localStorage.getItem('pref-theme') === 'dark' ? 'dark' : 'light';
        let s = document.createElement('script');
        s.src = 'https://giscus.app/client.js';
        s.setAttribute('data-repo', 'cylonchau\/cylonchau.github.io');
        s.setAttribute('data-repo-id', 'R_kgDOIRlNSQ');
        s.setAttribute('data-category', 'Announcements');
        s.setAttribute('data-category-id', 'DIC_kwDOIRlNSc4CXy1U');
        s.setAttribute('data-mapping', 'title');
        s.setAttribute('data-reactions-enabled', '1');
        s.setAttribute('data-emit-metadata', '1');
        s.setAttribute('data-input-position', 'top');
        s.setAttribute('data-lang', 'zh-TW');
        s.setAttribute('data-theme', theme);
        s.setAttribute('crossorigin', 'anonymous');
        s.setAttribute('async', '');
        document.querySelector('div.comments').innerHTML = '';
        document.querySelector('div.comments').appendChild(s);
    }
    loadComment();
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
  <p>
  Copyright
  <span>&copy; 2024 <a href="https://www.oomkill.com">Cylon&#39;s Collection</a></span></p>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> on github-page & Theme
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

<script>
  document.addEventListener('scroll', function (e) {
      const readProgress = document.getElementById("read_progress");
      const scrollHeight = document.documentElement.scrollHeight;
      const clientHeight = document.documentElement.clientHeight;
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
  })
</script>

<script>
  var menu = document.getElementById('menu')
  if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                  behavior: "smooth"
              });
          } else {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
          }
          if (id === "top") {
              history.replaceState(null, null, " ");
          } else {
              history.pushState(null, null, `#${id}`);
          }
      });
  });
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
      } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
      }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.6.0/mermaid.min.js" crossorigin="anonymous"></script>
<script>
    mermaid.init(undefined, '.language-mermaid');
</script>
</body>

</html>
