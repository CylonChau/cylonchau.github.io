<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>StackStorm自动化 - Rules | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="stackstorm,stackstorm action"><meta name=description content='StackStorm 使用 Rules 和 Workflows 来捕获操作模式并进行自动化。rule将 Triggers 映射到 Actions（或 Workflow），应用匹配条件( Criteria)，并将 Triggers payloads 映射到 Actions 的 Input。
注意
rule不按预期工作吗？请查看rule故障排除文档。其中介绍了rule测试、检查执行、记录和故障排除等内容。
Rule 的配置结构 stackstorm 中的 Rule 是以 YAML 格式来定义。以下是 Rule 定义结构以及 “必需”和 “可选” rule 元素的列表：
yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 --- name: "rule_name" # required pack: "examples" # optional description: "Rule description." # optional enabled: true # required trigger: # required type: "trigger_type_ref" criteria: # optional trigger.'><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2023/11/stackstorm-rules/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2023/11/stackstorm-rules/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="StackStorm自动化 - Rules"><meta property="og:description" content='StackStorm 使用 Rules 和 Workflows 来捕获操作模式并进行自动化。rule将 Triggers 映射到 Actions（或 Workflow），应用匹配条件( Criteria)，并将 Triggers payloads 映射到 Actions 的 Input。
注意
rule不按预期工作吗？请查看rule故障排除文档。其中介绍了rule测试、检查执行、记录和故障排除等内容。
Rule 的配置结构 stackstorm 中的 Rule 是以 YAML 格式来定义。以下是 Rule 定义结构以及 “必需”和 “可选” rule 元素的列表：
yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 --- name: "rule_name" # required pack: "examples" # optional description: "Rule description." # optional enabled: true # required trigger: # required type: "trigger_type_ref" criteria: # optional trigger.'><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2023/11/stackstorm-rules/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-22T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="StackStorm自动化 - Rules"><meta name=twitter:description content='StackStorm 使用 Rules 和 Workflows 来捕获操作模式并进行自动化。rule将 Triggers 映射到 Actions（或 Workflow），应用匹配条件( Criteria)，并将 Triggers payloads 映射到 Actions 的 Input。
注意
rule不按预期工作吗？请查看rule故障排除文档。其中介绍了rule测试、检查执行、记录和故障排除等内容。
Rule 的配置结构 stackstorm 中的 Rule 是以 YAML 格式来定义。以下是 Rule 定义结构以及 “必需”和 “可选” rule 元素的列表：
yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 --- name: "rule_name" # required pack: "examples" # optional description: "Rule description." # optional enabled: true # required trigger: # required type: "trigger_type_ref" criteria: # optional trigger.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"StackStorm自动化 - Rules","item":"https://www.oomkill.com/2023/11/stackstorm-rules/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"StackStorm自动化 - Rules","name":"StackStorm自动化 - Rules","description":"StackStorm 使用 Rules 和 Workflows 来捕获操作模式并进行自动化。rule将 Triggers 映射到 Actions（或 Workflow），应用匹配条件( Criteria)，并将 Triggers payloads 映射到 Actions 的 Input。\n注意\nrule不按预期工作吗？请查看rule故障排除文档。其中介绍了rule测试、检查执行、记录和故障排除等内容。\nRule 的配置结构 stackstorm 中的 Rule 是以 YAML 格式来定义。以下是 Rule 定义结构以及 “必需”和 “可选” rule 元素的列表：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 --- name: \u0026#34;rule_name\u0026#34; # required pack: \u0026#34;examples\u0026#34; # optional description: \u0026#34;Rule description.\u0026#34; # optional enabled: true # required trigger: # required type: \u0026#34;trigger_type_ref\u0026#34; criteria: # optional trigger.","keywords":["stackstorm","stackstorm action"],"articleBody":"StackStorm 使用 Rules 和 Workflows 来捕获操作模式并进行自动化。rule将 Triggers 映射到 Actions（或 Workflow），应用匹配条件( Criteria)，并将 Triggers payloads 映射到 Actions 的 Input。\n注意\nrule不按预期工作吗？请查看rule故障排除文档。其中介绍了rule测试、检查执行、记录和故障排除等内容。\nRule 的配置结构 stackstorm 中的 Rule 是以 YAML 格式来定义。以下是 Rule 定义结构以及 “必需”和 “可选” rule 元素的列表：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 --- name: \"rule_name\" # required pack: \"examples\" # optional description: \"Rule description.\" # optional enabled: true # required trigger: # required type: \"trigger_type_ref\" criteria: # optional trigger.payload_parameter_name1: type: \"regex\" pattern : \"^value$\" trigger.payload_parameter_name2: type: \"iequals\" pattern : \"watchevent\" action: # required ref: \"action_ref\" parameters: # optional foo: \"bar\" baz: \"{{ trigger.payload_parameter_1 }}\" 上面 yaml 表示一个通用形式 Rule 包括：\nname: rule 的名称。 pack: rule 所属的 pack。如果未指定 pack，则默认为 default。 description: 对 rule 的描述。 enabled: rule的启用状态（true 或 false）。 trigger: 从传感器发出的要监视的 trigger 的类型，以及可选的与该 trigger 相关的参数。 criteria: 一个可选的条件集，包括： trigger payload 的属性。 criteria 比较的类型。 pattern 与之匹配的模式。 action：当 rule 匹配时要执行的 action，包括： ref: 要执行的引用 (action/workflow) parameters: 要传递给动作 action 的可选参数。 Criteria Criteria 的条件是需要匹配的规则（逻辑运算符 AND），rules 中的 criteria 表达为：\nyaml 1 2 3 4 5 6 7 8 # more variables criteria: trigger.payload_parameter_name1: type: \"regex\" pattern : \"^value$\" trigger.payload_parameter_name2: type: \"iequals\" pattern : \"watchevent\" 通过创建多个独立的 rules （每个 rules 对应一个条件表达式），可以实现逻辑运算符 OR 行为（任何一个条件表达式匹配都会触发 Action 的执行）。\n在这里，type 指定要使用哪个条件比较运算符，而 pattern 指定要传递给运算符函数的模式。在正则表达式情况下，pattern 是一个正则表达式模式， trigger 值需要与之匹配。\n如果 criteria 包含任何特殊字符（如 -），则请使用字典查找格式来指定 criteria 键。在基于 Webhook 的规则中，通常在发布的事件标头中包含这些值：\nyaml 1 2 3 4 criteria: trigger.headers['X-Custom-Header']: type: \"eq\" pattern : \"customvalue\" pattern 值还可以使用 Jinja 变量访问语法引用数据存储的值\nyaml 1 2 3 4 criteria: trigger.payload.build_number: type: \"equals\" pattern : \"{{ st2kv.system.current_build_number }}\" 由于 PyYAML 中已知的已报告问题，“criteria key”必须是唯一的。这在您希望对相同的 trigger 数据应用不同的运算符（例如 contains 和 ncontains）时有时会变得相关，在下面示例中，仅评估条件中的最后一个重复 key。\nyaml 1 2 3 4 5 6 7 8 9 10 criteria: trigger.payload.commit.tags: # 重复的key 忽略 type: ncontains pattern: StackStorm trigger.payload.commit.tags: # 重复的key，需要评估 type: contains pattern: pull request trigger.payload.commit.message: # 唯一key，需要评估 type: ncontains pattern: ST2 在 PyYAML 中，“ncontains” 和 “contains” 是用于规则条件比较的两种不同运算符：\ncontains：表示匹配包含某个特定模式的条件。例如，如果您想要触发某个规则，只要 trigger 数据包含特定的内容，就可以使用 “contains” 运算符。 ncontains：表示匹配不包含某个特定模式的条件。与 “contains” 相反，只有当 trigger 数据不包含指定的内容时，规则才会触发。 另外，作为一种解决方法，可以使用 “criteria tags” 来多次引用相同的 “criteria key” 。“criteria tags” 使 key 变得唯一，并可以为条件提供上下文。要创建 “criteria tags”，请在 “criteria key” 的末尾包含一个 # 符号和一些文本。在评估时，# 和 # 后面的文本将被忽略。例如：trigger.payload.level#upper 和 trigger.payload.level#lower，如下面示例\nyaml 1 2 3 4 5 6 7 8 9 10 criteria: trigger.payload.commit.tags#1: type: ncontains pattern: StackStorm trigger.payload.commit.tags#2: type: contains pattern: pull request trigger.payload.commit.message: type: ncontains pattern: ST2 在这个例子中，由于 “criteria key” 都是唯一的，所有这些条件都将被评估，即使 trigger.payload.commit.tags#1 和 trigger.payload.commit.tags#2 在 trigger 数据中指定了相同的值。使用 “criteria tag” 是为了克服 PyYAML 中 “criteria key” 必须唯一的问题，使得可以在同一 key 上多次引用并且能够指定不同的运算符和模式，从而更灵活地定义规则。\nCriteria Comparison Criteria Comparison 这部分描述了在 Criteria 中可以使用的所有可用运算符。\n运算符 描述 equals 值相等（适用于任意类型的值）。 nequals 值不相等（适用于任意类型的值）。 lessthan trigger 值小于提供的值。 greaterthan trigger 值大于提供的值。 matchwildcard trigger 值与提供的通配符字符串匹配。此运算符支持类似于 Unix shell 的通配符，您可以使用字符如 * 和 ?。对于简单的字符串匹配，此运算符比正则表达式更可取。 regex trigger 值与提供的正则表达式模式匹配。此运算符的行为类似于 re.search('pattern', trigger_value)。 iregex trigger 值与提供的正则表达式模式不区分大小写地匹配。此运算符的行为类似于 re.search('pattern', trigger_value, re.IGNORECASE)。 matchregex trigger 值与提供的正则表达式模式匹配。此运算符已弃用，推荐使用 regex 和 iregex。 iequals 字符串 trigger 值不区分大小写地等于提供的值。 contains trigger 值包含提供的值。请注意， trigger 值可以是字符串或数组（列表）。 ncontains trigger 值不包含提供的值。请注意， trigger 值可以是字符串或数组（列表）。 icontains 字符串 trigger 值不区分大小写地包含提供的值。 incontains 字符串 trigger 值不区分大小写地不包含提供的字符串值。 startswith 字符串 trigger 值的开头与提供的字符串值匹配。 istartswith 字符串 trigger 值的开头与提供的字符串值不区分大小写地匹配。 endswith 字符串 trigger 值的结尾与提供的字符串值匹配。 iendswith 字符串 trigger 值的结尾与提供的字符串值不区分大小写地匹配。 timediff_lt trigger 值与当前时间的时间差小于提供的值。 timediff_gt trigger 值与当前时间的时间差大于提供的值。 exists 在 payload 中存在键。 nexists 在 payload 中不存在键。 inside 触发 payload 在提供的值内部（例如，测试是否“trigger.payload 在 provided_value 中”）。与 contains 的相反操作（其中 contains 会测试“trigger.payload 包含 provided_value”）。 ninside 触发 payload 不在提供的值内部（例如，测试是否 “trigger.payload 不在 provided_value 中”）。与 ncontains 的相反操作（其中 contains 会测试“trigger.payload 不包含 provided_value”）。 search 在触发 payload 中搜索与子条件匹配的数组（列表）。有关更多信息和示例，请参阅高级比较部分。 高级比较运算符 “搜索运算符” 比其他运算符稍微复杂一些。它接受一个额外的条件参数以及应用于搜索列表每个元素的额外嵌套条件。\n条件参数控制搜索运算符如何匹配列表。对于 any 条件，如果 trigger payload 列表中至少有一项匹配所有子条件，搜索运算符将返回成功匹配。对于 all 条件， trigger payload 列表中的每一项都必须与所有子条件匹配，搜索运算符才会返回成功匹配。any2any 条件在任何 payload 项匹配任何条件项时返回成功匹配。最后，all2any 条件在所有 payload 项匹配任何条件项时返回成功匹配。\n以下是使用 “搜索运算符” 和 any 条件的示例条件：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 --- criteria: trigger.issue_fields: type: \"search\" # Controls whether all items in the trigger payload must match the child criteria, # or if any single item matching the child criteria is sufficient condition: any # \u003c- *At least one* item must match all child patterns pattern: # Here our context is each item of the list # All of these patterns must match the item for the item to be considered a match # These are simply other operators applied to each item of the list item.field_name: type: \"equals\" pattern: \"Status\" item.to_value: type: \"equals\" pattern: \"Approved\" 下面内容，这个条件将匹配以下 trigger payload，因为“Status”字段已更改为“Approved”：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 { \"issue_fields\": [ { \"field_type\": \"Custom\", \"field_name\": \"Status\", \"to_value\": \"Approved\" }, { \"field_type\": \"Custom\", \"field_name\": \"Signed off by\", \"to_value\": \"Stanley\" } ] } 以下是另一个示例，其中 condition 参数为 all，在这种情况下，列表中的所有项都必须匹配所有的子模式：\nyaml 1 2 3 4 5 6 7 8 9 --- criteria: trigger.issue_fields: type: \"search\" condition: all # \u003c- *All* items must match all patterns pattern: item.field_type: type: \"equals\" pattern: \"Custom\" 该条件也将与上述 trigger payload 匹配。\n然而，以下 trigger payload 不会与 all 条件匹配，因为 “Summary” 字段不是 “Custom” 字段：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 { \"issue_fields\": [ { \"field_type\": \"Built-in\", \"field_name\": \"Summary\", \"to_value\": \"Lorem Ipsum\" }, { \"field_type\": \"Custom\", \"field_name\": \"Status\", \"to_value\": \"Approved\" }, { \"field_type\": \"Custom\", \"field_name\": \"Signed off by\", \"to_value\": \"Stanley\" } ] } 以下示例是 参数 condition 为 any2any 的示例。在任何 payload 项匹配模式的任何部分的情况下，这将返回 true。此示例使用上面 “condition” 部分中描述的条件标签。\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 --- criteria: trigger.body.data.tank: type: \"search\" condition: any2any pattern: item.chemicalLevel#1: type: \"lessthan\" pattern: 40 item.chemicalLevel#2: type: \"greaterthan\" pattern: 50 Payload\nyaml 1 2 3 4 5 6 7 8 9 10 11 { \"tanks\": [ { \"id\": 1, \"chemicalLevel\": 43 }, { \"id\": 2, \"chemicalLevel\": 55 } ] } 上面示例中，由于第二个 chemicalLevel 值超过了50，因此此条件解析为 true，并且将触发操作，例如向操作员发送通知。如果第二个chemicalLevel 为45，则条件解析为 false，不会发生任何操作。\n以下是条件参数为 all2any 的示例。在所有 payload 都与所有的 condition pattern 匹配的情况下，这将返回 true\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 --- criteria: trigger.body.data.equipment: type: \"search\" condition: all2any pattern: item.latitude.value#1: type: \"lessthan\" pattern: 40 item.latitude.value#2: type: \"greaterthan\" pattern: 50 item.longitude.value#1: type: \"lessthan\" pattern: -100 item.longitude.value#2: type: \"greaterthan\" pattern: -90 payload 如下：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 { \"equipment\": [ { \"latitude\": { \"value\": 43 } \"longitude\": { \"value\": -95 } }, { \"latitude\": { \"value\": 44 } \"longitude\": { \"value\": -96 } } ] } 在这个例子中，所有设备的值都在条件指定的范围内，因此不会执行任何操作。即使将第一个 latitude 设置为 53，仍然不会有任何操作。假设第二个 longitude 值设置为 -106，那么操作将触发，因为所有设备将违反 contition 中的至少一个部分。这可以在最后一个 equipment 离开区域时触发通知。\n单一 payload 模式\n如果 payload 中只需要一个元素，则如果 payload 是字典，则搜索参数仍然可以用于测试规则的条件，例如下面示例，payload 还是和上面相同，但是实际内容不同\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 --- criteria: trigger.body.data: type: \"search\" condition: all2any pattern: item.latitude.value#1: type: \"lessthan\" pattern: 40 item.latitude.value#2: type: \"greaterthan\" pattern: 50 item.longitude.value#1: type: \"lessthan\" pattern: -100 item.longitude.value#2: type: \"greaterthan\" pattern: -90 payload\nyaml 1 2 3 4 5 6 7 8 9 10 { \"data\": { \"latitude\": { \"value\": 43 } \"longitude\": { \"value\": -95 } } } 在使用 single payload 时，all2any 和 any2any 具有相同的结果，因为选择所有与选择任何一件相同。\ncondition 参数 count count_gt count_gte count_lt count_lte any all any2any all2any 搜索运算符的注意事项 首先，它将规则引擎转变为一个 “递归下降解析器”，这可能会降低规则引擎的性能。因此，如果有一个规则必须保持快速响应，不受系统负载影响，建议尽量避免使用 “搜索运算符”。\n其次，“搜索运算符” 的认知复杂性使其一眼难以理解。如果你与他人共享代码，可能需要详细记录规则和模式，以更清晰地解释你的意图。\n最后，“搜索运算符” 的算法复杂性与其他运算符大不相同，下面是算法的复杂度：\nO($n_{patterns}$) 是指 $n_{patterns}$，即子模式的数量。这表示算法的运行时间（复杂度）与子模式的数量成正比。当子模式数量增加时，运行时间也会相应增加。 O($n_{payloads}$) 是指 $n_{payloads}$，即 “trigger payload” 字段的数量。同样，这表示算法的运行时间与 “trigger payload” 字段的数量成正比。增加 “trigger payload” 字段的数量也会导致运行时间增加。 其中，O 表示的是算法的渐进复杂度，即算法的运行时间与输入规模的增长关系。因此，如果有大量 “子条件” 或者在 “trigger payload” 中搜索长列表，使用搜索运算符很容易编写出慢规则。\n总结：使用 “搜索运算符” 应主要限制在尝试匹配 “少量的子条件” 和 ”少量预期 payload“ 列表项的情况下。尽管搜索运算符可能使规则引擎变慢，但与无条件运行工作流并在那里进行过滤相比，在规则中使用搜索运算符仍然更快且更轻量。\n在Rule中配置Actions的执行 这一部分描述了在 ”tigger“ 成功匹配并满足一组可选条件时要执行的后续 ”actions/workflows“。至少，Rules 应指定要执行的 Actions。Rules 还可以指定在执行 Actions 时提供给 Actions 的参数。\n下面是一个 Actions 的示例\nyaml 1 2 3 4 5 action: # required ref: \"action_ref\" parameters: # optional foo: \"bar\" baz: 1 偶尔情况下，在规则 Rules 时，将 Tigger 的上下文传递给 Actions 可能是必要的。 Rule 引擎能够通过利用 Jinja 模板语法插值变量。如下所示：\nyaml 1 2 3 4 5 action: ref: \"action_ref\" parameters: foo: \"bar\" baz: \"{{ trigger.payload_parameter_1 }}\" 触发器属性的值可以是 null 和 None。这也是相关 Actions 参数的有效值。您需要使用 use_none Jinja 模板过滤器，以确保在调用操作时正确序列化 null/None 值。\nyaml 1 2 3 4 5 action: ref: \"action_ref\" parameters: foo: \"bar\" baz: \"{{ trigger.payload_parameter_1 | use_none }}\" Notes: 当使用 Jinja 模板插值时，null 或 None 的值可能会导致一些序列化问题。使用 “use_none” 过滤器可以帮助规避这些问题，确保 null 或 None 值在序列化时被正确处理。\n由于当前的 Jinja 模板系统不支持非字符串类型，因此需要此解决方法。在调用操作之前，我们被迫根据操作参数定义执行类型转换。\nRules 的管理 添加rule 如果只为了部署部署一条 rule，可以使用 st2 命令：st2 rule create ${PATH_TO_RULE}，例如：\nbash 1 st2 rule create /usr/share/doc/st2/examples/rules/sample_rule_with_webhook.yaml 完成后记得要重新加载所有规则，请使用 st2ctl reload --register-rules\n如果 rule name 已经存在将会出现下面的提示：\nyaml 1 2 ERROR: 409 Client Error: Conflict MESSAGE: Tried to save duplicate unique keys (E11000 duplicate key error index: st2.rule_d_b.$uid_1 dup key: { : \"rule:examples:sample_rule_with_webhook\" }) 更新rule 要更新一条规则，编辑规则定义文件并运行命令：st2 rule update，如下例所示：\nbash 1 st2 rule update examples.sample_rule_with_webhook /usr/share/doc/st2/examples/rules/sample_rule_with_webhook.yaml 获取rule 要查看所有规则或获取单个规则，请使用以下命令：\nbash 1 2 st2 rule list st2 rule get examples.sample_rule_with_webhook 要取消部署一条规则，运行命令：st2 rule delete ${RULE_NAME_OR_ID}。例如，要取消部署之前部署的名为 examples.sample_rule_with_webhook 的规则，运行：\nbash 1 st2 rule delete examples.sample_rule_with_webhook rule的放置位置 自定义规则可以放置在本地系统上的任何可访问文件夹中。自定义规则通常放置在 /opt/stackstorm/packs//rules 目录中。\n测试rule 为了更方便地测试规则，我们提供了一个 st2-rule-tester 工具，它可以在不运行任何 StackStorm 组件的情况下评估规则与触发器实例的匹配。\n该工具通过接受包含规则定义的文件路径和包含触发器实例定义的文件路径来实现：\nbash 1 2 st2-rule-tester --rule=${RULE_FILE} --trigger-instance=${TRIGGER_INSTANCE_DEFINITION} --config-file=/etc/st2/st2.conf echo $? 两个文件都需要以YAML或JSON格式包含定义。对于规则，您可以使用计划部署的相同文件。\n对于触发器实例，定义文件需要包含以下键：\ntrigger：触发器的完整引用（例如，core.st2.IntervalTimer，slack.message，irc.pubmsg，twitter.matched_tweet等）。 payload：Trigger payload。负载本身是特定于所讨论触发器的。要了解触发器结构，您可以查看包的 README 或查找位于 packs//sensors/ 目录中的 sensor 元数据文件中的 trigger_types 部分。 如果触发器实例匹配，将打印 === RULE MATCHES === 并且该工具将以 0 的状态代码退出。如果规则不匹配，将打印 === RULE DOES NOT MATCH === 并且该工具将以 1 的状态代码退出。\n以下是如何使用该工具的一些示例：\nrule.yaml\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 --- name: \"relayed_matched_irc_message\" pack: \"irc\" description: \"Relay IRC message to Slack if the message contains word StackStorm\" enabled: true trigger: type: \"irc.pubmsg\" parameters: {} criteria: trigger.message: # 触发器的message值 type: \"icontains\" # 不区分大小写包含 pattern 的值 pattern: \"StackStorm\" action: ref: \"slack.post_message\" parameters: message: \"{{ trigger.source.nick }} on {{ trigger.channel }}: {{ trigger.message }}\" channel: \"#irc-relay\" trigger_instance_1.yaml :\nyaml 1 2 3 4 5 6 7 8 9 --- trigger: \"irc.pubmsg\" payload: source: nick: \"Kami_\" host: \"gateway/web/irccloud.com/x-uvv\" channel: \"#stackstorm\" timestamp: 1419166748, message: \"stackstorm is cool!\" trigger_instance_2.yaml\nyaml 1 2 3 4 5 6 7 8 9 --- trigger: \"irc.pubmsg\" payload: source: nick: \"Kami_\" host: \"gateway/web/irccloud.com/x-uvv\" channel: \"#stackstorm\" timestamp: 1419166748, message: \"blah blah\" 下面使用 trigger_instance_1 来评估rules\nbash 1 2 st2-rule-tester --rule=./my_rule.yaml --trigger-instance=./trigger_instance_1.yaml echo $? trigger_instance_1 输出的结果为\nbash 1 2 3 4 5 2015-12-11 14:35:03,249 INFO [-] Connecting to database \"st2\" @ \"0.0.0.0:27017\" as user \"None\". 2015-12-11 14:35:03,318 INFO [-] Validating rule irc.relayed_matched_irc_message for pubmsg. 2015-12-11 14:35:03,331 INFO [-] 1 rule(s) found to enforce for pubmsg. 2015-12-11 14:35:03,333 INFO [-] === RULE MATCHES === 0 使用 trigger_instance_2 来评估rules\ntext 1 2 st2-rule-tester --rule=./my_rule.yaml --trigger-instance=./trigger_instance_2.yaml echo $? trigger_instance_2 输出的结果为\nbash 1 2 3 4 5 6 7 8 9 10 2015-12-11 14:35:57,380 INFO [-] Connecting to database \"st2\" @ \"0.0.0.0:27017\" as user \"None\". 2015-12-11 14:35:57,444 INFO [-] Validating rule irc.relayed_matched_irc_message for pubmsg. 2015-12-11 14:35:57,459 INFO [-] Validation for rule irc.relayed_matched_irc_message failed on - key: trigger.message pattern: StackStorm type: icontains payload: blah blah 2015-12-11 14:35:57,461 INFO [-] 0 rule(s) found to enforce for pubmsg. 2015-12-11 14:35:57,462 INFO [-] === RULE DOES NOT MATCH === 1 st2-rule-tester 进一步提供了一种事后调试的方式，您可以回答一个问题：“为什么我的 Rule 没有与刚刚触发的 Trigger 匹配？” 这表示着已经在 StackStorm 中加载了一个已知引用的 rule，类似地，还有一个带有已知 ID 的 Trigger Instance。\n假设我们有规则引用为 my_pack.fire_on_execution 和 Trigger 实例 ID 为 566b4be632ed352a09cd347d：\nbash 1 2 st2-rule-tester --rule-ref=my_pack.fire_on_execution --trigger-instance-id=566b4be632ed352a09cd347d --config-file=/etc/st2/st2.conf echo $? 输出结果为\nbash 1 2 3 4 5 6 7 8 9 2015-12-11 15:24:16,459 INFO [-] Connecting to database \"st2\" @ \"0.0.0.0:27017\" as user \"None\". 2015-12-11 15:24:16,527 INFO [-] Validating rule my_pack.fire_on_execution for st2.generic.actiontrigger. 2015-12-11 15:24:16,542 INFO [-] Validation for rule my_pack.fire_on_execution failed on - key: trigger.status pattern: succeeded type: iequals payload: failed 2015-12-11 15:24:16,545 INFO [-] 0 rule(s) found to enforce for st2.generic.actiontrigger. 2015-12-11 15:24:16,546 INFO [-] === RULE DOES NOT MATCH === 输出还标识了不匹配的来源，即是 Trigger 类型不匹配还是其中一个条件不匹配。\n如果您正在调试并想要查看发送到 StackStorm 的 Trigger 实例列表，可以使用下面命令：\nbash 1 st2 trigger-instance list 还可以按触发器进行触发器实例的过滤：\nbash 1 st2 trigger-instance list --trigger=core.f9e09284-b2b1-4127-aedd-dcde7a752819 此外，还可以通过使用 timestamp_gt 和 timestamp_lt 过滤选项，在时间范围内获取触发器实例：\nbash 1 st2 trigger-instance list --trigger=\"core.f9e09284-b2b1-4127-aedd-dcde7a752819\" -timestamp_gt=2015-06-01T12:00:00Z -timestamp_lt=2015-06-02T12:00:00Z 请注意，您还可以指定其中一个 timestamp_lt 或 timestamp_gt。您可以使用 get 命令获取有关触发器实例的详细信息：\nbash 1 st2 trigger-instance get 556e135232ed35569ff23238 在调试规则时可能很有用的一项功能是将触发器实例重新发送到 StackStorm。您可以使用 re-emit 命令来实现这一点。\nbash 1 st2 trigger-instance re-emit 556e135232ed35569ff23238 定时器 - timers 定时器 (Timers) 允许基于定义的时间间隔重复运行特定操作，或在特定日期和时间运行。您可以将它们视为 cron 作业，但具有更多的灵活性，例如仅在提供的日期和时间运行操作一次的能力。\n目前，我们支持以下定时器触发器类型：\ncore.st2.IntervalTimer ：在预定义的时间间隔（例如每30秒，每24小时，每周等）运行一个操作。 core.st2.DateTimer ：在指定的日期和时间运行一个操作。 core.st2.CronTimer ：当前时间匹配在UNIX cron格式中定义的时间约束时运行一个操作。 定时器被实现为 Trigger，这意味着您可以在 Rule 中使用它们。在下面的部分中，您可以找到如何在规则定义中使用定时器的一些示例。\ncore.st2.IntervalTimer 使用示例 可用的参数有：unit 和 delta。\n对于 unit 参数，支持的值包括：seconds、minutes、hours、days、weeks。\n每30秒运行一次Action yaml 1 2 3 4 5 6 7 8 9 10 11 --- ... trigger: type: \"core.st2.IntervalTimer\" parameters: unit: \"seconds\" delta: 30 action: ... 每24小时运行一次Action yaml 1 2 3 4 5 6 7 8 9 10 11 --- ... trigger: type: \"core.st2.IntervalTimer\" parameters: unit: \"hours\" delta: 24 action: ... 每2星期运行一次Action yaml 1 2 3 4 5 6 7 8 9 10 11 --- ... trigger: type: \"core.st2.IntervalTimer\" parameters: unit: \"weeks\" delta: 2 action: ... core.st2.DateTimer 可用参数 timezone, date.\n在指定时间运行 action\nyaml 1 2 3 4 5 6 7 8 9 10 11 --- ... trigger: type: \"core.st2.DateTimer\" parameters: timezone: \"UTC\" date: \"2014-12-31 23:59:59\" action: ... core.st2.CronTimer 此定时器支持类似 cron 的表达式。\n默认情况下，如果没有为特定参数提供值，则假定为 *，这意味着在每个值上触发。\n可用参数 timezone, year, month, day, week, day_of_week, hour, minute, second，注意，时区(timezone ) 使用 pytz 格式 例如 Asia/Shanghai.\n每周日午夜运行action yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 --- ... trigger: type: \"core.st2.CronTimer\" parameters: timezone: \"UTC\" day_of_week: 6 # or day_of_week: \"sun\" hour: 0 minute: 0 second: 0 action: ... 每天午夜运行action yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 --- ... trigger: type: \"core.st2.CronTimer\" parameters: timezone: \"UTC\" day_of_week: \"*\" hour: 0 minute: 0 second: 0 action: ... 如上所述，如果没有为特定参数提供值，则假定为 *，这意味着以下内容等效于上述内容：\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 --- ... trigger: type: \"core.st2.CronTimer\" parameters: timezone: \"UTC\" hour: 0 minute: 0 second: 0 action: ... 周一到周五每天午夜执行，但周六日不执行 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 --- ... trigger: type: \"core.st2.CronTimer\" parameters: timezone: \"UTC\" day_of_week: \"mon-fri\" hour: 0 minute: 0 second: 0 action: ... 每小时执行一次 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 --- ... trigger: type: \"core.st2.CronTimer\" parameters: timezone: \"UTC\" hour: \"*\" minute: 0 second: 0 action: ... 故障排除 rules 不如预期那样工作？或者只是想看看哪些 rules 已经生效？\n运行 st2 rule-enforcement list 以查看所有 rules 执行。您可以通过规则对此输出进行过滤以缩小范围。\n","wordCount":"2136","inLanguage":"zh","datePublished":"2023-11-25T00:00:00Z","dateModified":"2024-03-22T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2023/11/stackstorm-rules/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">StackStorm自动化 - Rules</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-11-25</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>2136 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>11 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/automation/>#Automation</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#rule-%e7%9a%84%e9%85%8d%e7%bd%ae%e7%bb%93%e6%9e%84 aria-label="Rule 的配置结构">Rule 的配置结构</a><li><a href=#criteria aria-label=Criteria>Criteria</a><li><a href=#criteria-comparison aria-label="Criteria Comparison">Criteria Comparison</a><li><a href=#%e9%ab%98%e7%ba%a7%e6%af%94%e8%be%83%e8%bf%90%e7%ae%97%e7%ac%a6 aria-label=高级比较运算符>高级比较运算符</a><ul><li><a href=#condition-%e5%8f%82%e6%95%b0 aria-label="condition 参数">condition 参数</a><li><a href=#%e6%90%9c%e7%b4%a2%e8%bf%90%e7%ae%97%e7%ac%a6%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label=搜索运算符的注意事项>搜索运算符的注意事项</a></ul><li><a href=#%e5%9c%a8rule%e4%b8%ad%e9%85%8d%e7%bd%aeactions%e7%9a%84%e6%89%a7%e8%a1%8c aria-label=在Rule中配置Actions的执行>在Rule中配置Actions的执行</a><li><a href=#rules-%e7%9a%84%e7%ae%a1%e7%90%86 aria-label="Rules 的管理">Rules 的管理</a><ul><li><a href=#%e6%b7%bb%e5%8a%a0rule aria-label=添加rule>添加rule</a><li><a href=#%e6%9b%b4%e6%96%b0rule aria-label=更新rule>更新rule</a><li><a href=#%e8%8e%b7%e5%8f%96rule aria-label=获取rule>获取rule</a><li><a href=#rule%e7%9a%84%e6%94%be%e7%bd%ae%e4%bd%8d%e7%bd%ae aria-label=rule的放置位置>rule的放置位置</a><li><a href=#%e6%b5%8b%e8%af%95rule aria-label=测试rule>测试rule</a></ul><li><a href=#%e5%ae%9a%e6%97%b6%e5%99%a8---timers aria-label="定时器 - timers">定时器 - timers</a><ul><li><a href=#corest2intervaltimer-%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b aria-label="core.st2.IntervalTimer 使用示例">core.st2.IntervalTimer 使用示例</a><ul><li><a href=#%e6%af%8f30%e7%a7%92%e8%bf%90%e8%a1%8c%e4%b8%80%e6%ac%a1action aria-label=每30秒运行一次Action>每30秒运行一次Action</a><li><a href=#%e6%af%8f24%e5%b0%8f%e6%97%b6%e8%bf%90%e8%a1%8c%e4%b8%80%e6%ac%a1action aria-label=每24小时运行一次Action>每24小时运行一次Action</a><li><a href=#%e6%af%8f2%e6%98%9f%e6%9c%9f%e8%bf%90%e8%a1%8c%e4%b8%80%e6%ac%a1action aria-label=每2星期运行一次Action>每2星期运行一次Action</a></ul><li><a href=#corest2datetimer aria-label=core.st2.DateTimer>core.st2.DateTimer</a><li><a href=#corest2crontimer aria-label=core.st2.CronTimer>core.st2.CronTimer</a><ul><li><a href=#%e6%af%8f%e5%91%a8%e6%97%a5%e5%8d%88%e5%a4%9c%e8%bf%90%e8%a1%8caction aria-label=每周日午夜运行action>每周日午夜运行action</a><li><a href=#%e6%af%8f%e5%a4%a9%e5%8d%88%e5%a4%9c%e8%bf%90%e8%a1%8caction aria-label=每天午夜运行action>每天午夜运行action</a><li><a href=#%e5%91%a8%e4%b8%80%e5%88%b0%e5%91%a8%e4%ba%94%e6%af%8f%e5%a4%a9%e5%8d%88%e5%a4%9c%e6%89%a7%e8%a1%8c%e4%bd%86%e5%91%a8%e5%85%ad%e6%97%a5%e4%b8%8d%e6%89%a7%e8%a1%8c aria-label=周一到周五每天午夜执行，但周六日不执行>周一到周五每天午夜执行，但周六日不执行</a><li><a href=#%e6%af%8f%e5%b0%8f%e6%97%b6%e6%89%a7%e8%a1%8c%e4%b8%80%e6%ac%a1 aria-label=每小时执行一次>每小时执行一次</a></ul></ul><li><a href=#%e6%95%85%e9%9a%9c%e6%8e%92%e9%99%a4 aria-label=故障排除>故障排除</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><p>StackStorm 使用 Rules 和 Workflows 来捕获操作模式并进行自动化。rule将 Triggers 映射到 Actions（或 Workflow），应用匹配条件( Criteria)，并将 Triggers payloads 映射到 Actions 的 Input。</p><p>注意</p><p>rule不按预期工作吗？请查看rule故障排除文档。其中介绍了rule测试、检查执行、记录和故障排除等内容。</p><h2 id=rule-的配置结构>Rule 的配置结构<a hidden class=anchor aria-hidden=true href=#rule-的配置结构>#</a></h2><p>stackstorm 中的 Rule 是以 YAML 格式来定义。以下是 Rule 定义结构以及 “必需”和 “可选” rule 元素的列表：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;rule_name&#34;</span><span class=w>                      </span><span class=c># required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pack</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;examples&#34;</span><span class=w>                       </span><span class=c># optional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Rule description.&#34;</span><span class=w>       </span><span class=c># optional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                          </span><span class=c># required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w>                               </span><span class=c># required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;trigger_type_ref&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>criteria</span><span class=p>:</span><span class=w>                              </span><span class=c># optional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>trigger.payload_parameter_name1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;regex&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>pattern </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;^value$&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>trigger.payload_parameter_name2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;iequals&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>pattern </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;watchevent&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w>                                </span><span class=c># required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;action_ref&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>parameters</span><span class=p>:</span><span class=w>                        </span><span class=c># optional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>foo</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;bar&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>baz</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ trigger.payload_parameter_1 }}&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>上面 yaml 表示一个通用形式 Rule 包括：</p><ul><li><em>name</em>: rule 的名称。</li><li><em>pack</em>: rule 所属的 pack。如果未指定 pack，则默认为 default。</li><li><em>description</em>: 对 rule 的描述。<ul><li><em>enabled</em>: rule的启用状态（true 或 false）。</li></ul></li><li><em>trigger</em>: 从传感器发出的要监视的 trigger 的类型，以及可选的与该 trigger 相关的参数。</li><li><em>criteria</em>: 一个可选的条件集，包括：<ul><li>trigger payload 的属性。</li><li>criteria 比较的类型。</li><li><em>pattern</em> 与之匹配的模式。</li></ul></li><li><em>action</em>：当 rule 匹配时要执行的 action，包括：<ul><li><em>ref</em>: 要执行的引用 (action/workflow)</li><li><em>parameters</em>: 要传递给动作 action 的可选参数。</li></ul></li></ul><h2 id=criteria>Criteria<a hidden class=anchor aria-hidden=true href=#criteria>#</a></h2><p>Criteria 的条件是需要匹配的规则（逻辑运算符 AND），rules 中的 criteria 表达为：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># more variables</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload_parameter_name1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;regex&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;^value$&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload_parameter_name2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;iequals&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;watchevent&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>通过创建多个独立的 rules （每个 rules 对应一个条件表达式），可以实现逻辑运算符 OR 行为（任何一个条件表达式匹配都会触发 Action 的执行）。</p><p>在这里，<em>type</em> 指定要使用哪个条件比较运算符，而 <em>pattern</em> 指定要传递给运算符函数的模式。在正则表达式情况下，pattern 是一个正则表达式模式， trigger 值需要与之匹配。</p><p>如果 <em>criteria</em> 包含任何特殊字符（如 <code>-</code>），则请使用字典查找格式来指定 criteria 键。在基于 Webhook 的规则中，通常在发布的事件标头中包含这些值：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.headers[&#39;X-Custom-Header&#39;]</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;eq&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;customvalue&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>pattern 值还可以使用 Jinja 变量访问语法引用数据存储的值</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.build_number</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;equals&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ st2kv.system.current_build_number }}&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>由于 PyYAML 中已知的已报告问题，“criteria key”必须是唯一的。这在您希望对相同的 trigger 数据应用不同的运算符（例如 contains 和 ncontains）时有时会变得相关，在下面示例中，仅评估条件中的最后一个重复 key。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.commit.tags</span><span class=p>:</span><span class=w>  </span><span class=c># 重复的key 忽略</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ncontains</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>StackStorm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.commit.tags</span><span class=p>:</span><span class=w>  </span><span class=c># 重复的key，需要评估</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>contains</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>pull request</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.commit.message</span><span class=p>:</span><span class=w>  </span><span class=c># 唯一key，需要评估</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ncontains</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>ST2</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p>在 PyYAML 中，&ldquo;ncontains&rdquo; 和 &ldquo;contains&rdquo; 是用于规则条件比较的两种不同运算符：</p><ul><li><strong>contains</strong>：表示匹配包含某个特定模式的条件。例如，如果您想要触发某个规则，只要 trigger 数据包含特定的内容，就可以使用 &ldquo;contains&rdquo; 运算符。</li><li><strong>ncontains</strong>：表示匹配不包含某个特定模式的条件。与 &ldquo;contains&rdquo; 相反，只有当 trigger 数据不包含指定的内容时，规则才会触发。</li></ul></blockquote><p>另外，作为一种解决方法，可以使用 “criteria tags” 来多次引用相同的 “criteria key” 。“criteria tags” 使 key 变得唯一，并可以为条件提供上下文。要创建 “criteria tags”，请在 “criteria key” 的末尾包含一个 <code>#</code> 符号和一些文本。在评估时，# 和 # 后面的文本将被忽略。例如：<code>trigger.payload.level#upper</code> 和 <code>trigger.payload.level#lower</code>，如下面示例</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.commit.tags#1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ncontains</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>StackStorm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.commit.tags#2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>contains</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>pull request</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger.payload.commit.message</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ncontains</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>ST2</span></span></span></code></pre></td></tr></table></div></div></div></div><p>在这个例子中，由于 “criteria key” 都是唯一的，所有这些条件都将被评估，即使 <code>trigger.payload.commit.tags#1</code> 和 <code>trigger.payload.commit.tags#2</code> 在 trigger 数据中指定了相同的值。使用 “criteria tag” 是为了克服 PyYAML 中 “criteria key” 必须唯一的问题，使得可以在同一 key 上多次引用并且能够指定不同的运算符和模式，从而更灵活地定义规则。</p><h2 id=criteria-comparison>Criteria Comparison<a hidden class=anchor aria-hidden=true href=#criteria-comparison>#</a></h2><p>Criteria Comparison 这部分描述了在 Criteria 中可以使用的所有可用运算符。</p><table><thead><tr><th>运算符</th><th>描述</th></tr></thead><tbody><tr><td>equals</td><td>值相等（适用于任意类型的值）。</td></tr><tr><td>nequals</td><td>值不相等（适用于任意类型的值）。</td></tr><tr><td>lessthan</td><td>trigger 值小于提供的值。</td></tr><tr><td>greaterthan</td><td>trigger 值大于提供的值。</td></tr><tr><td>matchwildcard</td><td>trigger 值与提供的通配符字符串匹配。此运算符支持类似于 Unix shell 的通配符，您可以使用字符如 * 和 ?。对于简单的字符串匹配，此运算符比正则表达式更可取。</td></tr><tr><td>regex</td><td>trigger 值与提供的正则表达式模式匹配。此运算符的行为类似于 <code>re.search('pattern', trigger_value)</code>。</td></tr><tr><td>iregex</td><td>trigger 值与提供的正则表达式模式不区分大小写地匹配。此运算符的行为类似于 <code>re.search('pattern', trigger_value, re.IGNORECASE)</code>。</td></tr><tr><td>matchregex</td><td>trigger 值与提供的正则表达式模式匹配。此运算符已弃用，推荐使用 regex 和 iregex。</td></tr><tr><td>iequals</td><td>字符串 trigger 值不区分大小写地等于提供的值。</td></tr><tr><td>contains</td><td>trigger 值包含提供的值。请注意， trigger 值可以是字符串或数组（列表）。</td></tr><tr><td>ncontains</td><td>trigger 值不包含提供的值。请注意， trigger 值可以是字符串或数组（列表）。</td></tr><tr><td>icontains</td><td>字符串 trigger 值不区分大小写地包含提供的值。</td></tr><tr><td>incontains</td><td>字符串 trigger 值不区分大小写地不包含提供的字符串值。</td></tr><tr><td>startswith</td><td>字符串 trigger 值的开头与提供的字符串值匹配。</td></tr><tr><td>istartswith</td><td>字符串 trigger 值的开头与提供的字符串值不区分大小写地匹配。</td></tr><tr><td>endswith</td><td>字符串 trigger 值的结尾与提供的字符串值匹配。</td></tr><tr><td>iendswith</td><td>字符串 trigger 值的结尾与提供的字符串值不区分大小写地匹配。</td></tr><tr><td>timediff_lt</td><td>trigger 值与当前时间的时间差小于提供的值。</td></tr><tr><td>timediff_gt</td><td>trigger 值与当前时间的时间差大于提供的值。</td></tr><tr><td>exists</td><td>在 payload 中存在键。</td></tr><tr><td>nexists</td><td>在 payload 中不存在键。</td></tr><tr><td>inside</td><td>触发 payload 在提供的值内部（例如，测试是否“trigger.payload 在 provided_value 中”）。与 contains 的相反操作（其中 contains 会测试“trigger.payload 包含 provided_value”）。</td></tr><tr><td>ninside</td><td>触发 payload 不在提供的值内部（例如，测试是否 “trigger.payload 不在 provided_value 中”）。与 ncontains 的相反操作（其中 contains 会测试“trigger.payload 不包含 provided_value”）。</td></tr><tr><td>search</td><td>在触发 payload 中搜索与子条件匹配的数组（列表）。有关更多信息和示例，请参阅高级比较部分。</td></tr></tbody></table><h2 id=高级比较运算符>高级比较运算符<a hidden class=anchor aria-hidden=true href=#高级比较运算符>#</a></h2><p>“搜索运算符” 比其他运算符稍微复杂一些。它接受一个额外的条件参数以及应用于搜索列表每个元素的额外嵌套条件。</p><p>条件参数控制搜索运算符如何匹配列表。对于 any 条件，如果 trigger payload 列表中至少有一项匹配所有子条件，搜索运算符将返回成功匹配。对于 all 条件， trigger payload 列表中的每一项都必须与所有子条件匹配，搜索运算符才会返回成功匹配。any2any 条件在任何 payload 项匹配任何条件项时返回成功匹配。最后，all2any 条件在所有 payload 项匹配任何条件项时返回成功匹配。</p><p>以下是使用 “搜索运算符” 和 any 条件的示例条件：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger.issue_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;search&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Controls whether all items in the trigger payload must match the child criteria,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># or if any single item matching the child criteria is sufficient</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>any </span><span class=w> </span><span class=c># &lt;- *At least one* item must match all child patterns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Here our context is each item of the list</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># All of these patterns must match the item for the item to be considered a match</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># These are simply other operators applied to each item of the list</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.field_name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;equals&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Status&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.to_value</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;equals&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Approved&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>下面内容，这个条件将匹配以下 trigger payload，因为“Status”字段已更改为“Approved”：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;issue_fields&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_type&#34;: </span><span class=s2>&#34;Custom&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_name&#34;: </span><span class=s2>&#34;Status&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;to_value&#34;: </span><span class=s2>&#34;Approved&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w> </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_type&#34;: </span><span class=s2>&#34;Custom&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_name&#34;: </span><span class=s2>&#34;Signed off by&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;to_value&#34;: </span><span class=s2>&#34;Stanley&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></td></tr></table></div></div></div></div><p>以下是另一个示例，其中 <code>condition</code> 参数为 all，在这种情况下，列表中的所有项都必须匹配所有的子模式：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger.issue_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;search&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>all </span><span class=w> </span><span class=c># &lt;- *All* items must match all patterns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pattern</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>item.field_type</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;equals&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Custom&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>该条件也将与上述 trigger payload 匹配。</p><p>然而，以下 trigger payload 不会与 all 条件匹配，因为 “Summary” 字段不是 &ldquo;Custom&rdquo; 字段：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;issue_fields&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_type&#34;: </span><span class=s2>&#34;Built-in&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_name&#34;: </span><span class=s2>&#34;Summary&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;to_value&#34;: </span><span class=s2>&#34;Lorem Ipsum&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_type&#34;: </span><span class=s2>&#34;Custom&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_name&#34;: </span><span class=s2>&#34;Status&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;to_value&#34;: </span><span class=s2>&#34;Approved&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_type&#34;: </span><span class=s2>&#34;Custom&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;field_name&#34;: </span><span class=s2>&#34;Signed off by&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;to_value&#34;: </span><span class=s2>&#34;Stanley&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></td></tr></table></div></div></div></div><p>以下示例是 参数 <code>condition</code> 为 any2any 的示例。在任何 payload 项匹配模式的任何部分的情况下，这将返回 true。此示例使用上面 “condition” 部分中描述的条件标签。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger.body.data.tank</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;search&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>any2any</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.chemicalLevel#1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;lessthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=m>40</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.chemicalLevel#2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;greaterthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=m>50</span></span></span></code></pre></td></tr></table></div></div></div></div><p>Payload</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;tanks&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;id&#34;: </span><span class=m>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;chemicalLevel&#34;: </span><span class=m>43</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w> </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;id&#34;: </span><span class=m>2</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;chemicalLevel&#34;: </span><span class=m>55</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></td></tr></table></div></div></div></div><p>上面示例中，由于第二个 chemicalLevel 值超过了50，因此此条件解析为 true，并且将触发操作，例如向操作员发送通知。如果第二个chemicalLevel 为45，则条件解析为 false，不会发生任何操作。</p><p>以下是条件参数为 all2any 的示例。在所有 payload 都与所有的 condition pattern 匹配的情况下，这将返回 true</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger.body.data.equipment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;search&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>all2any</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.latitude.value#1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;lessthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=m>40</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.latitude.value#2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;greaterthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.longitude.value#1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;lessthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span>-<span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.longitude.value#2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;greaterthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span>-<span class=m>90</span></span></span></code></pre></td></tr></table></div></div></div></div><p>payload 如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;equipment&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;latitude&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;value&#34;: </span><span class=m>43</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;longitude&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;value&#34;: </span>-<span class=m>95</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w> </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;latitude&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;value&#34;: </span><span class=m>44</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;longitude&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;value&#34;: </span>-<span class=m>96</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></td></tr></table></div></div></div></div><p>在这个例子中，所有设备的值都在条件指定的范围内，因此不会执行任何操作。即使将第一个 latitude 设置为 53，仍然不会有任何操作。假设第二个 longitude 值设置为 -106，那么操作将触发，因为所有设备将违反 contition 中的至少一个部分。这可以在最后一个 equipment 离开区域时触发通知。</p><p>单一 payload 模式</p><p>如果 payload 中只需要一个元素，则如果 payload 是字典，则搜索参数仍然可以用于测试规则的条件，例如下面示例，payload 还是和上面相同，但是实际内容不同</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger.body.data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;search&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>all2any</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pattern</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.latitude.value#1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;lessthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=m>40</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.latitude.value#2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;greaterthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.longitude.value#1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;lessthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span>-<span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>item.longitude.value#2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;greaterthan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span>-<span class=m>90</span></span></span></code></pre></td></tr></table></div></div></div></div><p>payload</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;data&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;latitude&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;value&#34;: </span><span class=m>43</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;longitude&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;value&#34;: </span>-<span class=m>95</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p>在使用 single payload 时，all2any 和 any2any 具有相同的结果，因为选择所有与选择任何一件相同。</p></blockquote><h3 id=condition-参数>condition 参数<a hidden class=anchor aria-hidden=true href=#condition-参数>#</a></h3><ul><li><code>count</code></li><li><code>count_gt</code></li><li><code>count_gte</code></li><li><code>count_lt</code></li><li><code>count_lte</code></li><li>any</li><li>all</li><li>any2any</li><li>all2any</li></ul><h3 id=搜索运算符的注意事项>搜索运算符的注意事项<a hidden class=anchor aria-hidden=true href=#搜索运算符的注意事项>#</a></h3><p>首先，它将规则引擎转变为一个 “<font color=#f8070d size=3>递归下降解析器</font>”，这可能会降低规则引擎的性能。因此，如果有一个规则必须保持快速响应，不受系统负载影响，建议尽量避免使用 “搜索运算符”。</p><p>其次，“搜索运算符” 的认知复杂性使其一眼难以理解。如果你与他人共享代码，可能需要详细记录规则和模式，以更清晰地解释你的意图。</p><p>最后，“搜索运算符” 的算法复杂性与其他运算符大不相同，下面是算法的复杂度：</p><ul><li>O($n_{patterns}$) 是指 $n_{patterns}$，即子模式的数量。这表示算法的运行时间（复杂度）与子模式的数量成正比。当子模式数量增加时，运行时间也会相应增加。</li><li>O($n_{payloads}$) 是指 $n_{payloads}$，即 “trigger payload” 字段的数量。同样，这表示算法的运行时间与 “trigger payload” 字段的数量成正比。增加 “trigger payload” 字段的数量也会导致运行时间增加。</li></ul><p>其中，O 表示的是算法的渐进复杂度，即算法的运行时间与输入规模的增长关系。因此，如果有大量 “子条件” 或者在 “trigger payload” 中搜索长列表，<font color=#f8070d size=3>使用搜索运算符很容易编写出慢规则</font>。</p><p>总结：使用 “搜索运算符” 应主要限制在尝试匹配 “少量的子条件” 和 ”少量预期 payload“ 列表项的情况下。尽管搜索运算符可能使规则引擎变慢，但与无条件运行工作流并在那里进行过滤相比，在规则中使用搜索运算符仍然更快且更轻量。</p><h2 id=在rule中配置actions的执行>在Rule中配置Actions的执行<a hidden class=anchor aria-hidden=true href=#在rule中配置actions的执行>#</a></h2><p>这一部分描述了在 ”tigger“ 成功匹配并满足一组可选条件时要执行的后续 ”actions/workflows“。至少，Rules 应指定要执行的 Actions。Rules 还可以指定在执行 Actions 时提供给 Actions 的参数。</p><p>下面是一个 Actions 的示例</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>action</span><span class=p>:</span><span class=w>                                </span><span class=c># required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;action_ref&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parameters</span><span class=p>:</span><span class=w>                        </span><span class=c># optional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>foo</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;bar&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>baz</span><span class=p>:</span><span class=w> </span><span class=m>1</span></span></span></code></pre></td></tr></table></div></div></div></div><p>偶尔情况下，在规则 Rules 时，将 Tigger 的上下文传递给 Actions 可能是必要的。 Rule 引擎能够通过利用 Jinja 模板语法插值变量。如下所示：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;action_ref&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>foo</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;bar&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>baz</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ trigger.payload_parameter_1 }}&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>触发器属性的值可以是 null 和 None。这也是相关 Actions 参数的有效值。您需要使用 use_none Jinja 模板过滤器，以确保在调用操作时正确序列化 null/None 值。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;action_ref&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>foo</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;bar&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>baz</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ trigger.payload_parameter_1 | use_none }}&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p>Notes: 当使用 Jinja 模板插值时，null 或 None 的值可能会导致一些序列化问题。使用 &ldquo;use_none&rdquo; 过滤器可以帮助规避这些问题，确保 null 或 None 值在序列化时被正确处理。</p></blockquote><p>由于当前的 Jinja 模板系统不支持非字符串类型，因此需要此解决方法。在调用操作之前，我们被迫根据操作参数定义执行类型转换。</p><h2 id=rules-的管理>Rules 的管理<a hidden class=anchor aria-hidden=true href=#rules-的管理>#</a></h2><h3 id=添加rule>添加rule<a hidden class=anchor aria-hidden=true href=#添加rule>#</a></h3><p>如果只为了部署部署一条 rule，可以使用 st2 命令：<code>st2 rule create ${PATH_TO_RULE}</code>，例如：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 rule create /usr/share/doc/st2/examples/rules/sample_rule_with_webhook.yaml</span></span></code></pre></td></tr></table></div></div></div></div><p>完成后记得要重新加载所有规则，请使用 <code>st2ctl reload --register-rules</code></p><p>如果 rule name 已经存在将会出现下面的提示：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>ERROR: 409 Client Error</span><span class=p>:</span><span class=w> </span><span class=l>Conflict</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>MESSAGE: Tried to save duplicate unique keys (E11000 duplicate key error index: st2.rule_d_b.$uid_1  dup key</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=p>:</span><span class=w> </span><span class=s2>&#34;rule:examples:sample_rule_with_webhook&#34;</span><span class=w> </span>}<span class=l>)</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=更新rule>更新rule<a hidden class=anchor aria-hidden=true href=#更新rule>#</a></h3><p>要更新一条规则，编辑规则定义文件并运行命令：<code>st2 rule update</code>，如下例所示：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 rule update examples.sample_rule_with_webhook /usr/share/doc/st2/examples/rules/sample_rule_with_webhook.yaml</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=获取rule>获取rule<a hidden class=anchor aria-hidden=true href=#获取rule>#</a></h3><p>要查看所有规则或获取单个规则，请使用以下命令：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 rule list
</span></span><span class=line><span class=cl>st2 rule get examples.sample_rule_with_webhook</span></span></code></pre></td></tr></table></div></div></div></div><p>要取消部署一条规则，运行命令：<code>st2 rule delete ${RULE_NAME_OR_ID}</code>。例如，要取消部署之前部署的名为 <code>examples.sample_rule_with_webhook</code> 的规则，运行：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 rule delete examples.sample_rule_with_webhook</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=rule的放置位置>rule的放置位置<a hidden class=anchor aria-hidden=true href=#rule的放置位置>#</a></h3><p>自定义规则可以放置在本地系统上的任何可访问文件夹中。自定义规则通常放置在 <code>/opt/stackstorm/packs/&lt;pack_name>/rules</code> 目录中。</p><h3 id=测试rule>测试rule<a hidden class=anchor aria-hidden=true href=#测试rule>#</a></h3><p>为了更方便地测试规则，我们提供了一个 <em>st2-rule-tester</em> 工具，它可以在不运行任何 StackStorm 组件的情况下评估规则与触发器实例的匹配。</p><p>该工具通过接受包含规则定义的文件路径和包含触发器实例定义的文件路径来实现：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2-rule-tester --rule<span class=o>=</span><span class=si>${</span><span class=nv>RULE_FILE</span><span class=si>}</span> --trigger-instance<span class=o>=</span><span class=si>${</span><span class=nv>TRIGGER_INSTANCE_DEFINITION</span><span class=si>}</span> --config-file<span class=o>=</span>/etc/st2/st2.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$?</span></span></span></code></pre></td></tr></table></div></div></div></div><p>两个文件都需要以YAML或JSON格式包含定义。对于规则，您可以使用计划部署的相同文件。</p><p>对于触发器实例，定义文件需要包含以下键：</p><ul><li>trigger：触发器的完整引用（例如，core.st2.IntervalTimer，slack.message，irc.pubmsg，twitter.matched_tweet等）。</li><li>payload：Trigger payload。负载本身是特定于所讨论触发器的。要了解触发器结构，您可以查看包的 README 或查找位于 <code>packs/&lt;pack_name>/sensors/</code> 目录中的 sensor 元数据文件中的 <code>trigger_types</code> 部分。</li></ul><p>如果触发器实例匹配，将打印 <code>=== RULE MATCHES ===</code> 并且该工具将以 0 的状态代码退出。如果规则不匹配，将打印 <code>=== RULE DOES NOT MATCH ===</code> 并且该工具将以 1 的状态代码退出。</p><p>以下是如何使用该工具的一些示例：</p><p>rule.yaml</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;relayed_matched_irc_message&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pack</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;irc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Relay IRC message to Slack if the message contains word StackStorm&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;irc.pubmsg&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parameters</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>criteria</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>trigger.message</span><span class=p>:</span><span class=w> </span><span class=c># 触发器的message值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;icontains&#34;</span><span class=w> </span><span class=c># 不区分大小写包含 pattern 的值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;StackStorm&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;slack.post_message&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ trigger.source.nick }} on {{ trigger.channel }}: {{ trigger.message }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;#irc-relay&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>trigger_instance_1.yaml :</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;irc.pubmsg&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>payload</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>source</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>nick</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Kami_&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway/web/irccloud.com/x-uvv&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;#stackstorm&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timestamp</span><span class=p>:</span><span class=w> </span><span class=m>1419166748</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;stackstorm is cool!&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>trigger_instance_2.yaml</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>trigger</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;irc.pubmsg&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>payload</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>source</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>nick</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Kami_&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway/web/irccloud.com/x-uvv&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;#stackstorm&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timestamp</span><span class=p>:</span><span class=w> </span><span class=m>1419166748</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;blah blah&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>下面使用 <em>trigger_instance_1</em> 来评估rules</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2-rule-tester --rule<span class=o>=</span>./my_rule.yaml --trigger-instance<span class=o>=</span>./trigger_instance_1.yaml
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$?</span></span></span></code></pre></td></tr></table></div></div></div></div><p><em>trigger_instance_1</em> 输出的结果为</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2015-12-11 14:35:03,249 INFO <span class=o>[</span>-<span class=o>]</span> Connecting to database <span class=s2>&#34;st2&#34;</span> @ <span class=s2>&#34;0.0.0.0:27017&#34;</span> as user <span class=s2>&#34;None&#34;</span>.
</span></span><span class=line><span class=cl>2015-12-11 14:35:03,318 INFO <span class=o>[</span>-<span class=o>]</span> Validating rule irc.relayed_matched_irc_message <span class=k>for</span> pubmsg.
</span></span><span class=line><span class=cl>2015-12-11 14:35:03,331 INFO <span class=o>[</span>-<span class=o>]</span> <span class=m>1</span> rule<span class=o>(</span>s<span class=o>)</span> found to enforce <span class=k>for</span> pubmsg.
</span></span><span class=line><span class=cl>2015-12-11 14:35:03,333 INFO <span class=o>[</span>-<span class=o>]</span> <span class=o>===</span> RULE <span class=nv>MATCHES</span> <span class=o>===</span>
</span></span><span class=line><span class=cl><span class=m>0</span></span></span></code></pre></td></tr></table></div></div></div></div><p>使用 <em>trigger_instance_2</em> 来评估rules</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>st2-rule-tester --rule=./my_rule.yaml --trigger-instance=./trigger_instance_2.yaml
</span></span><span class=line><span class=cl>echo $?</span></span></code></pre></td></tr></table></div></div></div></div><p><em>trigger_instance_2</em> 输出的结果为</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2015-12-11 14:35:57,380 INFO <span class=o>[</span>-<span class=o>]</span> Connecting to database <span class=s2>&#34;st2&#34;</span> @ <span class=s2>&#34;0.0.0.0:27017&#34;</span> as user <span class=s2>&#34;None&#34;</span>.
</span></span><span class=line><span class=cl>2015-12-11 14:35:57,444 INFO <span class=o>[</span>-<span class=o>]</span> Validating rule irc.relayed_matched_irc_message <span class=k>for</span> pubmsg.
</span></span><span class=line><span class=cl>2015-12-11 14:35:57,459 INFO <span class=o>[</span>-<span class=o>]</span> Validation <span class=k>for</span> rule irc.relayed_matched_irc_message failed on -
</span></span><span class=line><span class=cl>  key: trigger.message
</span></span><span class=line><span class=cl>  pattern: StackStorm
</span></span><span class=line><span class=cl>  type: icontains
</span></span><span class=line><span class=cl>  payload: blah blah
</span></span><span class=line><span class=cl>2015-12-11 14:35:57,461 INFO <span class=o>[</span>-<span class=o>]</span> <span class=m>0</span> rule<span class=o>(</span>s<span class=o>)</span> found to enforce <span class=k>for</span> pubmsg.
</span></span><span class=line><span class=cl>2015-12-11 14:35:57,462 INFO <span class=o>[</span>-<span class=o>]</span> <span class=o>===</span> RULE DOES NOT <span class=nv>MATCH</span> <span class=o>===</span>
</span></span><span class=line><span class=cl><span class=m>1</span></span></span></code></pre></td></tr></table></div></div></div></div><p><em>st2-rule-tester</em> 进一步提供了一种<font color=#f8070d size=3>事后调试的方式</font>，您可以回答一个问题：“为什么我的 Rule 没有与刚刚触发的 Trigger 匹配？” 这表示着已经在 StackStorm 中加载了一个已知引用的 <strong>rule</strong>，类似地，还有一个带有已知 ID 的 Trigger Instance。</p><p>假设我们有规则引用为 <em>my_pack.fire_on_execution</em> 和 Trigger 实例 ID 为 <em>566b4be632ed352a09cd347d</em>：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2-rule-tester --rule-ref<span class=o>=</span>my_pack.fire_on_execution --trigger-instance-id<span class=o>=</span>566b4be632ed352a09cd347d --config-file<span class=o>=</span>/etc/st2/st2.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$?</span></span></span></code></pre></td></tr></table></div></div></div></div><p>输出结果为</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2015-12-11 15:24:16,459 INFO <span class=o>[</span>-<span class=o>]</span> Connecting to database <span class=s2>&#34;st2&#34;</span> @ <span class=s2>&#34;0.0.0.0:27017&#34;</span> as user <span class=s2>&#34;None&#34;</span>.
</span></span><span class=line><span class=cl>2015-12-11 15:24:16,527 INFO <span class=o>[</span>-<span class=o>]</span> Validating rule my_pack.fire_on_execution <span class=k>for</span> st2.generic.actiontrigger.
</span></span><span class=line><span class=cl>2015-12-11 15:24:16,542 INFO <span class=o>[</span>-<span class=o>]</span> Validation <span class=k>for</span> rule my_pack.fire_on_execution failed on -
</span></span><span class=line><span class=cl>  key: trigger.status
</span></span><span class=line><span class=cl>  pattern: succeeded
</span></span><span class=line><span class=cl>  type: iequals
</span></span><span class=line><span class=cl>  payload: failed
</span></span><span class=line><span class=cl>2015-12-11 15:24:16,545 INFO <span class=o>[</span>-<span class=o>]</span> <span class=m>0</span> rule<span class=o>(</span>s<span class=o>)</span> found to enforce <span class=k>for</span> st2.generic.actiontrigger.
</span></span><span class=line><span class=cl>2015-12-11 15:24:16,546 INFO <span class=o>[</span>-<span class=o>]</span> <span class=o>===</span> RULE DOES NOT <span class=nv>MATCH</span> <span class=o>===</span></span></span></code></pre></td></tr></table></div></div></div></div><p>输出还标识了不匹配的来源，即是 Trigger 类型不匹配还是其中一个条件不匹配。</p><p>如果您正在调试并想要查看发送到 StackStorm 的 Trigger 实例列表，可以使用下面命令：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 trigger-instance list</span></span></code></pre></td></tr></table></div></div></div></div><p>还可以按触发器进行触发器实例的过滤：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 trigger-instance list --trigger<span class=o>=</span>core.f9e09284-b2b1-4127-aedd-dcde7a752819</span></span></code></pre></td></tr></table></div></div></div></div><p>此外，还可以通过使用 <code>timestamp_gt</code> 和 <code>timestamp_lt</code> 过滤选项，在时间范围内获取触发器实例：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 trigger-instance list --trigger<span class=o>=</span><span class=s2>&#34;core.f9e09284-b2b1-4127-aedd-dcde7a752819&#34;</span> -timestamp_gt<span class=o>=</span>2015-06-01T12:00:00Z -timestamp_lt<span class=o>=</span>2015-06-02T12:00:00Z</span></span></code></pre></td></tr></table></div></div></div></div><p>请注意，您还可以指定其中一个 timestamp_lt 或 timestamp_gt。您可以使用 get 命令获取有关触发器实例的详细信息：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 trigger-instance get 556e135232ed35569ff23238</span></span></code></pre></td></tr></table></div></div></div></div><p>在调试规则时可能很有用的一项功能是将触发器实例重新发送到 StackStorm。您可以使用 re-emit 命令来实现这一点。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>st2 trigger-instance re-emit 556e135232ed35569ff23238</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=定时器---timers>定时器 - timers<a hidden class=anchor aria-hidden=true href=#定时器---timers>#</a></h2><p>定时器 (Timers) 允许基于定义的时间间隔重复运行特定操作，或在特定日期和时间运行。您可以将它们视为 cron 作业，但具有更多的灵活性，例如仅在提供的日期和时间运行操作一次的能力。</p><p>目前，我们支持以下定时器触发器类型：</p><ul><li><code>core.st2.IntervalTimer</code> ：在预定义的时间间隔（例如每30秒，每24小时，每周等）运行一个操作。</li><li><code>core.st2.DateTimer</code> ：在指定的日期和时间运行一个操作。</li><li><code>core.st2.CronTimer</code> ：当前时间匹配在UNIX cron格式中定义的时间约束时运行一个操作。</li></ul><p>定时器被实现为 Trigger，这意味着您可以在 Rule 中使用它们。在下面的部分中，您可以找到如何在规则定义中使用定时器的一些示例。</p><h3 id=corest2intervaltimer-使用示例>core.st2.IntervalTimer 使用示例<a hidden class=anchor aria-hidden=true href=#corest2intervaltimer-使用示例>#</a></h3><p>可用的参数有：<code>unit</code> 和 <code>delta</code>。</p><p>对于 <code>unit</code> 参数，支持的值包括：<code>seconds</code>、<code>minutes</code>、<code>hours</code>、<code>days</code>、<code>weeks</code>。</p><h4 id=每30秒运行一次action>每30秒运行一次Action<a hidden class=anchor aria-hidden=true href=#每30秒运行一次action>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.IntervalTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;seconds&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>delta</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=每24小时运行一次action>每24小时运行一次Action<a hidden class=anchor aria-hidden=true href=#每24小时运行一次action>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.IntervalTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hours&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>delta</span><span class=p>:</span><span class=w> </span><span class=m>24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=每2星期运行一次action>每2星期运行一次Action<a hidden class=anchor aria-hidden=true href=#每2星期运行一次action>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.IntervalTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;weeks&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>delta</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=corest2datetimer>core.st2.DateTimer<a hidden class=anchor aria-hidden=true href=#corest2datetimer>#</a></h3><p>可用参数 <code>timezone</code>, <code>date</code>.</p><p>在指定时间运行 action</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.DateTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timezone</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UTC&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>date</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2014-12-31 23:59:59&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=corest2crontimer>core.st2.CronTimer<a hidden class=anchor aria-hidden=true href=#corest2crontimer>#</a></h3><p>此定时器支持类似 cron 的表达式。</p><p>默认情况下，如果没有为特定参数提供值，则假定为 *，这意味着在每个值上触发。</p><p>可用参数 <code>timezone</code>, <code>year</code>, <code>month</code>, <code>day</code>, <code>week</code>, <code>day_of_week</code>, <code>hour</code>, <code>minute</code>, <code>second</code>，注意，时区(<code>timezone</code> ) 使用 <em>pytz</em> 格式 例如 <code>Asia/Shanghai</code>.</p><h4 id=每周日午夜运行action>每周日午夜运行action<a hidden class=anchor aria-hidden=true href=#每周日午夜运行action>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.CronTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timezone</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UTC&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>day_of_week: 6 # or day_of_week</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;sun&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hour</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>minute</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>second</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=每天午夜运行action>每天午夜运行action<a hidden class=anchor aria-hidden=true href=#每天午夜运行action>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.CronTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timezone</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UTC&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>day_of_week</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;*&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hour</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>minute</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>second</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><p>如上所述，如果没有为特定参数提供值，则假定为 *，这意味着以下内容等效于上述内容：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;core.st2.CronTimer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timezone</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UTC&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hour</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>minute</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>second</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=周一到周五每天午夜执行但周六日不执行>周一到周五每天午夜执行，但周六日不执行<a hidden class=anchor aria-hidden=true href=#周一到周五每天午夜执行但周六日不执行>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>trigger:
</span></span><span class=line><span class=cl>  type: <span class=s2>&#34;core.st2.CronTimer&#34;</span>
</span></span><span class=line><span class=cl>  parameters:
</span></span><span class=line><span class=cl>      timezone: <span class=s2>&#34;UTC&#34;</span>
</span></span><span class=line><span class=cl>      day_of_week: <span class=s2>&#34;mon-fri&#34;</span>
</span></span><span class=line><span class=cl>      hour: <span class=m>0</span>
</span></span><span class=line><span class=cl>      minute: <span class=m>0</span>
</span></span><span class=line><span class=cl>      second: <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>action:
</span></span><span class=line><span class=cl>  ...</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=每小时执行一次>每小时执行一次<a hidden class=anchor aria-hidden=true href=#每小时执行一次>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>trigger:
</span></span><span class=line><span class=cl>  type: <span class=s2>&#34;core.st2.CronTimer&#34;</span>
</span></span><span class=line><span class=cl>  parameters:
</span></span><span class=line><span class=cl>      timezone: <span class=s2>&#34;UTC&#34;</span>
</span></span><span class=line><span class=cl>      hour: <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>      minute: <span class=m>0</span>
</span></span><span class=line><span class=cl>      second: <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>action:
</span></span><span class=line><span class=cl>  ...</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=故障排除>故障排除<a hidden class=anchor aria-hidden=true href=#故障排除>#</a></h2><p>rules 不如预期那样工作？或者只是想看看哪些 rules 已经生效？</p><p>运行 <code>st2 rule-enforcement list</code> 以查看所有 rules 执行。您可以通过规则对此输出进行过滤以缩小范围。</p></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：StackStorm自动化 - Rules</p><p>文章链接：<a href=https://www.oomkill.com/2023/11/stackstorm-rules/ target=_blank>https://www.oomkill.com/2023/11/stackstorm-rules/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2023/05/stackstorm-pack-configuaration/><span>StackStorm自动化 - 包配置</span></a></li><li><a href=/2018/06/ansible/><span>ansible介绍</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/automation/>Automation</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2023/11/stackstorm-pack/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>StackStorm自动化 - 包</span>
</a><a class=next href=https://www.oomkill.com/2023/11/ch07-in-cluster-pod/><span class=title></span>
<span>client-go - Pod使用in-cluster方式访问集群&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/Stackstorm-rules","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>