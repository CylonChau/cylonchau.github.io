<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Unix归档模式 cpio - 深入剖析与构建rpm包 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="Linux,rpm,rpmbuild,unix,深入剖析与构建rpm包"><meta name=description content="RPM概述 RPM (Red Hat Package Manager)，几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件。对于最终用户来说，使用RPM所提供的功能来维护系统是比较容易和轻松的。安装、卸载和升级RPM软件包只需一条命令就可以搞定。RPM维护了一个所有已安装的软件包和文件的数据库，可以让用户进行查询和验证工作。在软件包升级过程中，RPM会对配置文件进行特别处理，绝对不会丢失以往的定制信息。对于程序员RPM可以让我们连同软件的源代码打包成源代码和二进制软件包供最终用户使用。
一般而言制作一个RPM包包含以下几个步骤
计划你想要建立什么 收集软件包 根据需要修补软件 计划升级旧有的包 创建可重现的软件构建 概述任何依赖关系 构建rpm 测试rpm（能否安装、升级） RPM capability 能力 运行或安装需要依赖于其他的RPM包本身或所提供的文件为基础的现象被称之为依赖关系。但在制作RPM包时，依赖关系有两类编译依赖与安装依赖。
自身名字所包含的意义 它提供的文件也有可能被其他软件所依赖，文件本身也能识别成一种能力 编译依赖和安装依赖
每一个RPM包都提供一种能够完成任务的功能，此种能力很可能被其他RPM所依赖，此能力大多数情况下和RPM名字是相同的。
制作RPM包的纲要有如下四部
设定RPM包制作的目录结构（制作车间） 将原材料（源码包、配置文件、补丁包）放置规划好的目录当中。 创建spec文件，指挥如何使用原材料将其制作成rpm包。 编译源代码生成rpm包 在一个特定的目录中提供如下5个子目录 redhat上默认在/usr/src/reahat BUILD 源代码解压以后放置的位置，仅需提供目录。 RPMS 放置制作完成后的RPM包 SOURCES 原材料放置目录（配置文件、源码包、补丁包） SPECS 放置spec文件（纲领性文件）的。 SRPMS SRC rpm包存放位置 RPM优缺点 优点：
集中管理：RPM可以集中管理安装、升级和删除软件包，保证系统的干净和稳定。 精确控制：RPM提供详细的软件包信息，可以对软件包的安装路径、依赖关系、版本等进行精确控制，使得软件安装更加灵活便捷。 简单易用：RPM提供了一套完整的命令行工具和图形化管理工具，对于普通用户来说，使用起来非常方便。 更新机制：RPM可以根据用户需要进行更新，包括安全更新、功能更新和修复错误等，可以更好地保证系统安全与稳定性。 缺点：
依赖管理：RPM虽然可以管理软件包的依赖关系，但其解决依赖的方式容易出现问题，可能会出现某些软件包的依赖关系无法解决的情况。 更新速度：由于需要对软件包进行依赖检查等操作，升级软件包可能需要较长时间，特别是当软件包依赖比较复杂时。 存在问题：有时候使用RPM安装的软件包出现问题，需要手动卸载并重新安装，这会导致一些无法预测的麻烦。 兼容性：RPM采用了特定的软件包管理标准，要求安装的软件包必须符合这些标准。因此，RPM可能不太适用于其他Linux系统或自定义的软件包格式。 SPEC文件 制作RPM软件包的关键在于编写SPEC软件包描述文件。要想制作一个rpm软件包就必须写一个软件包描述文件（SPEC）。这个文件中包含了软件包的诸多信息，如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。
SPEC文件通常包括以下几个部分：
头文件：包括软件包的名称、版本、发布号、授权等信息。
%description：包括软件包的描述、依赖关系、构建环境等信息。
%prep：指定源代码的来源和如何解压缩及准备源代码。
%build：指定如何编译源代码。
%install：指定如何安装编译好的软件包。
%check：指定测试源代码的特定部分，通常是用来运行单元测试。
%clean：指定清除构建过程中产生的临时文件和目录的方法。
%files：指定哪些文件应该包括在最终的RPM文件中。
%changelog：记录软件包的变更历史。
SPEC文件中常用的宏变量 宏变量 说明 %{name} 软件包的名称，如 myapp。 %{version} 软件包的版本号，如 1."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2018/09/rpm-package/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2018/09/rpm-package/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="Unix归档模式 cpio - 深入剖析与构建rpm包"><meta property="og:description" content="RPM概述 RPM (Red Hat Package Manager)，几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件。对于最终用户来说，使用RPM所提供的功能来维护系统是比较容易和轻松的。安装、卸载和升级RPM软件包只需一条命令就可以搞定。RPM维护了一个所有已安装的软件包和文件的数据库，可以让用户进行查询和验证工作。在软件包升级过程中，RPM会对配置文件进行特别处理，绝对不会丢失以往的定制信息。对于程序员RPM可以让我们连同软件的源代码打包成源代码和二进制软件包供最终用户使用。
一般而言制作一个RPM包包含以下几个步骤
计划你想要建立什么 收集软件包 根据需要修补软件 计划升级旧有的包 创建可重现的软件构建 概述任何依赖关系 构建rpm 测试rpm（能否安装、升级） RPM capability 能力 运行或安装需要依赖于其他的RPM包本身或所提供的文件为基础的现象被称之为依赖关系。但在制作RPM包时，依赖关系有两类编译依赖与安装依赖。
自身名字所包含的意义 它提供的文件也有可能被其他软件所依赖，文件本身也能识别成一种能力 编译依赖和安装依赖
每一个RPM包都提供一种能够完成任务的功能，此种能力很可能被其他RPM所依赖，此能力大多数情况下和RPM名字是相同的。
制作RPM包的纲要有如下四部
设定RPM包制作的目录结构（制作车间） 将原材料（源码包、配置文件、补丁包）放置规划好的目录当中。 创建spec文件，指挥如何使用原材料将其制作成rpm包。 编译源代码生成rpm包 在一个特定的目录中提供如下5个子目录 redhat上默认在/usr/src/reahat BUILD 源代码解压以后放置的位置，仅需提供目录。 RPMS 放置制作完成后的RPM包 SOURCES 原材料放置目录（配置文件、源码包、补丁包） SPECS 放置spec文件（纲领性文件）的。 SRPMS SRC rpm包存放位置 RPM优缺点 优点：
集中管理：RPM可以集中管理安装、升级和删除软件包，保证系统的干净和稳定。 精确控制：RPM提供详细的软件包信息，可以对软件包的安装路径、依赖关系、版本等进行精确控制，使得软件安装更加灵活便捷。 简单易用：RPM提供了一套完整的命令行工具和图形化管理工具，对于普通用户来说，使用起来非常方便。 更新机制：RPM可以根据用户需要进行更新，包括安全更新、功能更新和修复错误等，可以更好地保证系统安全与稳定性。 缺点：
依赖管理：RPM虽然可以管理软件包的依赖关系，但其解决依赖的方式容易出现问题，可能会出现某些软件包的依赖关系无法解决的情况。 更新速度：由于需要对软件包进行依赖检查等操作，升级软件包可能需要较长时间，特别是当软件包依赖比较复杂时。 存在问题：有时候使用RPM安装的软件包出现问题，需要手动卸载并重新安装，这会导致一些无法预测的麻烦。 兼容性：RPM采用了特定的软件包管理标准，要求安装的软件包必须符合这些标准。因此，RPM可能不太适用于其他Linux系统或自定义的软件包格式。 SPEC文件 制作RPM软件包的关键在于编写SPEC软件包描述文件。要想制作一个rpm软件包就必须写一个软件包描述文件（SPEC）。这个文件中包含了软件包的诸多信息，如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。
SPEC文件通常包括以下几个部分：
头文件：包括软件包的名称、版本、发布号、授权等信息。
%description：包括软件包的描述、依赖关系、构建环境等信息。
%prep：指定源代码的来源和如何解压缩及准备源代码。
%build：指定如何编译源代码。
%install：指定如何安装编译好的软件包。
%check：指定测试源代码的特定部分，通常是用来运行单元测试。
%clean：指定清除构建过程中产生的临时文件和目录的方法。
%files：指定哪些文件应该包括在最终的RPM文件中。
%changelog：记录软件包的变更历史。
SPEC文件中常用的宏变量 宏变量 说明 %{name} 软件包的名称，如 myapp。 %{version} 软件包的版本号，如 1."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2018/09/rpm-package/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-26T23:10:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unix归档模式 cpio - 深入剖析与构建rpm包"><meta name=twitter:description content="RPM概述 RPM (Red Hat Package Manager)，几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件。对于最终用户来说，使用RPM所提供的功能来维护系统是比较容易和轻松的。安装、卸载和升级RPM软件包只需一条命令就可以搞定。RPM维护了一个所有已安装的软件包和文件的数据库，可以让用户进行查询和验证工作。在软件包升级过程中，RPM会对配置文件进行特别处理，绝对不会丢失以往的定制信息。对于程序员RPM可以让我们连同软件的源代码打包成源代码和二进制软件包供最终用户使用。
一般而言制作一个RPM包包含以下几个步骤
计划你想要建立什么 收集软件包 根据需要修补软件 计划升级旧有的包 创建可重现的软件构建 概述任何依赖关系 构建rpm 测试rpm（能否安装、升级） RPM capability 能力 运行或安装需要依赖于其他的RPM包本身或所提供的文件为基础的现象被称之为依赖关系。但在制作RPM包时，依赖关系有两类编译依赖与安装依赖。
自身名字所包含的意义 它提供的文件也有可能被其他软件所依赖，文件本身也能识别成一种能力 编译依赖和安装依赖
每一个RPM包都提供一种能够完成任务的功能，此种能力很可能被其他RPM所依赖，此能力大多数情况下和RPM名字是相同的。
制作RPM包的纲要有如下四部
设定RPM包制作的目录结构（制作车间） 将原材料（源码包、配置文件、补丁包）放置规划好的目录当中。 创建spec文件，指挥如何使用原材料将其制作成rpm包。 编译源代码生成rpm包 在一个特定的目录中提供如下5个子目录 redhat上默认在/usr/src/reahat BUILD 源代码解压以后放置的位置，仅需提供目录。 RPMS 放置制作完成后的RPM包 SOURCES 原材料放置目录（配置文件、源码包、补丁包） SPECS 放置spec文件（纲领性文件）的。 SRPMS SRC rpm包存放位置 RPM优缺点 优点：
集中管理：RPM可以集中管理安装、升级和删除软件包，保证系统的干净和稳定。 精确控制：RPM提供详细的软件包信息，可以对软件包的安装路径、依赖关系、版本等进行精确控制，使得软件安装更加灵活便捷。 简单易用：RPM提供了一套完整的命令行工具和图形化管理工具，对于普通用户来说，使用起来非常方便。 更新机制：RPM可以根据用户需要进行更新，包括安全更新、功能更新和修复错误等，可以更好地保证系统安全与稳定性。 缺点：
依赖管理：RPM虽然可以管理软件包的依赖关系，但其解决依赖的方式容易出现问题，可能会出现某些软件包的依赖关系无法解决的情况。 更新速度：由于需要对软件包进行依赖检查等操作，升级软件包可能需要较长时间，特别是当软件包依赖比较复杂时。 存在问题：有时候使用RPM安装的软件包出现问题，需要手动卸载并重新安装，这会导致一些无法预测的麻烦。 兼容性：RPM采用了特定的软件包管理标准，要求安装的软件包必须符合这些标准。因此，RPM可能不太适用于其他Linux系统或自定义的软件包格式。 SPEC文件 制作RPM软件包的关键在于编写SPEC软件包描述文件。要想制作一个rpm软件包就必须写一个软件包描述文件（SPEC）。这个文件中包含了软件包的诸多信息，如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。
SPEC文件通常包括以下几个部分：
头文件：包括软件包的名称、版本、发布号、授权等信息。
%description：包括软件包的描述、依赖关系、构建环境等信息。
%prep：指定源代码的来源和如何解压缩及准备源代码。
%build：指定如何编译源代码。
%install：指定如何安装编译好的软件包。
%check：指定测试源代码的特定部分，通常是用来运行单元测试。
%clean：指定清除构建过程中产生的临时文件和目录的方法。
%files：指定哪些文件应该包括在最终的RPM文件中。
%changelog：记录软件包的变更历史。
SPEC文件中常用的宏变量 宏变量 说明 %{name} 软件包的名称，如 myapp。 %{version} 软件包的版本号，如 1."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"Unix归档模式 cpio - 深入剖析与构建rpm包","item":"https://www.oomkill.com/2018/09/rpm-package/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unix归档模式 cpio - 深入剖析与构建rpm包","name":"Unix归档模式 cpio - 深入剖析与构建rpm包","description":"RPM概述 RPM (Red Hat Package Manager)，几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件。对于最终用户来说，使用RPM所提供的功能来维护系统是比较容易和轻松的。安装、卸载和升级RPM软件包只需一条命令就可以搞定。RPM维护了一个所有已安装的软件包和文件的数据库，可以让用户进行查询和验证工作。在软件包升级过程中，RPM会对配置文件进行特别处理，绝对不会丢失以往的定制信息。对于程序员RPM可以让我们连同软件的源代码打包成源代码和二进制软件包供最终用户使用。\n一般而言制作一个RPM包包含以下几个步骤\n计划你想要建立什么 收集软件包 根据需要修补软件 计划升级旧有的包 创建可重现的软件构建 概述任何依赖关系 构建rpm 测试rpm（能否安装、升级） RPM capability 能力 运行或安装需要依赖于其他的RPM包本身或所提供的文件为基础的现象被称之为依赖关系。但在制作RPM包时，依赖关系有两类编译依赖与安装依赖。\n自身名字所包含的意义 它提供的文件也有可能被其他软件所依赖，文件本身也能识别成一种能力 编译依赖和安装依赖\n每一个RPM包都提供一种能够完成任务的功能，此种能力很可能被其他RPM所依赖，此能力大多数情况下和RPM名字是相同的。\n制作RPM包的纲要有如下四部\n设定RPM包制作的目录结构（制作车间） 将原材料（源码包、配置文件、补丁包）放置规划好的目录当中。 创建spec文件，指挥如何使用原材料将其制作成rpm包。 编译源代码生成rpm包 在一个特定的目录中提供如下5个子目录 redhat上默认在/usr/src/reahat BUILD 源代码解压以后放置的位置，仅需提供目录。 RPMS 放置制作完成后的RPM包 SOURCES 原材料放置目录（配置文件、源码包、补丁包） SPECS 放置spec文件（纲领性文件）的。 SRPMS SRC rpm包存放位置 RPM优缺点 优点：\n集中管理：RPM可以集中管理安装、升级和删除软件包，保证系统的干净和稳定。 精确控制：RPM提供详细的软件包信息，可以对软件包的安装路径、依赖关系、版本等进行精确控制，使得软件安装更加灵活便捷。 简单易用：RPM提供了一套完整的命令行工具和图形化管理工具，对于普通用户来说，使用起来非常方便。 更新机制：RPM可以根据用户需要进行更新，包括安全更新、功能更新和修复错误等，可以更好地保证系统安全与稳定性。 缺点：\n依赖管理：RPM虽然可以管理软件包的依赖关系，但其解决依赖的方式容易出现问题，可能会出现某些软件包的依赖关系无法解决的情况。 更新速度：由于需要对软件包进行依赖检查等操作，升级软件包可能需要较长时间，特别是当软件包依赖比较复杂时。 存在问题：有时候使用RPM安装的软件包出现问题，需要手动卸载并重新安装，这会导致一些无法预测的麻烦。 兼容性：RPM采用了特定的软件包管理标准，要求安装的软件包必须符合这些标准。因此，RPM可能不太适用于其他Linux系统或自定义的软件包格式。 SPEC文件 制作RPM软件包的关键在于编写SPEC软件包描述文件。要想制作一个rpm软件包就必须写一个软件包描述文件（SPEC）。这个文件中包含了软件包的诸多信息，如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。\nSPEC文件通常包括以下几个部分：\n头文件：包括软件包的名称、版本、发布号、授权等信息。\n%description：包括软件包的描述、依赖关系、构建环境等信息。\n%prep：指定源代码的来源和如何解压缩及准备源代码。\n%build：指定如何编译源代码。\n%install：指定如何安装编译好的软件包。\n%check：指定测试源代码的特定部分，通常是用来运行单元测试。\n%clean：指定清除构建过程中产生的临时文件和目录的方法。\n%files：指定哪些文件应该包括在最终的RPM文件中。\n%changelog：记录软件包的变更历史。\nSPEC文件中常用的宏变量 宏变量 说明 %{name} 软件包的名称，如 myapp。 %{version} 软件包的版本号，如 1.","keywords":["Linux","rpm","rpmbuild","unix","深入剖析与构建rpm包"],"articleBody":"RPM概述 RPM (Red Hat Package Manager)，几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件。对于最终用户来说，使用RPM所提供的功能来维护系统是比较容易和轻松的。安装、卸载和升级RPM软件包只需一条命令就可以搞定。RPM维护了一个所有已安装的软件包和文件的数据库，可以让用户进行查询和验证工作。在软件包升级过程中，RPM会对配置文件进行特别处理，绝对不会丢失以往的定制信息。对于程序员RPM可以让我们连同软件的源代码打包成源代码和二进制软件包供最终用户使用。\n一般而言制作一个RPM包包含以下几个步骤\n计划你想要建立什么 收集软件包 根据需要修补软件 计划升级旧有的包 创建可重现的软件构建 概述任何依赖关系 构建rpm 测试rpm（能否安装、升级） RPM capability 能力 运行或安装需要依赖于其他的RPM包本身或所提供的文件为基础的现象被称之为依赖关系。但在制作RPM包时，依赖关系有两类编译依赖与安装依赖。\n自身名字所包含的意义 它提供的文件也有可能被其他软件所依赖，文件本身也能识别成一种能力 编译依赖和安装依赖\n每一个RPM包都提供一种能够完成任务的功能，此种能力很可能被其他RPM所依赖，此能力大多数情况下和RPM名字是相同的。\n制作RPM包的纲要有如下四部\n设定RPM包制作的目录结构（制作车间） 将原材料（源码包、配置文件、补丁包）放置规划好的目录当中。 创建spec文件，指挥如何使用原材料将其制作成rpm包。 编译源代码生成rpm包 在一个特定的目录中提供如下5个子目录 redhat上默认在/usr/src/reahat BUILD 源代码解压以后放置的位置，仅需提供目录。 RPMS 放置制作完成后的RPM包 SOURCES 原材料放置目录（配置文件、源码包、补丁包） SPECS 放置spec文件（纲领性文件）的。 SRPMS SRC rpm包存放位置 RPM优缺点 优点：\n集中管理：RPM可以集中管理安装、升级和删除软件包，保证系统的干净和稳定。 精确控制：RPM提供详细的软件包信息，可以对软件包的安装路径、依赖关系、版本等进行精确控制，使得软件安装更加灵活便捷。 简单易用：RPM提供了一套完整的命令行工具和图形化管理工具，对于普通用户来说，使用起来非常方便。 更新机制：RPM可以根据用户需要进行更新，包括安全更新、功能更新和修复错误等，可以更好地保证系统安全与稳定性。 缺点：\n依赖管理：RPM虽然可以管理软件包的依赖关系，但其解决依赖的方式容易出现问题，可能会出现某些软件包的依赖关系无法解决的情况。 更新速度：由于需要对软件包进行依赖检查等操作，升级软件包可能需要较长时间，特别是当软件包依赖比较复杂时。 存在问题：有时候使用RPM安装的软件包出现问题，需要手动卸载并重新安装，这会导致一些无法预测的麻烦。 兼容性：RPM采用了特定的软件包管理标准，要求安装的软件包必须符合这些标准。因此，RPM可能不太适用于其他Linux系统或自定义的软件包格式。 SPEC文件 制作RPM软件包的关键在于编写SPEC软件包描述文件。要想制作一个rpm软件包就必须写一个软件包描述文件（SPEC）。这个文件中包含了软件包的诸多信息，如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。\nSPEC文件通常包括以下几个部分：\n头文件：包括软件包的名称、版本、发布号、授权等信息。\n%description：包括软件包的描述、依赖关系、构建环境等信息。\n%prep：指定源代码的来源和如何解压缩及准备源代码。\n%build：指定如何编译源代码。\n%install：指定如何安装编译好的软件包。\n%check：指定测试源代码的特定部分，通常是用来运行单元测试。\n%clean：指定清除构建过程中产生的临时文件和目录的方法。\n%files：指定哪些文件应该包括在最终的RPM文件中。\n%changelog：记录软件包的变更历史。\nSPEC文件中常用的宏变量 宏变量 说明 %{name} 软件包的名称，如 myapp。 %{version} 软件包的版本号，如 1.0.0。 %{release} 软件包的发布号，如 1。 %{buildroot} RPM 构建过程中的临时根目录目，模拟真实的rootfs。 %{_bindir} 系统安装二进制程序的目录，通常是 /usr/bin。 %{_docdir} man dbus 查看帮助的文档的目录，通常是 /usr/share/doc %{_datadir} 系统安装数据文件的目录，通常是 /usr/share。 %{_includedir} 系统安装头文件的目录，通常是 /usr/include。 %{_libdir} 系统安装库文件的目录，通常是 /usr/lib，64位为 /usr/lib64 %{_datarootdir} 系统安装数据的根目录，通常是 /usr/share。 %{_prefix} 软件的安装路径前缀，通常是 /usr。 %{_sysconfdir} 系统配置文件的目录，通常是 /etc。 %{_var} 系统的/var目录路径 通常情况下在封装包时使用这些宏变量，封装对应目录下的内容而不用考虑每种 Linux 系统的路径差异。例如，我们可以使用 %{_bindir} 来指定安装软件的二进制程序所在目录，而不需要考虑不同系统中二进制程序目录的具体路径，这样可以确保软件在不同系统中能够正确安装和运行。\nSPEC参数解释 文件头部分 参数 详解 Name 软件的名称，构成RPM文件的文件名构成之一 Version 软件的版本号，构成RPM文件的文件名构成之一 Release 该版本打包的次数说明，构成RPM文件的文件名构成之一 Group 软件开发团体名称 Source 软件的来源，可以是URl或者文件。可以有多个，如：\nSource: php-5.3.29.tar.gz\nSource1:php.ini\nSource2:php-fpm Patch 作为软件的补丁。 BuildRoot 设置编译时，临时存放中间文件的路径。 License 软件授权模式。一般使用GPL。 Requires 这个软件的依赖程序。 description 软件的尖端说明。这个是必须的。rpm -qi software name显示的基础说明。\nprep prepare的简写，此段的意思为，尚未进行设置或安装之前，你要编译完成的PRM帮你事先做的事情。一般情况有如下事项：\n进行软件的补丁相关工作。 寻找软件需要的目录是否存在。 事先创建软件所需要的目录，或事先进行的任务。 备份可能会替换的文件。 bash 1 2 id nginx || useradd nginx -s /sbin/nologin -M %setup -q setup 此选项类似于解压之类的工作，常用选项如下表所示：\n参数 说明 %setup 不加任何选项，仅将软件包打开。 %setup -n newdir 将软件包解压在newdir目录。 %setup -c 解压缩之前先产生目录。 %setup -b num 将第num个source文件解压缩。 %setup -T 不使用default的解压缩操作。 %setup -T -b 0 将第0个源代码文件解压缩。 %setup -c -n newdir 指定目录名称newdir，并在此目录产生rpm套件。 %setup -q 提取源码到 BUILD 目录; -q 指不显示输出（quietly） build 构建区域 所要执行的命令为生成软件包服务，如configure、make等操作。\nbash 1 2 ./configure make -j 4 install 安装区域 其中的命令在安装软件包时将执行，如make install命令。在spec文件中的make install后面加上DESTDIR=%{buildroot} DESTDIR是Makefile文件中定义的一个安装路径的变量，根据实际情况修改， 例如mysql和nginx的是DESTDIR，而php的是INSTALL_ROOT。\nbash 1 2 3 %install make INSTALL_ROOT=%{buildroot} install #\u003c==php make install DESTDIR=%{buildroot} #\u003c==nginx files 打包文件区域 定义哪些文件将被打包入RPM中，分为三类–说明文档（doc），配置文件（config）及执行程序，还可定义文件存取权限，拥有者及组别。\n%defattr (-,root,root) 指定包装文件的属性，分别是(mode,owner,group)，- 表示默认值，对文本文件是0644，可执行文件是0755 %exclude 列出不想打包到rpm中的文件。 %dir 来指定空目录 %config 配置文件 %doc 文档 bash 1 2 3 %files %defattr(-,root,root,-) /usr/share/php-5.3.29/* 注：这里是在虚拟根目录下进行，千万不要写绝对路径，而应用宏或变量表示相对路径。\nchangelog 修改日志区域 语法：第一行是：* 星期 月 日 年 修改人 电子信箱；其中：星期、月份均用英文形式的前3个字母，用中文会报错。 接下来的行写的是修改了什么地方，一般以\" - “号开始，可写多行。\nbash 1 2 3 * Tue Dec 29 1998 lc - minimum spec and patches changes for openssl - modified for openssl sources 附录：\n12个月简写 全称 简写 January Jan February Feb March Ma April Apr May - June - July - August Aug September Sept October Oct November Nov December Dec 一星期7日简写 全称 简写 Monday Mon Tuesday Tues Wednesday Wed Thurday Thur Friday Fri Saturday Sat Sunday Sun clean 清理区域 用来清理 build 后的临时文件,主要是怕这些旧的文件影响以后编译。主要是要删除 $RPM_BUILD_ROOT 和运行 make clean 。\nD-Bus0 Scriptlets 这些选项可以让你动态的使用 shell 脚本来控制安装和删除，\n%pre rpm安装前执行的脚本 %post rpm安装后执行的脚本 %preun rpm卸载前执行的脚本 %postun rpm卸载后执行的脚本 %preun 在升级的时候会执行， %postun在升级rpm包的时候不会执行\nbash 1 rpm -q --scripts packagename # 查看脚本的信息 SERVER_BIN_DIR\tCLIENT_BIN_DIR 示例nginx.spec bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 Name: nginx Version: 1.13.9 Release: 1%{?dist} Summary: nginx Group: nginx License: GPL URL: http://dangjian.chinamoblie.com Packager: nginx Vendor: nginx Source0: nginx-1.13.9.tar.gz Source1: nginx.service Requires: openssl-devel,pcre-devel BuildRoot: %{_tmppath}/%{name}-%{version}-buildroot %description nginx %prep id nginx || useradd nginx -s /sbin/nologin -M %setup -q chmod +x ./configure %build ./configure --prefix=/usr/share/nginx \\ --sbin-path=/usr/sbin/nginx \\ --with-stream \\ --conf-path=/etc/nginx/nginx.conf \\ --error-log-path=/data/nginx/log/error.log \\ --pid-path=/data/nginx/run/nginx.pid \\ --lock-path=/data/nginx/lock/nginx.lock \\ --user=nginx --group=nginx \\ --with-http_ssl_module \\ --with-http_stub_status_module \\ --with-http_flv_module \\ --with-http_gzip_static_module \\ --http-log-path=/data/nginx/log/access.log --http-client-body-temp-path=/data/nginx/tmp/client/ \\ --http-proxy-temp-path=/data/nginx/tmp/proxy/ \\ --http-fastcgi-temp-path=/data/nginx/tmp/fcgi/ \\ --http-scgi-temp-path=/data/nginx/tmp/scgi \\ --http-uwsgi-temp-path=/data/nginx/tmp/uwsgi make %install make install DESTDIR=$RPM_BUILD_ROOT %{__install} -p -D %{SOURCE1} %{buildroot}/usr/lib/systemd/system/nginx.service %{__mkdir_p} /data/nginx/tmp/{client,uwsgi,scgi,fcgi,proxy} %files %defattr(-,root,root,-) %attr(0644,root,root) /usr/share/nginx/* %attr(0755,root,root) /usr/sbin/nginx %attr(0644,root,root) /etc/nginx/* %attr(0744,nginx,nginx) /data/nginx/* %attr(0744,root,root) /usr/lib/systemd/system/nginx.service %clean rm -rf $RPM_BUILD_DIR/%{name}-%{version} %pre id nginx || useradd nginx -s /sbin/nologin -M %preun systemctl stop nginx %postun rm -fr /data/nginx/ userdel nginx %changelog * Sun Aug 24 2015 LC 1.15-1 - package libiconv-1.15 rpmbuild rpmbuild 是用于构建 RPM 包的工具。RPM 是一种软件包管理格式，它可以简化软件的分发，使其在不同的 Linux 系统上易于安装和使用。rpmbuild 工具可以帮助我们构建这样的 RPM 包。\n参数 说明 -ba 既生成src.rpm又生成二进制rpm -bs 只生成src的rpm -bb 只生二进制的rpm -bp 执行到pre -bc 执行到 build段 -bi 执行install段 -bl 检测有文件没包含 rpmbuild 安装 rpm包并不仅仅限制于 Fedora/Redhat ，也可以使用在其他的发行版中\n对于 CentOS：\nbash 1 sudo yum install -y rpm-build redhat-rpm-config rpmdevtools 对于 Fedora：\nbash 1 sudo dnf install -y rpm-build redhat-rpm-config rpmdevtools 对于 Ubuntu：\nbash 1 sudo apt install -y rpm 查看默认宏\nbash 1 rpmbuild --showrc 创建 RPM 构建目录 要开始构建 RPM 包，您需要先创建 RPM 构建目录和相关文件。使用以下命令创建 RPM 构建目录和必要的子目录：\nbash 1 2 cd ~ mkdir -p rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS} 上述命令创建了 5 个子目录：\nBUILD: 构建 RPM 包所需的源码和二进制文件存放的目录。 RPMS: 二进制 RPM 包保存的目录。 SOURCES: 存储软件包的源代码，rpmbuild 根据该代码创建 RPM 包。 SPECS: INCLUDE metadata and build instructions files for creating RPM files SRPMS: 用于存储源 RPM 包的目录。 rpmbuild示例：如何使用rpmbuild制作php rpm包 sh 1 mkdir -pv ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS} php有一个依赖库，在yum源于epel源中都没有需要自己打包libiconv\n编写 libiconv 的spec文件\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 %define __os_install_post %{nil} %define debug_package %{nil} Name: libiconv Version: 1.15 Release: 1%{?dist} Summary: liconv Group: liconv License: GPL URL: http://www.test.net Packager: test Vendor: test Source0: libiconv-1.15.tar.gz BuildRoot: %{_tmppath}/%{name}-%{version}-buildroot %description iconv %prep %setup -q %build ./configure --prefix=/usr/share/libiconv-1.15 \\ make %install make install DESTDIR=%{buildroot} %files %defattr(-,root,root,-) %attr(0655,root,root) /usr/share/libiconv-1.15/* %attr(0755,root,root) /usr/share/libiconv-1.15/bin/* %clean rm -rf $RPM_BUILD_DIR/%{name}-%{version} %post ln -sv /usr/share/libiconv-1.15/ /usr/share/libiconv %changelog * Sun Aug 24 2015 LC 1.15-1 - package libiconv-1.15 打包libiconv遇到的错误 bash 1 2 3 4 5 6 7 Binary file /root/rpmbuild/BUILDROOT/libiconv-1.15.el7.centos.x86_64/usr/share/libiconv-1.15/bin/iconv matches Found '/root/rpmbuild/BUILDROOT/libiconv-1.15-1.el7.centos.x86_64' in installed files; aborting error: Bad exit status from /var/tmp/rpm-tmp.6AgqPk (%install) RPM build errors: Bad exit status from /var/tmp/rpm-tmp.6AgqPk (%install) 问题原因：\n在rpm构建过程中，在％install阶段结束时，运行 /usr/lib/rpm/check-buildroot脚本以检查构建根目录中的文件。此脚本扫描构建根目录中的所有文件，以获取${RPM_BUILD_ROOT}路径的任何引用。\n也就是说libiconv已经编译完成。一般情况下，是可以正常使用的。所以不需要他检查构建根目录。\n解决方法：通过报错信息可以得到如下提示\nbash 1 2 RPM build errors: Bad exit status from /var/tmp/rpm-tmp.6AgqPk (%install) 根据保存信息查看文件的执行过程。/var/tmp/rpm-tmp.6AgqPk，并发现脚本在执行到/usr/lib/rpm/check-buildroot时停止了。也就是说，执行这个脚本检查构建根目录时$?不为0\nbash 1 2 3 4 5 cd 'libiconv-1.15' make install DESTDIR=/root/rpmbuild/BUILDROOT/libiconv-1.15-1.el7.centos.x86_64 /usr/lib/rpm/check-buildroot 查看/usr/lib/rpm/check-buildroot脚本，发现只有此段检查才$?返回的是1。\nbash 1 2 3 4 5 test -s \"$tmp\" \u0026\u0026 { cat \"$tmp\" echo \"Found '$RPM_BUILD_ROOT' in installed files; aborting\" exit 1 } || : 由于压根不知道 $tmp 在哪里传入的。又压根可以不检查构建根目录的。直接在 /usr/lib/rpm/check-buildroot 脚本最前面加上 exit 0 让构建RPM包时跳过此步骤。之后成功完成rpm构建。\n参考文档： pk’s Tech Page: Found ‘${RPM_BUILD_ROOT}’ in installed files; aborting\nc++ - What does /usr/lib/rpm/check-buildroot do? - Stack Overflow\n编写spec文件 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 Name: php Version: 7.1.17 Release: 1%{?dist} Summary: php Group: php License: GPL URL: http://php.org Packager: php Vendor: php Source0: php-7.1.17.tar.bz2 Source1: php.ini BuildRoot: %{_tmppath}/%{name}-%{version}-buildroot Requires: libiconv,zlib-devel,libxml2-devel,libjpeg-devel,libjpeg-turbo-devel,freetype-devel,libpng-devel,gd-devel,curl-devel,libxslt-devel,bzip2-devel,gmp-devel,readline-devel,mcrypt,mhash,libmcrypt-devel %description php %prep id nginx || useradd nginx -s /sbin/nologin -M %setup -q %build ./configure \\ --prefix=/usr/share/php-7.1.17 \\ --with-config-file-path=/etc/php/ \\ --exec-prefix=/usr \\ --bindir=/usr/bin \\ --sbindir=/usr/sbin \\ --mandir=/usr/share/man \\ --sysconfdir=/etc/php/ \\ --with-mysqli=mysqlnd \\ --with-iconv-dir=/usr/share/libiconv \\ --with-jpeg-dir \\ --with-png-dir \\ --with-zlib-dir \\ --with-libxml-dir \\ --enable-xml \\ --disable-rpath \\ --enable-safe-mode \\ --enable-bcmath \\ --enable-shmop \\ --enable-sysvsem \\ --enable-inline-optimization \\ --with-curl \\ --enable-mbregex \\ --enable-fpm \\ --enable-mbstring \\ --with-mcrypt \\ --with-gd \\ --enable-gd-native-ttf \\ --with-openssl \\ --with-mhash \\ --enable-pcntl \\ --enable-sockets \\ --with-xmlrpc \\ --enable-zip \\ --enable-soap \\ --enable-short-tags \\ --enable-zend-multibyte \\ --enable-static \\ --with-xsl \\ --with-fpm-user=nginx \\ --with-fpm-group=nginx make -j 4 %install rm -rf %{buildroot} make INSTALL_ROOT=%{buildroot} install %{__install} -p -D %{SOURCE1} %{buildroot}/etc/php/php.ini %files %defattr(-,root,root,-) /usr/share/php-7.1.17/* %attr(0744,root,root) /usr/bin/* %attr(0744,root,root) /usr/sbin/* /usr/share/man/* /etc/php/* %pre id nginx || useradd nginx -s /sbin/nologin -M %post cp /etc/php/php-fpm.conf.default /etc/php/php-fpm.conf cp /etc/php/php-fpm.d/www.conf.default /etc/php/php-fpm.d/www.conf %postun userdel nginx %changelog * Sun Aug 10 2018 lc zhoushilong - package php-7.1.71 构建PHP RPM包遇到的问题 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 RPM build errors: bogus date in %changelog: Sun Aug 10 2018 lc zhoushilong Explicit %attr() mode not applicaple to symlink: /root/rpmbuild/BUILDROOT/php-7.1.17-1.el7.centos.x86_64/usr/bin/phar Installed (but unpackaged) file(s) found: /.channels/.alias/pear.txt /.channels/.alias/pecl.txt /.channels/.alias/phpdocs.txt /.channels/__uri.reg /.channels/doc.php.net.reg /.channels/pear.php.net.reg /.channels/pecl.php.net.reg /.depdb /.depdblock /.filemap /.lock 解决方法如下：\n方法1：生成的rpm包里有前面在%files里添加的这个文件，如下：\nbash 1 /usr/local/php/.channels 方法2：下面是直接删除的解决办法，实践OK（视具体情况是删除还是添加选一个即可）\nbash 1 rm -rf %{buildroot}/{.channels,.depdb,.depdblock,.filemap,.lock} 方法三： /usr/lib/rpm/macros 修改宏\nbash 1 2 3 4 # 构建根目录中的未打包文件是否应终止构建？ %_unpackaged_files_terminate_build 1 # 把1改为0只警告 %__check_files %{_rpmconfigdir}/check-files %{buildroot} # 这一行，把这一行注释掉，然后重新编译 %__check_files说明：\nBuild configuration macros. Script gets packaged file list on input and buildroot as first parameter. Returns list of unpackaged files, i.e. files in $RPM_BUILD_ROOT not packaged. Note: Disable (by commenting out) for legacy compatibility.\n构建配置宏。 脚本在输入和buildroot上获取打包文件列表作为第一个参数。 返回未打包文件的列表，即 $ RPM_BUILD_ROOT 中未打包的文件。 注意：禁用（通过注释掉）旧版兼容性。\n打包报错 sh 1 2 3 4 5 6 7 8 + '%{__debug_install_post}' /var/tmp/rpm-tmp.o0N7t4: line 45: fg: no job control error: Bad exit status from /var/tmp/rpm-tmp.o0N7t4 (%install) RPM build errors: bogus date in %changelog: Sun Aug 24 2018 YB 1.14.2 Bad exit status from /var/tmp/rpm-tmp.o0N7t4 (%install) 解决：使用以下命令禁用check-buildroot\ntext 1 2 %define __arch_install_post %{nil} %define __os_install_post %{nil} 关闭调试信息：\ntext 1 %global debug_package %{nil} 参考网址 rpmbuild 之 /usr/lib/rpm/check-buildroot\nrpmbuild - how to disable check-buildroot?\n[实践OK]rpmbuild报error: Installed (but unpackaged) file(s) found的解决办法\nrpmbuild 打包rpm实战\nrpmbuild 中文手册\nCreating RPM packages :: Fedora Docs Site\nHow to create an RPM package/zh-cn - Fedora Project Wiki\nFedora Packaging Guidelines - Fedora Project Wiki\n","wordCount":"1442","inLanguage":"zh","datePublished":"2018-09-15T00:00:00Z","dateModified":"2023-03-26T23:10:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2018/09/rpm-package/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Unix归档模式 cpio - 深入剖析与构建rpm包</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2018-09-15</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1442 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>7 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/linux/>#Linux</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#rpm%e6%a6%82%e8%bf%b0 aria-label=RPM概述>RPM概述</a><li><a href=#rpm%e4%bc%98%e7%bc%ba%e7%82%b9 aria-label=RPM优缺点>RPM优缺点</a><li><a href=#spec%e6%96%87%e4%bb%b6 aria-label=SPEC文件>SPEC文件</a><ul><li><a href=#spec%e6%96%87%e4%bb%b6%e4%b8%ad%e5%b8%b8%e7%94%a8%e7%9a%84%e5%ae%8f%e5%8f%98%e9%87%8f aria-label=SPEC文件中常用的宏变量>SPEC文件中常用的宏变量</a><li><a href=#spec%e5%8f%82%e6%95%b0%e8%a7%a3%e9%87%8a aria-label=SPEC参数解释>SPEC参数解释</a><ul><li><a href=#%e6%96%87%e4%bb%b6%e5%a4%b4%e9%83%a8%e5%88%86 aria-label=文件头部分>文件头部分</a><li><a href=#description aria-label=description>description</a><li><a href=#prep aria-label=prep>prep</a><li><a href=#setup aria-label=setup>setup</a><li><a href=#build-%e6%9e%84%e5%bb%ba%e5%8c%ba%e5%9f%9f aria-label="build 构建区域">build 构建区域</a><li><a href=#install-%e5%ae%89%e8%a3%85%e5%8c%ba%e5%9f%9f aria-label="install 安装区域">install 安装区域</a><li><a href=#files-%e6%89%93%e5%8c%85%e6%96%87%e4%bb%b6%e5%8c%ba%e5%9f%9f aria-label="files 打包文件区域">files 打包文件区域</a><li><a href=#changelog-%e4%bf%ae%e6%94%b9%e6%97%a5%e5%bf%97%e5%8c%ba%e5%9f%9f aria-label="changelog 修改日志区域">changelog 修改日志区域</a><li><a href=#clean-%e6%b8%85%e7%90%86%e5%8c%ba%e5%9f%9f aria-label="clean 清理区域">clean 清理区域</a><li><a href=#d-bus0-scriptlets aria-label="D-Bus0 Scriptlets">D-Bus0 Scriptlets</a></ul><li><a href=#%e7%a4%ba%e4%be%8bnginxspec aria-label=示例nginx.spec>示例nginx.spec</a></ul><li><a href=#rpmbuild aria-label=rpmbuild>rpmbuild</a><ul><li><a href=#rpmbuild-%e5%ae%89%e8%a3%85 aria-label="rpmbuild 安装">rpmbuild 安装</a><li><a href=#%e5%88%9b%e5%bb%ba-rpm-%e6%9e%84%e5%bb%ba%e7%9b%ae%e5%bd%95 aria-label="创建 RPM 构建目录">创建 RPM 构建目录</a></ul><li><a href=#rpmbuild%e7%a4%ba%e4%be%8b%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8rpmbuild%e5%88%b6%e4%bd%9cphp-rpm%e5%8c%85 aria-label="rpmbuild示例：如何使用rpmbuild制作php rpm包">rpmbuild示例：如何使用rpmbuild制作php rpm包</a><ul><li><a href=#%e6%89%93%e5%8c%85libiconv%e9%81%87%e5%88%b0%e7%9a%84%e9%94%99%e8%af%af aria-label=打包libiconv遇到的错误>打包libiconv遇到的错误</a><li><a href=#%e7%bc%96%e5%86%99spec%e6%96%87%e4%bb%b6 aria-label=编写spec文件>编写spec文件</a><li><a href=#%e6%9e%84%e5%bb%baphp-rpm%e5%8c%85%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98 aria-label="构建PHP RPM包遇到的问题">构建PHP RPM包遇到的问题</a><li><a href=#%e6%89%93%e5%8c%85%e6%8a%a5%e9%94%99 aria-label=打包报错>打包报错</a></ul><li><a href=#%e5%8f%82%e8%80%83%e7%bd%91%e5%9d%80 aria-label=参考网址>参考网址</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=rpm概述>RPM概述<a hidden class=anchor aria-hidden=true href=#rpm概述>#</a></h2><p>RPM (<em><strong>Red Hat Package Manager</strong></em>)，几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件。对于最终用户来说，使用RPM所提供的功能来维护系统是比较容易和轻松的。安装、卸载和升级RPM软件包只需一条命令就可以搞定。RPM维护了一个所有已安装的软件包和文件的数据库，可以让用户进行查询和验证工作。在软件包升级过程中，RPM会对配置文件进行特别处理，绝对不会丢失以往的定制信息。对于程序员RPM可以让我们连同软件的源代码打包成源代码和二进制软件包供最终用户使用。</p><p>一般而言制作一个RPM包包含以下几个步骤</p><ul><li>计划你想要建立什么</li><li>收集软件包</li><li>根据需要修补软件</li><li>计划升级旧有的包</li><li>创建可重现的软件构建</li><li>概述任何依赖关系</li><li>构建rpm</li><li>测试rpm（能否安装、升级）</li></ul><p>RPM capability 能力
运行或安装需要依赖于其他的RPM包本身或所提供的文件为基础的现象被称之为依赖关系。但在制作RPM包时，依赖关系有两类<code>编译依赖</code>与<code>安装依赖</code>。</p><ul><li>自身名字所包含的意义</li><li>它提供的文件也有可能被其他软件所依赖，文件本身也能识别成一种能力</li></ul><p>编译依赖和安装依赖</p><p>每一个RPM包都提供一种能够完成任务的功能，此种能力很可能被其他RPM所依赖，此能力大多数情况下和RPM名字是相同的。</p><p>制作RPM包的纲要有如下四部</p><ul><li>设定RPM包制作的目录结构（制作车间）</li><li>将原材料（源码包、配置文件、补丁包）放置规划好的目录当中。</li><li>创建spec文件，指挥如何使用原材料将其制作成rpm包。</li><li>编译源代码生成rpm包</li></ul><p>在一个特定的目录中提供如下5个子目录 redhat上默认在<code>/usr/src/reahat</code></p><ul><li><code>BUILD</code> 源代码解压以后放置的位置，仅需提供目录。</li><li><code>RPMS</code> 放置制作完成后的RPM包</li><li><code>SOURCES</code> 原材料放置目录（配置文件、源码包、补丁包）</li><li><code>SPECS</code> 放置spec文件（纲领性文件）的。</li><li><code>SRPMS</code> SRC rpm包存放位置</li></ul><h2 id=rpm优缺点>RPM优缺点<a hidden class=anchor aria-hidden=true href=#rpm优缺点>#</a></h2><p>优点：</p><ol><li>集中管理：RPM可以集中管理安装、升级和删除软件包，保证系统的干净和稳定。</li><li>精确控制：RPM提供详细的软件包信息，可以对软件包的安装路径、依赖关系、版本等进行精确控制，使得软件安装更加灵活便捷。</li><li>简单易用：RPM提供了一套完整的命令行工具和图形化管理工具，对于普通用户来说，使用起来非常方便。</li><li>更新机制：RPM可以根据用户需要进行更新，包括安全更新、功能更新和修复错误等，可以更好地保证系统安全与稳定性。</li></ol><p>缺点：</p><ol><li>依赖管理：RPM虽然可以管理软件包的依赖关系，但其解决依赖的方式容易出现问题，可能会出现某些软件包的依赖关系无法解决的情况。</li><li>更新速度：由于需要对软件包进行依赖检查等操作，升级软件包可能需要较长时间，特别是当软件包依赖比较复杂时。</li><li>存在问题：有时候使用RPM安装的软件包出现问题，需要手动卸载并重新安装，这会导致一些无法预测的麻烦。</li><li>兼容性：RPM采用了特定的软件包管理标准，要求安装的软件包必须符合这些标准。因此，RPM可能不太适用于其他Linux系统或自定义的软件包格式。</li></ol><h2 id=spec文件>SPEC文件<a hidden class=anchor aria-hidden=true href=#spec文件>#</a></h2><p>制作RPM软件包的关键在于编写SPEC软件包描述文件。要想制作一个rpm软件包就必须写一个软件包描述文件（SPEC）。这个文件中包含了软件包的诸多信息，如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。</p><p><strong>SPEC文件通常包括以下几个部分</strong>：</p><ol><li><p>头文件：包括软件包的名称、版本、发布号、授权等信息。</p></li><li><p>%description：包括软件包的描述、依赖关系、构建环境等信息。</p></li><li><p>%prep：指定源代码的来源和如何解压缩及准备源代码。</p></li><li><p>%build：指定如何编译源代码。</p></li><li><p>%install：指定如何安装编译好的软件包。</p></li><li><p>%check：指定测试源代码的特定部分，通常是用来运行单元测试。</p></li><li><p>%clean：指定清除构建过程中产生的临时文件和目录的方法。</p></li><li><p>%files：指定哪些文件应该包括在最终的RPM文件中。</p></li><li><p>%changelog：记录软件包的变更历史。</p></li></ol><h3 id=spec文件中常用的宏变量>SPEC文件中常用的宏变量<a hidden class=anchor aria-hidden=true href=#spec文件中常用的宏变量>#</a></h3><table><thead><tr><th>宏变量</th><th>说明</th></tr></thead><tbody><tr><td>%{name}</td><td>软件包的名称，如 myapp。</td></tr><tr><td>%{version}</td><td>软件包的版本号，如 1.0.0。</td></tr><tr><td>%{release}</td><td>软件包的发布号，如 1。</td></tr><tr><td>%{buildroot}</td><td>RPM 构建过程中的临时根目录目，模拟真实的rootfs。</td></tr><tr><td>%{_bindir}</td><td>系统安装二进制程序的目录，通常是 /usr/bin。</td></tr><tr><td>%{_docdir}</td><td>man dbus 查看帮助的文档的目录，通常是 /usr/share/doc</td></tr><tr><td>%{_datadir}</td><td>系统安装数据文件的目录，通常是 /usr/share。</td></tr><tr><td>%{_includedir}</td><td>系统安装头文件的目录，通常是 /usr/include。</td></tr><tr><td>%{_libdir}</td><td>系统安装库文件的目录，通常是 /usr/lib，64位为 /usr/lib64</td></tr><tr><td>%{_datarootdir}</td><td>系统安装数据的根目录，通常是 /usr/share。</td></tr><tr><td>%{_prefix}</td><td>软件的安装路径前缀，通常是 /usr。</td></tr><tr><td>%{_sysconfdir}</td><td>系统配置文件的目录，通常是 /etc。</td></tr><tr><td>%{_var}</td><td>系统的/var目录路径</td></tr></tbody></table><p>通常情况下在封装包时使用这些宏变量，封装对应目录下的内容而不用考虑每种 Linux 系统的路径差异。例如，我们可以使用 <code>%{_bindir}</code> 来指定安装软件的二进制程序所在目录，而不需要考虑不同系统中二进制程序目录的具体路径，这样可以确保软件在不同系统中能够正确安装和运行。</p><h3 id=spec参数解释>SPEC参数解释<a hidden class=anchor aria-hidden=true href=#spec参数解释>#</a></h3><h4 id=文件头部分>文件头部分<a hidden class=anchor aria-hidden=true href=#文件头部分>#</a></h4><table><thead><tr><th>参数</th><th>详解</th></tr></thead><tbody><tr><td>Name</td><td>软件的名称，<font color=#f8070d size=3>构成RPM文件的文件名构成之一</font></td></tr><tr><td>Version</td><td>软件的版本号，<font color=#f8070d size=3>构成RPM文件的文件名构成之一</font></td></tr><tr><td>Release</td><td>该版本打包的次数说明，<font color=#f8070d size=3>构成RPM文件的文件名构成之一</font></td></tr><tr><td>Group</td><td>软件开发团体名称</td></tr><tr><td>Source</td><td>软件的来源，可以是URl或者文件。可以有多个，如：<br>Source: php-5.3.29.tar.gz<br>Source1:php.ini<br>Source2:php-fpm</td></tr><tr><td>Patch</td><td>作为软件的补丁。</td></tr><tr><td>BuildRoot</td><td>设置编译时，临时存放中间文件的路径。</td></tr><tr><td>License</td><td>软件授权模式。一般使用GPL。</td></tr><tr><td>Requires</td><td>这个软件的依赖程序。</td></tr></tbody></table><h4 id=description>description<a hidden class=anchor aria-hidden=true href=#description>#</a></h4><p>软件的尖端说明。<font style=background:#fee904 size=2>这个是必须的</font>。<code>rpm -qi software name</code>显示的基础说明。</p><h4 id=prep>prep<a hidden class=anchor aria-hidden=true href=#prep>#</a></h4><p>prepare的简写，此段的意思为，尚未进行设置或安装之前，你要编译完成的PRM帮你事先做的事情。一般情况有如下事项：</p><ol><li>进行软件的补丁相关工作。</li><li>寻找软件需要的目录是否存在。</li><li>事先创建软件所需要的目录，或事先进行的任务。</li><li>备份可能会替换的文件。</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>id nginx <span class=o>||</span> useradd nginx -s /sbin/nologin -M
</span></span><span class=line><span class=cl>%setup -q</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=setup>setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h4><p>此选项类似于解压之类的工作，常用选项如下表所示：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>%setup</td><td>不加任何选项，仅将软件包打开。</td></tr><tr><td>%setup -n newdir</td><td>将软件包解压在newdir目录。</td></tr><tr><td>%setup -c</td><td>解压缩之前先产生目录。</td></tr><tr><td>%setup -b num</td><td>将第num个source文件解压缩。</td></tr><tr><td>%setup -T</td><td>不使用default的解压缩操作。</td></tr><tr><td>%setup -T -b 0</td><td>将第0个源代码文件解压缩。</td></tr><tr><td>%setup -c -n newdir</td><td>指定目录名称newdir，并在此目录产生rpm套件。</td></tr><tr><td>%setup -q</td><td>提取源码到 BUILD 目录; -q 指不显示输出（quietly）</td></tr></tbody></table><h4 id=build-构建区域>build 构建区域<a hidden class=anchor aria-hidden=true href=#build-构建区域>#</a></h4><p>所要执行的命令为生成软件包服务，如configure、make等操作。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./configure
</span></span><span class=line><span class=cl>make -j <span class=m>4</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=install-安装区域>install 安装区域<a hidden class=anchor aria-hidden=true href=#install-安装区域>#</a></h4><p>其中的命令在安装软件包时将执行，如make install命令。在spec文件中的make install后面加上<code>DESTDIR=%{buildroot}</code>
DESTDIR是Makefile文件中定义的一个安装路径的变量，根据实际情况修改，<font style=background:#fee904 size=2> 例如mysql和nginx的是DESTDIR</font>，而<font style=background:#02fa3c size=2>php的是INSTALL_ROOT</font>。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>%install
</span></span><span class=line><span class=cl>make <span class=nv>INSTALL_ROOT</span><span class=o>=</span>%<span class=o>{</span>buildroot<span class=o>}</span> install  <span class=c1>#&lt;==php</span>
</span></span><span class=line><span class=cl>make install <span class=nv>DESTDIR</span><span class=o>=</span>%<span class=o>{</span>buildroot<span class=o>}</span> <span class=c1>#&lt;==nginx</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=files-打包文件区域>files 打包文件区域<a hidden class=anchor aria-hidden=true href=#files-打包文件区域>#</a></h4><p>定义哪些文件将被打包入RPM中，分为三类&ndash;说明文档（doc），配置文件（config）及执行程序，还可定义文件存取权限，拥有者及组别。</p><ul><li><code>%defattr (-,root,root)</code> 指定包装文件的属性，分别是(mode,owner,group)，<code>-</code> 表示默认值，对文本文件是0644，可执行文件是0755</li><li>%exclude 列出不想打包到rpm中的文件。</li><li>%dir 来指定空目录</li><li>%config 配置文件</li><li>%doc 文档</li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>%files
</span></span><span class=line><span class=cl>%defattr<span class=o>(</span>-,root,root,-<span class=o>)</span>
</span></span><span class=line><span class=cl>/usr/share/php-5.3.29/*</span></span></code></pre></td></tr></table></div></div></div></div><hr><p><font color=#0215cd size=3><strong>注：这里是在虚拟根目录下进行，千万不要写绝对路径，而应用宏或变量表示相对路径。</strong></font></p><hr><h4 id=changelog-修改日志区域>changelog 修改日志区域<a hidden class=anchor aria-hidden=true href=#changelog-修改日志区域>#</a></h4><p>语法：第一行是：<code>* 星期 月 日 年 修改人 电子信箱</code>；其中：星期、月份均用英文形式的前3个字母，用中文会报错。
接下来的行写的是修改了什么地方，<font color=#f8070d size=2><strong>一般以" - &ldquo;号开始，可写多行。</strong></font></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>* Tue Dec <span class=m>29</span> <span class=m>1998</span> lc &lt;lc.com@gmail.com&gt;
</span></span><span class=line><span class=cl>- minimum spec and patches changes <span class=k>for</span> openssl
</span></span><span class=line><span class=cl>- modified <span class=k>for</span> openssl sources</span></span></code></pre></td></tr></table></div></div></div></div><p>附录：</p><ol><li><strong>12个月简写</strong></li></ol><table><thead><tr><th>全称</th><th>简写</th></tr></thead><tbody><tr><td>January</td><td>Jan</td></tr><tr><td>February</td><td>Feb</td></tr><tr><td>March</td><td>Ma</td></tr><tr><td>April</td><td>Apr</td></tr><tr><td>May</td><td>-</td></tr><tr><td>June</td><td>-</td></tr><tr><td>July</td><td>-</td></tr><tr><td>August</td><td>Aug</td></tr><tr><td>September</td><td>Sept</td></tr><tr><td>October</td><td>Oct</td></tr><tr><td>November</td><td>Nov</td></tr><tr><td>December</td><td>Dec</td></tr></tbody></table><ol start=2><li><strong>一星期7日简写</strong></li></ol><table><thead><tr><th>全称</th><th>简写</th></tr></thead><tbody><tr><td>Monday</td><td>Mon</td></tr><tr><td>Tuesday</td><td>Tues</td></tr><tr><td>Wednesday</td><td>Wed</td></tr><tr><td>Thurday</td><td>Thur</td></tr><tr><td>Friday</td><td>Fri</td></tr><tr><td>Saturday</td><td>Sat</td></tr><tr><td>Sunday</td><td>Sun</td></tr></tbody></table><h4 id=clean-清理区域>clean 清理区域<a hidden class=anchor aria-hidden=true href=#clean-清理区域>#</a></h4><p>用来清理 build 后的临时文件,主要是怕这些旧的文件影响以后编译。主要是要删除 $RPM_BUILD_ROOT 和运行 make clean 。</p><h4 id=d-bus0-scriptlets>D-Bus0 Scriptlets<a hidden class=anchor aria-hidden=true href=#d-bus0-scriptlets>#</a></h4><p>这些选项可以让你动态的使用 shell 脚本来控制安装和删除，</p><ul><li>%pre rpm安装前执行的脚本</li><li>%post rpm安装后执行的脚本</li><li>%preun rpm卸载前执行的脚本</li><li>%postun rpm卸载后执行的脚本</li></ul><hr><p>%preun 在升级的时候会执行， %postun在升级rpm包的时候不会执行</p><hr><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rpm -q --scripts packagename <span class=c1># 查看脚本的信息  SERVER_BIN_DIR	 CLIENT_BIN_DIR</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=示例nginxspec>示例nginx.spec<a hidden class=anchor aria-hidden=true href=#示例nginxspec>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Name: nginx
</span></span><span class=line><span class=cl>Version: 1.13.9
</span></span><span class=line><span class=cl>Release: 1%<span class=o>{</span>?dist<span class=o>}</span>
</span></span><span class=line><span class=cl>Summary: nginx
</span></span><span class=line><span class=cl>Group: nginx
</span></span><span class=line><span class=cl>License: GPL
</span></span><span class=line><span class=cl>URL: http://dangjian.chinamoblie.com
</span></span><span class=line><span class=cl>Packager: nginx
</span></span><span class=line><span class=cl>Vendor: nginx
</span></span><span class=line><span class=cl>Source0: nginx-1.13.9.tar.gz
</span></span><span class=line><span class=cl>Source1: nginx.service
</span></span><span class=line><span class=cl>Requires: openssl-devel,pcre-devel
</span></span><span class=line><span class=cl>BuildRoot: %<span class=o>{</span>_tmppath<span class=o>}</span>/%<span class=o>{</span>name<span class=o>}</span>-%<span class=o>{</span>version<span class=o>}</span>-buildroot
</span></span><span class=line><span class=cl>%description 
</span></span><span class=line><span class=cl>nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%prep
</span></span><span class=line><span class=cl>id nginx <span class=o>||</span> useradd nginx -s /sbin/nologin -M
</span></span><span class=line><span class=cl>%setup -q
</span></span><span class=line><span class=cl>chmod +x ./configure
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%build
</span></span><span class=line><span class=cl>./configure --prefix<span class=o>=</span>/usr/share/nginx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--sbin-path<span class=o>=</span>/usr/sbin/nginx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-stream <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--conf-path<span class=o>=</span>/etc/nginx/nginx.conf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--error-log-path<span class=o>=</span>/data/nginx/log/error.log <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--pid-path<span class=o>=</span>/data/nginx/run/nginx.pid <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--lock-path<span class=o>=</span>/data/nginx/lock/nginx.lock <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--user<span class=o>=</span>nginx --group<span class=o>=</span>nginx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-http_ssl_module <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-http_stub_status_module <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-http_flv_module <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-http_gzip_static_module <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--http-log-path<span class=o>=</span>/data/nginx/log/access.log --http-client-body-temp-path<span class=o>=</span>/data/nginx/tmp/client/ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--http-proxy-temp-path<span class=o>=</span>/data/nginx/tmp/proxy/ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--http-fastcgi-temp-path<span class=o>=</span>/data/nginx/tmp/fcgi/ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--http-scgi-temp-path<span class=o>=</span>/data/nginx/tmp/scgi <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--http-uwsgi-temp-path<span class=o>=</span>/data/nginx/tmp/uwsgi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>make
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%install
</span></span><span class=line><span class=cl>make install <span class=nv>DESTDIR</span><span class=o>=</span><span class=nv>$RPM_BUILD_ROOT</span>
</span></span><span class=line><span class=cl>%<span class=o>{</span>__install<span class=o>}</span> -p -D %<span class=o>{</span>SOURCE1<span class=o>}</span> %<span class=o>{</span>buildroot<span class=o>}</span>/usr/lib/systemd/system/nginx.service
</span></span><span class=line><span class=cl>%<span class=o>{</span>__mkdir_p<span class=o>}</span> /data/nginx/tmp/<span class=o>{</span>client,uwsgi,scgi,fcgi,proxy<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%files
</span></span><span class=line><span class=cl>%defattr<span class=o>(</span>-,root,root,-<span class=o>)</span>
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0644,root,root<span class=o>)</span> /usr/share/nginx/*
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0755,root,root<span class=o>)</span> /usr/sbin/nginx
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0644,root,root<span class=o>)</span> /etc/nginx/*
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0744,nginx,nginx<span class=o>)</span> /data/nginx/*
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0744,root,root<span class=o>)</span> /usr/lib/systemd/system/nginx.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%clean
</span></span><span class=line><span class=cl>rm -rf <span class=nv>$RPM_BUILD_DIR</span>/%<span class=o>{</span>name<span class=o>}</span>-%<span class=o>{</span>version<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%pre
</span></span><span class=line><span class=cl>id nginx <span class=o>||</span> useradd nginx -s /sbin/nologin -M
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%preun
</span></span><span class=line><span class=cl>systemctl stop nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%postun
</span></span><span class=line><span class=cl>rm -fr /data/nginx/
</span></span><span class=line><span class=cl>userdel nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%changelog
</span></span><span class=line><span class=cl>* Sun Aug <span class=m>24</span> <span class=m>2015</span> LC 1.15-1
</span></span><span class=line><span class=cl>- package libiconv-1.15</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=rpmbuild>rpmbuild<a hidden class=anchor aria-hidden=true href=#rpmbuild>#</a></h2><p>rpmbuild 是用于构建 RPM 包的工具。RPM 是一种软件包管理格式，它可以简化软件的分发，使其在不同的 Linux 系统上易于安装和使用。rpmbuild 工具可以帮助我们构建这样的 RPM 包。</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-ba</td><td>既生成src.rpm又生成二进制rpm</td></tr><tr><td>-bs</td><td>只生成src的rpm</td></tr><tr><td>-bb</td><td>只生二进制的rpm</td></tr><tr><td>-bp</td><td>执行到pre</td></tr><tr><td>-bc</td><td>执行到 build段</td></tr><tr><td>-bi</td><td>执行install段</td></tr><tr><td>-bl</td><td>检测有文件没包含</td></tr></tbody></table><h3 id=rpmbuild-安装>rpmbuild 安装<a hidden class=anchor aria-hidden=true href=#rpmbuild-安装>#</a></h3><p>rpm包并不仅仅限制于 Fedora/Redhat ，也可以使用在其他的发行版中</p><p>对于 CentOS：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo yum install -y rpm-build redhat-rpm-config rpmdevtools</span></span></code></pre></td></tr></table></div></div></div></div><p>对于 Fedora：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dnf install -y rpm-build redhat-rpm-config rpmdevtools</span></span></code></pre></td></tr></table></div></div></div></div><p>对于 Ubuntu：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install -y rpm</span></span></code></pre></td></tr></table></div></div></div></div><p>查看默认宏</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> rpmbuild --showrc</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=创建-rpm-构建目录>创建 RPM 构建目录<a hidden class=anchor aria-hidden=true href=#创建-rpm-构建目录>#</a></h3><p>要开始构建 RPM 包，您需要先创建 RPM 构建目录和相关文件。使用以下命令创建 RPM 构建目录和必要的子目录：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~
</span></span><span class=line><span class=cl>mkdir -p rpmbuild/<span class=o>{</span>BUILD,RPMS,SOURCES,SPECS,SRPMS<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>上述命令创建了 5 个子目录：</p><ul><li>BUILD: 构建 RPM 包所需的源码和二进制文件存放的目录。</li><li>RPMS: 二进制 RPM 包保存的目录。</li><li>SOURCES: 存储软件包的源代码，rpmbuild 根据该代码创建 RPM 包。</li><li>SPECS: INCLUDE metadata and build instructions files for creating RPM files</li><li>SRPMS: 用于存储源 RPM 包的目录。</li></ul><h2 id=rpmbuild示例如何使用rpmbuild制作php-rpm包>rpmbuild示例：如何使用rpmbuild制作php rpm包<a hidden class=anchor aria-hidden=true href=#rpmbuild示例如何使用rpmbuild制作php-rpm包>#</a></h2><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkdir -pv ~/rpmbuild/<span class=o>{</span>BUILD,RPMS,SOURCES,SPECS,SRPMS<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>php有一个依赖库，在yum源于epel源中都没有需要自己打包<code>libiconv</code></p><blockquote><p><strong>编写 libiconv 的spec文件</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>%define __os_install_post %<span class=o>{</span>nil<span class=o>}</span>
</span></span><span class=line><span class=cl>%define debug_package %<span class=o>{</span>nil<span class=o>}</span>
</span></span><span class=line><span class=cl>Name: libiconv
</span></span><span class=line><span class=cl>Version: 1.15
</span></span><span class=line><span class=cl>Release: 1%<span class=o>{</span>?dist<span class=o>}</span>
</span></span><span class=line><span class=cl>Summary: liconv
</span></span><span class=line><span class=cl>Group: liconv
</span></span><span class=line><span class=cl>License: GPL
</span></span><span class=line><span class=cl>URL: http://www.test.net
</span></span><span class=line><span class=cl>Packager: <span class=nb>test</span>
</span></span><span class=line><span class=cl>Vendor: <span class=nb>test</span>
</span></span><span class=line><span class=cl>Source0: libiconv-1.15.tar.gz
</span></span><span class=line><span class=cl>BuildRoot: %<span class=o>{</span>_tmppath<span class=o>}</span>/%<span class=o>{</span>name<span class=o>}</span>-%<span class=o>{</span>version<span class=o>}</span>-buildroot
</span></span><span class=line><span class=cl>%description 
</span></span><span class=line><span class=cl>iconv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%prep
</span></span><span class=line><span class=cl>%setup -q
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%build
</span></span><span class=line><span class=cl>./configure --prefix<span class=o>=</span>/usr/share/libiconv-1.15 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>
</span></span><span class=line><span class=cl>make
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%install
</span></span><span class=line><span class=cl>make install <span class=nv>DESTDIR</span><span class=o>=</span>%<span class=o>{</span>buildroot<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%files
</span></span><span class=line><span class=cl>%defattr<span class=o>(</span>-,root,root,-<span class=o>)</span>
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0655,root,root<span class=o>)</span> /usr/share/libiconv-1.15/*
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0755,root,root<span class=o>)</span> /usr/share/libiconv-1.15/bin/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%clean
</span></span><span class=line><span class=cl>rm -rf <span class=nv>$RPM_BUILD_DIR</span>/%<span class=o>{</span>name<span class=o>}</span>-%<span class=o>{</span>version<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%post
</span></span><span class=line><span class=cl>ln -sv /usr/share/libiconv-1.15/ /usr/share/libiconv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%changelog
</span></span><span class=line><span class=cl>* Sun Aug <span class=m>24</span> <span class=m>2015</span> LC 1.15-1
</span></span><span class=line><span class=cl>- package libiconv-1.15</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=打包libiconv遇到的错误>打包libiconv遇到的错误<a hidden class=anchor aria-hidden=true href=#打包libiconv遇到的错误>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Binary file /root/rpmbuild/BUILDROOT/libiconv-1.15.el7.centos.x86_64/usr/share/libiconv-1.15/bin/iconv matches
</span></span><span class=line><span class=cl>Found <span class=s1>&#39;/root/rpmbuild/BUILDROOT/libiconv-1.15-1.el7.centos.x86_64&#39;</span> in installed files<span class=p>;</span> aborting
</span></span><span class=line><span class=cl>error: Bad <span class=nb>exit</span> status from /var/tmp/rpm-tmp.6AgqPk <span class=o>(</span>%install<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RPM build errors:
</span></span><span class=line><span class=cl>    Bad <span class=nb>exit</span> status from /var/tmp/rpm-tmp.6AgqPk <span class=o>(</span>%install<span class=o>)</span></span></span></code></pre></td></tr></table></div></div></div></div><p><strong>问题原因</strong>：</p><p>在rpm构建过程中，在％install阶段结束时，运行 <code>/usr/lib/rpm/check-buildroot</code>脚本以检查构建根目录中的文件。此脚本扫描构建根目录中的所有文件，以获取<code>${RPM_BUILD_ROOT}</code>路径的任何引用。</p><p>也就是说libiconv已经编译完成。一般情况下，是可以正常使用的。所以不需要他检查构建根目录。</p><p><strong>解决方法</strong>：通过报错信息可以得到如下提示</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>RPM build errors:
</span></span><span class=line><span class=cl>    Bad <span class=nb>exit</span> status from /var/tmp/rpm-tmp.6AgqPk <span class=o>(</span>%install<span class=o>)</span></span></span></code></pre></td></tr></table></div></div></div></div><p>根据保存信息查看文件的执行过程。<code>/var/tmp/rpm-tmp.6AgqPk</code>，并发现脚本在执行到<code>/usr/lib/rpm/check-buildroot</code>时停止了。也就是说，执行这个脚本检查构建根目录时<code>$?</code>不为0</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> <span class=s1>&#39;libiconv-1.15&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>make install <span class=nv>DESTDIR</span><span class=o>=</span>/root/rpmbuild/BUILDROOT/libiconv-1.15-1.el7.centos.x86_64
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    /usr/lib/rpm/check-buildroot</span></span></code></pre></td></tr></table></div></div></div></div><p>查看<code>/usr/lib/rpm/check-buildroot</code>脚本，发现只有此段检查才<code>$?</code>返回的是1。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>test</span> -s <span class=s2>&#34;</span><span class=nv>$tmp</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    cat <span class=s2>&#34;</span><span class=nv>$tmp</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Found &#39;</span><span class=nv>$RPM_BUILD_ROOT</span><span class=s2>&#39; in installed files; aborting&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=o>||</span> :  </span></span></code></pre></td></tr></table></div></div></div></div><p>由于压根不知道 <code>$tmp</code> 在哪里传入的。又压根可以不检查构建根目录的。直接在 <code>/usr/lib/rpm/check-buildroot</code> 脚本最前面加上 <code>exit 0</code> 让构建RPM包时跳过此步骤。之后成功完成rpm构建。</p><p><strong>参考文档</strong>：
<a href=http://pktechpage.blogspot.com/2015/09/found-rpmbuildroot-in-installed-files.html target=_blank rel="noopener nofollow noreferrer">pk&rsquo;s Tech Page: Found &lsquo;${RPM_BUILD_ROOT}&rsquo; in installed files; aborting</a></p><p><a href=https://stackoverflow.com/questions/35511053/what-does-usr-lib-rpm-check-buildroot-do target=_blank rel="noopener nofollow noreferrer">c++ - What does /usr/lib/rpm/check-buildroot do? - Stack Overflow</a></p><h3 id=编写spec文件>编写spec文件<a hidden class=anchor aria-hidden=true href=#编写spec文件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Name: php
</span></span><span class=line><span class=cl>Version: 7.1.17
</span></span><span class=line><span class=cl>Release: 1%<span class=o>{</span>?dist<span class=o>}</span>
</span></span><span class=line><span class=cl>Summary: php
</span></span><span class=line><span class=cl>Group: php
</span></span><span class=line><span class=cl>License: GPL
</span></span><span class=line><span class=cl>URL: http://php.org
</span></span><span class=line><span class=cl>Packager: php
</span></span><span class=line><span class=cl>Vendor: php
</span></span><span class=line><span class=cl>Source0: php-7.1.17.tar.bz2
</span></span><span class=line><span class=cl>Source1: php.ini
</span></span><span class=line><span class=cl>BuildRoot: %<span class=o>{</span>_tmppath<span class=o>}</span>/%<span class=o>{</span>name<span class=o>}</span>-%<span class=o>{</span>version<span class=o>}</span>-buildroot
</span></span><span class=line><span class=cl>Requires: libiconv,zlib-devel,libxml2-devel,libjpeg-devel,libjpeg-turbo-devel,freetype-devel,libpng-devel,gd-devel,curl-devel,libxslt-devel,bzip2-devel,gmp-devel,readline-devel,mcrypt,mhash,libmcrypt-devel
</span></span><span class=line><span class=cl>%description 
</span></span><span class=line><span class=cl>php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%prep
</span></span><span class=line><span class=cl>id nginx <span class=o>||</span> useradd nginx -s /sbin/nologin -M
</span></span><span class=line><span class=cl>%setup -q
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%build
</span></span><span class=line><span class=cl>./configure <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--prefix<span class=o>=</span>/usr/share/php-7.1.17 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-config-file-path<span class=o>=</span>/etc/php/ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--exec-prefix<span class=o>=</span>/usr <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--bindir<span class=o>=</span>/usr/bin <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--sbindir<span class=o>=</span>/usr/sbin <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--mandir<span class=o>=</span>/usr/share/man <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--sysconfdir<span class=o>=</span>/etc/php/ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-mysqli<span class=o>=</span>mysqlnd <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-iconv-dir<span class=o>=</span>/usr/share/libiconv <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-jpeg-dir <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-png-dir <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-zlib-dir <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-libxml-dir <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-xml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--disable-rpath <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-safe-mode <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-bcmath <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-shmop <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-sysvsem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-inline-optimization <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-curl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-mbregex <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-fpm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-mbstring <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-mcrypt <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-gd <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-gd-native-ttf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-openssl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-mhash <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-pcntl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-sockets <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-xmlrpc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-zip <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-soap <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-short-tags <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-zend-multibyte <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--enable-static <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-xsl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-fpm-user<span class=o>=</span>nginx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--with-fpm-group<span class=o>=</span>nginx 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>make -j <span class=m>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%install
</span></span><span class=line><span class=cl>rm -rf %<span class=o>{</span>buildroot<span class=o>}</span>
</span></span><span class=line><span class=cl>make <span class=nv>INSTALL_ROOT</span><span class=o>=</span>%<span class=o>{</span>buildroot<span class=o>}</span> install
</span></span><span class=line><span class=cl>%<span class=o>{</span>__install<span class=o>}</span> -p -D %<span class=o>{</span>SOURCE1<span class=o>}</span> %<span class=o>{</span>buildroot<span class=o>}</span>/etc/php/php.ini
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%files
</span></span><span class=line><span class=cl>%defattr<span class=o>(</span>-,root,root,-<span class=o>)</span>
</span></span><span class=line><span class=cl>/usr/share/php-7.1.17/*
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0744,root,root<span class=o>)</span> /usr/bin/*
</span></span><span class=line><span class=cl>%attr<span class=o>(</span>0744,root,root<span class=o>)</span> /usr/sbin/*
</span></span><span class=line><span class=cl>/usr/share/man/*
</span></span><span class=line><span class=cl>/etc/php/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%pre
</span></span><span class=line><span class=cl>id nginx <span class=o>||</span> useradd nginx -s /sbin/nologin -M
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%post
</span></span><span class=line><span class=cl>cp /etc/php/php-fpm.conf.default /etc/php/php-fpm.conf
</span></span><span class=line><span class=cl>cp /etc/php/php-fpm.d/www.conf.default /etc/php/php-fpm.d/www.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%postun
</span></span><span class=line><span class=cl>userdel nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%changelog
</span></span><span class=line><span class=cl>* Sun Aug <span class=m>10</span> <span class=m>2018</span> lc zhoushilong
</span></span><span class=line><span class=cl>- package php-7.1.71</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=构建php-rpm包遇到的问题>构建PHP RPM包遇到的问题<a hidden class=anchor aria-hidden=true href=#构建php-rpm包遇到的问题>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>RPM build errors:
</span></span><span class=line><span class=cl>    bogus date in %changelog: Sun Aug <span class=m>10</span> <span class=m>2018</span> lc zhoushilong
</span></span><span class=line><span class=cl>    Explicit %attr<span class=o>()</span> mode not applicaple to symlink: /root/rpmbuild/BUILDROOT/php-7.1.17-1.el7.centos.x86_64/usr/bin/phar
</span></span><span class=line><span class=cl>    Installed <span class=o>(</span>but unpackaged<span class=o>)</span> file<span class=o>(</span>s<span class=o>)</span> found:
</span></span><span class=line><span class=cl>   /.channels/.alias/pear.txt
</span></span><span class=line><span class=cl>   /.channels/.alias/pecl.txt
</span></span><span class=line><span class=cl>   /.channels/.alias/phpdocs.txt
</span></span><span class=line><span class=cl>   /.channels/__uri.reg
</span></span><span class=line><span class=cl>   /.channels/doc.php.net.reg
</span></span><span class=line><span class=cl>   /.channels/pear.php.net.reg
</span></span><span class=line><span class=cl>   /.channels/pecl.php.net.reg
</span></span><span class=line><span class=cl>   /.depdb
</span></span><span class=line><span class=cl>   /.depdblock
</span></span><span class=line><span class=cl>   /.filemap
</span></span><span class=line><span class=cl>   /.lock</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>解决方法如下</strong>：</p><blockquote><p><strong>方法1</strong>：生成的rpm包里有前面在%files里添加的这个文件，如下：</p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/local/php/.channels</span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>方法2</strong>：下面是直接删除的解决办法，实践OK（视具体情况是删除还是添加选一个即可）</p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rm -rf %<span class=o>{</span>buildroot<span class=o>}</span>/<span class=o>{</span>.channels,.depdb,.depdblock,.filemap,.lock<span class=o>}</span> </span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>方法三</strong>： <code>/usr/lib/rpm/macros</code> 修改宏</p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 构建根目录中的未打包文件是否应终止构建？</span>
</span></span><span class=line><span class=cl>%_unpackaged_files_terminate_build <span class=m>1</span> <span class=c1># 把1改为0只警告</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%__check_files   %<span class=o>{</span>_rpmconfigdir<span class=o>}</span>/check-files %<span class=o>{</span>buildroot<span class=o>}</span> <span class=c1># 这一行，把这一行注释掉，然后重新编译</span></span></span></code></pre></td></tr></table></div></div></div></div><p><strong><code>%__check_files</code>说明</strong>：</p><blockquote><p>Build configuration macros. Script gets packaged file list on input and buildroot as first parameter. Returns list of unpackaged files, i.e. files in $RPM_BUILD_ROOT not packaged. Note: Disable (by commenting out) for legacy compatibility.</p></blockquote><p>构建配置宏。 脚本在输入和buildroot上获取打包文件列表作为第一个参数。 返回未打包文件的列表，即 $ RPM_BUILD_ROOT 中未打包的文件。 注意：禁用（通过注释掉）旧版兼容性。</p><h3 id=打包报错>打包报错<a hidden class=anchor aria-hidden=true href=#打包报错>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>+ <span class=s1>&#39;%{__debug_install_post}&#39;</span>
</span></span><span class=line><span class=cl>/var/tmp/rpm-tmp.o0N7t4: line 45: fg: no job control
</span></span><span class=line><span class=cl>error: Bad <span class=nb>exit</span> status from /var/tmp/rpm-tmp.o0N7t4 <span class=o>(</span>%install<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RPM build errors:
</span></span><span class=line><span class=cl>    bogus date in %changelog: Sun Aug <span class=m>24</span> <span class=m>2018</span> YB 1.14.2
</span></span><span class=line><span class=cl>    Bad <span class=nb>exit</span> status from /var/tmp/rpm-tmp.o0N7t4 <span class=o>(</span>%install<span class=o>)</span></span></span></code></pre></td></tr></table></div></div></div></div><p>解决：使用以下命令禁用check-buildroot</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>%define __arch_install_post %{nil}
</span></span><span class=line><span class=cl>%define __os_install_post %{nil}</span></span></code></pre></td></tr></table></div></div></div></div><p>关闭调试信息：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>%global debug_package %{nil}</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=参考网址>参考网址<a hidden class=anchor aria-hidden=true href=#参考网址>#</a></h2><blockquote><p><a href=https://phpor.net/blog/post/5670 target=_blank rel="noopener nofollow noreferrer">rpmbuild 之 /usr/lib/rpm/check-buildroot</a></p><p><a href=https://stackoverflow.com/questions/47838041/rpmbuild-how-to-disable-check-buildroot target=_blank rel="noopener nofollow noreferrer">rpmbuild - how to disable check-buildroot?</a></p><p><a href=http://jackxiang.com/post/8633/ target=_blank rel="noopener nofollow noreferrer">[实践OK]rpmbuild报error: Installed (but unpackaged) file(s) found的解决办法</a></p><p><a href=http://www.nongzusa.com/blog/2014/10/14/rpmbuild-da-bao-rpmshi-zhan/ target=_blank rel="noopener nofollow noreferrer">rpmbuild 打包rpm实战</a></p><p><a href=http://www.jinbuguo.com/redhat/rpmbuild.html target=_blank rel="noopener nofollow noreferrer">rpmbuild 中文手册</a></p><p><a href=https://docs.fedoraproject.org/en-US/quick-docs/creating-rpm-packages/index.html target=_blank rel="noopener nofollow noreferrer">Creating RPM packages :: Fedora Docs Site</a></p><p><a href=https://fedoraproject.org/wiki/How_to_create_an_RPM_package/zh-cn#.25files_.E5.9F.BA.E7.A1.80 target=_blank rel="noopener nofollow noreferrer">How to create an RPM package/zh-cn - Fedora Project Wiki</a></p><p><a href="https://fedoraproject.org/wiki/Packaging:Guidelines?rd=Packaging/Guidelines" target=_blank rel="noopener nofollow noreferrer">Fedora Packaging Guidelines - Fedora Project Wiki</a></p></blockquote></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：Unix归档模式 cpio - 深入剖析与构建rpm包</p><p>文章链接：<a href=https://www.oomkill.com/2018/09/rpm-package/ target=_blank>https://www.oomkill.com/2018/09/rpm-package/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2016/12/fpm/><span>使用fpm制作rpm包与搭建本地yum源</span></a></li><li><a href=/2018/05/ssh-client-application/><span>SSH客户端应用场景</span></a></li><li><a href=/2016/10/ch1-iptables-introduction/><span>ch1 iptables介绍</span></a></li><li><a href=/2016/10/ch2-iptables-command/><span>ch2 iptables命令帮助信息</span></a></li><li><a href=/2016/10/ch3-iptables-configuration/><span>ch3 iptables配置防火墙</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2018/09/kubernetes-serviceaccount/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>kubernetes概念 - serviceaccount</span>
</a><a class=next href=https://www.oomkill.com/2018/08/kubernetes-rbac/><span class=title></span>
<span>kubernetes概念 - RBAC&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/rpm package","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>