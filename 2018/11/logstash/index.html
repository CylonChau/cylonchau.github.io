<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Logstash使用 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="ELK,Logstash使用"><meta name=description content="1 logstash概述 logstash是基于Jruby语言研发的server/agent结构的日志收集工具，可以在任何一个能产生日志的服务器上部署其agent。agent能同时监控多个产生日志的服务，并把每个服务所产生的日志信息收集并发送给logstash server端。由于收集到的日志信息是分散的，logstash有专门的节点用来将所有的节点收集到的日志信息按时间序列合并在一起形成一个序列，基于这一个序列请求写入并存储在elasticsearch集群中。
kibana是基于node.js开发的elasticsearch的图形用户接口。它可以将用户的搜索语句发送给ES，有ES完成搜索，并且将结果返回。kibana可以将返回的数据，用非常直观的方式（画图）来做趋势展示的。
logstash基于多种数据获取机制，TCP/UDP协议、文件、syslog、windows EventLogs及STDIN等。同时也支持多种数据输出机制。获取到数据后，它支持对数据执行过滤、修改等操作。
logstash基于JRuby语言研发，需要运行在JVM虚拟机之上。工作于agent/server模型。
1.1 logstash工作机制 在每一个产生日志的节点之上部署一个agent，这个agent通常称为shipper。shipper负责收集日志，并且发送给server端。但是在发送给server端时，为了避免server端可能无法应付大量节点同时发来的信息，会在server端和agent端之间放置一个消息队列，通常称之为broker。这个消息队列比较常见的使用redis。各agent将数据发送至broker，logstash服务器会从broker中依次取出日志拿来在本地做过滤、修改等操作。在完修改后将其发送至ES集群。
对于logstash而言，server端也是插件式的工作的模式，与ES的不同在于，ES的插件是可有可无的。logstash的除核心外的所有功能都是基于插件来完成的。
1.2 logstash工作流程 logstash的工作模式类似于管道，从指定位置读入数据，而后过滤数据，最后将其输出到指定位置。事实上logstash的工作流程为：input | filter | output。如无需对数据额外处理，filter可省略。
1.3 logstash插件分类 input plugin：收集数据 codec plugin：编码插件 filter plugin：过滤 output plugin：输出插件 2 logstash安装下载 官网地址：https://www.elastic.co/cn/products../../images/Logstash
3 logstash的配置使用 /etc../../images/Logstash/conf.d/路径下所有以.conf结尾的文件都被当做配置文件使用。对于logstash的配置文件定义，就是定义插件。从哪得到数据。向哪里输出数据。
3.1 logstash的基本配置框架 sh 1 2 3 4 5 6 7 8 9 10 11 input{ .... } filter{ .... } output{ .... } 简单的
sh 1 2 3 4 5 6 7 8 input{ stdin {} } output { stdout{ codec =>rubydebug } } 检查配置文件语法是否正确logstash -f /etc."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2018/11/logstash/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2018/11/logstash/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="Logstash使用"><meta property="og:description" content="1 logstash概述 logstash是基于Jruby语言研发的server/agent结构的日志收集工具，可以在任何一个能产生日志的服务器上部署其agent。agent能同时监控多个产生日志的服务，并把每个服务所产生的日志信息收集并发送给logstash server端。由于收集到的日志信息是分散的，logstash有专门的节点用来将所有的节点收集到的日志信息按时间序列合并在一起形成一个序列，基于这一个序列请求写入并存储在elasticsearch集群中。
kibana是基于node.js开发的elasticsearch的图形用户接口。它可以将用户的搜索语句发送给ES，有ES完成搜索，并且将结果返回。kibana可以将返回的数据，用非常直观的方式（画图）来做趋势展示的。
logstash基于多种数据获取机制，TCP/UDP协议、文件、syslog、windows EventLogs及STDIN等。同时也支持多种数据输出机制。获取到数据后，它支持对数据执行过滤、修改等操作。
logstash基于JRuby语言研发，需要运行在JVM虚拟机之上。工作于agent/server模型。
1.1 logstash工作机制 在每一个产生日志的节点之上部署一个agent，这个agent通常称为shipper。shipper负责收集日志，并且发送给server端。但是在发送给server端时，为了避免server端可能无法应付大量节点同时发来的信息，会在server端和agent端之间放置一个消息队列，通常称之为broker。这个消息队列比较常见的使用redis。各agent将数据发送至broker，logstash服务器会从broker中依次取出日志拿来在本地做过滤、修改等操作。在完修改后将其发送至ES集群。
对于logstash而言，server端也是插件式的工作的模式，与ES的不同在于，ES的插件是可有可无的。logstash的除核心外的所有功能都是基于插件来完成的。
1.2 logstash工作流程 logstash的工作模式类似于管道，从指定位置读入数据，而后过滤数据，最后将其输出到指定位置。事实上logstash的工作流程为：input | filter | output。如无需对数据额外处理，filter可省略。
1.3 logstash插件分类 input plugin：收集数据 codec plugin：编码插件 filter plugin：过滤 output plugin：输出插件 2 logstash安装下载 官网地址：https://www.elastic.co/cn/products../../images/Logstash
3 logstash的配置使用 /etc../../images/Logstash/conf.d/路径下所有以.conf结尾的文件都被当做配置文件使用。对于logstash的配置文件定义，就是定义插件。从哪得到数据。向哪里输出数据。
3.1 logstash的基本配置框架 sh 1 2 3 4 5 6 7 8 9 10 11 input{ .... } filter{ .... } output{ .... } 简单的
sh 1 2 3 4 5 6 7 8 input{ stdin {} } output { stdout{ codec =>rubydebug } } 检查配置文件语法是否正确logstash -f /etc."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2018/11/logstash/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-22T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Logstash使用"><meta name=twitter:description content="1 logstash概述 logstash是基于Jruby语言研发的server/agent结构的日志收集工具，可以在任何一个能产生日志的服务器上部署其agent。agent能同时监控多个产生日志的服务，并把每个服务所产生的日志信息收集并发送给logstash server端。由于收集到的日志信息是分散的，logstash有专门的节点用来将所有的节点收集到的日志信息按时间序列合并在一起形成一个序列，基于这一个序列请求写入并存储在elasticsearch集群中。
kibana是基于node.js开发的elasticsearch的图形用户接口。它可以将用户的搜索语句发送给ES，有ES完成搜索，并且将结果返回。kibana可以将返回的数据，用非常直观的方式（画图）来做趋势展示的。
logstash基于多种数据获取机制，TCP/UDP协议、文件、syslog、windows EventLogs及STDIN等。同时也支持多种数据输出机制。获取到数据后，它支持对数据执行过滤、修改等操作。
logstash基于JRuby语言研发，需要运行在JVM虚拟机之上。工作于agent/server模型。
1.1 logstash工作机制 在每一个产生日志的节点之上部署一个agent，这个agent通常称为shipper。shipper负责收集日志，并且发送给server端。但是在发送给server端时，为了避免server端可能无法应付大量节点同时发来的信息，会在server端和agent端之间放置一个消息队列，通常称之为broker。这个消息队列比较常见的使用redis。各agent将数据发送至broker，logstash服务器会从broker中依次取出日志拿来在本地做过滤、修改等操作。在完修改后将其发送至ES集群。
对于logstash而言，server端也是插件式的工作的模式，与ES的不同在于，ES的插件是可有可无的。logstash的除核心外的所有功能都是基于插件来完成的。
1.2 logstash工作流程 logstash的工作模式类似于管道，从指定位置读入数据，而后过滤数据，最后将其输出到指定位置。事实上logstash的工作流程为：input | filter | output。如无需对数据额外处理，filter可省略。
1.3 logstash插件分类 input plugin：收集数据 codec plugin：编码插件 filter plugin：过滤 output plugin：输出插件 2 logstash安装下载 官网地址：https://www.elastic.co/cn/products../../images/Logstash
3 logstash的配置使用 /etc../../images/Logstash/conf.d/路径下所有以.conf结尾的文件都被当做配置文件使用。对于logstash的配置文件定义，就是定义插件。从哪得到数据。向哪里输出数据。
3.1 logstash的基本配置框架 sh 1 2 3 4 5 6 7 8 9 10 11 input{ .... } filter{ .... } output{ .... } 简单的
sh 1 2 3 4 5 6 7 8 input{ stdin {} } output { stdout{ codec =>rubydebug } } 检查配置文件语法是否正确logstash -f /etc."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"Logstash使用","item":"https://www.oomkill.com/2018/11/logstash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Logstash使用","name":"Logstash使用","description":"1 logstash概述 logstash是基于Jruby语言研发的server/agent结构的日志收集工具，可以在任何一个能产生日志的服务器上部署其agent。agent能同时监控多个产生日志的服务，并把每个服务所产生的日志信息收集并发送给logstash server端。由于收集到的日志信息是分散的，logstash有专门的节点用来将所有的节点收集到的日志信息按时间序列合并在一起形成一个序列，基于这一个序列请求写入并存储在elasticsearch集群中。\nkibana是基于node.js开发的elasticsearch的图形用户接口。它可以将用户的搜索语句发送给ES，有ES完成搜索，并且将结果返回。kibana可以将返回的数据，用非常直观的方式（画图）来做趋势展示的。\nlogstash基于多种数据获取机制，TCP/UDP协议、文件、syslog、windows EventLogs及STDIN等。同时也支持多种数据输出机制。获取到数据后，它支持对数据执行过滤、修改等操作。\nlogstash基于JRuby语言研发，需要运行在JVM虚拟机之上。工作于agent/server模型。\n1.1 logstash工作机制 在每一个产生日志的节点之上部署一个agent，这个agent通常称为shipper。shipper负责收集日志，并且发送给server端。但是在发送给server端时，为了避免server端可能无法应付大量节点同时发来的信息，会在server端和agent端之间放置一个消息队列，通常称之为broker。这个消息队列比较常见的使用redis。各agent将数据发送至broker，logstash服务器会从broker中依次取出日志拿来在本地做过滤、修改等操作。在完修改后将其发送至ES集群。\n对于logstash而言，server端也是插件式的工作的模式，与ES的不同在于，ES的插件是可有可无的。logstash的除核心外的所有功能都是基于插件来完成的。\n1.2 logstash工作流程 logstash的工作模式类似于管道，从指定位置读入数据，而后过滤数据，最后将其输出到指定位置。事实上logstash的工作流程为：input | filter | output。如无需对数据额外处理，filter可省略。\n1.3 logstash插件分类 input plugin：收集数据 codec plugin：编码插件 filter plugin：过滤 output plugin：输出插件 2 logstash安装下载 官网地址：https://www.elastic.co/cn/products../../images/Logstash\n3 logstash的配置使用 /etc../../images/Logstash/conf.d/路径下所有以.conf结尾的文件都被当做配置文件使用。对于logstash的配置文件定义，就是定义插件。从哪得到数据。向哪里输出数据。\n3.1 logstash的基本配置框架 sh 1 2 3 4 5 6 7 8 9 10 11 input{ .... } filter{ .... } output{ .... } 简单的\nsh 1 2 3 4 5 6 7 8 input{ stdin {} } output { stdout{ codec =\u0026gt;rubydebug } } 检查配置文件语法是否正确logstash -f /etc.","keywords":["ELK","Logstash使用"],"articleBody":"1 logstash概述 logstash是基于Jruby语言研发的server/agent结构的日志收集工具，可以在任何一个能产生日志的服务器上部署其agent。agent能同时监控多个产生日志的服务，并把每个服务所产生的日志信息收集并发送给logstash server端。由于收集到的日志信息是分散的，logstash有专门的节点用来将所有的节点收集到的日志信息按时间序列合并在一起形成一个序列，基于这一个序列请求写入并存储在elasticsearch集群中。\nkibana是基于node.js开发的elasticsearch的图形用户接口。它可以将用户的搜索语句发送给ES，有ES完成搜索，并且将结果返回。kibana可以将返回的数据，用非常直观的方式（画图）来做趋势展示的。\nlogstash基于多种数据获取机制，TCP/UDP协议、文件、syslog、windows EventLogs及STDIN等。同时也支持多种数据输出机制。获取到数据后，它支持对数据执行过滤、修改等操作。\nlogstash基于JRuby语言研发，需要运行在JVM虚拟机之上。工作于agent/server模型。\n1.1 logstash工作机制 在每一个产生日志的节点之上部署一个agent，这个agent通常称为shipper。shipper负责收集日志，并且发送给server端。但是在发送给server端时，为了避免server端可能无法应付大量节点同时发来的信息，会在server端和agent端之间放置一个消息队列，通常称之为broker。这个消息队列比较常见的使用redis。各agent将数据发送至broker，logstash服务器会从broker中依次取出日志拿来在本地做过滤、修改等操作。在完修改后将其发送至ES集群。\n对于logstash而言，server端也是插件式的工作的模式，与ES的不同在于，ES的插件是可有可无的。logstash的除核心外的所有功能都是基于插件来完成的。\n1.2 logstash工作流程 logstash的工作模式类似于管道，从指定位置读入数据，而后过滤数据，最后将其输出到指定位置。事实上logstash的工作流程为：input | filter | output。如无需对数据额外处理，filter可省略。\n1.3 logstash插件分类 input plugin：收集数据 codec plugin：编码插件 filter plugin：过滤 output plugin：输出插件 2 logstash安装下载 官网地址：https://www.elastic.co/cn/products../../images/Logstash\n3 logstash的配置使用 /etc../../images/Logstash/conf.d/路径下所有以.conf结尾的文件都被当做配置文件使用。对于logstash的配置文件定义，就是定义插件。从哪得到数据。向哪里输出数据。\n3.1 logstash的基本配置框架 sh 1 2 3 4 5 6 7 8 9 10 11 input{ .... } filter{ .... } output{ .... } 简单的\nsh 1 2 3 4 5 6 7 8 input{ stdin {} } output { stdout{ codec =\u003erubydebug } } 检查配置文件语法是否正确logstash -f /etc../../images/Logstash/conf.d/sample.conf --configtest\nsh 1 2 3 4 5 6 7 8 9 10 $ logstash -f /etc../../images/Logstash/conf.d/sample.conf hellow owrd Settings: Default pipeline workers: 1 Pipeline main started { \"message\" =\u003e \"hellow owrd\", #←信息的完整内容。logstash的信息是在input → filter → output之间流动的。 \"@version\" =\u003e \"1\", #←版本号。 \"@timestamp\" =\u003e \"2018-06-04T15:02:47.912Z\", #←事件发生时的时间戳。 \"host\" =\u003e \"test\" #←时间发生的主机。 } 3.2 logstash支持的数据类型 Array：[iteml,item2,…] Boolean：true,false Bytes Codec：编码器。 Hash: key =\u003evalue Number Password： Path：文件系统路径。 String：字符串。 logstash还支持字段引用，使用[]进行引用\n3.3 支持的条件判断 ==，!=，\u003c，\u003c=，\u003e，\u003e= 正则匹配=~ !~ in,not in and,or\n4 Logstash常用的插件 logstash是高度插件化的，主要分为input codec filter output插件：\n4.1 input插件 4.1.1 File 从指定的文件中读取事件流。其工作特性类似于tail -1f，能够将日志文件尾部的一行不断的读取出来。\nlogstash使用FileWatch（ruby gem库）机制来监听文件变化。filewatch是linux内核中提供的一种功能。filewatch库支持以glob方式展开文件名。因此可以监听多个文件。并且可以将每个文件读取的位置及状态信息保存在.sincedb数据库中。即使重启logstash后也不会从头读取文件的。.sincedb记录了每个被监听的文件的inode,major number,minor nubmer,pos。默认情况下位于启动logstash服务的用户家目录下。也可以自行定义位置。另外，file插件还可以自动识别日志的滚动（日志分割）操作。\nsh 1 2 3 4 5 6 7 8 9 10 11 12 13 input{ file{ path =\u003e ['/var/log/messages'] type =\u003e \"system\" start_postition =\u003e \"beginning\" } } output{ stdout{ codec =\u003e rubydebug } } Logstash file\n4.1.2 UDP logstash支持通过一个简单的协议来读取信息，如UDP、TCP，说明对方只要通过TCP协议发送时间也是支持的。或者哪怕通过syslog收集事件也是可以的。\nlogstash通过UDP协议通过网络连接来读取信息，其唯一必须制定的参数为port，用于指定自己监听的端口，agent可以向服务器端端口发送日志信息。而每个被收集数据的主机使用守护进程向server端发送事件。\nsh 1 2 3 4 5 6 7 8 input{ udp{ prot =\u003e 25826 queue_size =\u003e 2000 #←队列大小 workers =\u003e 2 #←启动的工作线程数来接收发送的事件。 buffer_size =\u003e #←接收缓冲区的大小 } } UDP插件实现\ncollectd：基于C语言开发的一款高度插件式的主机性能监控程序，以守护进程方式运行，能够收集系统性能相关的各种数据；并且能够基于各种存储机制将收集的结果存储下来。collectd本身所收集到的数据可以通过自身的network插件，将自己在本机所收集到的数据发送至其他主机。\ncollectd在epel源中\nsh 1 yum install collectd -y collectd的大量.so文件为其模块（插件），每一个模块分别实现每一种相应的功能。其配置文件 /etc/collectd.conf\nsh 1 2 3 4 5 6 7 8 9 10 11 12 Hostname \"node3.magedu.com\" LoadPlugin syslog LoadPlugin cpu # cpu性能数据 LoadPlugin df # 磁盘空间使用情况 LoadPlugin interface # 网络接口 LoadPlugin 1oad # 服务器负载 LoadPlugin memory # 内存 LoadPlugin network ","wordCount":"853","inLanguage":"zh","datePublished":"2018-11-02T00:00:00Z","dateModified":"2023-03-22T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2018/11/logstash/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Logstash使用</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2018-11-02</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>853 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>5 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/logging/>#Logging</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#1-logstash%e6%a6%82%e8%bf%b0 aria-label="1 logstash概述">1 logstash概述</a><ul><li><a href=#11-logstash%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6 aria-label="1.1 logstash工作机制">1.1 logstash工作机制</a><li><a href=#12-logstash%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b aria-label="1.2 logstash工作流程">1.2 logstash工作流程</a><li><a href=#13-logstash%e6%8f%92%e4%bb%b6%e5%88%86%e7%b1%bb aria-label="1.3 logstash插件分类">1.3 logstash插件分类</a></ul><li><a href=#2-logstash%e5%ae%89%e8%a3%85%e4%b8%8b%e8%bd%bd aria-label="2 logstash安装下载">2 logstash安装下载</a><li><a href=#3-logstash%e7%9a%84%e9%85%8d%e7%bd%ae%e4%bd%bf%e7%94%a8 aria-label="3 logstash的配置使用">3 logstash的配置使用</a><ul><li><a href=#31-logstash%e7%9a%84%e5%9f%ba%e6%9c%ac%e9%85%8d%e7%bd%ae%e6%a1%86%e6%9e%b6 aria-label="3.1 logstash的基本配置框架">3.1 logstash的基本配置框架</a><li><a href=#32-logstash%e6%94%af%e6%8c%81%e7%9a%84%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b aria-label="3.2 logstash支持的数据类型">3.2 logstash支持的数据类型</a></ul><li><a href=#4-logstash%e5%b8%b8%e7%94%a8%e7%9a%84%e6%8f%92%e4%bb%b6 aria-label="4 Logstash常用的插件">4 Logstash常用的插件</a><ul><li><a href=#41-input%e6%8f%92%e4%bb%b6 aria-label="4.1 input插件">4.1 input插件</a><ul><li><a href=#411-file aria-label="4.1.1 File">4.1.1 File</a><li><a href=#412-udp aria-label="4.1.2 UDP">4.1.2 UDP</a><li><a href=#413-redis aria-label="4.1.3 redis">4.1.3 redis</a></ul><li><a href=#42-filter%e6%8f%92%e4%bb%b6 aria-label="4.2 filter插件">4.2 filter插件</a><ul><li><a href=#421-grok aria-label="4.2.1 grok">4.2.1 grok</a><li><a href=#422-gork%e8%af%ad%e6%b3%95%e6%a0%bc%e5%bc%8f aria-label="4.2.2 gork语法格式">4.2.2 gork语法格式</a></ul></ul><li><a href=#5-conditionals aria-label="5 conditionals">5 conditionals</a><ul><li><a href=#51-%e8%af%ad%e6%b3%95 aria-label="5.1 语法">5.1 语法</a><li><a href=#52-logstash%e5%b8%b8%e7%94%a8%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%ad%e8%af%ad%e5%8f%a5 aria-label="5.2 logstash常用条件判断语句">5.2 logstash常用条件判断语句</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=1-logstash概述>1 logstash概述<a hidden class=anchor aria-hidden=true href=#1-logstash概述>#</a></h2><p>logstash是基于Jruby语言研发的server/agent结构的日志收集工具，可以在任何一个能产生日志的服务器上部署其agent。agent能同时监控多个产生日志的服务，并把每个服务所产生的日志信息收集并发送给logstash server端。由于收集到的日志信息是分散的，logstash有专门的节点用来将所有的节点收集到的日志信息按时间序列合并在一起形成一个序列，基于这一个序列请求写入并存储在elasticsearch集群中。</p><p>kibana是基于node.js开发的elasticsearch的图形用户接口。它可以将用户的搜索语句发送给ES，有ES完成搜索，并且将结果返回。kibana可以将返回的数据，用非常直观的方式（画图）来做趋势展示的。</p><p>logstash基于多种数据获取机制，TCP/UDP协议、文件、syslog、windows EventLogs及STDIN等。同时也支持多种数据输出机制。获取到数据后，它支持对数据执行过滤、修改等操作。</p><p>logstash基于JRuby语言研发，需要运行在JVM虚拟机之上。工作于agent/server模型。</p><h3 id=11-logstash工作机制>1.1 logstash工作机制<a hidden class=anchor aria-hidden=true href=#11-logstash工作机制>#</a></h3><p>在每一个产生日志的节点之上部署一个agent，这个agent通常称为<font color=#f8070d size=3><code>shipper</code></font>。shipper负责收集日志，并且发送给server端。但是在发送给server端时，为了避免server端可能无法应付大量节点同时发来的信息，会在server端和agent端之间放置一个消息队列，通常称之为<font color=#f8070d size=3><code>broker</code></font>。这个消息队列比较常见的使用redis。各agent将数据发送至broker，logstash服务器会从broker中依次取出日志拿来在本地做过滤、修改等操作。在完修改后将其发送至ES集群。</p><p>对于logstash而言，server端也是插件式的工作的模式，与ES的不同在于，ES的插件是可有可无的。logstash的除核心外的所有功能都是基于插件来完成的。</p><h3 id=12-logstash工作流程>1.2 logstash工作流程<a hidden class=anchor aria-hidden=true href=#12-logstash工作流程>#</a></h3><p>logstash的工作模式类似于管道，从指定位置读入数据，而后过滤数据，最后将其输出到指定位置。事实上logstash的工作流程为：<font color=#f8070d size=3><code>input | filter | output</code></font>。如无需对数据额外处理，filter可省略。</p><h3 id=13-logstash插件分类>1.3 logstash插件分类<a hidden class=anchor aria-hidden=true href=#13-logstash插件分类>#</a></h3><ul><li>input plugin：收集数据</li><li>codec plugin：编码插件</li><li>filter plugin：过滤</li><li>output plugin：输出插件</li></ul><h2 id=2-logstash安装下载>2 logstash安装下载<a hidden class=anchor aria-hidden=true href=#2-logstash安装下载>#</a></h2><p>官网地址：https://www.elastic.co/cn/products../../images/Logstash</p><p><div class=pe-fancybox><a data-fancybox=gallery href=../../images/Logstash/da565791.png><img src=../../images/Logstash/da565791.png#center alt=image onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h2 id=3-logstash的配置使用>3 logstash的配置使用<a hidden class=anchor aria-hidden=true href=#3-logstash的配置使用>#</a></h2><p><font color=#f8070d size=3><code>/etc../../images/Logstash/conf.d/</code></font>路径下所有以<font color=#f8070d size=3><code>.conf</code></font>结尾的文件都被当做配置文件使用。对于logstash的配置文件定义，就是定义插件。从哪得到数据。向哪里输出数据。</p><h3 id=31-logstash的基本配置框架>3.1 logstash的基本配置框架<a hidden class=anchor aria-hidden=true href=#31-logstash的基本配置框架>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input<span class=o>{</span>
</span></span><span class=line><span class=cl> 	....
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>filter<span class=o>{</span>
</span></span><span class=line><span class=cl> 	....
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>output<span class=o>{</span>
</span></span><span class=line><span class=cl> 	....
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>简单的</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input<span class=o>{</span>
</span></span><span class=line><span class=cl> 	stdin <span class=o>{}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>output <span class=o>{</span> 
</span></span><span class=line><span class=cl> 	stdout<span class=o>{</span>
</span></span><span class=line><span class=cl> 		<span class=nv>codec</span> <span class=o>=</span>&gt;rubydebug
</span></span><span class=line><span class=cl> 	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>检查配置文件语法是否正确<font color=#f8070d size=2><code>logstash -f /etc../../images/Logstash/conf.d/sample.conf --configtest</code></font></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ logstash -f /etc../../images/Logstash/conf.d/sample.conf 
</span></span><span class=line><span class=cl>hellow owrd
</span></span><span class=line><span class=cl>Settings: Default pipeline workers: <span class=m>1</span>
</span></span><span class=line><span class=cl>Pipeline main started
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>       <span class=s2>&#34;message&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;hellow owrd&#34;</span>, <span class=c1>#←信息的完整内容。logstash的信息是在input → filter → output之间流动的。</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;@version&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;1&#34;</span>, <span class=c1>#←版本号。</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;@timestamp&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;2018-06-04T15:02:47.912Z&#34;</span>, <span class=c1>#←事件发生时的时间戳。</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;host&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;test&#34;</span> <span class=c1>#←时间发生的主机。</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=32-logstash支持的数据类型>3.2 logstash支持的数据类型<a hidden class=anchor aria-hidden=true href=#32-logstash支持的数据类型>#</a></h3><p>Array：[iteml,item2,&mldr;]
Boolean：true,false
Bytes
Codec：编码器。
Hash: key =>value
Number
Password：
Path：文件系统路径。
String：字符串。
logstash还支持字段引用，使用<font color=#f8070d size=3><code>[]</code></font>进行引用</p><p>3.3 支持的条件判断
==，!=，&lt;，&lt;=，>，>= 正则匹配=~ !~
in,not in and,or</p><h2 id=4-logstash常用的插件>4 Logstash常用的插件<a hidden class=anchor aria-hidden=true href=#4-logstash常用的插件>#</a></h2><p>logstash是高度插件化的，主要分为<font color=#f8070d size=3><code>input</code></font> <font color=#f8070d size=3><code>codec</code></font> <font color=#f8070d size=3><code>filter</code></font> <font color=#f8070d size=3><code>output</code></font>插件：</p><h3 id=41-input插件>4.1 input插件<a hidden class=anchor aria-hidden=true href=#41-input插件>#</a></h3><h4 id=411-file>4.1.1 File<a hidden class=anchor aria-hidden=true href=#411-file>#</a></h4><p>从指定的文件中读取事件流。其工作特性类似于<font color=#f8070d size=3><code>tail -1f</code></font>，能够将日志文件尾部的一行不断的读取出来。</p><p>logstash使用<font color=#f8070d size=3><code>FileWatch</code></font>（ruby gem库）机制来监听文件变化。filewatch是linux内核中提供的一种功能。filewatch库支持以glob方式展开文件名。因此可以监听多个文件。并且可以将每个文件读取的位置及状态信息保存在<font color=#f8070d size=3><code>.sincedb</code></font>数据库中。即使重启logstash后也不会从头读取文件的。.sincedb记录了每个被监听的文件的<font color=#f8070d size=3><code>inode</code></font>,<font color=#f8070d size=3><code>major number</code></font>,<font color=#f8070d size=3><code>minor nubmer</code></font>,<font color=#f8070d size=3><code>pos</code></font>。默认情况下位于启动logstash服务的用户家目录下。也可以自行定义位置。另外，file插件还可以自动识别日志的滚动（日志分割）操作。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input<span class=o>{</span>
</span></span><span class=line><span class=cl>    file<span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>path</span> <span class=o>=</span>&gt; <span class=o>[</span><span class=s1>&#39;/var/log/messages&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>type</span> <span class=o>=</span>&gt; <span class=s2>&#34;system&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nv>start_postition</span> <span class=o>=</span>&gt; <span class=s2>&#34;beginning&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>output<span class=o>{</span>
</span></span><span class=line><span class=cl>    stdout<span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>codec</span> <span class=o>=</span>&gt; rubydebug
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p><a href=https://www.elastic.co/guide/en../../images/Logstash/2.4/index.html target=_blank rel="noopener nofollow noreferrer">Logstash</a>
<a href=https://www.elastic.co/guide/en../../images/Logstash/2.4/plugins-inputs-file.html target=_blank rel="noopener nofollow noreferrer">file</a></p><h4 id=412-udp>4.1.2 UDP<a hidden class=anchor aria-hidden=true href=#412-udp>#</a></h4><p>logstash支持通过一个简单的协议来读取信息，如UDP、TCP，说明对方只要通过TCP协议发送时间也是支持的。或者哪怕通过syslog收集事件也是可以的。</p><p>logstash通过UDP协议通过网络连接来读取信息，其唯一必须制定的参数为<font color=#f8070d size=3><code>port</code></font>，用于指定自己监听的端口，agent可以向服务器端端口发送日志信息。而每个被收集数据的主机使用守护进程向server端发送事件。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input<span class=o>{</span>
</span></span><span class=line><span class=cl>    udp<span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>prot</span> <span class=o>=</span>&gt; <span class=m>25826</span>
</span></span><span class=line><span class=cl>        <span class=nv>queue_size</span> <span class=o>=</span>&gt; <span class=m>2000</span>  <span class=c1>#←队列大小</span>
</span></span><span class=line><span class=cl>        <span class=nv>workers</span> <span class=o>=</span>&gt; <span class=m>2</span>        <span class=c1>#←启动的工作线程数来接收发送的事件。</span>
</span></span><span class=line><span class=cl>        <span class=nv>buffer_size</span> <span class=o>=</span>&gt;      <span class=c1>#←接收缓冲区的大小</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>UDP插件实现</strong></p></blockquote><p>collectd：基于C语言开发的一款高度插件式的主机性能监控程序，以守护进程方式运行，能够收集系统性能相关的各种数据；并且能够基于各种存储机制将收集的结果存储下来。collectd本身所收集到的数据可以通过自身的network插件，将自己在本机所收集到的数据发送至其他主机。</p><p>collectd在epel源中</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>yum install collectd -y</span></span></code></pre></td></tr></table></div></div></div></div><p>collectd的大量.so文件为其模块（插件），每一个模块分别实现每一种相应的功能。其配置文件 <font color=#f8070d size=3><code>/etc/collectd.conf</code></font></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>Hostname <span class=s2>&#34;node3.magedu.com&#34;</span>
</span></span><span class=line><span class=cl>LoadPlugin syslog 
</span></span><span class=line><span class=cl>LoadPlugin cpu  <span class=c1># cpu性能数据</span>
</span></span><span class=line><span class=cl>LoadPlugin df  <span class=c1># 磁盘空间使用情况</span>
</span></span><span class=line><span class=cl>LoadPlugin interface <span class=c1># 网络接口</span>
</span></span><span class=line><span class=cl>LoadPlugin 1oad  <span class=c1># 服务器负载</span>
</span></span><span class=line><span class=cl>LoadPlugin memory  <span class=c1># 内存</span>
</span></span><span class=line><span class=cl>LoadPlugin network 
</span></span><span class=line><span class=cl>&lt;Plugin network&gt;
</span></span><span class=line><span class=cl>    &lt;server <span class=s2>&#34;10.0.0.19&#34;</span> <span class=s2>&#34;25826&#34;</span>&gt; <span class=c1>#10.0.0.19是logstash主机的地址，25826是其监听的udp端口</span>
</span></span><span class=line><span class=cl>    &lt;/server&gt;
</span></span><span class=line><span class=cl>&lt;/Plugin</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input udp <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>port</span> <span class=o>=</span>&gt; <span class=s2>&#34;25826&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>codec</span> <span class=o>=</span>&gt; collectd <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span> <span class=o>=</span>&gt; <span class=s2>&#34;collectd&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>output<span class=o>{</span>
</span></span><span class=line><span class=cl>    stdout<span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>codec</span> <span class=o>=</span>&gt; rubydebug
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=413-redis>4.1.3 redis<a hidden class=anchor aria-hidden=true href=#413-redis>#</a></h4><p>redis插件主要作用在于从redis中获取数据。它支持redis中的两种方式；支持redis channel（发布频道）以及lists两种方式。logstash从redis读数据，可以基于列表方式进行。也可以基于channel方式进行。也就是说redis可以仅工作在正常模式下，不用启用channel机制，也一样能够使logstash从中获取数据。</p><p>对于logstash而言，一般要求redis版本在<font color=#f8070d size=3><code>2.6.0</code></font>之后的版本。</p><h3 id=42-filter插件>4.2 filter插件<a hidden class=anchor aria-hidden=true href=#42-filter插件>#</a></h3><p>filter插件主要用于将event通过output发出之前对其实现某些处理功能。对所收集到的数据当中，期望能够基于某种特定格式进行拆分、组合、过滤其中某些信息，都可以使用filter插件实现。在过滤前后如果有需要，都可以调用codec插件，事先基于某种形式对消息做编码。将处理过数据存往任何可存储位置，需要用到特定于存储位置的输出插件。logstash有众多filter过滤器。</p><h4 id=421-grok>4.2.1 grok<a hidden class=anchor aria-hidden=true href=#421-grok>#</a></h4><p>gork是logstash中最重要的插件之一，主要用于分析并结构化文本数据。从web服务器日志读取的日志事件是遵循同种格式的，如：我们只想统计有多少访问IP，但是获取的是一行信息。为了能够方便随后的统计操作，需要将每读到的任何一行日志实现切好。使得对日志分析能够得以进行。目前是logstash中将非结构化日志数据转化为结构化的可查询数据的不二之选。</p><p>目前支持处理 <font color=#f8070d size=3><code>syslog</code></font> <font color=#f8070d size=3><code>httpd</code></font> <font color=#f8070d size=3><code>nginx</code></font> 等。默认情况下，logstash提供了120种默认grok模式。这些模式定义在<font color=#f8070d size=3><code>patterns</code></font>目录下，每个模式都有默认的名称。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>rpm -ql logstash<span class=p>|</span>grep <span class=s2>&#34;patterns</span>$<span class=s2>&#34;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=422-gork语法格式>4.2.2 gork语法格式<a hidden class=anchor aria-hidden=true href=#422-gork语法格式>#</a></h4><p>logstash中grok的语法格式是使用<font color=#f8070d size=3><code>%{}</code></font>括起的一组信息使用<font color=#f8070d size=3><code>:</code></font>隔开，其中左半段称之为<font color=#f8070d size=3><code>SYNTAX</code></font>由半段称之为<font color=#f8070d size=3><code>SEMANTIC</code></font>。其中SYNTAX表示grok模板预定义模式中已有的模式名称，SEMANTIC，匹配到的文本的自定义的标识符。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>%<span class=o>{</span>SYNTAX:SEMANTIC<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>例:</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>10.0.0.1 GET /index.html <span class=m>30</span> 0.23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%<span class=o>{</span>IP:client_ip<span class=o>}</span> %<span class=o>{</span>WORD:method<span class=o>}</span> %<span class=o>{</span>URIPATHPARAM:request<span class=o>}</span> %<span class=o>{</span>NUMBER:bytes<span class=o>}</span> %<span class=o>{</span>NUMBER:duration<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>10.0.0.1 GET /index.html 30 0.23
{
&ldquo;message&rdquo; => &ldquo;10.0.0.1 GET /index.html 30 0.23&rdquo;,
&ldquo;@version&rdquo; => &ldquo;1&rdquo;,
&ldquo;@timestamp&rdquo; => &ldquo;2018-05-31T10:34:37.150Z&rdquo;,
&ldquo;host&rdquo; => &ldquo;mysql&rdquo;,
&ldquo;client_ip&rdquo; => &ldquo;10.0.0.1&rdquo;,
&ldquo;method&rdquo; => &ldquo;GET&rdquo;,
&ldquo;request&rdquo; => &ldquo;/index.html&rdquo;,
&ldquo;bytes&rdquo; => &ldquo;30&rdquo;,
&ldquo;duration&rdquo; => &ldquo;0.23&rdquo;
}</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input <span class=o>{</span>
</span></span><span class=line><span class=cl>		stdin <span class=o>{}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>filter <span class=o>{</span>
</span></span><span class=line><span class=cl>  grok <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>match</span> <span class=o>=</span>&gt; <span class=o>{</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;message&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;%{IP:client_ip} %{WORD:method} %{URIPATHPARAM:request} %{NUMBER:bytes} %{NUMBER:duration}&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=o>}</span> 
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>output <span class=o>{</span>
</span></span><span class=line><span class=cl>		stdout <span class=o>{</span> <span class=nv>codec</span> <span class=o>=</span>&gt; rubydebug <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>自定义grok模式</p><p>grok模式是基于正则表达式的模式编写，其元字符与其他用到正则表达式的工具awk\sed\grep\pcre差别不大</p><p>nginx log匹配方式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>NGUSERNAME <span class=o>[</span>a-zA-Z<span class=se>\.\@\-\+</span>_%<span class=o>]</span>+
</span></span><span class=line><span class=cl>NGUSER %<span class=o>{</span>NGUSERNAME<span class=o>}</span>
</span></span><span class=line><span class=cl>NGINXACCESS %<span class=o>{</span>IPORHOST:clientip<span class=o>}</span> - %<span class=o>{</span>NOTSPACE:remote_user<span class=o>}</span> <span class=se>\[</span>%<span class=o>{</span>HTTPDATE:timestamp<span class=o>}</span><span class=se>\]</span> <span class=se>\&#34;</span><span class=o>(</span>?:%<span class=o>{</span>WORD:verb<span class=o>}</span> %<span class=o>{</span>NOTSPACE:request<span class=o>}(</span>?: HTTP/%<span class=o>{</span>NUMBER:httpversion<span class=o>})</span>?<span class=p>|</span>%<span class=o>{</span>DATA:rawrequest<span class=o>})</span><span class=se>\&#34;</span> %<span class=o>{</span>NUMBER:response<span class=o>}</span> <span class=o>(</span>?:%<span class=o>{</span>NUMBER:bytes<span class=o>}</span><span class=p>|</span>-<span class=o>)</span> %<span class=o>{</span>QS:referrer<span class=o>}</span> %<span class=o>{</span>QS:agent<span class=o>}</span> %<span class=o>{</span>NOTSPACE:http_x_forwarded_for<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p><a href=https://blog.csdn.net/joeyon1985/article/details/46639511 target=_blank rel="noopener nofollow noreferrer">LOGSTASH+ELASTICSEARCH+KIBANA处理NGINX访问日志 - CSDN博客</a></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input <span class=o>{</span>
</span></span><span class=line><span class=cl>		file <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=nv>path</span> <span class=o>=</span>&gt; <span class=o>[</span><span class=s1>&#39;/var/log/nginx/access.log&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>				<span class=nb>type</span> <span class=o>=</span>&gt; <span class=s2>&#34;nginxlog&#34;</span>
</span></span><span class=line><span class=cl>				<span class=nv>start_position</span> <span class=o>=</span>&gt; <span class=s2>&#34;beginning&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>filter <span class=o>{</span>
</span></span><span class=line><span class=cl>		grok <span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=nv>match</span> <span class=o>=</span>&gt; <span class=o>{</span> <span class=s2>&#34;message&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;%{NGINXACCESS}&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>output <span class=o>{</span>
</span></span><span class=line><span class=cl>		stdout	<span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=nv>codec</span> <span class=o>=</span>&gt; rubydebug
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>action 将数据输出到至elasticsearch中后基于什么方式做操作
hosts es主机集群列表。数组
index 存储在es的哪个索引当中</p><p>logstash在使用redis做输入或输出插件时，有两种数据类型，用来保存logstash输出的数据list channel</p><p><a href=https://blog.csdn.net/aaronhadoop/article/details/73163025 target=_blank rel="noopener nofollow noreferrer">ES5.4.0 记录 - CSDN博客</a></p><p><a href=https://blog.csdn.net/qq_21383435/article/details/79323739 target=_blank rel="noopener nofollow noreferrer">18-elasticsearch集群健康为黄色 - CSDN博客</a></p><p>curl -X PUT 172.16.16.18:9200/gongsufanghua-work_record/_settings -d &lsquo;{
&ldquo;index&rdquo; : {
&ldquo;number_of_replicas&rdquo; : 0
}
}&rsquo;</p><p><a href=https://segmentfault.com/a/1190000011784259 target=_blank rel="noopener nofollow noreferrer">logstash-input-jdbc同步mysql数据到elasticsearch - 运维学习之路 - SegmentFault 思否</a></p><p><a href=https://blog.csdn.net/u012546526/article/details/78598608 target=_blank rel="noopener nofollow noreferrer">Elasticsearch yellow unassigned_shards 恢复 replicas 节点恢复 - CSDN博客</a></p><p><a href=https://www.jianshu.com/p/62433b9c5c96 target=_blank rel="noopener nofollow noreferrer">logstash mysql 准实时同步到 elasticsearch - 简书</a></p><h2 id=5-conditionals>5 conditionals<a hidden class=anchor aria-hidden=true href=#5-conditionals>#</a></h2><p>当需要在特定条件下过滤或输出事件。可以使用条件条件判断语句。Logstash中的条件查看和行为与编程语言中的条件相同。条件语句支持if，else if以及else和可以被嵌套。</p><p><a href=https://www.elastic.co/guide/en../../images/Logstash/6.4/event-dependent-configuration.html#conditionals target=_blank rel="noopener nofollow noreferrer">conditionals</a></p><h3 id=51-语法>5.1 语法<a hidden class=anchor aria-hidden=true href=#51-语法>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>if</span> EXPRESSION <span class=o>{</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> EXPRESSION <span class=o>{</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>logstash支持以下比较运算符：</p><ul><li><font color=#f8070d size=3><code>==</code></font> <font color=#f8070d size=3><code>!=</code></font>、 <font color=#f8070d size=3><code>&lt;</code></font> <font color=#f8070d size=3><code>></code></font> <font color=#f8070d size=3><code>&lt;=</code></font> <font color=#f8070d size=3><code>>=</code></font></li><li>regexp：<font color=#f8070d size=3><code>=~</code></font><font color=#f8070d size=3><code>!~</code></font>（检查右边的模式与左边的字符串值）</li><li>包含：<font color=#f8070d size=3><code>in</code></font> <font color=#f8070d size=3><code>not in</code></font></li><li>布尔运算符是： <font color=#f8070d size=3><code>and</code></font> <font color=#f8070d size=3><code>or</code></font> <font color=#f8070d size=3><code>nand</code></font> <font color=#f8070d size=3><code>xor（异或）</code></font></li><li>支持的一元运算符是：<font color=#f8070d size=3><code>!</code></font></li></ul><hr><p>注：条件判断语句不包括数学运算符，如下写法logstash会报错</p><hr><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span>seg_num<span class=o>]</span>&lt;<span class=o>[</span>total_seg<span class=o>]</span>-1 <span class=o>{</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=o>}</span> </span></span></code></pre></td></tr></table></div></div></div></div><h3 id=52-logstash常用条件判断语句>5.2 logstash常用条件判断语句<a hidden class=anchor aria-hidden=true href=#52-logstash常用条件判断语句>#</a></h3><p>为了避免多个input的数据提交到Elasticsearch后共存于一个索引中。使用index参数来为每个不同的type建立单独的索引。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>input<span class=o>{</span>
</span></span><span class=line><span class=cl>  file<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>path</span><span class=o>=</span>&gt; <span class=s2>&#34;/usr/local/elasticsearch-2.3.2/logs/elasticsearch.log.*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>type</span><span class=o>=</span>&gt; <span class=s2>&#34;elasticsearch&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>start_position</span><span class=o>=</span>&gt; <span class=s2>&#34;beginning&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  file<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>path</span><span class=o>=</span>&gt; <span class=s2>&#34;/var/log/secure&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>type</span><span class=o>=</span>&gt; <span class=s2>&#34;secure&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>start_position</span><span class=o>=</span>&gt; <span class=s2>&#34;beginning&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>output<span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span>type<span class=o>]</span> <span class=o>==</span> <span class=s2>&#34;elasticsearch&#34;</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>    elasticsearch <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>hosts</span><span class=o>=</span>&gt; <span class=o>[</span><span class=s2>&#34;192.168.44.129:9200&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>index</span><span class=o>=</span>&gt; <span class=s2>&#34;elasticsearch-%{+YYYY-MM}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span>type<span class=o>]</span> <span class=o>==</span> <span class=s2>&#34;secure&#34;</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>    elasticsearch <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>hosts</span><span class=o>=</span>&gt; <span class=o>[</span><span class=s2>&#34;192.168.44.129:9200&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>index</span><span class=o>=</span>&gt; <span class=s2>&#34;secure-%{+YYYY-MM}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>  </span></span></code></pre></td></tr></table></div></div></div></div><p>使用in运算符来测试字段是否包含特定字符串，键或（对于列表）元素：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>filter <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span>foo<span class=o>]</span> in <span class=o>[</span>foobar<span class=o>]</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    mutate <span class=o>{</span> <span class=nv>add_tag</span> <span class=o>=</span>&gt; <span class=s2>&#34;field in field&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span>foo<span class=o>]</span> in <span class=s2>&#34;foo&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    mutate <span class=o>{</span> <span class=nv>add_tag</span> <span class=o>=</span>&gt; <span class=s2>&#34;field in string&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=s2>&#34;hello&#34;</span> in <span class=o>[</span>greeting<span class=o>]</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    mutate <span class=o>{</span> <span class=nv>add_tag</span> <span class=o>=</span>&gt; <span class=s2>&#34;string in field&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span>foo<span class=o>]</span> in <span class=o>[</span><span class=s2>&#34;hello&#34;</span>, <span class=s2>&#34;world&#34;</span>, <span class=s2>&#34;foo&#34;</span><span class=o>]</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    mutate <span class=o>{</span> <span class=nv>add_tag</span> <span class=o>=</span>&gt; <span class=s2>&#34;field in list&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span>missing<span class=o>]</span> in <span class=o>[</span>alsomissing<span class=o>]</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    mutate <span class=o>{</span> <span class=nv>add_tag</span> <span class=o>=</span>&gt; <span class=s2>&#34;shouldnotexist&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> !<span class=o>(</span><span class=s2>&#34;foo&#34;</span> in <span class=o>[</span><span class=s2>&#34;hello&#34;</span>, <span class=s2>&#34;world&#34;</span><span class=o>])</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    mutate <span class=o>{</span> <span class=nv>add_tag</span> <span class=o>=</span>&gt; <span class=s2>&#34;shouldexist&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>  </span></span></code></pre></td></tr></table></div></div></div></div><p>在单个条件中指定多个表达式：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span>loglevel<span class=o>]</span> <span class=o>==</span> <span class=s2>&#34;ERROR&#34;</span> and <span class=o>[</span>deployment<span class=o>]</span> <span class=o>==</span> <span class=s2>&#34;production&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    pagerduty <span class=o>{</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：Logstash使用</p><p>文章链接：<a href=https://www.oomkill.com/2018/11/logstash/ target=_blank>https://www.oomkill.com/2018/11/logstash/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2018/11/elk-collect-java/><span>ELK收集java日志</span></a></li><li><a href=/2018/11/collect-syslog/><span>ELK收集syslog</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/logging/>Logging</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2018/11/jenkins-docker/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>jenkins pipeline docker方式</span>
</a><a class=next href=https://www.oomkill.com/2018/10/go-datasort/><span class=title></span>
<span>Go数组排序算法&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/logstash","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>