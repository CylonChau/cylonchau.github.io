<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>docker-compose示例 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="docker"><meta name=description content='使用docker-compose构建LNMP环境。 编写Dockerfile 这里采用的是先将nginx php打包为rpm包，然后做成镜像。与直接在容器里编译安装同理的。
nginx Dockerfile
bash 1 2 3 4 5 6 7 8 FROM centos MAINTAINER lc RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ RUN cd /tmp/ && rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ADD nginx.conf /etc/nginx/ EXPOSE 80 CMD ["/usr/sbin/nginx", "-g", "daemon off;"] php Dockerfile
bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 FROM centos MAINTAINER LC RUN curl -o /etc/yum.'><meta name=author content="cylon"><link rel=canonical href=http://localhost:1313/2018/06/docker-compose-example/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/favicon.ico><link rel=mask-icon href=http://localhost:1313/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/2018/06/docker-compose-example/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="docker-compose示例"><meta property="og:description" content='使用docker-compose构建LNMP环境。 编写Dockerfile 这里采用的是先将nginx php打包为rpm包，然后做成镜像。与直接在容器里编译安装同理的。
nginx Dockerfile
bash 1 2 3 4 5 6 7 8 FROM centos MAINTAINER lc RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ RUN cd /tmp/ && rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ADD nginx.conf /etc/nginx/ EXPOSE 80 CMD ["/usr/sbin/nginx", "-g", "daemon off;"] php Dockerfile
bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 FROM centos MAINTAINER LC RUN curl -o /etc/yum.'><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/2018/06/docker-compose-example/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-22T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="docker-compose示例"><meta name=twitter:description content='使用docker-compose构建LNMP环境。 编写Dockerfile 这里采用的是先将nginx php打包为rpm包，然后做成镜像。与直接在容器里编译安装同理的。
nginx Dockerfile
bash 1 2 3 4 5 6 7 8 FROM centos MAINTAINER lc RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ RUN cd /tmp/ && rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ADD nginx.conf /etc/nginx/ EXPOSE 80 CMD ["/usr/sbin/nginx", "-g", "daemon off;"] php Dockerfile
bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 FROM centos MAINTAINER LC RUN curl -o /etc/yum.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"docker-compose示例","item":"http://localhost:1313/2018/06/docker-compose-example/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"docker-compose示例","name":"docker-compose示例","description":"使用docker-compose构建LNMP环境。 编写Dockerfile 这里采用的是先将nginx php打包为rpm包，然后做成镜像。与直接在容器里编译安装同理的。\nnginx Dockerfile\nbash 1 2 3 4 5 6 7 8 FROM centos MAINTAINER lc RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ RUN cd /tmp/ \u0026amp;\u0026amp; rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ADD nginx.conf /etc/nginx/ EXPOSE 80 CMD [\u0026#34;/usr/sbin/nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] php Dockerfile\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 FROM centos MAINTAINER LC RUN curl -o /etc/yum.","keywords":["docker"],"articleBody":"使用docker-compose构建LNMP环境。 编写Dockerfile 这里采用的是先将nginx php打包为rpm包，然后做成镜像。与直接在容器里编译安装同理的。\nnginx Dockerfile\nbash 1 2 3 4 5 6 7 8 FROM centos MAINTAINER lc RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ RUN cd /tmp/ \u0026\u0026 rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ADD nginx.conf /etc/nginx/ EXPOSE 80 CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] php Dockerfile\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 FROM centos MAINTAINER LC RUN curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo RUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo RUN yum install zlib-devel \\ libxml2-devel \\ libjpeg-devel \\ libjpeg-turbo-devel \\ freetype-devel \\ libpng-devel gd-devel \\ curl-devel \\ libxslt-devel \\ bzip2-devel \\ gmp-devel \\ readline-devel \\ mcrypt \\ mhash \\ openssl-devel \\ libmcrypt-devel -y COPY php-7.1.17-1.el7.centos.x86_64.rpm /tmp/ COPY libiconv-1.15-1.el7.centos.x86_64.rpm /tmp/ RUN rpm -ivh /tmp/libiconv-1.15-1.el7.centos.x86_64.rpm RUN rpm -ivh /tmp/php-7.1.17-1.el7.centos.x86_64.rpm ADD php-fpm.conf /etc/php/ CMD /usr/sbin/php-fpm \u0026\u0026 tail -f /dev/null EXPOSE 9000 准备构建容器的配置文件 在nginx配置文件中增加解析php的语句\nnginx 1 2 3 4 5 location ~ .*\\.(php|php5)$ { fastcgi_pass php.com:9000;$\u003c--这里使用link将php的ip解析过来 fastcgi_index index.php; include fastcgi.conf; } 修改php-fpm监听端口为外网通讯的ip\nbash 1 2 3 $ sed -i \"s#listen = 127.0.0.1:900$listen = 0.0.0.0:900$g\" php/php-fpm.conf $ cat php/php-fpm.conf |grep 9000 listen = 0.0.0.0:9000 注：此步骤可以在打包RPM时，使用%post在安装后进行修改，免去构建镜像的步骤\n准备RPM包 bash 1 2 3 4 5 6 7 8 9 10 11 $ ls -1 php libiconv-1.15-1.el7.centos.x86_64.rpm php-7.1.17-1.el7.centos.x86_64.rpm phpfile php-fpm.conf php.ini $ ls -1 nginx nginx-1.13.9-1.el7.centos.x86_64.rpm nginx.conf nginxfile 使用docker-compose一键构建镜像 编写docker-compose.yaml yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 version: \"3\" services: nginx: hostname: nginx build: context: ./nginx dockerfile: nginxfile expose: - \"80\" ports: - \"80:80\" links: - mysql - php:php.com volumes: - ./wwwroot:/usr/share/nginx/html/ php: hostname: \"php\" build: context: ./php dockerfile: phpfile ports: - \"9000:9000\" links: - mysql:mysql-db volumes: - ./wwwroot:/usr/share/nginx/html/ mysql: image: mysql:5.6 hostname: mysql ports: - \"3306:3306\" environment: MYSQL_ROOT_PASSWORD: \"Zhang@123\" MYSQL_USER: \"test\" MYSQL_PASSWORD: \"test@123\" 参考文档： https://hub.docker.com/_/mysql/\n检查docker-compose-yaml语法 bash 1 2 3 4 5 6 7 8 9 10 11 $ docker-compose config services: mysql: environment: MYSQL_PASSWORD: test@123 MYSQL_ROOT_PASSWORD: Zhang@123 MYSQL_USER: test hostname: mysql image: mysql:5.6 ports: ...... 注：在语法正确时，打印docker-compose.yaml内容，语法出错直接报问题所在位置。\n一键构建所有镜像 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 $ docker-compose build mysql uses an image, skipping Building php Step 1/12 : FROM centos ---\u003e 5182e96772bf ..... Step 12/12 : EXPOSE 9000 ---\u003e Running in 3c5f3c46124c Removing intermediate container 3c5f3c46124c ---\u003e 8791ad17224d Successfully built 8791ad17224d Successfully tagged lnmp_php:latest Building nginx Step : FROM centos ---\u003e 5182e96772bf ..... Step 8/8 : CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] ---\u003e Using cache ---\u003e 8cca531a5c21 Successfully built 8cca531a5c21 Successfully tagged lnmp_nginx:latest 管理编排容器 bash 1 2 3 docker-compose up -d docker-compose down docker-compose ps 查看运行结果\n使用docker-compose一键构建tomcat集群 编写Dockerfile nginx Dockerfile bash 1 2 3 4 5 6 7 8 FROM centos MAINTAINER lc RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ RUN cd /tmp/ \u0026\u0026 rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ADD nginx.conf /etc/nginx/ EXPOSE 80 CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] tomcat Dockerfile bash 1 2 3 4 5 6 7 8 9 FROM centos MAINTAINER lc ADD apache-tomcat-8.5.29.tar.gz /usr/share/ ADD jdk-8u161-linux-x64.tar.gz /usr/share/ RUN mv /usr/share/apache-tomcat-8.5.29 /usr/share/tomcat ENV JAVA_HOME=/usr/share/jdk1.8.0_161 WORKDIR /usr/share/tomcat ENTRYPOINT [\"bin/catalina.sh\",\"run\"] EXPOSE 8080 准备配置文件 nginx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 upstream tomcat { server tomcat01:8080; server tomcat02:8080; } server { listen 81; location / { proxy_pass http://tomcat/; proxy_set_header Host $host; client_max_body_size 10m; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } # 在日志中加入如下配置，来证明访问是负载进行的。 log_format access '\"$upstream_addr\" $remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /data/nginx/log/access.log access; bash 1 2 mkdir ./webapps/ROOT echo jsp-test \u003ewebapps/ROOT/index.jsp 准备构建容器所需的软件 bash 1 2 3 apache-tomcat-8.5.29.tar.gz jdk-8u144-linux-x64.tar.gz tomcatfile 编写docker-compose文件 yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 version: \"3\" services: nginx: hostname: nginx build: context: ./nginx dockerfile: nginxfile ports: - 80:81 links: - tomcat01:tomcat01 - tomcat02:tomcat02 volumes: - ./webapps:/usr/share/nginx/html depends_on: - mysql - tomcat01 - tomcat02 tomcat01: hostname: tomcat01 build: context: ./tomcat dockerfile: tomcatfile links: - mysql:mysql-db volumes: - ./webapps:/usr/share/tomcat/webapps/ tomcat02: hostname: tomcat02 build: context: ./tomcat dockerfile: tomcatfile links: - mysql:mysql-db volumes: - ./webapps:/usr/share/tomcat/webapps/ mysql: hostname: mysql image: mysql:5.5 ports: - 3306:3306 environment: MYSQL_ROOT_PASSWORD: 123456 MYSQL_DATABASE: wordpress MYSQL_USER: user MYSQL_PASSWORD: 123456 使用docker-compose一键构建镜像 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 $ docker-compose -f docker-compose.yml build mysql uses an image, skipping Building tomcat02 Step : FROM centos ---\u003e 5182e96772bf Step 2/9 : MAINTAINER lc ---\u003e Using cache ---\u003e 111890e6d42e Step 3/9 : ADD apache-tomcat-8.5.29.tar.gz /usr/share/ ---\u003e 46725ed86e2e Step 4/9 : ADD jdk-8u144-linux-x64.tar.gz /usr/share/ ---\u003e 431ea9bb9918 Step 5/9 : RUN mv /usr/share/apache-tomcat-8.5.29 /usr/share/tomcat ---\u003e Running in 22275e028633 Removing intermediate container 22275e028633 ---\u003e 0f3919e97b50 Step 6/9 : ENV JAVA_HOME=/usr/share/jdk1.8.0_144 ---\u003e Running in 60d616e0b9fc Removing intermediate container 60d616e0b9fc ---\u003e 5255488c51ab Step 7/9 : WORKDIR /usr/share/tomcat ---\u003e Running in 6b04d8f5524b Removing intermediate container 6b04d8f5524b ---\u003e db88a81ec00a Step 8/9 : ENTRYPOINT [\"bin/catalina.sh\",\"run\"] ---\u003e Running in 189b6ee0ff4e Removing intermediate container 189b6ee0ff4e ---\u003e 9b444829ed55 Step 9/9 : EXPOSE 8080 ---\u003e Running in f2115bf03afb Removing intermediate container f2115bf03afb ---\u003e 31c01ca93305 Successfully built 31c01ca93305 Successfully tagged lnmp_tomcat02:latest Building tomcat01 Step : FROM centos ---\u003e 5182e96772bf Step 2/9 : MAINTAINER lc ---\u003e Using cache ---\u003e 111890e6d42e Step 3/9 : ADD apache-tomcat-8.5.29.tar.gz /usr/share/ ---\u003e Using cache ---\u003e 46725ed86e2e Step 4/9 : ADD jdk-8u144-linux-x64.tar.gz /usr/share/ ---\u003e Using cache ---\u003e 431ea9bb9918 Step 5/9 : RUN mv /usr/share/apache-tomcat-8.5.29 /usr/share/tomcat ---\u003e Using cache ---\u003e 0f3919e97b50 Step 6/9 : ENV JAVA_HOME=/usr/share/jdk1.8.0_144 ---\u003e Using cache ---\u003e 5255488c51ab Step 7/9 : WORKDIR /usr/share/tomcat ---\u003e Using cache ---\u003e db88a81ec00a Step 8/9 : ENTRYPOINT [\"bin/catalina.sh\",\"run\"] ---\u003e Using cache ---\u003e 9b444829ed55 Step 9/9 : EXPOSE 8080 ---\u003e Using cache ---\u003e 31c01ca93305 Successfully built 31c01ca93305 Successfully tagged lnmp_tomcat01:latest Building nginx Step : FROM centos ---\u003e 5182e96772bf Step 2/8 : MAINTAINER lc ---\u003e Using cache ---\u003e 111890e6d42e Step 3/8 : RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel ---\u003e Using cache ---\u003e 36090d81ef5e Step 4/8 : ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/ ---\u003e Using cache ---\u003e cecd606c7619 Step 5/8 : RUN cd /tmp/ \u0026\u0026 rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm ---\u003e Using cache ---\u003e 8c7b331fc175 Step 6/8 : ADD nginx.conf /etc/nginx/ ---\u003e 84940ae84e06 Step 7/8 : EXPOSE 80 ---\u003e Running in 94ac22711605 Removing intermediate container 94ac22711605 ---\u003e ef10799c0844 Step 8/8 : CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] ---\u003e Running in 039ea9de17f0 Removing intermediate container 039ea9de17f0 ---\u003e d489d87223f8 Successfully built d489d87223f8 Successfully tagged lnmp_nginx:latest 测试访问结果\n查看nginx访问日志，发现是负载到每一台tomcat上的。\nbash 1 2 \"172.24.0.5:8080\" 10.0.0.1 - - [12/Aug/2018:17:52:39 +0000] \"GET /index.jsp HTTP/1.1\" 200 9 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.Safari/537.36\" \"-\" \"172.24.0.4:8080\" 10.0.0.1 - - [12/Aug/2018:17:52:40 +0000] \"GET /index.jsp HTTP/1.1\" 200 9 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.Safari/537.36\" \"-\" ","wordCount":"1236","inLanguage":"zh","datePublished":"2018-06-02T00:00:00Z","dateModified":"2023-03-22T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/2018/06/docker-compose-example/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/><img src=http://localhost:1313/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives><span>归档</span></a></li><li><a href=http://localhost:1313/tags><span>标签</span></a></li><li><a href=http://localhost:1313/search><span>搜索</span></a></li><li><a href=http://localhost:1313/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">docker-compose示例</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2018-06-02</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1236 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>6 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=http://localhost:1313/tags/docker/>#Docker</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e4%bd%bf%e7%94%a8docker-compose%e6%9e%84%e5%bb%balnmp%e7%8e%af%e5%a2%83 aria-label=使用docker-compose构建LNMP环境。>使用docker-compose构建LNMP环境。</a><ul><li><a href=#%e7%bc%96%e5%86%99dockerfile aria-label=编写Dockerfile>编写Dockerfile</a><li><a href=#%e5%87%86%e5%a4%87%e6%9e%84%e5%bb%ba%e5%ae%b9%e5%99%a8%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=准备构建容器的配置文件>准备构建容器的配置文件</a><li><a href=#%e5%87%86%e5%a4%87rpm%e5%8c%85 aria-label=准备RPM包>准备RPM包</a><li><a href=#%e4%bd%bf%e7%94%a8docker-compose%e4%b8%80%e9%94%ae%e6%9e%84%e5%bb%ba%e9%95%9c%e5%83%8f aria-label=使用docker-compose一键构建镜像>使用docker-compose一键构建镜像</a><ul><li><a href=#%e7%bc%96%e5%86%99docker-composeyaml aria-label=编写docker-compose.yaml>编写docker-compose.yaml</a><li><a href=#%e6%a3%80%e6%9f%a5docker-compose-yaml%e8%af%ad%e6%b3%95 aria-label=检查docker-compose-yaml语法>检查docker-compose-yaml语法</a><li><a href=#%e4%b8%80%e9%94%ae%e6%9e%84%e5%bb%ba%e6%89%80%e6%9c%89%e9%95%9c%e5%83%8f aria-label=一键构建所有镜像>一键构建所有镜像</a><li><a href=#%e7%ae%a1%e7%90%86%e7%bc%96%e6%8e%92%e5%ae%b9%e5%99%a8 aria-label=管理编排容器>管理编排容器</a></ul></ul><li><a href=#%e4%bd%bf%e7%94%a8docker-compose%e4%b8%80%e9%94%ae%e6%9e%84%e5%bb%batomcat%e9%9b%86%e7%be%a4 aria-label=使用docker-compose一键构建tomcat集群>使用docker-compose一键构建tomcat集群</a><ul><li><a href=#%e7%bc%96%e5%86%99dockerfile-1 aria-label=编写Dockerfile>编写Dockerfile</a><ul><li><a href=#nginx-dockerfile aria-label="nginx Dockerfile">nginx Dockerfile</a></ul><li><a href=#tomcat-dockerfile aria-label="tomcat Dockerfile">tomcat Dockerfile</a><li><a href=#%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=准备配置文件>准备配置文件</a><li><a href=#%e5%87%86%e5%a4%87%e6%9e%84%e5%bb%ba%e5%ae%b9%e5%99%a8%e6%89%80%e9%9c%80%e7%9a%84%e8%bd%af%e4%bb%b6 aria-label=准备构建容器所需的软件>准备构建容器所需的软件</a><li><a href=#%e7%bc%96%e5%86%99docker-compose%e6%96%87%e4%bb%b6 aria-label=编写docker-compose文件>编写docker-compose文件</a><li><a href=#%e4%bd%bf%e7%94%a8docker-compose%e4%b8%80%e9%94%ae%e6%9e%84%e5%bb%ba%e9%95%9c%e5%83%8f-1 aria-label=使用docker-compose一键构建镜像>使用docker-compose一键构建镜像</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=使用docker-compose构建lnmp环境>使用docker-compose构建LNMP环境。<a hidden class=anchor aria-hidden=true href=#使用docker-compose构建lnmp环境>#</a></h2><h3 id=编写dockerfile>编写Dockerfile<a hidden class=anchor aria-hidden=true href=#编写dockerfile>#</a></h3><p>这里采用的是先将nginx php打包为rpm包，然后做成镜像。与直接在容器里编译安装同理的。</p><blockquote><p><strong>nginx Dockerfile</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM centos
</span></span><span class=line><span class=cl>MAINTAINER lc
</span></span><span class=line><span class=cl>RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel
</span></span><span class=line><span class=cl>ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/
</span></span><span class=line><span class=cl>RUN <span class=nb>cd</span> /tmp/ <span class=o>&amp;&amp;</span> rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>ADD nginx.conf /etc/nginx/
</span></span><span class=line><span class=cl>EXPOSE <span class=m>80</span>
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;/usr/sbin/nginx&#34;</span>, <span class=s2>&#34;-g&#34;</span>, <span class=s2>&#34;daemon off;&#34;</span><span class=o>]</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>php Dockerfile</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM centos
</span></span><span class=line><span class=cl>MAINTAINER LC
</span></span><span class=line><span class=cl>RUN curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span class=line><span class=cl>RUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span class=line><span class=cl>RUN yum install zlib-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libxml2-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libjpeg-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libjpeg-turbo-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    freetype-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libpng-devel gd-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    curl-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libxslt-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    bzip2-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    gmp-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    readline-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mcrypt <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mhash <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    openssl-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libmcrypt-devel -y
</span></span><span class=line><span class=cl>COPY php-7.1.17-1.el7.centos.x86_64.rpm /tmp/
</span></span><span class=line><span class=cl>COPY libiconv-1.15-1.el7.centos.x86_64.rpm /tmp/
</span></span><span class=line><span class=cl>RUN rpm -ivh /tmp/libiconv-1.15-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>RUN rpm -ivh /tmp/php-7.1.17-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>ADD php-fpm.conf /etc/php/
</span></span><span class=line><span class=cl>CMD /usr/sbin/php-fpm <span class=o>&amp;&amp;</span> tail -f /dev/null
</span></span><span class=line><span class=cl>EXPOSE <span class=m>9000</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=准备构建容器的配置文件>准备构建容器的配置文件<a hidden class=anchor aria-hidden=true href=#准备构建容器的配置文件>#</a></h3><blockquote><p><strong>在nginx配置文件中增加解析php的语句</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>nginx</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=p>~</span> <span class=sr>.*\.(php|php5)$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kn>fastcgi_pass</span>  <span class=n>php.com</span><span class=p>:</span><span class=mi>9000</span><span class=p>;</span><span class=kn>$&lt;--这里使用link将php的ip解析过来</span>
</span></span><span class=line><span class=cl>		<span class=s>fastcgi_index</span> <span class=s>index.php</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kn>include</span> <span class=s>fastcgi.conf</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>修改php-fpm监听端口为外网通讯的ip</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sed -i <span class=s2>&#34;s#listen = 127.0.0.1:900</span><span class=nv>$listen</span><span class=s2> = 0.0.0.0:900</span><span class=nv>$g</span><span class=s2>&#34;</span> php/php-fpm.conf 
</span></span><span class=line><span class=cl>$ cat php/php-fpm.conf <span class=p>|</span>grep <span class=m>9000</span>
</span></span><span class=line><span class=cl><span class=nv>listen</span> <span class=o>=</span> 0.0.0.0:9000</span></span></code></pre></td></tr></table></div></div></div></div><hr><p>注：此步骤可以在打包RPM时，使用%post在安装后进行修改，免去构建镜像的步骤</p><hr><h3 id=准备rpm包>准备RPM包<a hidden class=anchor aria-hidden=true href=#准备rpm包>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls -1 php
</span></span><span class=line><span class=cl>libiconv-1.15-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>php-7.1.17-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>phpfile
</span></span><span class=line><span class=cl>php-fpm.conf
</span></span><span class=line><span class=cl>php.ini
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls -1 nginx
</span></span><span class=line><span class=cl>nginx-1.13.9-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>nginx.conf
</span></span><span class=line><span class=cl>nginxfile</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=使用docker-compose一键构建镜像>使用docker-compose一键构建镜像<a hidden class=anchor aria-hidden=true href=#使用docker-compose一键构建镜像>#</a></h3><h4 id=编写docker-composeyaml>编写docker-compose.yaml<a hidden class=anchor aria-hidden=true href=#编写docker-composeyaml>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>nginxfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expose</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;80:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>php:php.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./wwwroot:/usr/share/nginx/html/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>php</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;php&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./php</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>phpfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;9000:9000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql:mysql-db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./wwwroot:/usr/share/nginx/html/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3306:3306&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Zhang@123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_USER</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;test&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;test@123&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>参考文档： <a href=https://hub.docker.com/_/mysql/ target=_blank rel="noopener nofollow noreferrer">https://hub.docker.com/_/mysql/</a></p><h4 id=检查docker-compose-yaml语法>检查docker-compose-yaml语法<a hidden class=anchor aria-hidden=true href=#检查docker-compose-yaml语法>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker-compose config
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  mysql:
</span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      MYSQL_PASSWORD: test@123
</span></span><span class=line><span class=cl>      MYSQL_ROOT_PASSWORD: Zhang@123
</span></span><span class=line><span class=cl>      MYSQL_USER: <span class=nb>test</span>
</span></span><span class=line><span class=cl>    hostname: mysql
</span></span><span class=line><span class=cl>    image: mysql:5.6
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>......</span></span></code></pre></td></tr></table></div></div></div></div><hr><p><strong><font color=#f8070d; size=2>注：在语法正确时，打印docker-compose.yaml内容，语法出错直接报问题所在位置。</font></strong></p><hr><h4 id=一键构建所有镜像>一键构建所有镜像<a hidden class=anchor aria-hidden=true href=#一键构建所有镜像>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker-compose build
</span></span><span class=line><span class=cl>mysql uses an image, skipping
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Building php
</span></span><span class=line><span class=cl>Step 1/12 : FROM centos
</span></span><span class=line><span class=cl> ---&gt; 5182e96772bf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.....
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Step 12/12 : EXPOSE <span class=m>9000</span>
</span></span><span class=line><span class=cl> ---&gt; Running in 3c5f3c46124c
</span></span><span class=line><span class=cl>Removing intermediate container 3c5f3c46124c
</span></span><span class=line><span class=cl> ---&gt; 8791ad17224d
</span></span><span class=line><span class=cl>Successfully built 8791ad17224d
</span></span><span class=line><span class=cl>Successfully tagged lnmp_php:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Building nginx
</span></span><span class=line><span class=cl>Step : FROM centos
</span></span><span class=line><span class=cl> ---&gt; 5182e96772bf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.....
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Step 8/8 : CMD <span class=o>[</span><span class=s2>&#34;/usr/sbin/nginx&#34;</span>, <span class=s2>&#34;-g&#34;</span>, <span class=s2>&#34;daemon off;&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 8cca531a5c21
</span></span><span class=line><span class=cl>Successfully built 8cca531a5c21
</span></span><span class=line><span class=cl>Successfully tagged lnmp_nginx:latest</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=管理编排容器>管理编排容器<a hidden class=anchor aria-hidden=true href=#管理编排容器>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d
</span></span><span class=line><span class=cl>docker-compose down
</span></span><span class=line><span class=cl>docker-compose ps </span></span></code></pre></td></tr></table></div></div></div></div><p>查看运行结果</p><h2 id=使用docker-compose一键构建tomcat集群>使用docker-compose一键构建tomcat集群<a hidden class=anchor aria-hidden=true href=#使用docker-compose一键构建tomcat集群>#</a></h2><h3 id=编写dockerfile-1>编写Dockerfile<a hidden class=anchor aria-hidden=true href=#编写dockerfile-1>#</a></h3><h4 id=nginx-dockerfile>nginx Dockerfile<a hidden class=anchor aria-hidden=true href=#nginx-dockerfile>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM centos
</span></span><span class=line><span class=cl>MAINTAINER lc
</span></span><span class=line><span class=cl>RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel
</span></span><span class=line><span class=cl>ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/
</span></span><span class=line><span class=cl>RUN <span class=nb>cd</span> /tmp/ <span class=o>&amp;&amp;</span> rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl>ADD nginx.conf /etc/nginx/
</span></span><span class=line><span class=cl>EXPOSE <span class=m>80</span>
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;/usr/sbin/nginx&#34;</span>, <span class=s2>&#34;-g&#34;</span>, <span class=s2>&#34;daemon off;&#34;</span><span class=o>]</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=tomcat-dockerfile>tomcat Dockerfile<a hidden class=anchor aria-hidden=true href=#tomcat-dockerfile>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM centos
</span></span><span class=line><span class=cl>MAINTAINER lc
</span></span><span class=line><span class=cl>ADD apache-tomcat-8.5.29.tar.gz /usr/share/
</span></span><span class=line><span class=cl>ADD jdk-8u161-linux-x64.tar.gz /usr/share/
</span></span><span class=line><span class=cl>RUN mv /usr/share/apache-tomcat-8.5.29 /usr/share/tomcat
</span></span><span class=line><span class=cl>ENV <span class=nv>JAVA_HOME</span><span class=o>=</span>/usr/share/jdk1.8.0_161
</span></span><span class=line><span class=cl>WORKDIR /usr/share/tomcat
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;bin/catalina.sh&#34;</span>,<span class=s2>&#34;run&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>EXPOSE <span class=m>8080</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=准备配置文件>准备配置文件<a hidden class=anchor aria-hidden=true href=#准备配置文件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>nginx</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>upstream</span> <span class=s>tomcat</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kn>server</span> <span class=n>tomcat01</span><span class=p>:</span><span class=mi>8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kn>server</span> <span class=n>tomcat02</span><span class=p>:</span><span class=mi>8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kn>listen</span> <span class=mi>81</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		     <span class=kn>proxy_pass</span> <span class=s>http://tomcat/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		     <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		     <span class=kn>client_max_body_size</span> <span class=mi>10m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		     <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		     <span class=kn>proxy_set_header</span> <span class=s>REMOTE-HOST</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		     <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		 <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在日志中加入如下配置，来证明访问是负载进行的。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>log_format</span>  <span class=s>access</span>  <span class=s>&#39;&#34;</span><span class=nv>$upstream_addr&#34;</span> <span class=nv>$remote_addr</span> <span class=s>-</span> <span class=nv>$remote_user</span> <span class=s>[</span><span class=nv>$time_local]</span> <span class=s>&#34;</span><span class=nv>$request&#34;</span> <span class=s>&#39;</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#39;</span><span class=nv>$status</span> <span class=nv>$body_bytes_sent</span> <span class=s>&#34;</span><span class=nv>$http_referer&#34;</span> <span class=s>&#39;</span>
</span></span><span class=line><span class=cl>										<span class=s>&#39;&#34;</span><span class=nv>$http_user_agent&#34;</span> <span class=s>&#34;</span><span class=nv>$http_x_forwarded_for&#34;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>access_log</span> <span class=s>/data/nginx/log/access.log</span> <span class=s>access</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir ./webapps/ROOT
</span></span><span class=line><span class=cl><span class=nb>echo</span> jsp-test &gt;webapps/ROOT/index.jsp</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=准备构建容器所需的软件>准备构建容器所需的软件<a hidden class=anchor aria-hidden=true href=#准备构建容器所需的软件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apache-tomcat-8.5.29.tar.gz
</span></span><span class=line><span class=cl>jdk-8u144-linux-x64.tar.gz
</span></span><span class=line><span class=cl>tomcatfile</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=编写docker-compose文件>编写docker-compose文件<a hidden class=anchor aria-hidden=true href=#编写docker-compose文件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>nginxfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>80</span><span class=p>:</span><span class=m>81</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>tomcat01:tomcat01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>tomcat02:tomcat02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./webapps:/usr/share/nginx/html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>tomcat01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>tomcat02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tomcat01</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>tomcat01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./tomcat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>tomcatfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql:mysql-db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./webapps:/usr/share/tomcat/webapps/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tomcat02</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>tomcat02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>./tomcat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>tomcatfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql:mysql-db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./webapps:/usr/share/tomcat/webapps/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>3306</span><span class=p>:</span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=m>123456</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_DATABASE</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_USER</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=m>123456</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=使用docker-compose一键构建镜像-1>使用docker-compose一键构建镜像<a hidden class=anchor aria-hidden=true href=#使用docker-compose一键构建镜像-1>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker-compose -f docker-compose.yml build 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mysql uses an image, skipping
</span></span><span class=line><span class=cl>Building tomcat02
</span></span><span class=line><span class=cl>Step : FROM centos
</span></span><span class=line><span class=cl> ---&gt; 5182e96772bf
</span></span><span class=line><span class=cl>Step 2/9 : MAINTAINER lc
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 111890e6d42e
</span></span><span class=line><span class=cl>Step 3/9 : ADD apache-tomcat-8.5.29.tar.gz /usr/share/
</span></span><span class=line><span class=cl> ---&gt; 46725ed86e2e
</span></span><span class=line><span class=cl>Step 4/9 : ADD jdk-8u144-linux-x64.tar.gz /usr/share/
</span></span><span class=line><span class=cl> ---&gt; 431ea9bb9918
</span></span><span class=line><span class=cl>Step 5/9 : RUN mv /usr/share/apache-tomcat-8.5.29 /usr/share/tomcat
</span></span><span class=line><span class=cl> ---&gt; Running in 22275e028633
</span></span><span class=line><span class=cl>Removing intermediate container 22275e028633
</span></span><span class=line><span class=cl> ---&gt; 0f3919e97b50
</span></span><span class=line><span class=cl>Step 6/9 : ENV <span class=nv>JAVA_HOME</span><span class=o>=</span>/usr/share/jdk1.8.0_144
</span></span><span class=line><span class=cl> ---&gt; Running in 60d616e0b9fc
</span></span><span class=line><span class=cl>Removing intermediate container 60d616e0b9fc
</span></span><span class=line><span class=cl> ---&gt; 5255488c51ab
</span></span><span class=line><span class=cl>Step 7/9 : WORKDIR /usr/share/tomcat
</span></span><span class=line><span class=cl> ---&gt; Running in 6b04d8f5524b
</span></span><span class=line><span class=cl>Removing intermediate container 6b04d8f5524b
</span></span><span class=line><span class=cl> ---&gt; db88a81ec00a
</span></span><span class=line><span class=cl>Step 8/9 : ENTRYPOINT <span class=o>[</span><span class=s2>&#34;bin/catalina.sh&#34;</span>,<span class=s2>&#34;run&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl> ---&gt; Running in 189b6ee0ff4e
</span></span><span class=line><span class=cl>Removing intermediate container 189b6ee0ff4e
</span></span><span class=line><span class=cl> ---&gt; 9b444829ed55
</span></span><span class=line><span class=cl>Step 9/9 : EXPOSE <span class=m>8080</span>
</span></span><span class=line><span class=cl> ---&gt; Running in f2115bf03afb
</span></span><span class=line><span class=cl>Removing intermediate container f2115bf03afb
</span></span><span class=line><span class=cl> ---&gt; 31c01ca93305
</span></span><span class=line><span class=cl>Successfully built 31c01ca93305
</span></span><span class=line><span class=cl>Successfully tagged lnmp_tomcat02:latest
</span></span><span class=line><span class=cl>Building tomcat01
</span></span><span class=line><span class=cl>Step : FROM centos
</span></span><span class=line><span class=cl> ---&gt; 5182e96772bf
</span></span><span class=line><span class=cl>Step 2/9 : MAINTAINER lc
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 111890e6d42e
</span></span><span class=line><span class=cl>Step 3/9 : ADD apache-tomcat-8.5.29.tar.gz /usr/share/
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 46725ed86e2e
</span></span><span class=line><span class=cl>Step 4/9 : ADD jdk-8u144-linux-x64.tar.gz /usr/share/
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 431ea9bb9918
</span></span><span class=line><span class=cl>Step 5/9 : RUN mv /usr/share/apache-tomcat-8.5.29 /usr/share/tomcat
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 0f3919e97b50
</span></span><span class=line><span class=cl>Step 6/9 : ENV <span class=nv>JAVA_HOME</span><span class=o>=</span>/usr/share/jdk1.8.0_144
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 5255488c51ab
</span></span><span class=line><span class=cl>Step 7/9 : WORKDIR /usr/share/tomcat
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; db88a81ec00a
</span></span><span class=line><span class=cl>Step 8/9 : ENTRYPOINT <span class=o>[</span><span class=s2>&#34;bin/catalina.sh&#34;</span>,<span class=s2>&#34;run&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 9b444829ed55
</span></span><span class=line><span class=cl>Step 9/9 : EXPOSE <span class=m>8080</span>
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 31c01ca93305
</span></span><span class=line><span class=cl>Successfully built 31c01ca93305
</span></span><span class=line><span class=cl>Successfully tagged lnmp_tomcat01:latest
</span></span><span class=line><span class=cl>Building nginx
</span></span><span class=line><span class=cl>Step : FROM centos
</span></span><span class=line><span class=cl> ---&gt; 5182e96772bf
</span></span><span class=line><span class=cl>Step 2/8 : MAINTAINER lc
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 111890e6d42e
</span></span><span class=line><span class=cl>Step 3/8 : RUN yum install -y gcc gcc-c++ openssl-devel make pcre-devel
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 36090d81ef5e
</span></span><span class=line><span class=cl>Step 4/8 : ADD nginx-1.13.9-1.el7.centos.x86_64.rpm /tmp/
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; cecd606c7619
</span></span><span class=line><span class=cl>Step 5/8 : RUN <span class=nb>cd</span> /tmp/ <span class=o>&amp;&amp;</span> rpm -ivh nginx-1.13.9-1.el7.centos.x86_64.rpm
</span></span><span class=line><span class=cl> ---&gt; Using cache
</span></span><span class=line><span class=cl> ---&gt; 8c7b331fc175
</span></span><span class=line><span class=cl>Step 6/8 : ADD nginx.conf /etc/nginx/
</span></span><span class=line><span class=cl> ---&gt; 84940ae84e06
</span></span><span class=line><span class=cl>Step 7/8 : EXPOSE <span class=m>80</span>
</span></span><span class=line><span class=cl> ---&gt; Running in 94ac22711605
</span></span><span class=line><span class=cl>Removing intermediate container 94ac22711605
</span></span><span class=line><span class=cl> ---&gt; ef10799c0844
</span></span><span class=line><span class=cl>Step 8/8 : CMD <span class=o>[</span><span class=s2>&#34;/usr/sbin/nginx&#34;</span>, <span class=s2>&#34;-g&#34;</span>, <span class=s2>&#34;daemon off;&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl> ---&gt; Running in 039ea9de17f0
</span></span><span class=line><span class=cl>Removing intermediate container 039ea9de17f0
</span></span><span class=line><span class=cl> ---&gt; d489d87223f8
</span></span><span class=line><span class=cl>Successfully built d489d87223f8
</span></span><span class=line><span class=cl>Successfully tagged lnmp_nginx:latest</span></span></code></pre></td></tr></table></div></div></div></div><p>测试访问结果</p><p><div class=pe-fancybox><a data-fancybox=gallery href=../../images/docker-compose%E5%AE%9E%E6%88%98/e1fcd3f3.png><img src=../../images/docker-compose%E5%AE%9E%E6%88%98/e1fcd3f3.png#center alt=image onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>查看nginx访问日志，发现是负载到每一台tomcat上的。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;172.24.0.5:8080&#34;</span> 10.0.0.1 - - <span class=o>[</span>12/Aug/2018:17:52:39 +0000<span class=o>]</span> <span class=s2>&#34;GET /index.jsp HTTP/1.1&#34;</span> <span class=m>200</span> <span class=m>9</span> <span class=s2>&#34;-&#34;</span> <span class=s2>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.Safari/537.36&#34;</span> <span class=s2>&#34;-&#34;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;172.24.0.4:8080&#34;</span> 10.0.0.1 - - <span class=o>[</span>12/Aug/2018:17:52:40 +0000<span class=o>]</span> <span class=s2>&#34;GET /index.jsp HTTP/1.1&#34;</span> <span class=m>200</span> <span class=m>9</span> <span class=s2>&#34;-&#34;</span> <span class=s2>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.Safari/537.36&#34;</span> <span class=s2>&#34;-&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：docker-compose示例</p><p>文章链接：<a href=http://localhost:1313/2018/06/docker-compose-example/ target=_blank>http://localhost:1313/2018/06/docker-compose-example/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2018/06/dockerfile/><span>Dockerfile使用示例</span></a></li><li><a href=/2018/06/docker-network/><span>Docker网络</span></a></li><li><a href=/2018/06/docker-cross-node-network/><span>Docker跨宿主机网络通信</span></a></li><li><a href=/2018/06/docker-registry/><span>docker Registry使用</span></a></li><li><a href=/2018/06/docker-volume/><span>docker Volume</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/docker/>Docker</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/2018/06/docker-compose/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>docker-compose使用</span>
</a><a class=next href=http://localhost:1313/2018/06/dockerfile/><span class=title></span>
<span>Dockerfile使用示例&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/docker-compose-example","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>