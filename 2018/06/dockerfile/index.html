<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Dockerfile使用示例 | Cylon&#39;s Collection</title>
<meta name="keywords" content="docker, Dockerfile使用">
<meta name="description" content="Dockerfile使用示例 - Cylon&#39;s Collection">
<meta name="author" content="cylon">
<link rel="canonical" href="https://www.oomkill.com/2018/06/dockerfile/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.3bb4f84aec67825d7a3152940245f562f5450320b3f7b17556fca4031290d160.css" integrity="sha256-O7T4Suxngl16MVKUAkX1YvVFAyCz97F1VvykAxKQ0WA=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.oomkill.com/favicon.ico">
<link rel="apple-touch-icon" href="https://www.oomkill.com/apple-touch-icon.png">

<meta name="twitter:title" content="Dockerfile使用示例 | Cylon&#39;s Collection" />
<meta name="twitter:description" content="" />
<meta property="og:title" content="Dockerfile使用示例 | Cylon&#39;s Collection" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.oomkill.com/2018/06/dockerfile/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2018-06-02T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2023-03-22T23:00:36&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.oomkill.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Dockerfile使用示例",
      "item": "https://www.oomkill.com/2018/06/dockerfile/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Dockerfile使用示例 | Cylon's Collection",
  "name": "Dockerfile使用示例",
  "description": "",
  "keywords": [
    "docker", "Dockerfile使用"
  ],
  "wordCount" : "6378",
  "inLanguage": "zh",
  "datePublished": "2018-06-02T00:00:00Z",
  "dateModified": "2023-03-22T23:00:36+08:00",
  "author":{
    "@type": "Person",
    "name": "cylon"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.oomkill.com/2018/06/dockerfile/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cylon's Collection",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.oomkill.com/favicon.ico"
    }
  }
}
</script><script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.oomkill.com" accesskey="h" title="Cylon&#39;s Collection (Alt + H)">Cylon&#39;s Collection</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.oomkill.com/archives/" title="归档"
                >归档
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/tags/" title="标签"
                >标签
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/search/" title="搜索 (Alt &#43; /)"data-no-instant accesskey=/
                >搜索
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/about/" title="关于"
                >关于
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header"><h1 class="post-title">Dockerfile使用示例</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2018-06-02</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>Edited on 2023-03-22</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="https://www.oomkill.com/tags/docker/">docker</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>13 分钟</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%b8%80%e4%bd%bf%e7%94%a8%e5%89%8d%e6%8f%90" aria-label="一、使用前提">一、使用前提</a><ul>
                        
                <li>
                    <a href="#11-%e5%b8%b8%e8%a7%81%e9%95%9c%e5%83%8f%e5%88%b6%e4%bd%9c%e6%96%b9%e5%bc%8f" aria-label="1.1 常见镜像制作方式">1.1 常见镜像制作方式</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8cdockerfile%e6%a6%82%e8%bf%b0" aria-label="二、Dockerfile概述">二、Dockerfile概述</a><ul>
                        
                <li>
                    <a href="#21-dockerfile%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f" aria-label="2.1 Dockerfile的工作模式">2.1 Dockerfile的工作模式</a></li>
                <li>
                    <a href="#22-%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e6%9b%bf%e6%8d%a2" aria-label="2.2 环境变量替换">2.2 环境变量替换</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%89dockerfile%e6%8c%87%e4%bb%a4%e8%af%b4%e6%98%8e" aria-label="三、Dockerfile指令说明">三、Dockerfile指令说明</a><ul>
                        
                <li>
                    <a href="#from" aria-label="FROM">FROM</a></li>
                <li>
                    <a href="#maintanierdepreacted" aria-label="MAINTANIER(depreacted)">MAINTANIER(depreacted)</a></li>
                <li>
                    <a href="#lable" aria-label="LABLE">LABLE</a></li>
                <li>
                    <a href="#copy" aria-label="COPY">COPY</a></li>
                <li>
                    <a href="#add" aria-label="ADD">ADD</a></li>
                <li>
                    <a href="#workdir" aria-label="WORKDIR">WORKDIR</a></li>
                <li>
                    <a href="#volume" aria-label="VOLUME">VOLUME</a></li>
                <li>
                    <a href="#expose" aria-label="EXPOSE">EXPOSE</a></li>
                <li>
                    <a href="#env" aria-label="ENV">ENV</a></li>
                <li>
                    <a href="#run" aria-label="RUN">RUN</a></li>
                <li>
                    <a href="#cmd" aria-label="CMD">CMD</a></li>
                <li>
                    <a href="#entrypoint" aria-label="ENTRYPOINT">ENTRYPOINT</a></li>
                <li>
                    <a href="#user" aria-label="USER">USER</a></li>
                <li>
                    <a href="#healthcheck" aria-label="HEALTHCHECK">HEALTHCHECK</a></li>
                <li>
                    <a href="#shell" aria-label="SHELL">SHELL</a></li>
                <li>
                    <a href="#stohsignal" aria-label="STOHSIGNAL">STOHSIGNAL</a></li>
                <li>
                    <a href="#arg" aria-label="ARG">ARG</a></li>
                <li>
                    <a href="#onbuild" aria-label="ONBUILD">ONBUILD</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9b%e6%9e%84%e5%bb%baphp%e7%8e%af%e5%a2%83%e9%95%9c%e5%83%8f" aria-label="四、构建php环境镜像">四、构建php环境镜像</a></li>
                <li>
                    <a href="#%e4%ba%94%e6%9e%84%e5%bb%bajava%e7%8e%af%e5%a2%83%e9%95%9c%e5%83%8f" aria-label="五、构建java环境镜像">五、构建java环境镜像</a></li>
                <li>
                    <a href="#%e5%85%ad%e6%9e%84%e5%bb%bassh%e7%8e%af%e5%a2%83%e9%95%9c%e5%83%8f" aria-label="六、构建ssh环境镜像">六、构建ssh环境镜像</a><ul>
                        <ul>
                        
                <li>
                    <a href="#61-%e6%b5%8b%e8%af%95ssh%e9%95%9c%e5%83%8f" aria-label="6.1 测试ssh镜像">6.1 测试ssh镜像</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    





<div class="copyrightTopBlock">
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <div class="articleSuffix-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
</div>
<br><h2 id="一使用前提">一、使用前提<a hidden class="anchor" aria-hidden="true" href="#一使用前提">¶</a></h2>
<p>通用镜像未必与应用程序和配置是符合我们需要的。</p>
<h3 id="11-常见镜像制作方式">1.1 常见镜像制作方式<a hidden class="anchor" aria-hidden="true" href="#11-常见镜像制作方式">¶</a></h3>
<p>常见制作镜像方式有两种</p>
<ul>
<li>基于容器</li>
<li>基于镜像制作：编辑一个Dockerfile，而后根据此文件制作；</li>
</ul>
<h2 id="二dockerfile概述">二、Dockerfile概述<a hidden class="anchor" aria-hidden="true" href="#二dockerfile概述">¶</a></h2>
<p>Dockerfile只是构建Docker镜像的源代码，docker可以通过读取Dockerfile中的指令自动构建图像。Dockerfile是一个文本文档，其中包含用户可以在命令行上调用以组合图像的所有命令。用户可以使用 <font color="#f8070d" size=3><code>docker build</code></font> 创建连续执行多个命令行指令的自动构建。</p>
<h3 id="21-dockerfile的工作模式">2.1 Dockerfile的工作模式<a hidden class="anchor" aria-hidden="true" href="#21-dockerfile的工作模式">¶</a></h3>
<p>基于Dockerfile制作镜像时，需在专用目录放置Dockerfile文件，并且文件首字母必须大写。基于Dockerfile中打包的文件必须奇基于工作目录往下走的路径。在打包镜像时，<font color="#f8070d" size=3><code>.dockeringore</code></font> 文件本身与所有包含在 <font color="#f8070d" size=3><code>.dockeringore</code></font> 文件中的路径，都不被打包进去。在Dockerfile制作环境为底层镜像启动容器时所能够提供的环境。</p>
<h3 id="22-环境变量替换">2.2 环境变量替换<a hidden class="anchor" aria-hidden="true" href="#22-环境变量替换">¶</a></h3>
<p>制作镜像中还可以使用环境变量。环境变量（使用ENV语句声明）也可以在某些指令中使用，因为<code>Dockerfile</code>环境变量在 <code>Dockerfile</code> 中以 <font color="#f8070d" size=3><code>$variable_name</code></font> 或<font color="#f8070d" size=3><code>${variable_name}</code></font>标记。</p>
<p>语法还支持一些标准`bash修饰符</p>
<ul>
<li><font color="#f8070d" size=3><code>${variable:-word}</code></font> 表示如果设置了变量，那么结果将是该值。如果未设置变量，那么word将是结果。</li>
<li><font color="#f8070d" size=3><code>${variable+word}</code></font> 表示如果设置了变量，则word将是结果，否则结果为空字符串。</li>
</ul>
<h2 id="三dockerfile指令说明">三、Dockerfile指令说明<a hidden class="anchor" aria-hidden="true" href="#三dockerfile指令说明">¶</a></h2>
<hr>
<p><strong><font color="#f8070d" size=3>特别说明：Dockerfile中每一条指令都会生成一个新的镜像层。</font></strong></p>
<hr>
<h3 id="from">FROM<a hidden class="anchor" aria-hidden="true" href="#from">¶</a></h3>
<p>FROM指令（最重要的一个），<font style="background:#ffff00;" size=2>必须为Dockerfile文件开篇的第一个非注释行</font>，用于为镜像文件构建过程指定基准镜像，后续的指令运行于此基准镜像所提供的运行环境。基准镜像可以是任何可用镜像文件，默认情况下，<code>docker build</code>会在docker主机上查找指定的镜像文件，在其不存在时，则会从 <font color="#f8070d" size=3><code>Docker Hub Registry</code></font> 上拉取所需的镜像文件。如果找不到指定的镜像文件，<code>docker build</code> 会返回一个错误信息</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">FROM repository<span class="o">[</span>:tag<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">FROM registry/repository<span class="o">[</span>:tag<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">FROM resository@<span class="o">[</span>digest<span class="o">]</span>  <span class="c1">#←相同名称时，可以使用resository@镜像hush码指定镜像。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明-</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>reposotiry</strong></td>
<td>某一个镜像的仓库，如redis镜像仓库。</td>
</tr>
<tr>
<td><strong>registry</strong></td>
<td>docker镜像仓库，如docker hub，docker registry包含很多reposotiry，如nginx php tomcat等。不指定registry，默认从docker hub下载。</td>
</tr>
<tr>
<td><strong>tag</strong></td>
<td>image的标签，为可选项，省略时默认为latest。</td>
</tr>
</tbody>
</table>
<h3 id="maintanierdepreacted">MAINTANIER(depreacted)<a hidden class="anchor" aria-hidden="true" href="#maintanierdepreacted">¶</a></h3>
<p>MAINTANIER（depreacted）用于让Dockerfile制作者提供本人的详细信息。Dockerfile并不限制MAINTAINER指令可在出现的位置，但推荐将其放置于FROM指令之后。</p>
<blockquote>
<p><strong>Syntax</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">MAINTAINER &lt;authtor<span class="err">&#39;</span>s detail&gt;  
</span></span></code></pre></td></tr></table>
</div>
</div><p>&lt;author&rsquo;s detail&gt; 可是任何文本信息，但约定俗成地使用作者名称及邮箱地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">MAINTAINER <span class="s2">&#34;lc &lt;12399.com@gmail.com&gt;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="lable">LABLE<a hidden class="anchor" aria-hidden="true" href="#lable">¶</a></h3>
<p>LABLE可以提供Key value信息，比MAINTANIER具有更宽泛的使用领域。LABLE让用户提供格式各样的元数据，都是键值格式。如果在LABEL值中包含空格，请使用引号和反斜杠。image可以有多个tag。您可以在一行上指定多个tag。docker17+增加此指令。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">LABEL &lt;key&gt;<span class="o">=</span>&lt;value&gt; &lt;key&gt;<span class="o">=</span>&lt;value&gt; &lt;key&gt;<span class="o">=</span>&lt;value&gt;...
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">LABEL <span class="nv">maintainer</span><span class="o">=</span><span class="s2">&#34;lc &lt;12399.com@gmail.com&gt;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="copy">COPY<a hidden class="anchor" aria-hidden="true" href="#copy">¶</a></h3>
<p>用于从宿主机工作目录将文件复制至到镜像的文件系统中。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">COPY src...dest
</span></span><span class="line"><span class="cl">COPY <span class="s2">&#34;src&#34;</span>....<span class="s2">&#34;dest&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>src</td>
<td>要复制的源文件或目录，支持使用通配符。</td>
</tr>
<tr>
<td>dest</td>
<td>目标路径，即正在创建的image的文件系统路径；建议为dest使用绝对路径，否则，COPY指定则以WORKDIR为其起始路径。</td>
</tr>
</tbody>
</table>
<hr>
<p>注意：在路径中有空白字符时，通常使用第二种格式。</p>
<hr>
<p>文件复制准则</p>
<ul>
<li><code>src</code> 必须是build上下文中的路径，不能是其父目录中的文件。</li>
<li>如果src是目录，则其内部文件或子目录会被递归复制，但src目录自身不会被复制。 等同于 <font color="#f8070d" size=3><code>cp a/*</code></font>而不是 <font color="#f8070d" size=3><code>cp -r a</code></font></li>
<li>如果指定了多个src，或在src中使用了通配符，则dest必须是一个目录，且必须以<font color="#f8070d" size=3><code>/</code></font>结尾。</li>
<li>如果dest事先不存在，它将会被自动创建，这包括其父目录路径。</li>
</ul>
<h3 id="add">ADD<a hidden class="anchor" aria-hidden="true" href="#add">¶</a></h3>
<p>ADD指令类似于COPY指令，ADD支持使用TAR文件和URL路径。</p>
<p>add官方解释：<a href="https://docs.docker.com/engine/reference/builder/#add">ADD</a></p>
<p>如果src是以</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ADD src dest
</span></span><span class="line"><span class="cl">ADD <span class="o">[</span><span class="s2">&#34;src&#34;</span>…<span class="s2">&#34;dest&#34;</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>操作准则同COPY指令</p>
<ul>
<li>
<p>如果 <code>&lt;src&gt;</code> 为URL且 <code>&lt;dest&gt;</code> 不以 <font color="#f8070d" size=3><code>/</code></font> 结尾，则 <code>&lt;src&gt;</code> 指定的文件将被下载并直接被创建为dest；如果dest以<font color="#f8070d" size=3><code>/</code></font>结尾，则文件名URL指定的文件将被直接下载并保存为 <font color="#f8070d" size=3><code>dest/filename</code></font></p>
</li>
<li>
<p>如果src是一个本地系统上的可识别的压缩格式（identity，gzip，bzip2或xz）的本地 tar存档，则将其解压缩为目录。，其行为类似于 <font color="#f8070d" size=3><code>tar -xf</code></font> 命令；然而，从URL远程网址不会自动解压。</p>
</li>
<li>
<p>如果src有多个，或其间接或直接使用了通配符，则dest必须是一个以 <font color="#f8070d" size=3><code>/</code></font> 结尾的目录路径；如果dest不以 <font color="#f8070d" size=3><code>/</code></font> 结尾，则其被视作一个普通文件，src的内容将被直接写入到dest。</p>
</li>
</ul>
<hr>
<p><font color="#0215cd" size=3>Dockerfile中每一条指令都会生成一个新的镜像层。尽量避免很多指令</font></p>
<hr>
<h3 id="workdir">WORKDIR<a hidden class="anchor" aria-hidden="true" href="#workdir">¶</a></h3>
<p>用于为Dockerfile中所有的 <font color="#f8070d" size=3><code>RUN</code></font>、<font color="#f8070d" size=3><code>CMD</code></font>、<font color="#f8070d" size=3><code>ENTRYPOINT</code></font>、<font color="#f8070d" size=3><code>COPY</code></font> 和 <font color="#f8070d" size=3><code>ADD</code></font> 指定设定工作目录</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">WORKDIR dirpath  
</span></span></code></pre></td></tr></table>
</div>
</div><p>在Dockerfile文件中，WORKDIR指令可出现多次，其路径也可以为相对路径，不过，其是相对此前一个WORKDR指令指定的路径。另外，WORKDIR也可满用由ENV指定定义的变量</p>
<p>例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">WORKDIR /var/log
</span></span><span class="line"><span class="cl">WORKDIR <span class="nv">$STATEPATH</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="volume">VOLUME<a hidden class="anchor" aria-hidden="true" href="#volume">¶</a></h3>
<p>用于在image中创建一个挂载点目录，以挂载Docker host上的卷或其它容器上的卷，在Dockerfile中的镜像自动指定VOLUME时，一般只能指定挂载点，不能指定宿主机文件。被称之为docker管理的卷。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">VOLUME mountpoint
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">VOLUME <span class="o">[</span><span class="s2">&#34;mountpoint&#34;</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果挂载点目录路径下此前在文件存在，docker run命令会在卷挂载完成后将此前的所有文件复制到新挂载的卷中。</p>
<h3 id="expose">EXPOSE<a hidden class="anchor" aria-hidden="true" href="#expose">¶</a></h3>
<p>用于为容器打开指定要监听的端口以实现与外部通信，写在文件中的端口暴露并不会直接暴露，当<font color="#f8070d" size=3><code>docker run -P</code></font>时不用声明端口，会自动读取镜像中指定要暴露的端口，动态分配到宿主机端口上。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">EXPOSE port<span class="o">[</span>/protocol<span class="o">]</span> <span class="o">[</span>port<span class="o">[</span>/protocol<span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>protocol用于指定传输层协议，可为tcp或udp二者之一，默认为TCP协议。</p>
<p>EXPOSE指令可一次指定多个端口，例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">EXPOSE 11211/udp 11211/tcp  
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="env">ENV<a hidden class="anchor" aria-hidden="true" href="#env">¶</a></h3>
<p>用于为镜像定义新需的环境变量，并可被Dockerfile文件中位于其后的其它指令（如ENV、ADD、COPY等）所调用格式为 <font color="#f8070d" size=3><code>$variable_name</code></font> 或 <font color="#f8070d" size=3><code>${variable_name}</code></font>。在Dockerfile中所定义的所有环境变量，是可以在启动容器后直接在容器中使用的变量。在运行容器时更改ENV并不会影响<code>docker build</code>的值。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ENV key value
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ENV <span class="nv">key1</span><span class="o">=</span>value1 <span class="nv">key2</span><span class="o">=</span>value2....    
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一位格式中。key之后的所有内容均会被视作其value的组成部分，因此，一次只能设置一个变量。第二种格式可用一次设置多个变量，每个变量为一个 <font color="#f8070d" size=3><code>key=value</code></font> 的键值对，如果value中包含空格，可以以反斜线（\）进行转义，也可通过对value加引号递行标识；另外，反斜线也可用于续行。</p>
<p>在定义多个变量时，建议使用第二种方式，以便在同一层中完成所有功能。</p>
<p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/085a742e.png" alt="image"  /></p>
<p>运行命令。</p>
<h3 id="run">RUN<a hidden class="anchor" aria-hidden="true" href="#run">¶</a></h3>
<p>用于指定 <font color="#f8070d" size=3><code>dodker build</code></font> 过程中运行的程序，其可以是任何命令。RUN可以运行多次的，如果多个命令彼此间有关联关系，建议在一条RUN中将多个Command写进来。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">RUN <span class="nb">command</span>
</span></span><span class="line"><span class="cl">RUN <span class="o">[</span><span class="s2">&#34;executable&#34;</span>，<span class="s2">&#34;param1&#34;</span>，<span class="s2">&#34;param2&#34;</span><span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一种格式中，command通常是一个shell命令，且以 <font color="#f8070d" size=3><code>/bin/sh -c</code></font> 来运行它，这意味着此进程在容器中的PID不为1，不能接枚Unix信号，因此，当使用 <font color="#f8070d" size=3><code>docker stop container </code></font> 命令停止容器时，此进程接收不到SIGTERM信号；</p>
<p>第二种语法格式中的参数是一个JSON格式的数组，其中executable为要运行的命令，后面的 <font color="#f8070d" size=3><code>paramN</code></font> 为传递给命令的选项或参数；然而，此种格式指定的命令不会以 <font color="#f8070d" size=3><code>/bin/sh -c</code></font> 来发起，因此常见的shell操作如变量替换以及通配符（，*等）替换将不会进行；不过，如果要运行的命令依赖于此shell特性的话，可以将其替换为奏似下面的格式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">RUN <span class="o">[</span><span class="s2">&#34;/bin/bash&#34;</span> , <span class="s2">&#34;-c&#34;</span>，<span class="s2">&#34;executable&#34;</span>, <span class="s2">&#34;param1&#34;</span><span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>CMD是在镜像运行为容器时没有指定默认运行命令时所运行的命令。
RUN是在基于Dockerfile构建镜像时要运行的命令。将在docker build中运行。</p>
<h3 id="cmd">CMD<a hidden class="anchor" aria-hidden="true" href="#cmd">¶</a></h3>
<p>类似于RUN指令，CMD指令也可用于运行任何命令或应用程序，不过，二者的运行时间点不同。RUN指令运行于镜像文件构建过程中，而CMD指令运行于基于Dockerfile构建出的新映像文件启动一个容器时</p>
<p>CMD指令的首要目的在于为启动的容器指定默认要运行的程序，且其运行结束后，容器也将终止；不过，CMD指定的命令其可以被<font color="#f8070d" size=3><code>docker run</code></font>的命令行选项所覆盖。<font style="background:#ffff00;" size=2>在Dockerfile中可以存在多个CMD指令，但仅最后一个会生效</font>。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">CMD <span class="nb">command</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">CMD <span class="o">[</span><span class="s2">&#34;executable&#34;</span> , <span class="s2">&#34;param1&#34;</span> , <span class="s2">&#34;param2&#34;</span><span class="o">]</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">CMD <span class="o">[</span><span class="s2">&#34;param1&#34;</span> , <span class="s2">&#34;param2&#34;</span><span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>使用第一种方式默认使用bin/sh -c</li>
<li>前两种语法格式的意义同RUN</li>
<li>第三种则用于为ENTRYPOINT指令提供默认参数</li>
</ul>
<h3 id="entrypoint">ENTRYPOINT<a hidden class="anchor" aria-hidden="true" href="#entrypoint">¶</a></h3>
<p>在<font color="#f8070d" size=3><code>docker run</code></font>时明明指定的运行命令为nginx，但是可以执行<font color="#f8070d" size=3><code>docker run -it --rm busybox ls /</code></font>，这表示了更改了镜像中默认要运行的程序。没有运行默认程序，转而运行了指定的命令。</p>
<p>对于自定义的镜像而言，默认在运行容器时运行的命令是可以被覆盖的。而不允许在运行命令是改变默认命令CMD就无法完成，而<font color="#f8070d" size=3><code>ENTRYPOINT</code></font>可以做到</p>
<p>类似CMD指令的功能，用于为容器指定默认运行程序，从而使得容器像是一个单独的可执行程序。但是与CMD不同的是，。<font style="background:#ffff00;" size=2>由ENTRYPOINT启动的程序不会被docker run命令行指定的参数所覆盖</font>，而且，这些命令行参数会被当作参数传递给ENTRYPOINT指定的程序。当CMD和ENTRYPOINT同时存在时，CMD的内容会当做参数传给ENTRYPOINT。不过，docker run命令的&ndash;entrypoint选项的参教可覆盖ENTRYPOINT指令指定的程序。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ENTRYPOINT <span class="nb">command</span>
</span></span><span class="line"><span class="cl">ENTRYPOINT <span class="o">[</span><span class="s2">&#34;executable&#34;</span>，<span class="s2">&#34;paraml&#34;</span>，<span class="s2">&#34;param2&#34;</span><span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>docker run命令传入的命令参数会覆盖CMD指令的内容并且附加到ENTRYPOINT命令最后做为其参数使用，Dockerfile文件中也可以存在多个ENTRYPOINT指令，但仅有最后一个会生效</p>
<p>当同时CMD与ENTRYPOINT，在运行容器时传入参数会覆盖CMD，除非使用<code>--entrypoint选项</code>否则ENTRYPOINT不能够被覆盖。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">CMD <span class="o">[</span><span class="s2">&#34;/bin/httpd&#34;</span> , <span class="s2">&#34;-f&#34;</span> , <span class="s2">&#34;-h </span><span class="si">${</span><span class="nv">WEB00C_ROOT</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">ENTRYPOINT <span class="o">[</span><span class="s2">&#34;/bin/sh&#34;</span>,<span class="s2">&#34;-c&#34;</span><span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>为什么非要同时使用CMD与ENTRYPOINT？</strong></p>
<ol>
<li>多数情况下ENTRYPOINT是用来指定一个shell，指定一个谁用来作为启动别的进程的服务进程。在命令行中的参数会当做他的子进程来启动。这样就可以灵活传参数被shell所解析了。</li>
<li>容器接受配置要靠环境变量，要想让应用镜像（如，nginx）在run时能够通过环境变量接受参数来决定他的配置文件（监听地址、端口、document_root），变量可以在启动容器时进行传递。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>cat &gt;/etc/nginx/conf.d/www.conf <span class="s">&lt;&lt; EOF 
</span></span></span><span class="line"><span class="cl"><span class="s">  server{
</span></span></span><span class="line"><span class="cl"><span class="s">    server name ${HOSTNAME};
</span></span></span><span class="line"><span class="cl"><span class="s">    listen ${IP:-0.0.0.0}:{PORT:-80};
</span></span></span><span class="line"><span class="cl"><span class="s">    root ${NGX_DOC_ROOT:-/usr/share/nginx/html};
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span> <span class="nb">exec</span> <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">FROM nginx:1.14-alpine 
</span></span><span class="line"><span class="cl">LABEL <span class="nv">maintainer</span><span class="o">=</span><span class="s2">&#34;lc &lt;lc.com&gt;&#34;</span>
</span></span><span class="line"><span class="cl">ENV <span class="nv">NGX_DOC_ROOT</span><span class="o">=</span><span class="s2">&#34;/data/web/html/&#34;</span>
</span></span><span class="line"><span class="cl">ADD index.html <span class="si">${</span><span class="nv">NGX_DOC_ROOT</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">ADD entrypoint.sh /bin/
</span></span><span class="line"><span class="cl">CMD <span class="o">[</span><span class="s2">&#34;/usr/sbin/nginx&#34;</span> , <span class="s2">&#34;-g&#34;</span> , <span class="s2">&#34;daemon off;&#34;</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">ENTRYPOINT <span class="o">[</span><span class="s2">&#34;/bin/entrypoint.sh&#34;</span><span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="user">USER<a hidden class="anchor" aria-hidden="true" href="#user">¶</a></h3>
<p>用于指定运行image时的或运行Dockerfile中任何RUN、CMD或ENTRYPOINT指令指定的程序时的用户名或UID，默认情况下，container的运行身份为root用户</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">USER UID<span class="p">|</span>UseName  
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意的是，UID可以为任意教字，但实践中必须为 <font color="#f8070d" size=3><code>/etc/passwd</code></font> 中某用户的有效UID，否则，<font color="#f8070d" size=3><code>docker run</code></font> 命令将运行失败</p>
<p>在基于某个镜像启动容器后，只要容器没转向后台（没停止），这个容器就不会停止。在docker引擎在判定容器健康与否并不是主进程能否提供服务，而仅仅判断进程是否运行。因此docker判断机制并不是真正意义上判断主进程的是否健康，需要其他工具来辅助确定。</p>
<h3 id="healthcheck">HEALTHCHECK<a hidden class="anchor" aria-hidden="true" href="#healthcheck">¶</a></h3>
<p>HEALTHCHECK指令定义一个command，<font color="#f8070d" size=3><code>CMD</code></font> 为固定关键词，<font color="#f8070d" size=3><code>CMD</code></font> 后指定一个命令，这个命令用于检查容器主进程工作状态健康与否。即使主进程仍在运行，这也可以检测到陷入无限循环且无法处理新连接的Web服务器等情况。</p>
<p>HEALTHCHECK指令有</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">HEALTHCHECK <span class="o">[</span>OPTIONS<span class="o">]</span> CMD <span class="nb">command</span> <span class="c1"># 通过在容器内运行命令来检查容器运行状况</span>
</span></span><span class="line"><span class="cl">HEALTHCHECK NONE <span class="c1"># 禁用任何的健康状态检查，包括默认的健康状态检测机制</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以在CMD之前出现的选项：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明-</th>
</tr>
</thead>
<tbody>
<tr>
<td>--interval  </td>
<td>间隔 s秒、m分钟、h小时，default:30s。</td>
</tr>
<tr>
<td>--timeout</td>
<td>执行command需要时间，比如curl一个地址，如果超过timeout秒则认为超时是错误的状态，此时每次健康检查的时间是timeout+interval秒。default:30s。</td>
</tr>
<tr>
<td>--start-period</td>
<td>在启动容器是，对主进程自我初始化较慢的情况下，default:0s。17.05引入</td>
</tr>
<tr>
<td>--retries=N</td>
<td>失败次数，default:3。</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>当指定了健康检测状态命令，检测请求发出时，响应值为如下3种情况：</p>
<ul>
<li>0: 成功，容器健康且随时可用。</li>
<li>1: 不健康，容器无法正常工作。</li>
<li>2: 预留值，无意义，可以自行定义。</li>
</ul>
<p>|HEALTHCHECK&ndash;start-period=3s CMD wget-0&ndash;q http://${IP:-0.0.0.0}:10080/</p>
<p>For example</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">  HEALTHCHECK--interval<span class="o">=</span>5m --timeout<span class="o">=</span>3s <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  CMD curl -f http://locdlhost/ <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="shell">SHELL<a hidden class="anchor" aria-hidden="true" href="#shell">¶</a></h3>
<p>SHELL指令允许覆盖用于shell命令形式的默认shell。在Linux上的默认shell是 <font color="#f8070d" size=3><code>[&quot;/bin/sh&quot;,&quot;-c&quot;]</code></font> , 在Windows上是 <font color="#f8070d" size=3><code>[&quot;cmd&quot; , &quot;/S&quot; , &quot;/C&quot;]</code></font> 。SHELL指令必须以JSON格式写入Dockerfile。</p>
<p>SHELL指令可以多次出现。每个SHELL指令覆盖先前的SHELL指令，并影响所有后续指令。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">SHELL <span class="o">[</span><span class="s2">&#34;executable&#34;</span>,<span class="s2">&#34;parameters]  
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="stohsignal">STOHSIGNAL<a hidden class="anchor" aria-hidden="true" href="#stohsignal">¶</a></h3>
<p>STOPSIGNAL指令设置将发送到容器的系统调用信号，以退出。此信号可以是与内核的系统调用表中的位置匹配的有效无符号数，例如9，或SIGNAME格式的信号名，例如SIGKILL。
语法：<font color="#f8070d" size=3><code>STOPSIGNAL signal</code></font></p>
<h3 id="arg">ARG<a hidden class="anchor" aria-hidden="true" href="#arg">¶</a></h3>
<p>ARG指令使用 <font color="#f8070d" size=3><code>--build-arg varname='value'</code></font> 标志定义一个变量，用户可以在使用<font color="#f8070d" size=3><code>docker build</code></font>命令在构建时将其传递给构建器。</p>
<p>此功能使得一个Dockerfile能够适用于较多的不同场景，尤其是应用程序版本变换时。直接传参数就能确定应该基于Dockerfile制作哪个版本。<font style="background:#fee904;" size=2>如果用户指定了未在Dockerfile中定义的构建参数，则构建会输出警告</font>。</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ARG <span class="nv">name</span> <span class="o">=</span> default value
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Dockerfile中可以包括一个或多个ARG指令。</li>
<li>ARG指令可以选择性地包括默认值：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ARG <span class="nv">version</span> <span class="o">=</span> 1.14
</span></span><span class="line"><span class="cl"><span class="nv">ARGuser</span> <span class="o">=</span> mageedu  
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="onbuild">ONBUILD<a hidden class="anchor" aria-hidden="true" href="#onbuild">¶</a></h3>
<p>用于在Dockerfile中定义一个触发器。Dockerfile用于build映像文件，此映像文件亦可作为base image被另一个Dockerfile用作FROM指令的参数，并以之构建新的映像文件</p>
<p>在后面的这个Dockerfile中的FROM指令在build过程中被执行时，将会“触发”创建其base image的Dockerfile文件中的ONBUILD指令定义的触发器</p>
<blockquote>
<p><strong>Syntax</strong>:</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ONBUILD INSTRUCTION  
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>：</p>
<ul>
<li>尽管任何指令都可注册成为触发器指令，但ONBUILD不能自我嵌套，且不会触发FROM和MAINTAINER指令。</li>
<li>使用包含ONBUILD指令的Dockerfle构建的镜像应该使用特殊的标签，例如ruby：2.0-onbuild</li>
<li>在ONBUILD指令中使用ADD或COPY指令应该格外小心，因为新构建过程的上下文在缺少指定的源文件时会失败。</li>
</ul>
<h2 id="四构建php环境镜像">四、构建php环境镜像<a hidden class="anchor" aria-hidden="true" href="#四构建php环境镜像">¶</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">FROM  centos:6
</span></span><span class="line"><span class="cl">MAINTAINER   lc
</span></span><span class="line"><span class="cl">RUN  yum install -y httpd php php-gd php-mysql mysql mysql-server
</span></span><span class="line"><span class="cl">ENV   MYSQL_ROOT_PASSWORD <span class="m">123456</span>
</span></span><span class="line"><span class="cl">RUN   <span class="nb">echo</span> <span class="s2">&#34;&lt;?php phpinfo()?&gt;&#34;</span> &gt; /var/www/html/index.php
</span></span><span class="line"><span class="cl">ADD   start.sh /start.sh
</span></span><span class="line"><span class="cl">RUN  chmod +x /start.sh
</span></span><span class="line"><span class="cl">ADD   https://cn.wordpress.org/wordpress-4.7.4-zh_CN.tar.gz /var/www/html
</span></span><span class="line"><span class="cl">COPY   wp-config.php /var/www/html/wordpress
</span></span><span class="line"><span class="cl">VOLUME   <span class="o">[</span><span class="s2">&#34;/var/lib/mysql&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">CMD   /start.sh
</span></span><span class="line"><span class="cl">EXPOSE  <span class="m">80</span> <span class="m">3306</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="五构建java环境镜像">五、构建java环境镜像<a hidden class="anchor" aria-hidden="true" href="#五构建java环境镜像">¶</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">FROM centos
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MAINTAINER lc
</span></span><span class="line"><span class="cl">ADD jdk-8u144-linux-x64.tar.gz /usr/local
</span></span><span class="line"><span class="cl">ENV <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/jdk1.8.0_144
</span></span><span class="line"><span class="cl">ADD apache-tomcat-8.5.32.tar.gz /usr/local/
</span></span><span class="line"><span class="cl">RUN mv /usr/local/apache-tomcat-8.5.32 /usr/local/tomcat
</span></span><span class="line"><span class="cl">WORKDIR /usr/local/tomcat
</span></span><span class="line"><span class="cl">ENTRYPOINT <span class="o">[</span><span class="s2">&#34;bin/catalina.sh&#34;</span>,<span class="s2">&#34;run&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">EXPOSE <span class="m">8080</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="六构建ssh环境镜像">六、构建ssh环境镜像<a hidden class="anchor" aria-hidden="true" href="#六构建ssh环境镜像">¶</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">FROM centos
</span></span><span class="line"><span class="cl">MAINTAINER zhangsan
</span></span><span class="line"><span class="cl">ENV PWD <span class="m">123</span>
</span></span><span class="line"><span class="cl">RUN yum install openssh openssh-server openssh-clients -y
</span></span><span class="line"><span class="cl">RUN <span class="nb">echo</span> <span class="nv">$PWD</span><span class="p">|</span>passwd --stdin root
</span></span><span class="line"><span class="cl">RUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
</span></span><span class="line"><span class="cl">RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
</span></span><span class="line"><span class="cl">CMD <span class="o">[</span><span class="s2">&#34;/usr/sbin/sshd&#34;</span>,<span class="s2">&#34;-D&#34;</span><span class="o">]</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="61-测试ssh镜像">6.1 测试ssh镜像<a hidden class="anchor" aria-hidden="true" href="#61-测试ssh镜像">¶</a></h4>
<blockquote>
<p><strong>systemd启动</strong></p>
</blockquote>
<p>构建完镜像使用systemctl启动发现没有sshd进程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ps
</span></span><span class="line"><span class="cl">   PID TTY          TIME CMD
</span></span><span class="line"><span class="cl">     <span class="m">1</span> pts/0    00:00:00 bash
</span></span><span class="line"><span class="cl">    <span class="m">18</span> pts/0    00:00:00 ps
</span></span><span class="line"><span class="cl">$ systemctl start ssh
</span></span><span class="line"><span class="cl">Failed to get D-Bus connection: Operation not permitted
</span></span></code></pre></td></tr></table>
</div>
</div><p>此问题原因：systemd服务没有启动无法使用systemd启动</p>
<p><a href="https://github.com/moby/moby/issues/7459">Failed to get D-Bus connection: No connection to service manager</a></p>
<p>故启动时一般使用 <code>CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;]</code></p>


    
    


<div class="copyrightBlock" >
    <div class="articleSuffix-bg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <p>链接：<a href="https://www.oomkill.com/2018/06/dockerfile/" target="_blank">https://www.oomkill.com/2018/06/dockerfile/</a></p>
    <p style="margin-bottom: 0px;">版权：本作品采用<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">「署名-非商业性使用-相同方式共享 4.0 国际」</a> 许可协议进行许可。</p>
    </div>
</div>
  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://www.oomkill.com/2018/06/docker-compose-example/">
    <span class="title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline>
      </polyline></svg>&nbsp; </span>
    
    <span>docker-compose示例</span>
  </a>
  <a class="next" href="https://www.oomkill.com/2018/06/docker-cross-node-network/" >
    <span class="title"> </span>
    
    <span>Docker跨宿主机网络通信&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg></span>
  </a>
</nav>

  </footer>

  
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
  </div>
  
  
  
  
    <div class="comments-separator"></div>
    

<h3 class="relatedContentTitle" >相关阅读</h3>
<ul class="relatedContent">
	
	<li><a href="/2018/06/docker-network/"><span>Docker网络</span></a></li>
	
	<li><a href="/2018/06/docker-cross-node-network/"><span>Docker跨宿主机网络通信</span></a></li>
	
	<li><a href="/2018/06/docker-registry/"><span>docker Registry使用</span></a></li>
	
	<li><a href="/2018/06/docker-volume/"><span>docker Volume</span></a></li>
	
	<li><a href="/2018/06/docker-compose/"><span>docker-compose使用</span></a></li>
	
</ul>

  

  
    
      <div class="comments-separator"></div>
<div class="comments">
    <script>
    function loadComment() {
        let theme = localStorage.getItem('pref-theme') === 'dark' ? 'dark' : 'light';
        let s = document.createElement('script');
        s.src = 'https://giscus.app/client.js';
        s.setAttribute('data-repo', 'cylonchau\/cylonchau.github.io');
        s.setAttribute('data-repo-id', 'R_kgDOIRlNSQ');
        s.setAttribute('data-category', 'Announcements');
        s.setAttribute('data-category-id', 'DIC_kwDOIRlNSc4CXy1U');
        s.setAttribute('data-mapping', 'title');
        s.setAttribute('data-reactions-enabled', '1');
        s.setAttribute('data-emit-metadata', '1');
        s.setAttribute('data-input-position', 'top');
        s.setAttribute('data-lang', 'zh-TW');
        s.setAttribute('data-theme', theme);
        s.setAttribute('crossorigin', 'anonymous');
        s.setAttribute('async', '');
        document.querySelector('div.comments').innerHTML = '';
        document.querySelector('div.comments').appendChild(s);
    }
    loadComment();
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
  <p>
  Copyright
  <span>&copy; 2024 <a href="https://www.oomkill.com">Cylon&#39;s Collection</a></span></p>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> on github-page & Theme
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

<script>
  document.addEventListener('scroll', function (e) {
      const readProgress = document.getElementById("read_progress");
      const scrollHeight = document.documentElement.scrollHeight;
      const clientHeight = document.documentElement.clientHeight;
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
  })
</script>

<script>
  var menu = document.getElementById('menu')
  if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                  behavior: "smooth"
              });
          } else {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
          }
          if (id === "top") {
              history.replaceState(null, null, " ");
          } else {
              history.pushState(null, null, `#${id}`);
          }
      });
  });
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
      } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
      }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.6.0/mermaid.min.js" crossorigin="anonymous"></script>
<script>
    mermaid.init(undefined, '.language-mermaid');
</script>
</body>

</html>
