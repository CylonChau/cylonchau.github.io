<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>常用加密算法之数字证书与TLS/SSL | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="encryption,openssl"><meta name=description content="数字证书 互联网上任意双方之间实现通信时，证书的目的有两种，
主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。
对于一个安全的通信，应该有以下特征：
完整性：消息在传输过程中未被篡改 身份验证：确认消息发送者的身份 不可否认：消息的发送者无法否认自己发送了信息 显然，数字签名和消息认证码是不符合要求的，这里就需要数字证书来解决其弊端。
数字证书（digital certificate）又称公开密钥认证 PKC（英语：Public key certificate）。是在互联网通信中，方式数字签名的秘钥被篡改，是用来证明公开密钥拥有者的身份。此文件包含了公钥信息、拥有者身份信息（主体）、以及数字证书认证机构（发行者）对这份文件的数字签名，以保证这个文件的整体内容正确无误。
数字证书认证机构 CA (Certificate Authority)：是负责发放和管理数字证书的权威机构。
公钥证书的格式标准 X.509是密码学中公钥明证PKC的格式标准，所有的证书都符合ITU-T X.509国际标准。X.509证书的结构是用ASN1 (Abstract Syntax Notation One)进行描述数据结构，并使用ASN.1语法进行编码。
证书规范 X.509指的是ITU和ISO联合制定的（RFC5280）里定义的的 X.509 v3
前使用最广泛的标准为X.509的 v3版本规范 (RFC5280）, 一般遵从X.509格式规范的证书，会有以下的内容：
证书组成结构
结构 说明 版本 现行通用版本是 V3， 序号 用来识别每一张证书，用来追踪和撤销证书。只要拥有签发者信息和序列号，就可以唯一标识一个证书，最大不能过20个字节；由CA来维护 主体 拥有此证书的法人或自然人身份或机器，包括：
国家（C，Country） 州/省（S，State）** 地域/城市（L，Location） 组织/单位（O，Organization） 通用名称（CN，Common Name）：在TLS应用上，此字段一般是域名 发行者 以数字签名形式签署此证书的数字证书认证机构 有效期(Validity) 此证书的有效开始时间，在此前该证书并未生效；此证书的有效结束时间，在此后该证书作废。 公开密钥用途 指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等 公开密钥 公开密钥指纹 数字签名 使用信任的CA对内容进行 主体别名 例如一个网站可能会有多个域名（www.jd.com www.360buy.com..）
一个组织可能会有多个网站（*.baidu.com tieba.baidu.com），不同的网域可以一并使用同一张证书，方便实现应用及管理。 互联网上任意双方之间实现通信时，证书的目的有两种，
主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。
数字证书文件格式 X."><meta name=author content="cylon"><link rel=canonical href=http://localhost:1313/2020/08/openssl-x509/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/favicon.ico><link rel=mask-icon href=http://localhost:1313/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/2020/08/openssl-x509/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="常用加密算法之数字证书与TLS/SSL"><meta property="og:description" content="数字证书 互联网上任意双方之间实现通信时，证书的目的有两种，
主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。
对于一个安全的通信，应该有以下特征：
完整性：消息在传输过程中未被篡改 身份验证：确认消息发送者的身份 不可否认：消息的发送者无法否认自己发送了信息 显然，数字签名和消息认证码是不符合要求的，这里就需要数字证书来解决其弊端。
数字证书（digital certificate）又称公开密钥认证 PKC（英语：Public key certificate）。是在互联网通信中，方式数字签名的秘钥被篡改，是用来证明公开密钥拥有者的身份。此文件包含了公钥信息、拥有者身份信息（主体）、以及数字证书认证机构（发行者）对这份文件的数字签名，以保证这个文件的整体内容正确无误。
数字证书认证机构 CA (Certificate Authority)：是负责发放和管理数字证书的权威机构。
公钥证书的格式标准 X.509是密码学中公钥明证PKC的格式标准，所有的证书都符合ITU-T X.509国际标准。X.509证书的结构是用ASN1 (Abstract Syntax Notation One)进行描述数据结构，并使用ASN.1语法进行编码。
证书规范 X.509指的是ITU和ISO联合制定的（RFC5280）里定义的的 X.509 v3
前使用最广泛的标准为X.509的 v3版本规范 (RFC5280）, 一般遵从X.509格式规范的证书，会有以下的内容：
证书组成结构
结构 说明 版本 现行通用版本是 V3， 序号 用来识别每一张证书，用来追踪和撤销证书。只要拥有签发者信息和序列号，就可以唯一标识一个证书，最大不能过20个字节；由CA来维护 主体 拥有此证书的法人或自然人身份或机器，包括：
国家（C，Country） 州/省（S，State）** 地域/城市（L，Location） 组织/单位（O，Organization） 通用名称（CN，Common Name）：在TLS应用上，此字段一般是域名 发行者 以数字签名形式签署此证书的数字证书认证机构 有效期(Validity) 此证书的有效开始时间，在此前该证书并未生效；此证书的有效结束时间，在此后该证书作废。 公开密钥用途 指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等 公开密钥 公开密钥指纹 数字签名 使用信任的CA对内容进行 主体别名 例如一个网站可能会有多个域名（www.jd.com www.360buy.com..）
一个组织可能会有多个网站（*.baidu.com tieba.baidu.com），不同的网域可以一并使用同一张证书，方便实现应用及管理。 互联网上任意双方之间实现通信时，证书的目的有两种，
主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。
数字证书文件格式 X."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/2020/08/openssl-x509/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-22T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="常用加密算法之数字证书与TLS/SSL"><meta name=twitter:description content="数字证书 互联网上任意双方之间实现通信时，证书的目的有两种，
主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。
对于一个安全的通信，应该有以下特征：
完整性：消息在传输过程中未被篡改 身份验证：确认消息发送者的身份 不可否认：消息的发送者无法否认自己发送了信息 显然，数字签名和消息认证码是不符合要求的，这里就需要数字证书来解决其弊端。
数字证书（digital certificate）又称公开密钥认证 PKC（英语：Public key certificate）。是在互联网通信中，方式数字签名的秘钥被篡改，是用来证明公开密钥拥有者的身份。此文件包含了公钥信息、拥有者身份信息（主体）、以及数字证书认证机构（发行者）对这份文件的数字签名，以保证这个文件的整体内容正确无误。
数字证书认证机构 CA (Certificate Authority)：是负责发放和管理数字证书的权威机构。
公钥证书的格式标准 X.509是密码学中公钥明证PKC的格式标准，所有的证书都符合ITU-T X.509国际标准。X.509证书的结构是用ASN1 (Abstract Syntax Notation One)进行描述数据结构，并使用ASN.1语法进行编码。
证书规范 X.509指的是ITU和ISO联合制定的（RFC5280）里定义的的 X.509 v3
前使用最广泛的标准为X.509的 v3版本规范 (RFC5280）, 一般遵从X.509格式规范的证书，会有以下的内容：
证书组成结构
结构 说明 版本 现行通用版本是 V3， 序号 用来识别每一张证书，用来追踪和撤销证书。只要拥有签发者信息和序列号，就可以唯一标识一个证书，最大不能过20个字节；由CA来维护 主体 拥有此证书的法人或自然人身份或机器，包括：
国家（C，Country） 州/省（S，State）** 地域/城市（L，Location） 组织/单位（O，Organization） 通用名称（CN，Common Name）：在TLS应用上，此字段一般是域名 发行者 以数字签名形式签署此证书的数字证书认证机构 有效期(Validity) 此证书的有效开始时间，在此前该证书并未生效；此证书的有效结束时间，在此后该证书作废。 公开密钥用途 指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等 公开密钥 公开密钥指纹 数字签名 使用信任的CA对内容进行 主体别名 例如一个网站可能会有多个域名（www.jd.com www.360buy.com..）
一个组织可能会有多个网站（*.baidu.com tieba.baidu.com），不同的网域可以一并使用同一张证书，方便实现应用及管理。 互联网上任意双方之间实现通信时，证书的目的有两种，
主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。
数字证书文件格式 X."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"常用加密算法之数字证书与TLS/SSL","item":"http://localhost:1313/2020/08/openssl-x509/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"常用加密算法之数字证书与TLS/SSL","name":"常用加密算法之数字证书与TLS\/SSL","description":"数字证书 互联网上任意双方之间实现通信时，证书的目的有两种，\n主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。\n对于一个安全的通信，应该有以下特征：\n完整性：消息在传输过程中未被篡改 身份验证：确认消息发送者的身份 不可否认：消息的发送者无法否认自己发送了信息 显然，数字签名和消息认证码是不符合要求的，这里就需要数字证书来解决其弊端。\n数字证书（digital certificate）又称公开密钥认证 PKC（英语：Public key certificate）。是在互联网通信中，方式数字签名的秘钥被篡改，是用来证明公开密钥拥有者的身份。此文件包含了公钥信息、拥有者身份信息（主体）、以及数字证书认证机构（发行者）对这份文件的数字签名，以保证这个文件的整体内容正确无误。\n数字证书认证机构 CA (Certificate Authority)：是负责发放和管理数字证书的权威机构。\n公钥证书的格式标准 X.509是密码学中公钥明证PKC的格式标准，所有的证书都符合ITU-T X.509国际标准。X.509证书的结构是用ASN1 (Abstract Syntax Notation One)进行描述数据结构，并使用ASN.1语法进行编码。\n证书规范 X.509指的是ITU和ISO联合制定的（RFC5280）里定义的的 X.509 v3\n前使用最广泛的标准为X.509的 v3版本规范 (RFC5280）, 一般遵从X.509格式规范的证书，会有以下的内容：\n证书组成结构\n结构 说明 版本 现行通用版本是 V3， 序号 用来识别每一张证书，用来追踪和撤销证书。只要拥有签发者信息和序列号，就可以唯一标识一个证书，最大不能过20个字节；由CA来维护 主体 拥有此证书的法人或自然人身份或机器，包括：\n国家（C，Country） 州/省（S，State）** 地域/城市（L，Location） 组织/单位（O，Organization） 通用名称（CN，Common Name）：在TLS应用上，此字段一般是域名 发行者 以数字签名形式签署此证书的数字证书认证机构 有效期(Validity) 此证书的有效开始时间，在此前该证书并未生效；此证书的有效结束时间，在此后该证书作废。 公开密钥用途 指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等 公开密钥 公开密钥指纹 数字签名 使用信任的CA对内容进行 主体别名 例如一个网站可能会有多个域名（www.jd.com www.360buy.com..）\n一个组织可能会有多个网站（*.baidu.com tieba.baidu.com），不同的网域可以一并使用同一张证书，方便实现应用及管理。 互联网上任意双方之间实现通信时，证书的目的有两种，\n主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。\n数字证书文件格式 X.","keywords":["encryption","openssl"],"articleBody":"数字证书 互联网上任意双方之间实现通信时，证书的目的有两种，\n主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。\n对于一个安全的通信，应该有以下特征：\n完整性：消息在传输过程中未被篡改 身份验证：确认消息发送者的身份 不可否认：消息的发送者无法否认自己发送了信息 显然，数字签名和消息认证码是不符合要求的，这里就需要数字证书来解决其弊端。\n数字证书（digital certificate）又称公开密钥认证 PKC（英语：Public key certificate）。是在互联网通信中，方式数字签名的秘钥被篡改，是用来证明公开密钥拥有者的身份。此文件包含了公钥信息、拥有者身份信息（主体）、以及数字证书认证机构（发行者）对这份文件的数字签名，以保证这个文件的整体内容正确无误。\n数字证书认证机构 CA (Certificate Authority)：是负责发放和管理数字证书的权威机构。\n公钥证书的格式标准 X.509是密码学中公钥明证PKC的格式标准，所有的证书都符合ITU-T X.509国际标准。X.509证书的结构是用ASN1 (Abstract Syntax Notation One)进行描述数据结构，并使用ASN.1语法进行编码。\n证书规范 X.509指的是ITU和ISO联合制定的（RFC5280）里定义的的 X.509 v3\n前使用最广泛的标准为X.509的 v3版本规范 (RFC5280）, 一般遵从X.509格式规范的证书，会有以下的内容：\n证书组成结构\n结构 说明 版本 现行通用版本是 V3， 序号 用来识别每一张证书，用来追踪和撤销证书。只要拥有签发者信息和序列号，就可以唯一标识一个证书，最大不能过20个字节；由CA来维护 主体 拥有此证书的法人或自然人身份或机器，包括：\n国家（C，Country） 州/省（S，State）** 地域/城市（L，Location） 组织/单位（O，Organization） 通用名称（CN，Common Name）：在TLS应用上，此字段一般是域名 发行者 以数字签名形式签署此证书的数字证书认证机构 有效期(Validity) 此证书的有效开始时间，在此前该证书并未生效；此证书的有效结束时间，在此后该证书作废。 公开密钥用途 指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等 公开密钥 公开密钥指纹 数字签名 使用信任的CA对内容进行 主体别名 例如一个网站可能会有多个域名（www.jd.com www.360buy.com..）\n一个组织可能会有多个网站（*.baidu.com tieba.baidu.com），不同的网域可以一并使用同一张证书，方便实现应用及管理。 互联网上任意双方之间实现通信时，证书的目的有两种，\n主机证书，主要实现主机与主机之间进程间通信的。 个人证书，主要用作个人通信的，主要用作加密的数据的发送。 主机类证书所拥有的标识主要为主机名，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。\n数字证书文件格式 X.509一般推荐使用PEM (Privacy Enhanced Mail）格式来存储证书相关的文件。\n.crt \u0026 .cer：证书文件后缀名 .key: 私钥后缀名 .csr：证书请求文件后缀名\n公钥基础设施（PKI） 公钥基础设施 PKI（Public-Key infrastructure）是为了能够更有效地运用公钥而制定的一系列规范和规格的总称。\nPKI的组成要素 用户：使用PKI的人 注册公钥用户。 使用已注册公钥用户。 认证机构： 签证机构：CA Certificate Authority 注册机构：RA 仓库 证书吊销列表：CRL； 证书存取库，从签发机构中获得其签发的证书，需要有存取库来提供这些证书。 SSL/TLS 传输层安全协议，TLS，（Transport Layer Security），其前身为安全套接层 SSL（Secure Sockets Layer）。SSL3.0为SSL最高版本，3.1 即TLS 1.0\nSSL/TLS是世界上应用最广泛的密码通信方法。比如说，当在网上商城中输人信用卡号时，我们的Web浏览器就会使用SSL/TLS进行密码通信。使用SSL/TLS可以对通信对象进行认证，还可以确保通信内容的机密性。\n协议 时间 状态 SSL 1.0 未公布 未公布 SSL 2.0 1995年 已于2011年弃用 SSL 3.0 1996年 已于2015年弃用 TLS 1.0 1999年 TLS 1.1 2006年 TLS 1.2 2008年 TLS 1.3 2018年 http协议本身为文本格式，数据发送做文本编码；https协议实现的是二进制格式，数据发送做文本编码。由于ssl的存在，双方在实现通讯时，除了tcp协议三次 握手之外，双方还需做ssl握手会话的过程（认证密钥证书、数据交换等）。ssl会话的建立只能基于IP地址，无法基于主机名识别每一个通信方。一个IP地址在某个应用协议上只能建立一个ssl会话。\nTLS采用了分层设计，虽然在TCP/IP协议栈上，SSL增加的半层，其内部实现为多层\n最底层，基础算法原语的实现，aes，rsa，md5 向上一层，选定参数后，符合密码学标准分类的算法的实现 aes-128-abc-pkcs7 abc内部块的串联方式 pkcs7 对称加密公钥格式。 再向上一层：组合算法实现的半成品。 用各种组件拼装而成的种种成品密码学协议/软件 tls ssh。 openssh是利用openssl工具实现的软件程序。 OpenSSL OpenSSL是一个开放源代码的软件库，并实现了SSL与TLS协议。OpenSSL可以运行在，MS Windows、Linux、MacOS。OpenSSL已经成为linux基础公共组件，主要由三个开源组件组成：\nopenssl：多用途的命令行工具，能实现对称加密、非对称加密、单项加密等。各功能分别使用单独子命令来实现。 libcrypto：公共加密库，实现了多种加密算法。 libssl：实现了SSL及TLS的功能库 OpenSSL命令 OpenSSL命令分为 标准命令Standard commands、消息摘要命令Message Digest commands、密码命令Cipher commands三部分组成。\n标准命令。完成某些功能时使用的，如生成随机数、扮演CA签发证书。 enc 对称加密 crl 证书吊销列表 ca 证书签发机构 dgst 消息摘要算法（单项散列函数） dh 密钥交换算法 req 请求证书生成器 消息摘要命令算法，常用散列函数。 加密命令，所支持的加密算法。 OpenSSL 命令使用 对称加密 加密\ntext 1 openssl enc -e -des3 -a -salt -in /etc/passwd -out ./passwd 解密\ntext 1 openssl enc -d -des3 -a -salt -in passwd -d 解密 -e 加密 -a base64编码处理数据 单项加密 openssl中，单项加密即数字签名计算message的摘要信息，为 openssl dgst...\n单项散列函数通常应用于数字签名于消息认证码（MAC： Message Authentication Code 消息认证码，单项加密的一种延申应用，用于实现再网络通信中保证所传输的数据的完整性。）\ntext 1 2 $ openssl dgst -md5 /var/log/messages MD5(/var/log/messages)= 4515fae68552c00646ee7e07aac25d1d 也可以简写为\ntext 1 2 $ openssl md5 /var/log/messages MD5(/var/log/messages)= 24483320e6af7ed2cee401aa00c260e6 openssl也可以生成用户密码 sslpasswd\ntext 1 2 3 $ openssl passwd -1 -salt 123456 Password: $1$123456$wWKtx7yY/RnLiPN.KaX.z. $1$123456$wWKtx7yY/RnLiPN.KaX.z. 这是扩展Unix风格的crypt(3) 密码哈希语法。格式为 $id$salt$encrypted 前$id$符表示加密算法 1标识md5 6标识SHA-512，123456是指定的salt,salt为id后的最多16位的对密码加盐。\nReference crypt unix style encrypted\n使用openssl生成随机数 hex基于16进制编码格式 每个字节4位，4指的是4个字节，一个字节是8位二进制数。4位二进制可以用一个16进制字节标识（一个十六进制对应四个二进制 $44=16$） 出现字符 num2\nbash 1 2 3 4 $ openssl rand -hex 16 8cd7c7a85e22b4548f6942468028fde4 $ openssl rand -base64 6 c0jDwKIG 使用OpenSSL生成自签数字证书 获取证书两种方法：\n使用证书授权机构 生成签名请求（csr） 将csr发送给CA 从CA处接收签名 自签名的证书：自已签发自己的公钥 1. 建立RootCA 生成私钥\n参数 说明 -new 表示生成一个新证书签署请求 -x509 专用于CA生成自签证书，如果不是自签证书则不需要此项 -key 生成请求时用到的私钥文件 -out 证书的保存路径 -days 证书的有效期限，单位是day（天），默认是365天 bash 1 2 3 4 cd /etc/pki/tls/ openssl genrsa -out private/cakey.pem 2048 # 路径和名称必须为openssl配置文件中路径的名称 2 自签名证书 bash 1 2 3 4 5 6 openssl req -new \\ -x509 \\ -key private/cakey.pem \\ -out cacert.pem \\ -days 3650 \\ -subj \"/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=CHINA MOBILE\" 自签名证书是base64编码的，查看证书内容\nbash 1 openssl x509 -in cacert.pem -noout -text 参数 说明 x509 格式 -noout 输出时不生成新文件，只显示内容 -text 以文本格式输出 数字证书中主题(Subject)中字段的含义\n一般的数字证书产品的主题通常含有如下字段： 字段名 说明 公用名称 CN (Common Name) 对于 SSL 证书，一般为网站域名；而对于代码签名证书则为申请单位名称；而对于客户端证书则为证书申请者的姓名； 单位名称 O (Organization Name) 对于 SSL 证书，一般为网站域名；而对于代码签名证书则为申请单位名称；而对于客户端单位证书则为证书申请者所在单位名称； OU 可以理解为公司部门名称 所在城市 L (Locality) 所在省份 ST(State/Provice) 所在国家 C (Country） 可以看到生成了一个Chinamobile的自签的RootCA\n用户或组织向CA申请公钥（证书） 生成私钥 bash 1 2 mkdir child openssl genrsa -out child/child.pem 2048 生成证书申请文件 child.csr bash 1 2 3 4 openssl req -new \\ -key child/child.pem \\ -out child/child.csr \\ -subj \"/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=*.10086.com\" 将证书申请文件发送给CA 可以通过任意方式发送申请文件给CA\nCA颁发证书 text 1 2 3 4 touch /etc/pki/CA/index.txt touch /etc/pki/CA/serial # 下一个要颁发的编号 16进制 touch /etc/pki/CA/crlnumber echo 01 \u003e /etc/pki/CA/serial text 1 2 3 4 openssl ca -in child/child.csr \\ # 签发请求 -cert cacert.pem \\ # CA证书 -keyfile private/cakey.pem \\ # CA私钥 -out child/a.crt -days 30 证书发送给客户端 在应用软件中使用证书\nOpenSSL配置文件注释 /etc/pki/tls/openssl.cnf 定义了管理CA的相关信息。\ncnf # 语法 # 变量 = 值 # 1. 字符串值最好使用双引号界定，并且其中可以使用\"\\n\",\"\\r\",\"\\t\",\"\\\\\"这些转义序列。 # 2. 可以使用 ${变量名} 的形式引用同一字段中的变量，使用 ${字段名::变量名} 的形式引用其它字段中的变量。 # 3. 可以使用 ${ENV::环境变量} 的形式引用操作系统中定义的环境变量，若变量不存在则会导致错误。 # 4. 可以在默认字段定义与操作系统环境变量同名的变量作为默认值来避免环境变量不存在导致的错误。 # 5. 如果在同一字段内有多个相同名称的变量，那么后面的值将覆盖前面的值。 # 6. 可以通过 \".include = 绝对路径\" 语法或 OPENSSL_CONF_INCLUDE 环境变量引入其他配置文件(*.cnf)。 # 定义 HOME 的默认值，防止操作系统中不存在 HOME 环境变量。 HOME\t= . # 默认的随机数种子文件，对应 -rand 命令行选项。 RANDFILE\t= $ENV::HOME/.rnd # 扩展对象定义 # 如果没有在 OpenSSL 命令行中定义X.509证书的扩展项，那么就会从下面对扩展对象的定义中获取。 # 定义方法有两种，第一种(反对使用)是存储在外部文件中，也就是这里\"oid_file\"变量定义的文件。 #oid_file\t= $ENV::HOME/.oid # 第二种是存储在配置文件的一个字段中，也就是这里\"oid_section\"变量值所指定的字段。 oid_section\t= new_oids # 要将此配置文件用于 \"openssl x509\" 命令的 \"-extfile\" 选项， # 请在此指定包含 X.509v3 扩展的小节名称 #extensions = # 或者使用一个默认字段中仅包含 X.509v3 扩展的配置文件 [ new_oids ] # 添加可以被 'ca', 'req', 'ts' 命令使用的扩展对象。格式如下： # 对象简称 = 对象数字ID # 下面是一些增强型密钥用法(extendedKeyUsage)的例子 # We can add new OIDs in here for use by 'ca', 'req' and 'ts'. # Add a simple OID like this: # testoid1=1.2.3.4 # Or use config file substitution like this: # testoid2=${testoid1}.5.6 # Policies used by the TSA examples. tsa_policy1 = 1.2.3.4.1 tsa_policy2 = 1.2.3.4.5.6 tsa_policy3 = 1.2.3.4.5.7 ######################################################################################## ################################### 证书签发配置 ###################################### ######################################################################################## # openssl 的 ca 命令实现了证书签发的功能，其相关选项的默认值就来自于这里的设置。 # 这个字段只是通过唯一的 default_ca 变量来指定默认CA主配置字段的入口(-name 命令行选项的默认值) ######################################################################################## ######################## 默认CA主配置字段，(★)标记表示必需项 ############################# ######################################################################################## [ ca ] # default_ca\t= CA_default\t# The default ca section # 默认CA ######################################################################################## ######################### 默认CA主配置字段，(★)标记表示必需项 ############################ ######################################################################################## [ CA_default ] # 保存所有信息的文件夹，这个变量只是为了给后面的变量使用 dir\t= /etc/pki/CA # (★)存放新签发证书的默认目录，证书名就是该证书的系列号，后缀是.pem 。对应 -outdir 命令行选项。 certs\t= $dir/certs # 存放证书吊销列表的 crl_dir\t= $dir/crl # 数据库，颁发了那些证书，以及证书状态、编号。 数据索引。默认不存在的 database\t= $dir/index.txt #unique_subject\t= no #(★)存放新签发证书的默认目录，证书名就是该证书的系列号，后缀是.pem 。对应 -outdir 命令行选项。 new_certs_dir\t= $dir/newcerts\t# default place for new certs. # 新证书目录 #(★)存放CA自身证书的文件名。对应 -cert 命令行选项。 certificate\t= $dir/cacert.pem #(★)签发证书时使用的序列号文本文件，里面必须包含下一个可用的16进制数字。。需手工创建 serial\t= $dir/serial # 存放当前(下一个吊销证书编号)CRL编号的文件，需手工创建 crlnumber\t= $dir/crlnumber # 证书吊销列表 crl\t= $dir/crl.pem #(★)存放CA自身私钥的文件名。对应 -keyfile 命令行选项。 private_key\t= $dir/private/cakey.pem # 私钥文件路径 RANDFILE\t= $dir/private/.rand # 定义X.509证书扩展项的字段。对应 -extensions 命令行选项。 x509_extensions\t= usr_cert # 当用户需要确认签发证书时可读证书DN域的显示格式。可用值与 x509 指令的 -nameopt 选项相同。 name_opt = ca_default\t# Subject Name options # 可用值与 x509 指令的 -certopt 选项相同，不过 no_signame 和 no_sigdump 总被默认设置。 cert_opt = ca_default\t# Certificate field options # 是否将证书请求中的扩展项信息加入到证书扩展项中去。取值范围以及解释： ## none: 忽略所有证书请求中的扩展项 ## copy: 将证书扩展项中没有的项目复制到证书中 ## copyall: 将所有证书请求中的扩展项都复制过去，并且覆盖证书扩展项中原来已经存在的值。 ## 此选项的主要用途是允许证书请求提供例如 subjectAltName 之类扩展的值。 # copy_extensions = copy # 定义生成CRL时需要加入的扩展项字段。对应 -crlexts 命令行选项。 # crl_extensions\t= crl_ext # 新签发的证书默认有效期，以天为单位。依次对应 -days , -startdate , -enddate 命令行选项。 default_days\t= 365\t# 颁发证书默认有效期 # crl的有效期 30天 default_crl_days= 30 # 默认hash算法 default_md\t= sha256 preserve\t= no\t# keep passed DN ordering #(★)定义用于证书请求DN域匹配策略的字段，用于决定CA要求和处理证书请求提供的DN域的各个参数值的规则。 # 策略匹配 ，客户端与ca之间区申请证书信息是否必须匹配，对应 -policy 命令行选项。 policy\t= policy_match ######################################################################################## ################################ 为签发的证书设置扩展项 ################################## ######################################################################################## # 变量名称是DN域对象的名称，变量值可以是： # match: 该变量在证书请求中的值必须与CA证书相应的变量值完全相同，否则拒签。 # supplied: 该变量在证书请求中必须提供(值可以不同)，否则拒签。 # optional: 该变量在证书请求中可以存在也可以不存在(相当于没有要求)。 # 除非preserve=yes或者在ca命令中使用了-preserveDN，否则在签发证书时将删除匹配策略中未提及的对象。 [ policy_match ] countryName\t= match stateOrProvinceName\t= match organizationName\t= match organizationalUnitName\t= optional commonName\t= supplied emailAddress\t= optional ######################################################################################## ############## \"特征名称\"字段包含了用户的标识信息，对应 -subj 命令行选项 ################### ######################################################################################## [ req_distinguished_name ] countryName = CN # 必须是两字母国家代码 stateOrProvinceName = # 省份或直辖市 localityName = # 城市 organizationName = # 组织名或公司名 organizationalUnitName = # 部门名称 commonName = # 全限定域名或个人姓名 emailAddress = # Email地址 ######################################################################################## ################################# 为签发的证书设置扩展项 ################################# ######################################################################################## [ extendtsion_name ] # 基本约束(该证书是否为CA证书)。\"CA:FALSE\"表示非CA证书(不能签发其他证书的\"叶子证书\")。 basicConstraints = CA:FALSE # 颁发机构密钥标识符(\"always\"表示始终包含) authorityKeyIdentifier = keyid:always,issuer # PKIX工作组推荐将使用者与颁发机构的密钥标识符包含在证书中 subjectKeyIdentifier=hash # 证书用途，如省略，則可以用于签名外的任何。 # server SSL服务器 # objsign 签名证书 # client 客户端 # email 电子邮件 nsCertType = client # Netscape Comment（nsComment）是包含注释的字符串扩展名，当在某些浏览器中查看证书时，该注释将显示。 nsComment = \"OpenSSL Generated Client Certificate\" # 密钥用法：防否认(nonRepudiation)、数字签名(digitalSignature)、密钥加密(keyEncipherment)。 # 密钥协商(keyAgreement)、数据加密(dataEncipherment)、仅加密(encipherOnly)、仅解密(decipherOnly) keyUsage = nonRepudiation, digitalSignature, keyEncipherment # 增强型密钥用法(参见\"new_oids\"字段)：服务器身份验证、客户端身份验证、时间戳。 extendedKeyUsage = critical,serverAuth, clientAuth, timeStamping # 使用者备用名称(email, URI, DNS, RID, IP, dirName) # 例如，DNS常用于实现泛域名证书、IP常用于绑定特定的IP地址、\"copy\"表示直接复制 subjectAltName = DNS:www.example.com, DNS:*.example.net, IP:192.168.7.1, IP:13::17 OpenSSL扩展密钥用法：生成多域名证书 SAN(Subject Alternative Name) 是 SSL/TLS 标准 x.509 中定义的一个扩展。使用了SAN字段的 SSL 证书，可以扩展此证书支持的域名，使一个证书可支持多个不同域名的解析。RFC 5280 4.2.1.6\n可以看到面子书与京东的证书的 Subject Alternative Name 段中列了大量的域名，使用这种类型的证书能够极大的简化网站证书的管理\n使用OpenSSL生成根CA bash 1 2 3 4 5 6 7 8 9 cd /etc/pki/tls/ openssl genrsa -out private/cakey.pem 2048 openssl req -new \\ -x509 \\ -key private/cakey.pem \\ -out cacert.pem \\ -days 3650 \\ -subj \"/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=CHINA MOBILE\" 准备openssl配置文件 conf [ v3_req ] basicConstraints = CA:FALSE keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectKeyIdentifier=hash authorityKeyIdentifier = keyid:always,issuer nsComment = \"OpenSSL Generated Client Certificate\" subjectAltName = DNS:etcd, DNS:hk-etcd, IP:10.0.0.1 nsCertType = client, server 可以看到此证书请求文件中会包含 Subject Alternative Names 字段，并包含之前在配置文件中填写的域名。\n使用 openssl 签署带有 SAN 扩展的证书请求csr 生成私钥 text 1 2 mkdir child openssl genrsa -out child/child.pem 2048 生成证书申请文件 child.csr text 1 2 3 4 5 openssl req -new \\ -key child/child.pem \\ -out child/child.csr \\ -subj \"/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=hketcd\" \\ -config ./openssl.cnf 单条命令实现方式\ntext 1 2 3 4 5 6 7 openssl req -new \\ -key child/child.pem \\ -subj \"/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=hketcd\" \\ -reqexts req_v3 \\ -config \u003c(cat /etc/pki/tls/openssl.cnf \\ \u003c(printf \"[aa]\\nsubjectAltName=DNS:etcd, DNS:hk-etcd, IP:10.0.0.1\")) \\ -out child/child.csr CA颁发证书 单条命令实现\ntext 1 2 3 4 5 6 7 8 9 openssl ca \\ -in child/child.csr \\ -cert cacert.pem \\ -keyfile private/cakey.pem \\ -out child/child.crt \\ -days 30 \\ -extensions aa \\ -extfile \u003c(cat /etc/pki/tls/openssl.cnf \\ \u003c(printf \"[aa]\\nsubjectAltName=DNS:etcd, DNS:hk-etcd, IP:10.0.0.1\")) ","wordCount":"1208","inLanguage":"zh","datePublished":"2020-08-02T00:00:00Z","dateModified":"2023-03-22T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/2020/08/openssl-x509/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/><img src=http://localhost:1313/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives><span>归档</span></a></li><li><a href=http://localhost:1313/tags><span>标签</span></a></li><li><a href=http://localhost:1313/search><span>搜索</span></a></li><li><a href=http://localhost:1313/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">常用加密算法之数字证书与TLS/SSL</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2020-08-02</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1208 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>6 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=http://localhost:1313/tags/encryption/>#Encryption</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e6%95%b0%e5%ad%97%e8%af%81%e4%b9%a6 aria-label=数字证书>数字证书</a><ul><li><a href=#%e5%85%ac%e9%92%a5%e8%af%81%e4%b9%a6%e7%9a%84%e6%a0%bc%e5%bc%8f%e6%a0%87%e5%87%86 aria-label=公钥证书的格式标准>公钥证书的格式标准</a><li><a href=#%e8%af%81%e4%b9%a6%e8%a7%84%e8%8c%83 aria-label=证书规范>证书规范</a><li><a href=#%e6%95%b0%e5%ad%97%e8%af%81%e4%b9%a6%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f aria-label=数字证书文件格式>数字证书文件格式</a><li><a href=#%e5%85%ac%e9%92%a5%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bdpki aria-label=公钥基础设施（PKI）>公钥基础设施（PKI）</a><ul><li><a href=#pki%e7%9a%84%e7%bb%84%e6%88%90%e8%a6%81%e7%b4%a0 aria-label=PKI的组成要素>PKI的组成要素</a></ul></ul><li><a href=#ssltls aria-label=SSL/TLS>SSL/TLS</a><li><a href=#openssl aria-label=OpenSSL>OpenSSL</a><ul><li><a href=#openssl%e5%91%bd%e4%bb%a4 aria-label=OpenSSL命令>OpenSSL命令</a><li><a href=#openssl-%e5%91%bd%e4%bb%a4%e4%bd%bf%e7%94%a8 aria-label="OpenSSL 命令使用">OpenSSL 命令使用</a><ul><li><a href=#%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label=对称加密>对称加密</a><li><a href=#%e5%8d%95%e9%a1%b9%e5%8a%a0%e5%af%86 aria-label=单项加密>单项加密</a></ul></ul><li><a href=#reference aria-label=Reference>Reference</a><ul><ul><li><a href=#%e4%bd%bf%e7%94%a8openssl%e7%94%9f%e6%88%90%e9%9a%8f%e6%9c%ba%e6%95%b0 aria-label=使用openssl生成随机数>使用openssl生成随机数</a><li><a href=#%e4%bd%bf%e7%94%a8openssl%e7%94%9f%e6%88%90%e8%87%aa%e7%ad%be%e6%95%b0%e5%ad%97%e8%af%81%e4%b9%a6 aria-label=使用OpenSSL生成自签数字证书>使用OpenSSL生成自签数字证书</a><ul><li><a href=#1-%e5%bb%ba%e7%ab%8brootca aria-label="1. 建立RootCA"><strong>1. 建立RootCA</strong></a><li><a href=#2-%e8%87%aa%e7%ad%be%e5%90%8d%e8%af%81%e4%b9%a6 aria-label="2 自签名证书">2 自签名证书</a><li><a href=#%e7%94%a8%e6%88%b7%e6%88%96%e7%bb%84%e7%bb%87%e5%90%91ca%e7%94%b3%e8%af%b7%e5%85%ac%e9%92%a5%e8%af%81%e4%b9%a6 aria-label=用户或组织向CA申请公钥（证书）>用户或组织向CA申请公钥（证书）</a><li><a href=#ca%e9%a2%81%e5%8f%91%e8%af%81%e4%b9%a6 aria-label=CA颁发证书>CA颁发证书</a><li><a href=#%e8%af%81%e4%b9%a6%e5%8f%91%e9%80%81%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af aria-label=证书发送给客户端>证书发送给客户端</a></ul><li><a href=#openssl%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%b3%a8%e9%87%8a aria-label=OpenSSL配置文件注释>OpenSSL配置文件注释</a></ul><li><a href=#openssl%e6%89%a9%e5%b1%95%e5%af%86%e9%92%a5%e7%94%a8%e6%b3%95%e7%94%9f%e6%88%90%e5%a4%9a%e5%9f%9f%e5%90%8d%e8%af%81%e4%b9%a6 aria-label=OpenSSL扩展密钥用法：生成多域名证书>OpenSSL扩展密钥用法：生成多域名证书</a><ul><li><a href=#%e4%bd%bf%e7%94%a8openssl%e7%94%9f%e6%88%90%e6%a0%b9ca aria-label=使用OpenSSL生成根CA>使用OpenSSL生成根CA</a><li><a href=#%e5%87%86%e5%a4%87openssl%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=准备openssl配置文件>准备openssl配置文件</a><li><a href=#%e4%bd%bf%e7%94%a8-openssl-%e7%ad%be%e7%bd%b2%e5%b8%a6%e6%9c%89-san-%e6%89%a9%e5%b1%95%e7%9a%84%e8%af%81%e4%b9%a6%e8%af%b7%e6%b1%82csr aria-label="使用 openssl 签署带有 SAN 扩展的证书请求csr">使用 openssl 签署带有 SAN 扩展的证书请求csr</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=数字证书>数字证书<a hidden class=anchor aria-hidden=true href=#数字证书>#</a></h2><p>互联网上任意双方之间实现通信时，证书的目的有两种，</p><ul><li>主机证书，主要实现主机与主机之间进程间通信的。</li><li>个人证书，主要用作个人通信的，主要用作加密的数据的发送。</li></ul><p>主机类证书所拥有的标识主要为<code>主机名</code>，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。</p><p>对于一个安全的通信，应该有以下特征：</p><ul><li>完整性：消息在传输过程中未被篡改</li><li>身份验证：确认消息发送者的身份</li><li>不可否认：消息的发送者无法否认自己发送了信息</li></ul><p>显然，数字签名和消息认证码是不符合要求的，这里就需要数字证书来解决其弊端。</p><p>数字证书（digital certificate）又称公开密钥认证 PKC（英语：Public key certificate）。是在互联网通信中，方式数字签名的秘钥被篡改，是用来证明公开密钥拥有者的身份。此文件包含了公钥信息、拥有者身份信息（主体）、以及数字证书认证机构（发行者）对这份文件的数字签名，以保证这个文件的整体内容正确无误。</p><p>数字证书认证机构 CA (Certificate Authority)：是负责发放和管理数字证书的权威机构。</p><h3 id=公钥证书的格式标准>公钥证书的格式标准<a hidden class=anchor aria-hidden=true href=#公钥证书的格式标准>#</a></h3><p><code>X.509</code>是密码学中公钥明证PKC的格式标准，所有的证书都符合ITU-T X.509国际标准。X.509证书的结构是用<code>ASN1</code> (Abstract Syntax Notation One)进行描述数据结构，并使用<code>ASN.1</code>语法进行编码。</p><h3 id=证书规范>证书规范<a hidden class=anchor aria-hidden=true href=#证书规范>#</a></h3><p>X.509指的是ITU和ISO联合制定的（RFC5280）里定义的的 <code>X.509 v3</code></p><p>前使用最广泛的标准为X.509的 v3版本规范 (RFC5280）, 一般遵从<code>X.509</code>格式规范的证书，会有以下的内容：</p><p>证书组成结构</p><table><thead><tr><th><strong>结构</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>版本  </strong></td><td>现行通用版本是 V3，</td></tr><tr><td><strong>序号</strong></td><td>用来识别每一张证书，用来追踪和撤销证书。只要拥有签发者信息和序列号，就可以唯一标识一个证书，最大不能过20个字节；由CA来维护</td></tr><tr><td><strong>主体</strong></td><td>拥有此证书的法人或自然人身份或机器，包括：<br><strong>国家</strong>（C，Country）<br><strong>州/省</strong>（S，State）**<br><strong>地域/城市</strong>（L，Location）<br><strong>组织/单位</strong>（O，Organization）<br><strong>通用名称</strong>（CN，Common Name）：在TLS应用上，此字段一般是域名</td></tr><tr><td><strong>发行者</strong></td><td>以数字签名形式签署此证书的数字证书认证机构</td></tr><tr><td><strong>有效期(Validity) </strong></td><td>此证书的有效开始时间，在此前该证书并未生效；此证书的有效结束时间，在此后该证书作废。</td></tr><tr><td><strong>公开密钥用途</strong></td><td>指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等</td></tr><tr><td><strong>公开密钥</strong></td><td></td></tr><tr><td><strong>公开密钥指纹</strong></td><td></td></tr><tr><td><strong>数字签名</strong></td><td>使用信任的CA对内容进行</td></tr><tr><td>主体别名</td><td>例如一个网站可能会有多个域名（www.jd.com <a href=https://www.360buy.com target=_blank rel="noopener nofollow noreferrer">www.360buy.com</a>..）<br>一个组织可能会有多个网站（*.baidu.com tieba.baidu.com），<br>不同的网域可以一并使用同一张证书，方便实现应用及管理。</td></tr></tbody></table><p>互联网上任意双方之间实现通信时，证书的目的有两种，</p><ul><li>主机证书，主要实现主机与主机之间进程间通信的。</li><li>个人证书，主要用作个人通信的，主要用作加密的数据的发送。</li></ul><p>主机类证书所拥有的标识主要为<code>主机名</code>，主机证书名称一定要与互联网之上访问名称一致，否则此证书为不可信证书。</p><h3 id=数字证书文件格式>数字证书文件格式<a hidden class=anchor aria-hidden=true href=#数字证书文件格式>#</a></h3><p><code>X.509</code>一般推荐使用<code>PEM</code> (Privacy Enhanced Mail）格式来存储证书相关的文件。</p><p><code>.crt</code> & <code>.cer</code>：证书文件后缀名
<code>.key</code>: 私钥后缀名
<code>.csr</code>：证书请求文件后缀名</p><h3 id=公钥基础设施pki>公钥基础设施（PKI）<a hidden class=anchor aria-hidden=true href=#公钥基础设施pki>#</a></h3><p>公钥基础设施 PKI（Public-Key infrastructure）是为了能够更有效地运用公钥而制定的一系列规范和规格的总称。</p><h4 id=pki的组成要素>PKI的组成要素<a hidden class=anchor aria-hidden=true href=#pki的组成要素>#</a></h4><ul><li>用户：使用PKI的人<ul><li>注册公钥用户。</li><li>使用已注册公钥用户。</li></ul></li><li>认证机构：<ul><li>签证机构：CA Certificate Authority</li><li>注册机构：RA</li></ul></li><li>仓库<ul><li>证书吊销列表：CRL；</li><li>证书存取库，从签发机构中获得其签发的证书，需要有存取库来提供这些证书。</li></ul></li></ul><h2 id=ssltls>SSL/TLS<a hidden class=anchor aria-hidden=true href=#ssltls>#</a></h2><p>传输层安全协议，TLS，（Transport Layer Security），其前身为<strong>安全套接层</strong> SSL（Secure Sockets Layer）。SSL3.0为SSL最高版本，3.1 即TLS 1.0</p><p>SSL/TLS是世界上应用最广泛的密码通信方法。比如说，当在网上商城中输人信用卡号时，我们的Web浏览器就会使用SSL/TLS进行密码通信。使用SSL/TLS可以对通信对象进行认证，还可以确保通信内容的机密性。</p><table><thead><tr><th>协议</th><th>时间</th><th>状态</th></tr></thead><tbody><tr><td>SSL 1.0</td><td>未公布</td><td>未公布</td></tr><tr><td>SSL 2.0</td><td>1995年</td><td>已于2011年弃用</td></tr><tr><td>SSL 3.0</td><td>1996年</td><td>已于2015年弃用</td></tr><tr><td>TLS 1.0</td><td>1999年</td><td></td></tr><tr><td>TLS 1.1</td><td>2006年</td><td></td></tr><tr><td>TLS 1.2</td><td>2008年</td><td></td></tr><tr><td>TLS 1.3</td><td>2018年</td><td></td></tr></tbody></table><p>http协议本身为文本格式，数据发送做文本编码；https协议实现的是二进制格式，数据发送做文本编码。由于ssl的存在，双方在实现通讯时，除了tcp协议三次 握手之外，双方还需做ssl握手会话的过程（认证密钥证书、数据交换等）。ssl会话的建立只能基于IP地址，无法基于主机名识别每一个通信方。一个IP地址在某个应用协议上只能建立一个ssl会话。</p><p>TLS采用了分层设计，虽然在TCP/IP协议栈上，SSL增加的半层，其内部实现为多层</p><ul><li>最底层，基础算法原语的实现，aes，rsa，md5</li><li>向上一层，选定参数后，符合密码学标准分类的算法的实现<ul><li>aes-128-abc-pkcs7 abc内部块的串联方式 pkcs7 对称加密公钥格式。</li></ul></li><li>再向上一层：组合算法实现的半成品。</li><li>用各种组件拼装而成的种种成品密码学协议/软件 tls ssh。 openssh是利用openssl工具实现的软件程序。</li></ul><h2 id=openssl>OpenSSL<a hidden class=anchor aria-hidden=true href=#openssl>#</a></h2><p>OpenSSL是一个开放源代码的软件库，并实现了SSL与TLS协议。OpenSSL可以运行在，MS Windows、Linux、MacOS。OpenSSL已经成为linux基础公共组件，主要由三个开源组件组成：</p><ul><li><code>openssl</code>：多用途的命令行工具，能实现对称加密、非对称加密、单项加密等。各功能分别使用单独子命令来实现。</li><li><code>libcrypto</code>：公共加密库，实现了多种加密算法。</li><li><code>libssl</code>：实现了SSL及TLS的功能库</li></ul><h3 id=openssl命令>OpenSSL命令<a hidden class=anchor aria-hidden=true href=#openssl命令>#</a></h3><p>OpenSSL命令分为 标准命令<code>Standard commands</code>、消息摘要命令<code>Message Digest commands</code>、密码命令<code>Cipher commands</code>三部分组成。</p><blockquote><ul><li>标准命令。完成某些功能时使用的，如生成随机数、扮演CA签发证书。<ul><li>enc 对称加密</li><li>crl 证书吊销列表</li><li>ca 证书签发机构</li><li>dgst 消息摘要算法（单项散列函数）</li><li>dh 密钥交换算法</li><li>req 请求证书生成器</li></ul></li><li>消息摘要命令算法，常用散列函数。</li><li>加密命令，所支持的加密算法。</li></ul></blockquote><h3 id=openssl-命令使用>OpenSSL 命令使用<a hidden class=anchor aria-hidden=true href=#openssl-命令使用>#</a></h3><h4 id=对称加密>对称加密<a hidden class=anchor aria-hidden=true href=#对称加密>#</a></h4><p>加密</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl enc -e -des3 -a -salt -in /etc/passwd -out ./passwd</span></span></code></pre></td></tr></table></div></div></div></div><p>解密</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl enc -d -des3 -a -salt -in passwd</span></span></code></pre></td></tr></table></div></div></div></div><ul><li><code>-d</code> 解密</li><li><code>-e</code> 加密</li><li><code>-a</code> base64编码处理数据</li></ul><h4 id=单项加密>单项加密<a hidden class=anchor aria-hidden=true href=#单项加密>#</a></h4><p>openssl中，单项加密即数字签名计算message的摘要信息，为 <code>openssl dgst...</code></p><p>单项散列函数通常应用于数字签名于消息认证码（MAC： Message Authentication Code 消息认证码，单项加密的一种延申应用，用于实现再网络通信中保证所传输的数据的完整性。）</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ openssl dgst -md5 /var/log/messages
</span></span><span class=line><span class=cl>MD5(/var/log/messages)= 4515fae68552c00646ee7e07aac25d1d</span></span></code></pre></td></tr></table></div></div></div></div><p>也可以简写为</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ openssl md5 /var/log/messages
</span></span><span class=line><span class=cl>MD5(/var/log/messages)= 24483320e6af7ed2cee401aa00c260e6</span></span></code></pre></td></tr></table></div></div></div></div><p>openssl也可以生成用户密码 sslpasswd</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ openssl passwd -1 -salt 123456
</span></span><span class=line><span class=cl>Password: 
</span></span><span class=line><span class=cl>$1$123456$wWKtx7yY/RnLiPN.KaX.z.</span></span></code></pre></td></tr></table></div></div></div></div><p><code>$1$123456$wWKtx7yY/RnLiPN.KaX.z.</code> 这是扩展Unix风格的<code>crypt(3)</code> 密码哈希语法。格式为 <code>$id$salt$encrypted</code> 前<code>$id$</code>符表示加密算法 1标识md5 6标识<code>SHA-512</code>，123456是指定的salt,salt为id后的最多16位的对密码加盐。</p><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><p><a href=https://man7.org/linux/man-pages/man3/crypt.3.html target=_blank rel="noopener nofollow noreferrer">crypt</a>
<a href=https://unix.stackexchange.com/questions/510990/why-is-the-output-of-openssl-passwd-different-each-time target=_blank rel="noopener nofollow noreferrer">unix style encrypted</a></p></blockquote><h4 id=使用openssl生成随机数>使用openssl生成随机数<a hidden class=anchor aria-hidden=true href=#使用openssl生成随机数>#</a></h4><p>hex基于16进制编码格式 每个字节4位，4指的是4个字节，一个字节是8位二进制数。4位二进制可以用一个16进制字节标识（一个十六进制对应四个二进制 $4<em>4=16$） 出现字符 num</em>2</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ openssl rand -hex <span class=m>16</span>
</span></span><span class=line><span class=cl>8cd7c7a85e22b4548f6942468028fde4
</span></span><span class=line><span class=cl>$ openssl rand -base64 <span class=m>6</span>
</span></span><span class=line><span class=cl>c0jDwKIG</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=使用openssl生成自签数字证书>使用OpenSSL生成自签数字证书<a hidden class=anchor aria-hidden=true href=#使用openssl生成自签数字证书>#</a></h4><p>获取证书两种方法：</p><ul><li>使用证书授权机构<ul><li>生成签名请求（csr）</li><li>将csr发送给CA</li><li>从CA处接收签名</li></ul></li><li>自签名的证书：自已签发自己的公钥</li></ul><h5 id=1-建立rootca><strong>1. 建立RootCA</strong><a hidden class=anchor aria-hidden=true href=#1-建立rootca>#</a></h5><p><strong>生成私钥</strong></p><table><thead><tr><th style=text-align:center>参数</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:center>-new</td><td style=text-align:left>表示生成一个新证书签署请求</td></tr><tr><td style=text-align:center>-x509</td><td style=text-align:left>专用于CA生成自签证书，如果不是自签证书则不需要此项</td></tr><tr><td style=text-align:center>-key</td><td style=text-align:left>生成请求时用到的私钥文件</td></tr><tr><td style=text-align:center>-out</td><td style=text-align:left>证书的保存路径</td></tr><tr><td style=text-align:center>-days</td><td style=text-align:left>证书的有效期限，单位是day（天），默认是365天</td></tr></tbody></table><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/pki/tls/
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>openssl genrsa -out private/cakey.pem <span class=m>2048</span>
</span></span><span class=line><span class=cl><span class=c1># 路径和名称必须为openssl配置文件中路径的名称</span></span></span></code></pre></td></tr></table></div></div></div></div><h5 id=2-自签名证书>2 自签名证书<a hidden class=anchor aria-hidden=true href=#2-自签名证书>#</a></h5><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl req -new <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-x509 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-key private/cakey.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-out cacert.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-days <span class=m>3650</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-subj <span class=s2>&#34;/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=CHINA MOBILE&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>自签名证书是base64编码的，查看证书内容</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl x509 -in cacert.pem -noout -text</span></span></code></pre></td></tr></table></div></div></div></div><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>x509</td><td>格式</td></tr><tr><td>-noout</td><td>输出时不生成新文件，只显示内容</td></tr><tr><td>-text</td><td>以文本格式输出</td></tr></tbody></table><p><strong>数字证书中主题(Subject)中字段的含义</strong></p><ul><li>一般的数字证书产品的主题通常含有如下字段：</li></ul><table><thead><tr><th>字段名</th><th>说明</th></tr></thead><tbody><tr><td>公用名称 <font color=#f8070d size=3>CN</font> (Common Name)</td><td>对于 SSL 证书，<font color=#f8070d size=2>一般为网站域名</font>；而对于代码签名证书则为申请单位名称；而对于客户端证书则为证书申请者的姓名；</td></tr><tr><td>单位名称 <font color=#f8070d size=3>O</font> (Organization Name)</td><td>对于 SSL 证书，一般为网站域名；而对于代码签名证书则为申请单位名称；而对于客户端单位证书则为证书申请者所在单位名称；</td></tr><tr><td>OU</td><td>可以理解为公司部门名称</td></tr><tr><td>所在城市 <font color=#f8070d size=3>L</font> (Locality)</td><td></td></tr><tr><td>所在省份 <font color=#f8070d size=3>ST</font>(State/Provice)</td><td></td></tr><tr><td>所在国家 <font color=#f8070d size=3>C</font> (Country）</td><td></td></tr></tbody></table><p>可以看到生成了一个Chinamobile的自签的RootCA</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201105220215285-526813628.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201105220215285-526813628.png#center alt onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h5 id=用户或组织向ca申请公钥证书>用户或组织向CA申请公钥（证书）<a hidden class=anchor aria-hidden=true href=#用户或组织向ca申请公钥证书>#</a></h5><ol><li>生成私钥</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> mkdir child
</span></span><span class=line><span class=cl> openssl genrsa -out child/child.pem <span class=m>2048</span></span></span></code></pre></td></tr></table></div></div></div></div><ol start=2><li>生成证书申请文件 <code>child.csr</code></li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl req -new <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-key child/child.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-out child/child.csr <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-subj <span class=s2>&#34;/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=*.10086.com&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><ol start=3><li>将证书申请文件发送给CA</li></ol><p>可以通过任意方式发送申请文件给CA</p><h5 id=ca颁发证书>CA颁发证书<a hidden class=anchor aria-hidden=true href=#ca颁发证书>#</a></h5><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>touch /etc/pki/CA/index.txt
</span></span><span class=line><span class=cl>touch /etc/pki/CA/serial # 下一个要颁发的编号 16进制
</span></span><span class=line><span class=cl>touch /etc/pki/CA/crlnumber
</span></span><span class=line><span class=cl>echo 01 &gt; /etc/pki/CA/serial</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl ca -in child/child.csr \ # 签发请求
</span></span><span class=line><span class=cl>	-cert cacert.pem \ # CA证书
</span></span><span class=line><span class=cl>	-keyfile private/cakey.pem \  # CA私钥
</span></span><span class=line><span class=cl>	-out child/a.crt -days 30</span></span></code></pre></td></tr></table></div></div></div></div><h5 id=证书发送给客户端>证书发送给客户端<a hidden class=anchor aria-hidden=true href=#证书发送给客户端>#</a></h5><p>在应用软件中使用证书</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201105221806859-170479134.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201105221806859-170479134.png#center alt onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201105221815048-923869731.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201105221815048-923869731.png#center alt onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><h4 id=openssl配置文件注释>OpenSSL配置文件注释<a hidden class=anchor aria-hidden=true href=#openssl配置文件注释>#</a></h4><p><code>/etc/pki/tls/openssl.cnf </code>定义了管理CA的相关信息。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>cnf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-cnf data-lang=cnf># 语法
# 变量 = 值
# 1. 字符串值最好使用双引号界定，并且其中可以使用&#34;\n&#34;,&#34;\r&#34;,&#34;\t&#34;,&#34;\\&#34;这些转义序列。
# 2. 可以使用 ${变量名} 的形式引用同一字段中的变量，使用 ${字段名::变量名} 的形式引用其它字段中的变量。
# 3. 可以使用 ${ENV::环境变量} 的形式引用操作系统中定义的环境变量，若变量不存在则会导致错误。
# 4. 可以在默认字段定义与操作系统环境变量同名的变量作为默认值来避免环境变量不存在导致的错误。
# 5. 如果在同一字段内有多个相同名称的变量，那么后面的值将覆盖前面的值。
# 6. 可以通过 &#34;.include = 绝对路径&#34; 语法或 OPENSSL_CONF_INCLUDE 环境变量引入其他配置文件(*.cnf)。


# 定义 HOME 的默认值，防止操作系统中不存在 HOME 环境变量。
HOME			= .
# 默认的随机数种子文件，对应 -rand 命令行选项。
RANDFILE		= $ENV::HOME/.rnd

# 扩展对象定义
# 如果没有在 OpenSSL 命令行中定义X.509证书的扩展项，那么就会从下面对扩展对象的定义中获取。
# 定义方法有两种，第一种(反对使用)是存储在外部文件中，也就是这里&#34;oid_file&#34;变量定义的文件。
#oid_file		= $ENV::HOME/.oid
# 第二种是存储在配置文件的一个字段中，也就是这里&#34;oid_section&#34;变量值所指定的字段。
oid_section		= new_oids

# 要将此配置文件用于 &#34;openssl x509&#34; 命令的 &#34;-extfile&#34; 选项，
# 请在此指定包含 X.509v3 扩展的小节名称
#extensions =
# 或者使用一个默认字段中仅包含 X.509v3 扩展的配置文件



[ new_oids ]
# 添加可以被 &#39;ca&#39;, &#39;req&#39;, &#39;ts&#39; 命令使用的扩展对象。格式如下：
# 对象简称 = 对象数字ID
# 下面是一些增强型密钥用法(extendedKeyUsage)的例子
# We can add new OIDs in here for use by &#39;ca&#39;, &#39;req&#39; and &#39;ts&#39;.
# Add a simple OID like this:
# testoid1=1.2.3.4
# Or use config file substitution like this:
# testoid2=${testoid1}.5.6

# Policies used by the TSA examples.
tsa_policy1 = 1.2.3.4.1
tsa_policy2 = 1.2.3.4.5.6
tsa_policy3 = 1.2.3.4.5.7

########################################################################################
###################################  证书签发配置  ######################################
########################################################################################

# openssl 的 ca 命令实现了证书签发的功能，其相关选项的默认值就来自于这里的设置。
# 这个字段只是通过唯一的 default_ca 变量来指定默认CA主配置字段的入口(-name 命令行选项的默认值)


########################################################################################
######################## 默认CA主配置字段，(★)标记表示必需项 #############################
########################################################################################
[ ca ]  #
default_ca	= CA_default		# The default ca section # 默认CA

########################################################################################
######################### 默认CA主配置字段，(★)标记表示必需项 ############################
########################################################################################
[ CA_default ] 
# 保存所有信息的文件夹，这个变量只是为了给后面的变量使用
dir			= /etc/pki/CA

# (★)存放新签发证书的默认目录，证书名就是该证书的系列号，后缀是.pem 。对应 -outdir 命令行选项。
certs		= $dir/certs

# 存放证书吊销列表的
crl_dir		= $dir/crl

# 数据库，颁发了那些证书，以及证书状态、编号。 数据索引。默认不存在的
database	= $dir/index.txt

#unique_subject	= no

#(★)存放新签发证书的默认目录，证书名就是该证书的系列号，后缀是.pem 。对应 -outdir 命令行选项。
new_certs_dir	= $dir/newcerts		# default place for new certs. # 新证书目录

#(★)存放CA自身证书的文件名。对应 -cert 命令行选项。
certificate	= $dir/cacert.pem

#(★)签发证书时使用的序列号文本文件，里面必须包含下一个可用的16进制数字。。需手工创建 
serial		= $dir/serial

# 存放当前(下一个吊销证书编号)CRL编号的文件，需手工创建
crlnumber	= $dir/crlnumber

# 证书吊销列表
crl		= $dir/crl.pem 		

#(★)存放CA自身私钥的文件名。对应 -keyfile 命令行选项。
private_key	= $dir/private/cakey.pem

# 私钥文件路径
RANDFILE	= $dir/private/.rand

# 定义X.509证书扩展项的字段。对应 -extensions 命令行选项。
x509_extensions	= usr_cert


# 当用户需要确认签发证书时可读证书DN域的显示格式。可用值与 x509 指令的 -nameopt 选项相同。
name_opt 	= ca_default		# Subject Name options

# 可用值与 x509 指令的 -certopt 选项相同，不过 no_signame 和 no_sigdump 总被默认设置。
cert_opt 	= ca_default		# Certificate field options

# 是否将证书请求中的扩展项信息加入到证书扩展项中去。取值范围以及解释：
## none: 忽略所有证书请求中的扩展项
## copy: 将证书扩展项中没有的项目复制到证书中
## copyall: 将所有证书请求中的扩展项都复制过去，并且覆盖证书扩展项中原来已经存在的值。
## 此选项的主要用途是允许证书请求提供例如 subjectAltName 之类扩展的值。

# copy_extensions = copy

# 定义生成CRL时需要加入的扩展项字段。对应 -crlexts 命令行选项。
# crl_extensions	= crl_ext

# 新签发的证书默认有效期，以天为单位。依次对应 -days , -startdate , -enddate 命令行选项。
default_days	= 365	# 颁发证书默认有效期

# crl的有效期 30天
default_crl_days= 30

# 默认hash算法
default_md	= sha256
preserve	= no	    # keep passed DN ordering


#(★)定义用于证书请求DN域匹配策略的字段，用于决定CA要求和处理证书请求提供的DN域的各个参数值的规则。
# 策略匹配 ，客户端与ca之间区申请证书信息是否必须匹配，对应 -policy 命令行选项。
policy		= policy_match 

########################################################################################
################################ 为签发的证书设置扩展项 ##################################
########################################################################################

# 变量名称是DN域对象的名称，变量值可以是：
# match: 该变量在证书请求中的值必须与CA证书相应的变量值完全相同，否则拒签。
# supplied: 该变量在证书请求中必须提供(值可以不同)，否则拒签。
# optional: 该变量在证书请求中可以存在也可以不存在(相当于没有要求)。
# 除非preserve=yes或者在ca命令中使用了-preserveDN，否则在签发证书时将删除匹配策略中未提及的对象。

[ policy_match ]
countryName		= match
stateOrProvinceName	= match
organizationName	= match
organizationalUnitName	= optional
commonName		= supplied
emailAddress		= optional

########################################################################################
############## &#34;特征名称&#34;字段包含了用户的标识信息，对应 -subj 命令行选项 ###################
########################################################################################

[ req_distinguished_name ]
countryName = CN  # 必须是两字母国家代码
stateOrProvinceName = # 省份或直辖市
localityName = # 城市
organizationName = # 组织名或公司名
organizationalUnitName = # 部门名称
commonName = # 全限定域名或个人姓名
emailAddress = # Email地址

########################################################################################
################################# 为签发的证书设置扩展项 #################################
########################################################################################

[ extendtsion_name ]
# 基本约束(该证书是否为CA证书)。&#34;CA:FALSE&#34;表示非CA证书(不能签发其他证书的&#34;叶子证书&#34;)。
basicConstraints = CA:FALSE

# 颁发机构密钥标识符(&#34;always&#34;表示始终包含)
authorityKeyIdentifier = keyid:always,issuer

# PKIX工作组推荐将使用者与颁发机构的密钥标识符包含在证书中
subjectKeyIdentifier=hash

# 证书用途，如省略，則可以用于签名外的任何。
# server SSL服务器
# objsign 签名证书
# client 客户端
# email 电子邮件
nsCertType = client

# Netscape Comment（nsComment）是包含注释的字符串扩展名，当在某些浏览器中查看证书时，该注释将显示。
nsComment = &#34;OpenSSL Generated Client Certificate&#34;

# 密钥用法：防否认(nonRepudiation)、数字签名(digitalSignature)、密钥加密(keyEncipherment)。
# 密钥协商(keyAgreement)、数据加密(dataEncipherment)、仅加密(encipherOnly)、仅解密(decipherOnly)
keyUsage = nonRepudiation, digitalSignature, keyEncipherment

# 增强型密钥用法(参见&#34;new_oids&#34;字段)：服务器身份验证、客户端身份验证、时间戳。
extendedKeyUsage = critical,serverAuth, clientAuth, timeStamping

# 使用者备用名称(email, URI, DNS, RID, IP, dirName)
# 例如，DNS常用于实现泛域名证书、IP常用于绑定特定的IP地址、&#34;copy&#34;表示直接复制
subjectAltName = DNS:www.example.com, DNS:*.example.net, IP:192.168.7.1, IP:13::17</code></pre></div></div><h3 id=openssl扩展密钥用法生成多域名证书>OpenSSL扩展密钥用法：生成多域名证书<a hidden class=anchor aria-hidden=true href=#openssl扩展密钥用法生成多域名证书>#</a></h3><p>SAN(Subject Alternative Name) 是 <code>SSL/TLS</code> 标准 <code>x.509</code> 中定义的一个扩展。使用了SAN字段的 SSL 证书，可以扩展此证书支持的域名，使一个证书可支持多个不同域名的解析。<a href=https://tools.ietf.org/html/rfc5280#section-4.2.1.6 target=_blank rel="noopener nofollow noreferrer">RFC 5280 4.2.1.6</a></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201112203256164-952424212.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201112203256164-952424212.png#center alt onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201112203458757-2086651260.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201112203458757-2086651260.png#center alt onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>可以看到面子书与京东的证书的 <code>Subject Alternative Name</code> 段中列了大量的域名，使用这种类型的证书能够极大的简化网站证书的管理</p><h4 id=使用openssl生成根ca>使用OpenSSL生成根CA<a hidden class=anchor aria-hidden=true href=#使用openssl生成根ca>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/pki/tls/
</span></span><span class=line><span class=cl>openssl genrsa -out private/cakey.pem <span class=m>2048</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>openssl req -new <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-x509 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-key private/cakey.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-out cacert.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-days <span class=m>3650</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	-subj <span class=s2>&#34;/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=CHINA MOBILE&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=准备openssl配置文件>准备openssl配置文件<a hidden class=anchor aria-hidden=true href=#准备openssl配置文件>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectKeyIdentifier=hash
authorityKeyIdentifier = keyid:always,issuer
nsComment = &#34;OpenSSL Generated Client Certificate&#34;
subjectAltName = DNS:etcd, DNS:hk-etcd, IP:10.0.0.1
nsCertType = client, server</code></pre></div></div><p>可以看到此证书请求文件中会包含 <code>Subject Alternative Names</code> 字段，并包含之前在配置文件中填写的域名。</p><h4 id=使用-openssl-签署带有-san-扩展的证书请求csr>使用 openssl 签署带有 SAN 扩展的证书请求csr<a hidden class=anchor aria-hidden=true href=#使用-openssl-签署带有-san-扩展的证书请求csr>#</a></h4><ol><li>生成私钥</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>mkdir child
</span></span><span class=line><span class=cl>openssl genrsa -out child/child.pem 2048</span></span></code></pre></td></tr></table></div></div></div></div><ol start=2><li>生成证书申请文件 <code>child.csr</code></li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl req -new \
</span></span><span class=line><span class=cl>	-key child/child.pem \
</span></span><span class=line><span class=cl>	-out child/child.csr \
</span></span><span class=line><span class=cl>	-subj &#34;/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=hketcd&#34; \
</span></span><span class=line><span class=cl>	-config ./openssl.cnf</span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>单条命令实现方式</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl req -new \
</span></span><span class=line><span class=cl>	-key child/child.pem \
</span></span><span class=line><span class=cl>	-subj &#34;/C=HK/ST=HK/L=HK/O=chinamobile/OU=SY/CN=hketcd&#34; \
</span></span><span class=line><span class=cl>	-reqexts req_v3 \
</span></span><span class=line><span class=cl>	-config &lt;(cat /etc/pki/tls/openssl.cnf \
</span></span><span class=line><span class=cl> 			&lt;(printf &#34;[aa]\nsubjectAltName=DNS:etcd, DNS:hk-etcd, IP:10.0.0.1&#34;)) \
</span></span><span class=line><span class=cl>	-out child/child.csr</span></span></code></pre></td></tr></table></div></div></div></div><ol start=3><li>CA颁发证书</li></ol><p>单条命令实现</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl ca \
</span></span><span class=line><span class=cl>	-in child/child.csr \
</span></span><span class=line><span class=cl>	-cert cacert.pem \
</span></span><span class=line><span class=cl>	-keyfile private/cakey.pem \
</span></span><span class=line><span class=cl>	-out child/child.crt \
</span></span><span class=line><span class=cl>	-days 30 \
</span></span><span class=line><span class=cl>	-extensions aa \
</span></span><span class=line><span class=cl>	-extfile &lt;(cat /etc/pki/tls/openssl.cnf \
</span></span><span class=line><span class=cl>             &lt;(printf &#34;[aa]\nsubjectAltName=DNS:etcd, DNS:hk-etcd, IP:10.0.0.1&#34;))</span></span></code></pre></td></tr></table></div></div></div></div><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201112210753782-1479864379.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/1380340-20201112210753782-1479864379.png#center alt=img onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：常用加密算法之数字证书与TLS/SSL</p><p>文章链接：<a href=http://localhost:1313/2020/08/openssl-x509/ target=_blank>http://localhost:1313/2020/08/openssl-x509/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/encryption/>Encryption</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/2020/08/istio-cli/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>istio命令</span>
</a><a class=next href=http://localhost:1313/2020/05/ciper-script/><span class=title></span>
<span>脚本在公网的加密执行&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/openssl x509","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>