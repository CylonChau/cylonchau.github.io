<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Envoy路由管理 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="envoy"><meta name=description content="HTTP 链接管理 envoy处理用户请求逻辑
① 用户请求报文到达七层过滤器链处理机制后，首先根据请求HTTP报文中的 Host 首部来完成虚拟主机的选择；② 由此虚拟机主机内部的 Route 表项进行处理。③ 后由 match 进行匹配; Match 是与请求URL的 PATH 组成部分或请求报文的标头部分 header 。④ 最后才可到达 Route 进行 direct_response 、redirect 等。
官方手册
Envoy通过内置的L4过滤器HTTP连接管理器将原始字节转换为HTTP应用层协议级别的消息和事件，例如接收到的标头和主体等，以及处理所有HTTP连接和请求共有的功能，包括访问日志、生成和跟踪请求ID，请求/响应头处理、路由表管理和统计信息等；
支持HTTP/1.1、WebSockets和HTTP/2，但不支持SPDY; 关联的路由表可静态配置，亦可经由 xDS API 中的 RDS 动态生成； 内建重试插件，可用于配置重试行为; Host Predicates Priority Predicates 内建支持302重定向，它可以捕获302重定向响应，合成新请求后将其发送到新的路由匹配（match）所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端
支持适用于HTTP连接及其组成流（constituent streams）的多种可配置超时机制
连接级别：空闲超时和排空超时（GOAWAY）； 流级别：空闲超时、每路由相关的上游端点超时和每路由相关的 gRPC 最大超时时长； 基于自定义集群的动态转发代理； HTTP协议相关的功能通过各HTTP过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；
router envoy.router 是最常的过滤器之一，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；
HTTP 路由 Envoy基于HTTP router过滤器基于路由表完成多种高级路由机制，例如:
将域名映射到虚拟主机； path的前级 prefix 匹配、精确匹配或正则表达式匹配； 虚拟主机级别的TLS重定向； path级别的 path/host 重定向； direct_response ，由Envoy直接生成响应报文 ； 显式 host rewrite； prefix rewrite； 基于HTTP标头或路由配置的请求重试与请求超时； 基于运行时参数的流量迁移； 基于权重或百分比的跨集群流量分割； 基于任意标头匹配路由规则； 基于优先级的路由； 基于hash策略的路由； 路由配置和虚拟主机 路由配置中的顶级元素是虚拟主机"><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2020/09/envoy-router-management/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2020/09/envoy-router-management/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="Envoy路由管理"><meta property="og:description" content="HTTP 链接管理 envoy处理用户请求逻辑
① 用户请求报文到达七层过滤器链处理机制后，首先根据请求HTTP报文中的 Host 首部来完成虚拟主机的选择；② 由此虚拟机主机内部的 Route 表项进行处理。③ 后由 match 进行匹配; Match 是与请求URL的 PATH 组成部分或请求报文的标头部分 header 。④ 最后才可到达 Route 进行 direct_response 、redirect 等。
官方手册
Envoy通过内置的L4过滤器HTTP连接管理器将原始字节转换为HTTP应用层协议级别的消息和事件，例如接收到的标头和主体等，以及处理所有HTTP连接和请求共有的功能，包括访问日志、生成和跟踪请求ID，请求/响应头处理、路由表管理和统计信息等；
支持HTTP/1.1、WebSockets和HTTP/2，但不支持SPDY; 关联的路由表可静态配置，亦可经由 xDS API 中的 RDS 动态生成； 内建重试插件，可用于配置重试行为; Host Predicates Priority Predicates 内建支持302重定向，它可以捕获302重定向响应，合成新请求后将其发送到新的路由匹配（match）所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端
支持适用于HTTP连接及其组成流（constituent streams）的多种可配置超时机制
连接级别：空闲超时和排空超时（GOAWAY）； 流级别：空闲超时、每路由相关的上游端点超时和每路由相关的 gRPC 最大超时时长； 基于自定义集群的动态转发代理； HTTP协议相关的功能通过各HTTP过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；
router envoy.router 是最常的过滤器之一，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；
HTTP 路由 Envoy基于HTTP router过滤器基于路由表完成多种高级路由机制，例如:
将域名映射到虚拟主机； path的前级 prefix 匹配、精确匹配或正则表达式匹配； 虚拟主机级别的TLS重定向； path级别的 path/host 重定向； direct_response ，由Envoy直接生成响应报文 ； 显式 host rewrite； prefix rewrite； 基于HTTP标头或路由配置的请求重试与请求超时； 基于运行时参数的流量迁移； 基于权重或百分比的跨集群流量分割； 基于任意标头匹配路由规则； 基于优先级的路由； 基于hash策略的路由； 路由配置和虚拟主机 路由配置中的顶级元素是虚拟主机"><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2020/09/envoy-router-management/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-02T00:00:00+00:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Envoy路由管理"><meta name=twitter:description content="HTTP 链接管理 envoy处理用户请求逻辑
① 用户请求报文到达七层过滤器链处理机制后，首先根据请求HTTP报文中的 Host 首部来完成虚拟主机的选择；② 由此虚拟机主机内部的 Route 表项进行处理。③ 后由 match 进行匹配; Match 是与请求URL的 PATH 组成部分或请求报文的标头部分 header 。④ 最后才可到达 Route 进行 direct_response 、redirect 等。
官方手册
Envoy通过内置的L4过滤器HTTP连接管理器将原始字节转换为HTTP应用层协议级别的消息和事件，例如接收到的标头和主体等，以及处理所有HTTP连接和请求共有的功能，包括访问日志、生成和跟踪请求ID，请求/响应头处理、路由表管理和统计信息等；
支持HTTP/1.1、WebSockets和HTTP/2，但不支持SPDY; 关联的路由表可静态配置，亦可经由 xDS API 中的 RDS 动态生成； 内建重试插件，可用于配置重试行为; Host Predicates Priority Predicates 内建支持302重定向，它可以捕获302重定向响应，合成新请求后将其发送到新的路由匹配（match）所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端
支持适用于HTTP连接及其组成流（constituent streams）的多种可配置超时机制
连接级别：空闲超时和排空超时（GOAWAY）； 流级别：空闲超时、每路由相关的上游端点超时和每路由相关的 gRPC 最大超时时长； 基于自定义集群的动态转发代理； HTTP协议相关的功能通过各HTTP过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；
router envoy.router 是最常的过滤器之一，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；
HTTP 路由 Envoy基于HTTP router过滤器基于路由表完成多种高级路由机制，例如:
将域名映射到虚拟主机； path的前级 prefix 匹配、精确匹配或正则表达式匹配； 虚拟主机级别的TLS重定向； path级别的 path/host 重定向； direct_response ，由Envoy直接生成响应报文 ； 显式 host rewrite； prefix rewrite； 基于HTTP标头或路由配置的请求重试与请求超时； 基于运行时参数的流量迁移； 基于权重或百分比的跨集群流量分割； 基于任意标头匹配路由规则； 基于优先级的路由； 基于hash策略的路由； 路由配置和虚拟主机 路由配置中的顶级元素是虚拟主机"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"Envoy路由管理","item":"https://www.oomkill.com/2020/09/envoy-router-management/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Envoy路由管理","name":"Envoy路由管理","description":"HTTP 链接管理 envoy处理用户请求逻辑\n① 用户请求报文到达七层过滤器链处理机制后，首先根据请求HTTP报文中的 Host 首部来完成虚拟主机的选择；② 由此虚拟机主机内部的 Route 表项进行处理。③ 后由 match 进行匹配; Match 是与请求URL的 PATH 组成部分或请求报文的标头部分 header 。④ 最后才可到达 Route 进行 direct_response 、redirect 等。\n官方手册\nEnvoy通过内置的L4过滤器HTTP连接管理器将原始字节转换为HTTP应用层协议级别的消息和事件，例如接收到的标头和主体等，以及处理所有HTTP连接和请求共有的功能，包括访问日志、生成和跟踪请求ID，请求/响应头处理、路由表管理和统计信息等；\n支持HTTP/1.1、WebSockets和HTTP/2，但不支持SPDY; 关联的路由表可静态配置，亦可经由 xDS API 中的 RDS 动态生成； 内建重试插件，可用于配置重试行为; Host Predicates Priority Predicates 内建支持302重定向，它可以捕获302重定向响应，合成新请求后将其发送到新的路由匹配（match）所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端\n支持适用于HTTP连接及其组成流（constituent streams）的多种可配置超时机制\n连接级别：空闲超时和排空超时（GOAWAY）； 流级别：空闲超时、每路由相关的上游端点超时和每路由相关的 gRPC 最大超时时长； 基于自定义集群的动态转发代理； HTTP协议相关的功能通过各HTTP过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；\nrouter envoy.router 是最常的过滤器之一，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；\nHTTP 路由 Envoy基于HTTP router过滤器基于路由表完成多种高级路由机制，例如:\n将域名映射到虚拟主机； path的前级 prefix 匹配、精确匹配或正则表达式匹配； 虚拟主机级别的TLS重定向； path级别的 path/host 重定向； direct_response ，由Envoy直接生成响应报文 ； 显式 host rewrite； prefix rewrite； 基于HTTP标头或路由配置的请求重试与请求超时； 基于运行时参数的流量迁移； 基于权重或百分比的跨集群流量分割； 基于任意标头匹配路由规则； 基于优先级的路由； 基于hash策略的路由； 路由配置和虚拟主机 路由配置中的顶级元素是虚拟主机","keywords":["envoy"],"articleBody":"HTTP 链接管理 envoy处理用户请求逻辑\n① 用户请求报文到达七层过滤器链处理机制后，首先根据请求HTTP报文中的 Host 首部来完成虚拟主机的选择；② 由此虚拟机主机内部的 Route 表项进行处理。③ 后由 match 进行匹配; Match 是与请求URL的 PATH 组成部分或请求报文的标头部分 header 。④ 最后才可到达 Route 进行 direct_response 、redirect 等。\n官方手册\nEnvoy通过内置的L4过滤器HTTP连接管理器将原始字节转换为HTTP应用层协议级别的消息和事件，例如接收到的标头和主体等，以及处理所有HTTP连接和请求共有的功能，包括访问日志、生成和跟踪请求ID，请求/响应头处理、路由表管理和统计信息等；\n支持HTTP/1.1、WebSockets和HTTP/2，但不支持SPDY; 关联的路由表可静态配置，亦可经由 xDS API 中的 RDS 动态生成； 内建重试插件，可用于配置重试行为; Host Predicates Priority Predicates 内建支持302重定向，它可以捕获302重定向响应，合成新请求后将其发送到新的路由匹配（match）所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端\n支持适用于HTTP连接及其组成流（constituent streams）的多种可配置超时机制\n连接级别：空闲超时和排空超时（GOAWAY）； 流级别：空闲超时、每路由相关的上游端点超时和每路由相关的 gRPC 最大超时时长； 基于自定义集群的动态转发代理； HTTP协议相关的功能通过各HTTP过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；\nrouter envoy.router 是最常的过滤器之一，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；\nHTTP 路由 Envoy基于HTTP router过滤器基于路由表完成多种高级路由机制，例如:\n将域名映射到虚拟主机； path的前级 prefix 匹配、精确匹配或正则表达式匹配； 虚拟主机级别的TLS重定向； path级别的 path/host 重定向； direct_response ，由Envoy直接生成响应报文 ； 显式 host rewrite； prefix rewrite； 基于HTTP标头或路由配置的请求重试与请求超时； 基于运行时参数的流量迁移； 基于权重或百分比的跨集群流量分割； 基于任意标头匹配路由规则； 基于优先级的路由； 基于hash策略的路由； 路由配置和虚拟主机 路由配置中的顶级元素是虚拟主机\n每个虚拟主机都有一个逻辑名称以及一组域名，请求报文中的主机头将根据此处的域名进行路由；单个侦听器可以服务于多个顶级域。\n基于域名选择虚拟主机后，将基于配置的路由机制完成请求路由或进行重定向；\njson 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 { \"name\" : \"...\", \"domains\" : [], \"routes\" : [], \"require_tls\" : \"\", \"virtual_clusters\": [], \"rate_limits\": [], \"request_headers_to_add\": [], \"request_headers_to_remote\": [], \"response_headers_to_add\": [], \"response_headers_to_remove\": [], \"cors\": \"{...}\", \"pre_filter_config\": \"{}\", \"typed_per_filter_config\": \"{}\", \"include_request_attempt_count\": \"..\", \"retry_policy\": \"{...}\", \"hedge_policy\": \"{...}\" } 虚拟主机级别的路由策略用于为相关的路由属性提供默认配置，用户也可在路由配置上自定义用到的路由属性，例如限流、CORS和重试机制等；\nRoute及配置框架 Envoy匹配路由时，它基于如下工作过程进行：\nHost；检测HTTP请求的host标头或；authority，并将其同路由配置中定义的虚拟主机作匹配检查；\n将域名映射到虚拟主机 将请求报文中的host标头值依次与路由表中定义的各Virtualhost的domain属性值进行比较，并与第一次匹配时终止搜索 Domain search order Exact domain names: www.ilinux.io. Suffix domain wildcards: *.ilinux.io or *-envoy.ilinux.io. Prefix domain wildcards: ilinux.* or ilinux-*. Special wildcard * matching any domain. Match；在匹配到的虚拟主机配置中按顺序检查虚拟主机中的每个路由条目中的匹配条件，直到第一个匹配的为止（短路）；\n基于 prefix path regex 三者其中任何一个进行URL匹配。 可根据 headers 和 query_parameters 完成报文额外匹配。 匹配得到的报文可有三种路由机制： redirect direct_response route route；如果定义了虚拟集群，按顺序检查虚拟主机中的每个虚拟集群，直到第一个匹配的为止；\n支持 cluster 、weighted_cluster cluster_header 三者之一定义目标路由。 转发期间可根据 prefix_rewrite 和 host_rewrite 完成URL重写。\n可额外配置流量管理机制，例如：timeout retry_policy cors request_mirror_policy rate_limits 等 text 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 listeners: - name: address: {...} filter_chians: [] - filters: - name: envoy.http_connection_manager config: ... route_config: name: ... virutal_hosts: [] - name: domains: [] # 虚拟主机的域名，路由匹配时，将请求报文中的host标头值与此处列表项进行匹配检测 routes: [] # 路由条目，匹配到当前虚拟主机的请求中的path匹配检测将针对各route中有match定义条件进行; - name: ... match: {...} prefix|path|regex: ... # 记录路径前缀、路由或正则表达式三者之一定义匹配条件； route: {...} cluster|cluster_header|weighted_cluster: .. # 基于集群、请求报文中的集群标头或加权集群（流量分割）定义路由目标； virtual_clusters: [] # 为此虚拟主机定义的用于收集统计信息的虚拟集群列表； 路由配置框架\n符合匹配条件的请求要由如下三种方式之一处理\nroute：路由到指定位置。 redirect：重定向到指定位置。 direct_response：直接以给定的内容进行响应。 路由中也可按需在请求及响应报文中添加或删除响应标头\nconfig.route.v3.Route\njson 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \"name\": \"...\", \"match\": \"{...}\", \"route\": \"{...}\", \"redirect\": \"{...}\", \"direct_response\": \"{...}\", \"metadata\": \"{...}\", \"decorator\": \"{...}\", \"typed_per_filter_config\": \"{...}\", \"request_headers_to_add\": [], \"request_headers_to_remove\": [], \"response_headers_to_add\": [], \"response_headers_to_remove\": [], \"tracing\": \"{...}\", \"per_request_buffer_limit_bytes\": \"{...}\" } RouteMatch\n匹配条件是定义的检测机制，用于过滤出符合条件的请求并对其作出所需的处理，例如路由、重定向或直接响应等；\n必须要定义**prefix** 、path 和 regex 三种匹配条件中的一种形式\njson 1 2 3 4 5 6 7 8 9 10 11 12 { \"prefix\": \"...\", /* path前缀匹配条件 */ \"path\": \"...\", /* path精确匹配条件 */ \"safe_regex\": \"{...}\", /* 整个path（不包含query子串）必须制定的正则表达式匹配 */ \"connect_matcher\": \"{...}\", \"case_sensitive\": \"{...}\", \"runtime_fraction\": \"{...}\", \"headers\": [], \"query_parameters\": [], \"grpc\": \"{...}\", \"tls_context\": \"{...}\" } 除了必须设置上述三者其中之一外，还可额外完成如下限定\n区分字符大小写（case_sensitive） 匹配指定的运行键值表示的比例进行 流量迁移 runtime_fraction； 不断地修改运行时键值完成流量迁移 基于标头的路由：匹配指定的一组标头（headers）； 基于参数的路由：匹配指定的一组URL查询参数（query_parameters）； 仅匹配grpc流量（grpc）； Route.HeaderMatcher\nconfig.route.v3.HeaderMatcher\n指定的路由需要额外匹配指定的一组标头\n路由器将根据路由配置中的所有指定标头检查请求的标头\n若路由中指定的所有标头都存在于请求中且具有相同值，则匹配\n若配置中未指定标头值，则基于标头的存在性进行判断\njson 1 2 3 4 5 6 7 8 9 10 11 { \"name\": \"...\", \"exact_match\": \"...\", \"safe_regex_match\": \"{...}\", \"range_match\": \"{...}\", \"present_match\": \"...\", \"prefix_match\": \"...\", /* 默认配置，即根据制定标头的存在性进行判断 */ \"suffix_match\": \"...\", \"contains_match\": \"...\", \"invert_match\": \"...\" /* 布尔型值，用于制定是否为上面的匹配条件取反 */ } 标头及其值的上述检查机制仅能定义一个：\nexact_match：精确值匹配 regex-match：整个值与正则表达式匹配 range_mtch：值范围匹配 present_match：标头存在性匹配 prefix_match：值前缀匹配 sufix_match：值后缀匹配 invert_match：将匹配结果取反，默认为==false== route.QueryParameterMatcher\nroute.QueryParameterMatcher\n指定的路由需要额外匹配的一组URL查询参数\n路由器将根据路由配置中指定的所有查询参数检查路径头中的查询字符串\n查询参数匹配将请求的URL中查询字符串视为以 \u0026 符号分隔的 key 或 key=value 元素列表\n若存在指定的查询参数，则所有参数都必须与URL中的查询字符串匹配\n匹配条件指定为 string_match 或 present_match 其中之一。\njson 1 2 3 4 5 { \"name\": \"...\", \"string_match\": \"{...}\", /* 指定查询参数值是否应与字符串匹配。 */ \"present_match\": \"...\" /* 指定是否应存在查询参数。 */ } 路由目标 路由目标：重定向（redirect） config.route.v3.RedirectAction\n为请求响应一个301应答，从而将请求从一个URL永久重定向至另一个URL\nEnvoy支持如下重定向行为:\n协议重定向：https redirect或scheme_redirect二者只能使用其一；\n主机重定向：host_redirect口端口重定向：port_redirect\n路径重定向：path_redirect口路径前级重定向：prefix_redirect\n重设响应码：response_code，默认为301；\nstrip_query：是否在重定向期间删除URL中的查询参数，默认为false；\njson 1 2 3 4 5 6 7 8 9 10 { \"https_redirect\": \"...\", \"scheme_redirect\": \"...\", \"host_redirect\": \"...\", \"port_redirect\": \"...\", \"path_redirect\": \"...\", \"prefix_rewrite\": \"...\", \"response_code\": \"...\", \"strip_query\": \"...\" } 路由目标：直接相应请求（direct_response） config.route.v3.DirectResponseAction\nEnvoy可以直接相应请求，而不将请求代理至上游主机\njson 1 2 3 4 { \"status\": \"...\", \"body\": \"{...}\" } 响应码可由status直接给出 响应正文可省略，默认为空；需要指定时应该由body通过如下三种方式之一给出数据源: filename: 本地文件数据源 inline_bytes: 配置中给出内嵌的byte类型 （unsigned char） inline_string：配置中内嵌的字符串。 路由目标：路由到指定集群（route） 匹配到的流量可路由至如下三种目标之一\ncluster：指定的上游集群； cluster_header：在请求标头中设置cluster_header的值指定的上游集群； weighted_clusters：基于权重将请求路由至多个上游集群，进行流量分割； json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 { \"cluster\": \"...\", /* 路由到的目标集群 */ \"cluster_header\": \"...\", \"weighted_clusters\": \"{...}\", /* 将流量路由并按权重分配到多个上游集群 */ \"cluster_not_found_response_code\": \"...\", \"metadata_match\": \"{...}\", \"prefix_rewrite\": \"...\", \"regex_rewrite\": \"{...}\", \"host_rewrite_literal\": \"...\", \"auto_host_rewrite\": \"{...}\", \"host_rewrite_header\": \"...\", \"host_rewrite_path_regex\": \"{...}\", \"timeout\": \"{...}\", \"idle_timeout\": \"{...}\", \"retry_policy\": \"{...}\", \"request_mirror_policies\": [], \"priority\": \"...\", \"rate_limits\": [], \"include_vh_rate_limits\": \"{...}\", \"hash_policy\": [], \"cors\": \"{...}\", \"max_grpc_timeout\": \"{...}\", \"grpc_timeout_offset\": \"{...}\", \"upgrade_configs\": [], \"internal_redirect_policy\": \"{...}\", \"internal_redirect_action\": \"...\", \"max_internal_redirects\": \"{...}\", \"hedge_policy\": \"{...}\" } 常用路由策略 基础路由配置\n在match中简单通过 prefix 、path 或 regex 指定匹配条件；\n将匹配到的请求进行重定向、直接响应或路由到指定目标集群\n高级路由策略\n在match中通过 prefix、path 或 regex 指定匹配条件，并使用高级匹配机制;\n结合 runtime_fraction 按比例切割流量;\n结合 headers 按指定的标头路由，例如基于cookie进行，将其值分组后路由到不同目标；\n结合 query_parameters 按指定的参数路由，例如基于参数group进行，将其值分组后路由到不同的目标；\n提示：可灵活组合多种条件构建复杂的匹配机制\n复杂路由目标\n结合请求报文标头中cluster header的值进行定向路由\nweighted_clusters：将请求根据目标集群权重进行流量分割\n配置高级路由属性，例如重试、超时、CORS、限途等；\n配置示例 示例用于演示match的基本匹配机制及不同的路由方式\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 routes: - match: path: \"/service/color\" route: cluster: color - match: regex: \"^/service/.*color$\" redirect: path_redirect: \"/service/color\" - match: prefix: \"/service/version\" direct_response: status: 200 boby: inline_string: \"this page is envoy reponsed\" - match: prefix: \"/\" route: cluster: webserver 示例用于演示基于标头和查询参数的匹配；\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 routes: - match: prefix: \"/\" headers: - name: environment exact_match: \"2\" route: cluster: v2 - match: prefix: \"/\" query_parmeters: - name: \"user\" string_match: prefix: \"root\" route: cluster: default - match: prefix: \"/\" route: cluster: v1 docker-compose文件\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 version: '3' services: envoy: image: envoyproxy/envoy-alpine:v1.15-latest environment: - ENVOY_UID=0 ports: - 80:80 - 443:443 - 82:9901 volumes: - ./envoy.yaml:/etc/envoy/envoy.yaml networks: envoymesh: aliases: - envoy depends_on: - webserver1 - webserver2 webserver1: image: sealloong/envoy-end:latest networks: envoymesh: aliases: - service_gray - front_envoy environment: - VERSION=v1 - COLORFUL=gray expose: - 90 webserver2: image: sealloong/envoy-end:latest networks: envoymesh: aliases: - service_red - front_envoy environment: - VERSION=v1 - COLORFUL=blue expose: - 90 service_gray: image: envoyproxy/envoy-alpine:v1.15-latest environment: - ENVOY_UID=0 volumes: - ./envoy.yaml:/etc/envoy/envoy.yaml networks: envoymesh: aliases: - envoy depends_on: - webserver1 - webserver2 networks: envoymesh: {} envoy.yaml\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 admin: access_log_path: /dev/null address: socket_address: { address: 0.0.0.0, port_value: 9901 } static_resources: listeners: - name: listener_0 address: socket_address: { address: 0.0.0.0, port_value: 80 } filter_chains: - filters: - name: envoy_http_connection_manager typed_config: \"@type\": type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager stat_prefix: ingress_http codec_type: AUTO route_config: name: local_route virtual_hosts: - name: base_domain domains: [ \"studyenvoy.eu\", \"*.studyenvoy.eu\", \"*studyenvoy.*\" ] routes: - match: path: \"/service/colorful\" route: prefix_rewrite: \"/colorful\" cluster: color - match: safe_regex: google_re2: {} regex: \"^/service/.*colorful$\" redirect: path_redirect: \"/service/colorful\" - match: prefix: \"/service/version\" direct_response: status: 200 body: inline_string: \"this page is envoy reponsed\" - match: { prefix: \"/\" } route: { cluster: default } - name: \"base_parameter\" domains: [ \"*\" ] routes: - match: prefix: \"/\" headers: - name: \"version\" exact_match: \"v2\" route: cluster: \"v2\" - match: prefix: \"/\" query_parameters: - name: \"user\" string_match: prefix: \"root\" route: cluster: \"default\" - match: prefix: \"/\" route: cluster: v1 http_filters: - name: envoy.filters.http.router clusters: - name: default connect_timeout: 0.25s type: STRICT_DNS lb_policy: ROUND_ROBIN load_assignment: cluster_name: default endpoints: - lb_endpoints: - endpoint: address: socket_address: { address: default_server, port_value: 90 } health_checks: timeout: 3s interval: 30s unhealthy_threshold: 2 healthy_threshold: 2 http_health_check: path: /ping expected_statuses: start: 200 end: 201 - name: color connect_timeout: 0.25s type: STRICT_DNS lb_policy: ROUND_ROBIN load_assignment: cluster_name: color endpoints: - lb_endpoints: - endpoint: address: socket_address: { address: color_server, port_value: 90 } health_checks: timeout: 3s interval: 30s unhealthy_threshold: 2 healthy_threshold: 2 http_health_check: path: /ping expected_statuses: start: 200 end: 201 - name: v2 connect_timeout: 0.25s type: STRICT_DNS lb_policy: ROUND_ROBIN load_assignment: cluster_name: v2 endpoints: - lb_endpoints: - endpoint: address: socket_address: { address: v2_server, port_value: 90 } health_checks: timeout: 3s interval: 30s unhealthy_threshold: 2 healthy_threshold: 2 http_health_check: path: /ping expected_statuses: start: 200 end: 201 - name: v1 connect_timeout: 0.25s type: STRICT_DNS lb_policy: ROUND_ROBIN load_assignment: cluster_name: v1 endpoints: - lb_endpoints: - endpoint: address: socket_address: { address: v1_server, port_value: 90 } health_checks: timeout: 3s interval: 30s unhealthy_threshold: 2 healthy_threshold: 2 http_health_check: path: /ping expected_statuses: start: 200 end: 201 ","wordCount":"1393","inLanguage":"zh","datePublished":"2020-09-02T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2020/09/envoy-router-management/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Envoy路由管理</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2020-09-02</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1393 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>7 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/web-middleware/>#Web Middleware</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#http-%e9%93%be%e6%8e%a5%e7%ae%a1%e7%90%86 aria-label="HTTP 链接管理">HTTP 链接管理</a><ul><li><a href=#http-%e8%b7%af%e7%94%b1 aria-label="HTTP 路由">HTTP 路由</a><ul><li><a href=#%e8%b7%af%e7%94%b1%e9%85%8d%e7%bd%ae%e5%92%8c%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=路由配置和虚拟主机>路由配置和虚拟主机</a><li><a href=#route%e5%8f%8a%e9%85%8d%e7%bd%ae%e6%a1%86%e6%9e%b6 aria-label=Route及配置框架>Route及配置框架</a></ul><li><a href=#%e8%b7%af%e7%94%b1%e7%9b%ae%e6%a0%87 aria-label=路由目标>路由目标</a><ul><li><a href=#%e8%b7%af%e7%94%b1%e7%9b%ae%e6%a0%87%e9%87%8d%e5%ae%9a%e5%90%91redirect aria-label=路由目标：重定向（redirect）>路由目标：重定向（redirect）</a><li><a href=#%e8%b7%af%e7%94%b1%e7%9b%ae%e6%a0%87%e7%9b%b4%e6%8e%a5%e7%9b%b8%e5%ba%94%e8%af%b7%e6%b1%82direct_response aria-label=路由目标：直接相应请求（direct_response）>路由目标：直接相应请求（direct_response）</a><li><a href=#%e8%b7%af%e7%94%b1%e7%9b%ae%e6%a0%87%e8%b7%af%e7%94%b1%e5%88%b0%e6%8c%87%e5%ae%9a%e9%9b%86%e7%be%a4route aria-label=路由目标：路由到指定集群（route）>路由目标：路由到指定集群（route）</a></ul><li><a href=#%e5%b8%b8%e7%94%a8%e8%b7%af%e7%94%b1%e7%ad%96%e7%95%a5 aria-label=常用路由策略>常用路由策略</a><li><a href=#%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b aria-label=配置示例>配置示例</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=http-链接管理>HTTP 链接管理<a hidden class=anchor aria-hidden=true href=#http-链接管理>#</a></h2><p>envoy处理用户请求逻辑</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20200919165020447.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20200919165020447.png#center alt=image-20200919165020447 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>① 用户请求报文到达七层过滤器链处理机制后，首先根据请求HTTP报文中的 <code>Host</code> 首部来完成虚拟主机的选择；② 由此虚拟机主机内部的 <strong><code>Route</code></strong> 表项进行处理。③ 后由 <code>match</code> 进行匹配; <code>Match</code> 是与请求URL的 <code>PATH</code> 组成部分或请求报文的标头部分 <code>header</code> 。④ 最后才可到达 <code>Route</code> 进行 <code>direct_response</code> 、<code>redirect</code> 等。</p><p><a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_routing target=_blank rel="noopener nofollow noreferrer">官方手册</a></p><p>Envoy通过内置的L4过滤器HTTP连接管理器将原始字节转换为HTTP应用层协议级别的消息和事件，例如接收到的标头和主体等，以及处理所有HTTP连接和请求共有的功能，包括访问日志、生成和跟踪请求ID，请求/响应头处理、路由表管理和统计信息等；</p><ul><li>支持HTTP/1.1、WebSockets和HTTP/2，但不支持SPDY;</li><li>关联的路由表可静态配置，亦可经由 <code>xDS API</code> 中的 <code>RDS</code> 动态生成；</li><li>内建重试插件，可用于配置重试行为;<ul><li>Host Predicates</li><li>Priority Predicates</li></ul></li></ul><p>内建支持302重定向，它可以捕获302重定向响应，合成新请求后将其发送到新的路由匹配（match）所指定的上游端点，并将收到的响应作为对原始请求的响应返回客户端</p><p>支持适用于HTTP连接及其组成流（constituent streams）的多种可配置超时机制</p><ul><li>连接级别：空闲超时和排空超时（GOAWAY）；</li><li>流级别：空闲超时、每路由相关的上游端点超时和每路由相关的 <code>gRPC</code> 最大超时时长；</li><li>基于自定义集群的动态转发代理；</li></ul><p>HTTP协议相关的功能通过各HTTP过滤器实现，这些过滤器大体可分为编码器、解码器和编/解码器三类；</p><p>router <code>envoy.router</code> 是最常的过滤器之一，它基于路由表完成请求的转发或重定向，以及处理重试操作和生成统计信息等；</p><h3 id=http-路由>HTTP 路由<a hidden class=anchor aria-hidden=true href=#http-路由>#</a></h3><p>Envoy基于HTTP router过滤器基于路由表完成多种高级路由机制，例如:</p><ul><li>将域名映射到虚拟主机；</li><li>path的前级 <code>prefix</code> 匹配、精确匹配或正则表达式匹配；</li><li>虚拟主机级别的TLS重定向；</li><li>path级别的 <code>path/host</code> 重定向；</li><li><strong><code>direct_response</code></strong> ，由Envoy直接生成响应报文 ；</li><li>显式 <code>host rewrite</code>；</li><li><code>prefix rewrite</code>；</li><li>基于HTTP标头或路由配置的<strong>请求重试</strong>与<strong>请求超时</strong>；</li><li>基于运行时参数的流量迁移；</li><li>基于权重或百分比的跨集群流量分割；</li><li>基于任意标头匹配路由规则；</li><li>基于优先级的路由；</li><li>基于hash策略的路由；</li></ul><h4 id=路由配置和虚拟主机>路由配置和虚拟主机<a hidden class=anchor aria-hidden=true href=#路由配置和虚拟主机>#</a></h4><p>路由配置中的顶级元素是虚拟主机</p><p>每个虚拟主机都有一个逻辑名称以及一组域名，请求报文中的主机头将根据此处的域名进行路由；单个侦听器可以服务于多个顶级域。</p><p>基于域名选择虚拟主机后，将基于配置的路由机制完成请求路由或进行重定向；</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;domains&#34;</span> <span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;routes&#34;</span> <span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;require_tls&#34;</span> <span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;virtual_clusters&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rate_limits&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;request_headers_to_add&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;request_headers_to_remote&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;response_headers_to_add&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;response_headers_to_remove&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cors&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pre_filter_config&#34;</span><span class=p>:</span> <span class=s2>&#34;{}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;typed_per_filter_config&#34;</span><span class=p>:</span> <span class=s2>&#34;{}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;include_request_attempt_count&#34;</span><span class=p>:</span>  <span class=s2>&#34;..&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;retry_policy&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;hedge_policy&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>虚拟主机级别的路由策略用于为相关的路由属性提供默认配置，用户也可在路由配置上自定义用到的路由属性，例如<strong>限流</strong>、<strong>CORS</strong>和<strong>重试</strong>机制等；</p><h4 id=route及配置框架>Route及配置框架<a hidden class=anchor aria-hidden=true href=#route及配置框架>#</a></h4><p>Envoy匹配路由时，它基于如下工作过程进行：</p><ul><li><p><strong>Host</strong>；检测HTTP请求的host标头或；authority，并将其同路由配置中定义的虚拟主机作匹配检查；</p><ul><li><strong>将域名映射到虚拟主机</strong><ul><li>将请求报文中的host标头值依次与路由表中定义的各Virtualhost的domain属性值进行比较，并与第一次匹配时终止搜索</li><li>Domain search order<ul><li><strong>Exact domain names</strong>: <code>www.ilinux.io</code>.</li><li><strong>Suffix domain wildcards</strong>: <code>*.ilinux.io</code> or <code>*-envoy.ilinux.io</code>.</li><li><strong>Prefix domain wildcards</strong>: <code>ilinux.*</code> or <code>ilinux-*</code>.</li><li><strong>Special wildcard</strong> <code>*</code> matching any domain.</li></ul></li></ul></li></ul></li><li><p><strong>Match</strong>；在匹配到的虚拟主机配置中按顺序检查虚拟主机中的每个路由条目中的匹配条件，直到第一个匹配的为止（<strong>短路</strong>）；</p><ul><li>基于 <code>prefix</code> <code>path</code> <code>regex</code> 三者其中任何一个进行URL匹配。</li><li>可根据 <code>headers</code> 和 <code>query_parameters</code> 完成报文额外匹配。</li><li>匹配得到的报文可有三种路由机制：<ul><li>redirect</li><li>direct_response</li><li>route</li></ul></li></ul></li><li><p><strong>route</strong>；如果定义了虚拟集群，按顺序检查虚拟主机中的每个虚拟集群，直到第一个匹配的为止；</p><ul><li>支持 <code>cluster</code> 、<code>weighted_cluster</code> <code>cluster_header</code> 三者之一定义目标路由。</li></ul></li><li><p>转发期间可根据 <code>prefix_rewrite</code> 和 <code>host_rewrite</code> 完成URL重写。</p><ul><li>可额外配置流量管理机制，例如：<code>timeout</code> <code>retry_policy</code> <code>cors</code> <code>request_mirror_policy</code> <code>rate_limits</code> 等</li></ul></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>listeners:
</span></span><span class=line><span class=cl>- name:
</span></span><span class=line><span class=cl>  address: {...}
</span></span><span class=line><span class=cl>  filter_chians: []
</span></span><span class=line><span class=cl>  - filters:
</span></span><span class=line><span class=cl>    - name: envoy.http_connection_manager
</span></span><span class=line><span class=cl>      config:
</span></span><span class=line><span class=cl>      ...
</span></span><span class=line><span class=cl>        route_config:
</span></span><span class=line><span class=cl>          name: ...
</span></span><span class=line><span class=cl>          virutal_hosts: []
</span></span><span class=line><span class=cl>          - name: 
</span></span><span class=line><span class=cl>            domains: [] # 虚拟主机的域名，路由匹配时，将请求报文中的host标头值与此处列表项进行匹配检测
</span></span><span class=line><span class=cl>            routes: [] # 路由条目，匹配到当前虚拟主机的请求中的path匹配检测将针对各route中有match定义条件进行;
</span></span><span class=line><span class=cl>            - name: ...
</span></span><span class=line><span class=cl>              match: {...}
</span></span><span class=line><span class=cl>                prefix|path|regex: ... # 记录路径前缀、路由或正则表达式三者之一定义匹配条件；
</span></span><span class=line><span class=cl>              route: {...}
</span></span><span class=line><span class=cl>                cluster|cluster_header|weighted_cluster: .. # 基于集群、请求报文中的集群标头或加权集群（流量分割）定义路由目标；
</span></span><span class=line><span class=cl>            virtual_clusters: [] # 为此虚拟主机定义的用于收集统计信息的虚拟集群列表；</span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>路由配置框架</strong></p></blockquote><p>符合匹配条件的请求要由如下三种方式之一处理</p><ul><li><strong>route</strong>：路由到指定位置。</li><li><strong>redirect</strong>：重定向到指定位置。</li><li><strong>direct_response</strong>：直接以给定的内容进行响应。</li></ul><p>路由中也可按需在请求及响应报文中添加或删除响应标头</p><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-route target=_blank rel="noopener nofollow noreferrer">config.route.v3.Route</a></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;match&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;route&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;redirect&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;direct_response&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;decorator&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;typed_per_filter_config&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;request_headers_to_add&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;request_headers_to_remove&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;response_headers_to_add&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;response_headers_to_remove&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tracing&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;per_request_buffer_limit_bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>RouteMatch</strong></p></blockquote><p>匹配条件是定义的检测机制，用于过滤出符合条件的请求并对其作出所需的处理，例如路由、重定向或直接响应等；</p><p>必须要定义**<code>prefix</code>** 、<strong><code>path</code></strong> 和 <strong><code>regex</code></strong> 三种匹配条件中的一种形式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span> 			<span class=err>/*</span> <span class=err>path前缀匹配条件</span> <span class=err>*/</span>  
</span></span><span class=line><span class=cl>  <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span> 			<span class=err>/*</span> <span class=err>path精确匹配条件</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;safe_regex&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span> 	<span class=err>/*</span> <span class=err>整个path（不包含query子串）必须制定的正则表达式匹配</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;connect_matcher&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;case_sensitive&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;runtime_fraction&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;headers&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;query_parameters&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;grpc&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tls_context&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>除了必须设置上述三者其中之一外，还可额外完成如下限定</p><ul><li>区分字符大小写（case_sensitive）</li><li>匹配指定的运行键值表示的比例进行 <font color=#f8070d size=2><strong>流量迁移</strong></font> <code>runtime_fraction</code>；<ul><li>不断地修改运行时键值完成流量迁移</li></ul></li><li><font color=#f8070d size=2>基于标头的路由：</font>匹配指定的一组标头（headers）；</li><li><font color=#f8070d size=2>基于参数的路由：</font>匹配指定的一组URL查询参数（query_parameters）；</li><li>仅匹配grpc流量（grpc）；</li></ul><blockquote><p><strong>Route.HeaderMatcher</strong></p></blockquote><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-headermatcher target=_blank rel="noopener nofollow noreferrer">config.route.v3.HeaderMatcher</a></p><p>指定的路由需要额外匹配指定的一组标头</p><p>路由器将根据路由配置中的所有指定标头检查请求的标头</p><p>若路由中指定的所有标头都存在于请求中且具有相同值，则匹配</p><p>若配置中未指定标头值，则基于标头的存在性进行判断</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;exact_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;safe_regex_match&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;range_match&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;present_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>  <span class=err>/*</span> <span class=err>默认配置，即根据制定标头的存在性进行判断</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;suffix_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>  
</span></span><span class=line><span class=cl>  <span class=nt>&#34;contains_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;invert_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span>   <span class=err>/*</span> <span class=err>布尔型值，用于制定是否为上面的匹配条件取反</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>标头及其值的上述检查机制仅能定义一个：</p><ul><li>exact_match：精确值匹配</li><li>regex-match：整个值与正则表达式匹配</li><li>range_mtch：值范围匹配</li><li>present_match：标头存在性匹配</li><li>prefix_match：值前缀匹配</li><li>sufix_match：值后缀匹配</li><li>invert_match：将匹配结果取反，默认为==false==</li></ul><blockquote><p><strong>route.QueryParameterMatcher</strong></p></blockquote><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-queryparametermatcher target=_blank rel="noopener nofollow noreferrer">route.QueryParameterMatcher</a></p><p>指定的路由需要额外匹配的一组URL查询参数</p><p>路由器将根据路由配置中指定的所有查询参数检查路径头中的查询字符串</p><ul><li><p>查询参数匹配将请求的URL中查询字符串视为以 <font color=#f8070d size=3><strong><code>&</code></strong></font> 符号分隔的 <font color=#f8070d size=3><code>key</code></font> 或 <font color=#f8070d size=3><code>key=value</code></font> 元素列表</p></li><li><p>若存在指定的查询参数，则所有参数都必须与URL中的查询字符串匹配</p></li><li><p>匹配条件指定为 <code>string_match</code> 或 <code>present_match</code> 其中之一。</p></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;string_match&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>  <span class=err>/*</span> <span class=err>指定查询参数值是否应与字符串匹配。</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;present_match&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span>    <span class=err>/*</span> <span class=err>指定是否应存在查询参数。</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=路由目标>路由目标<a hidden class=anchor aria-hidden=true href=#路由目标>#</a></h3><h4 id=路由目标重定向redirect>路由目标：重定向（redirect）<a hidden class=anchor aria-hidden=true href=#路由目标重定向redirect>#</a></h4><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-redirectaction target=_blank rel="noopener nofollow noreferrer">config.route.v3.RedirectAction</a></p><p>为请求响应一个301应答，从而将请求从一个URL永久重定向至另一个URL</p><p><strong>Envoy支持如下重定向行为</strong>:</p><ul><li><p>协议重定向：https redirect或scheme_redirect二者只能使用其一；</p></li><li><p>主机重定向：host_redirect口端口重定向：port_redirect</p></li><li><p>路径重定向：path_redirect口路径前级重定向：prefix_redirect</p></li><li><p>重设响应码：response_code，默认为301；</p></li><li><p>strip_query：是否在重定向期间删除URL中的查询参数，默认为false；</p></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;https_redirect&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scheme_redirect&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;host_redirect&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;port_redirect&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;path_redirect&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix_rewrite&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;response_code&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;strip_query&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=路由目标直接相应请求direct_response>路由目标：直接相应请求（direct_response）<a hidden class=anchor aria-hidden=true href=#路由目标直接相应请求direct_response>#</a></h4><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto#envoy-v3-api-msg-config-route-v3-directresponseaction target=_blank rel="noopener nofollow noreferrer">config.route.v3.DirectResponseAction</a></p><p>Envoy可以直接相应请求，而不将请求代理至上游主机</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><ul><li>响应码可由status直接给出</li><li>响应正文可省略，默认为空；需要指定时应该由body通过如下三种方式之一给出数据源:<ul><li>filename: 本地文件数据源</li><li>inline_bytes: 配置中给出内嵌的byte类型 （unsigned char）</li><li>inline_string：配置中内嵌的字符串。</li></ul></li></ul><h4 id=路由目标路由到指定集群route>路由目标：路由到指定集群（route）<a hidden class=anchor aria-hidden=true href=#路由目标路由到指定集群route>#</a></h4><p>匹配到的流量可路由至如下三种目标之一</p><ul><li>cluster：指定的上游集群；</li><li>cluster_header：在请求标头中设置cluster_header的值指定的上游集群；</li><li>weighted_clusters：基于权重将请求路由至多个上游集群，进行流量分割；</li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cluster&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>  <span class=err>/*</span> <span class=err>路由到的目标集群</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cluster_header&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;weighted_clusters&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>   <span class=err>/*</span> <span class=err>将流量路由并按权重分配到多个上游集群</span> <span class=err>*/</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cluster_not_found_response_code&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metadata_match&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix_rewrite&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;regex_rewrite&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;host_rewrite_literal&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;auto_host_rewrite&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;host_rewrite_header&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;host_rewrite_path_regex&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timeout&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;idle_timeout&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;retry_policy&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;request_mirror_policies&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;priority&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;rate_limits&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;include_vh_rate_limits&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;hash_policy&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cors&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;max_grpc_timeout&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;grpc_timeout_offset&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;upgrade_configs&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;internal_redirect_policy&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;internal_redirect_action&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;max_internal_redirects&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;hedge_policy&#34;</span><span class=p>:</span> <span class=s2>&#34;{...}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=常用路由策略>常用路由策略<a hidden class=anchor aria-hidden=true href=#常用路由策略>#</a></h3><p><strong>基础路由配置</strong></p><ul><li><p>在match中简单通过 <font color=#f8070d size=3><code>prefix</code></font> 、<font color=#f8070d size=3><code>path</code></font> 或 <font color=#f8070d size=3><code>regex</code></font> 指定匹配条件；</p></li><li><p>将匹配到的请求进行重定向、直接响应或路由到指定目标集群</p></li></ul><p><strong>高级路由策略</strong></p><ul><li><p>在match中通过 <font color=#f8070d size=3><code>prefix</code></font>、<font color=#f8070d size=3><code>path</code></font> 或 <font color=#f8070d size=3><code>regex</code></font> 指定匹配条件，并使用高级匹配机制;</p></li><li><p>结合 <font color=#f8070d size=3><code>runtime_fraction</code></font> 按比例切割流量;</p></li><li><p>结合 <font color=#f8070d size=3><code>headers</code></font> 按指定的标头路由，例如基于cookie进行，将其值分组后路由到不同目标；</p></li><li><p>结合 <font color=#f8070d size=3><code>query_parameters</code></font> 按指定的参数路由，例如基于参数group进行，将其值分组后路由到不同的目标；</p><hr><p><strong>提示</strong>：可灵活组合多种条件构建复杂的匹配机制</p><hr></li></ul><p><strong>复杂路由目标</strong></p><ul><li><p>结合请求报文标头中cluster header的值进行定向路由</p></li><li><p><font color=#f8070d size=3><code>weighted_clusters</code></font>：将请求根据目标集群权重进行流量分割</p></li><li><p>配置<font color=#f8070d size=2>高级路由属性</font>，例如重试、超时、CORS、限途等；</p></li></ul><h3 id=配置示例>配置示例<a hidden class=anchor aria-hidden=true href=#配置示例>#</a></h3><p>示例用于演示match的基本匹配机制及不同的路由方式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/service/color&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>color</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>regex</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;^/service/.*color$&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redirect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path_redirect</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/service/color&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/service/version&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>direct_response</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>boby</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>inline_string</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;this page is envoy reponsed&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>webserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span></span></span></code></pre></td></tr></table></div></div></div></div><p>示例用于演示基于标头和查询参数的匹配；</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exact_match</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>query_parmeters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;user&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>string_match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;root&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>v1</span></span></span></code></pre></td></tr></table></div></div></div></div><p>docker-compose文件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>envoy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>envoyproxy/envoy-alpine:v1.15-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ENVOY_UID=0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>80</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>443</span><span class=p>:</span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>82</span><span class=p>:</span><span class=m>9901</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>./envoy.yaml:/etc/envoy/envoy.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envoymesh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>aliases</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>envoy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>webserver1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>webserver2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>webserver1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>sealloong/envoy-end:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envoymesh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>aliases</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>service_gray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>front_envoy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>VERSION=v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>COLORFUL=gray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expose</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>90</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>webserver2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>sealloong/envoy-end:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envoymesh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>aliases</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>service_red</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>front_envoy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>VERSION=v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>COLORFUL=blue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expose</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>90</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service_gray</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>envoyproxy/envoy-alpine:v1.15-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ENVOY_UID=0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>./envoy.yaml:/etc/envoy/envoy.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envoymesh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>aliases</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>envoy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>webserver1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>webserver2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>envoymesh</span><span class=p>:</span><span class=w> </span>{}</span></span></code></pre></td></tr></table></div></div></div></div><p>envoy.yaml</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>admin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>access_log_path</span><span class=p>:</span><span class=w> </span><span class=l>/dev/null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>socket_address</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>address: 0.0.0.0, port_value</span><span class=p>:</span><span class=w> </span><span class=m>9901</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>static_resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>listeners</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>listener_0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>socket_address</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>address: 0.0.0.0, port_value</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>filter_chains</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>filters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy_http_connection_manager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>typed_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;@type&#34;: </span><span class=l>type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>stat_prefix</span><span class=p>:</span><span class=w> </span><span class=l>ingress_http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>codec_type</span><span class=p>:</span><span class=w> </span><span class=l>AUTO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>route_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>local_route</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>virtual_hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>base_domain</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>domains</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;studyenvoy.eu&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;*.studyenvoy.eu&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;*studyenvoy.*&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/service/colorful&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>prefix_rewrite</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/colorful&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>color</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>safe_regex</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>google_re2</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>regex</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;^/service/.*colorful$&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>redirect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>path_redirect</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/service/colorful&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/service/version&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>direct_response</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>body</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>inline_string</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;this page is envoy reponsed&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>route</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>default }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;base_parameter&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>domains</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;*&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;version&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>exact_match</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>query_parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;user&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>string_match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;root&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;default&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>http_filters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>envoy.filters.http.router</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connect_timeout</span><span class=p>:</span><span class=w> </span><span class=m>0.</span><span class=l>25s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>STRICT_DNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lb_policy</span><span class=p>:</span><span class=w> </span><span class=l>ROUND_ROBIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>load_assignment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cluster_name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>lb_endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>endpoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>socket_address</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>address: default_server, port_value</span><span class=p>:</span><span class=w> </span><span class=m>90</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health_checks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>3s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unhealthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>healthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http_health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/ping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expected_statuses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>start</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>end</span><span class=p>:</span><span class=w> </span><span class=m>201</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>color</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connect_timeout</span><span class=p>:</span><span class=w> </span><span class=m>0.</span><span class=l>25s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>STRICT_DNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lb_policy</span><span class=p>:</span><span class=w> </span><span class=l>ROUND_ROBIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>load_assignment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cluster_name</span><span class=p>:</span><span class=w> </span><span class=l>color</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>lb_endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>endpoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>socket_address</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>address: color_server, port_value</span><span class=p>:</span><span class=w> </span><span class=m>90</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health_checks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>3s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unhealthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>healthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http_health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/ping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expected_statuses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>start</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>end</span><span class=p>:</span><span class=w> </span><span class=m>201</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connect_timeout</span><span class=p>:</span><span class=w> </span><span class=m>0.</span><span class=l>25s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>STRICT_DNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lb_policy</span><span class=p>:</span><span class=w> </span><span class=l>ROUND_ROBIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>load_assignment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cluster_name</span><span class=p>:</span><span class=w> </span><span class=l>v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>lb_endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>endpoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>socket_address</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>address: v2_server, port_value</span><span class=p>:</span><span class=w> </span><span class=m>90</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health_checks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>3s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unhealthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>healthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http_health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/ping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expected_statuses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>start</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>end</span><span class=p>:</span><span class=w> </span><span class=m>201</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connect_timeout</span><span class=p>:</span><span class=w> </span><span class=m>0.</span><span class=l>25s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>STRICT_DNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lb_policy</span><span class=p>:</span><span class=w> </span><span class=l>ROUND_ROBIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>load_assignment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cluster_name</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>lb_endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>endpoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>socket_address</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>address: v1_server, port_value</span><span class=p>:</span><span class=w> </span><span class=m>90</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>health_checks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>3s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>unhealthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>healthy_threshold</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http_health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/ping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expected_statuses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>start</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>end</span><span class=p>:</span><span class=w> </span><span class=m>201</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：Envoy路由管理</p><p>文章链接：<a href=https://www.oomkill.com/2020/09/envoy-router-management/ target=_blank>https://www.oomkill.com/2020/09/envoy-router-management/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2020/09/envoy-tls-configuration/><span>Envoy TLS 配置</span></a></li><li><a href=/2020/09/envoy-health-check/><span>Envoy健康状态监测</span></a></li><li><a href=/2020/09/envoy-fundamental/><span>Envoy基础</span></a></li><li><a href=/2020/09/envoy-administartion/><span>Envoy管理</span></a></li><li><a href=/2020/09/envoy-deployment/><span>Envoy部署</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/web-middleware/>Web Middleware</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2020/09/envoy-traffic-management/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>envoy流量管理</span>
</a><a class=next href=https://www.oomkill.com/2020/09/service-mesh-security/><span class=title></span>
<span>服务网格安全体系&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/envoy-router-management","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>