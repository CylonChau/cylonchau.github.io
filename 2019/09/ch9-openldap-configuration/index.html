<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>理解ldap配置 - openldap中的一些高级配置 | Cylon's Collection</title>
<meta name=keywords content="ldap,linux,openldap中的一些高级配置"><meta name=description content="memberOf 默认情况下，openldap提供的Posixgroup组，实际上并不能很有效的区分组与用户之间的关系。而 memberOf 则可以有效地检索用户与组的关系
在OpenLDAP配置MemberOf模块 步骤一：可以检查在允许的slapd服务是否已经启用该模块
bash 1 $ slapcat -n 0 | grep olcModuleLoad 对于新部署的服务，可以按照如下方式添加
text 1 2 3 4 dn: cn=module,cn=config objectClass: olcModuleList cn: module olcModuleload: memberof.la 可以在线更改一个正在运行的slapd服务，使其加载 memberOf 模块，需要主义对应的 module{0} 是否正确
bash 1 2 3 4 5 6 cat << EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: memberof.la EOF 步骤二：配置overlay
在官方指南中看到olcOverlay 必须要配置到特定数据库的子条目。即此配置段需要在database配置后面。
Overlays must be configured as child entries of a specific database."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2019/09/ch9-openldap-configuration/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2019/09/ch9-openldap-configuration/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="理解ldap配置 - openldap中的一些高级配置"><meta property="og:description" content="memberOf 默认情况下，openldap提供的Posixgroup组，实际上并不能很有效的区分组与用户之间的关系。而 memberOf 则可以有效地检索用户与组的关系
在OpenLDAP配置MemberOf模块 步骤一：可以检查在允许的slapd服务是否已经启用该模块
bash 1 $ slapcat -n 0 | grep olcModuleLoad 对于新部署的服务，可以按照如下方式添加
text 1 2 3 4 dn: cn=module,cn=config objectClass: olcModuleList cn: module olcModuleload: memberof.la 可以在线更改一个正在运行的slapd服务，使其加载 memberOf 模块，需要主义对应的 module{0} 是否正确
bash 1 2 3 4 5 6 cat << EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: memberof.la EOF 步骤二：配置overlay
在官方指南中看到olcOverlay 必须要配置到特定数据库的子条目。即此配置段需要在database配置后面。
Overlays must be configured as child entries of a specific database."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2019/09/ch9-openldap-configuration/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-24T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-28T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="理解ldap配置 - openldap中的一些高级配置"><meta name=twitter:description content="memberOf 默认情况下，openldap提供的Posixgroup组，实际上并不能很有效的区分组与用户之间的关系。而 memberOf 则可以有效地检索用户与组的关系
在OpenLDAP配置MemberOf模块 步骤一：可以检查在允许的slapd服务是否已经启用该模块
bash 1 $ slapcat -n 0 | grep olcModuleLoad 对于新部署的服务，可以按照如下方式添加
text 1 2 3 4 dn: cn=module,cn=config objectClass: olcModuleList cn: module olcModuleload: memberof.la 可以在线更改一个正在运行的slapd服务，使其加载 memberOf 模块，需要主义对应的 module{0} 是否正确
bash 1 2 3 4 5 6 cat << EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: memberof.la EOF 步骤二：配置overlay
在官方指南中看到olcOverlay 必须要配置到特定数据库的子条目。即此配置段需要在database配置后面。
Overlays must be configured as child entries of a specific database."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"理解ldap配置 - openldap中的一些高级配置","item":"https://www.oomkill.com/2019/09/ch9-openldap-configuration/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"理解ldap配置 - openldap中的一些高级配置","name":"理解ldap配置 - openldap中的一些高级配置","description":"memberOf 默认情况下，openldap提供的Posixgroup组，实际上并不能很有效的区分组与用户之间的关系。而 memberOf 则可以有效地检索用户与组的关系\n在OpenLDAP配置MemberOf模块 步骤一：可以检查在允许的slapd服务是否已经启用该模块\nbash 1 $ slapcat -n 0 | grep olcModuleLoad 对于新部署的服务，可以按照如下方式添加\ntext 1 2 3 4 dn: cn=module,cn=config objectClass: olcModuleList cn: module olcModuleload: memberof.la 可以在线更改一个正在运行的slapd服务，使其加载 memberOf 模块，需要主义对应的 module{0} 是否正确\nbash 1 2 3 4 5 6 cat \u0026lt;\u0026lt; EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: memberof.la EOF 步骤二：配置overlay\n在官方指南中看到olcOverlay 必须要配置到特定数据库的子条目。即此配置段需要在database配置后面。\nOverlays must be configured as child entries of a specific database.","keywords":["ldap","linux","openldap中的一些高级配置"],"articleBody":"memberOf 默认情况下，openldap提供的Posixgroup组，实际上并不能很有效的区分组与用户之间的关系。而 memberOf 则可以有效地检索用户与组的关系\n在OpenLDAP配置MemberOf模块 步骤一：可以检查在允许的slapd服务是否已经启用该模块\nbash 1 $ slapcat -n 0 | grep olcModuleLoad 对于新部署的服务，可以按照如下方式添加\ntext 1 2 3 4 dn: cn=module,cn=config objectClass: olcModuleList cn: module olcModuleload: memberof.la 可以在线更改一个正在运行的slapd服务，使其加载 memberOf 模块，需要主义对应的 module{0} 是否正确\nbash 1 2 3 4 5 6 cat \u003c\u003c EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: memberof.la EOF 步骤二：配置overlay\n在官方指南中看到olcOverlay 必须要配置到特定数据库的子条目。即此配置段需要在database配置后面。\nOverlays must be configured as child entries of a specific database. [1]\ntext 1 2 3 4 5 6 7 8 9 10 11 dn: olcOverlay={0}memberof,olcDatabase={2}hdb,cn=config objectClass: olcConfig objectClass: olcMemberOf objectClass: olcOverlayConfig objectClass: top olcOverlay: memberof olcMemberOfDangling: ignore olcMemberOfRefInt: TRUE olcMemberOfGroupOC: groupOfUniqueNames olcMemberOfMemberAD: uniqueMember olcMemberOfMemberOfAD: memberOf 步骤三：配置refint\nrefint为 (referential integrity)，所引用完整性。是保持属性与所引用的条目保持一致。在使用 memberOf 时，当一个用户被归为 memberOf 组时，会存在 memberOf 的属性。当这个用户组重命名或删除时，refintOverlay 将自动修改或删除对应的属性。\nldif dn: olcOverlay=refint,olcDatabase={2}hdb,cn=config\robjectClass: olcConfig\robjectClass: olcOverlayConfig\robjectClass: olcRefintConfig\robjectClass: top\rolcOverlay: refint\rolcRefintAttribute: memberOf uniqueMember uid cn ## 哪些属性被改动时修改其他所属关系。 步骤四：配置memberOf\n新建一个groupOfUniqueNames用户组，将用户放入组内\ntext 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: ou=tvb,dc=test,dc=com objectClass: organizationalUnit ou: tvb dn: cn=adminGroup,ou=tvb,dc=test,dc=com objectClass: groupOfUniqueNames cn: adminGroup uniqueMember: uid=admin,ou=tvb,dc=test,dc=com dn: cn=dirGroup,ou=tvb,dc=test,dc=com objectClass: groupOfUniqueNames cn: dirGroup uniqueMember: uid=searchUser,ou=tvb,dc=test,dc=com dn: cn=confGroup,ou=tvb,dc=test,dc=com objectClass: groupOfUniqueNames cn: confGroup uniqueMember: uid=syncUser,ou=tvb,dc=test,dc=com EOF 创建测试用户\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: uid=syncUser,ou=tvb,dc=test,dc=com objectClass: inetOrgPerson objectClass: organizationalPerson objectClass: person objectClass: posixAccount uid: syncUser cn: syncUser uidNumber: 10006 gidNumber: 10002 userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6 homeDirectory: /home/syncUser loginShell: /bin/bash sn: syncUser givenName: syncUser memberOf: cn=confGroup,ou=tvb,dc=test,dc=com dn: uid=searchUser,ou=tvb,dc=test,dc=com objectClass: inetOrgPerson objectClass: organizationalPerson objectClass: person objectClass: posixAccount uid: searchUser cn: searchUser uidNumber: 10005 gidNumber: 10001 homeDirectory: /home/searchUser loginShell: /bin/bash userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6 sn: searchUser givenName: searchUser memberOf: cn=dirGroup,ou=tvb,dc=test,dc=com dn: uid=admin,ou=tvb,dc=test,dc=com objectClass: inetOrgPerson objectClass: organizationalPerson objectClass: person objectClass: posixAccount uid: admin cn: admin uidNumber: 0 gidNumber: 0 homeDirectory: /home/admin loginShell: /bin/bash userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6 sn: admin givenName: admin memberOf: cn=adminGroup,ou=tvb,dc=test,dc=com dn: uid=admin1,ou=tvb,dc=test,dc=com objectClass: inetOrgPerson objectClass: organizationalPerson objectClass: person objectClass: posixAccount uid: admin1 cn: admin uidNumber: 0 gidNumber: 0 homeDirectory: /home/admin loginShell: /bin/bash userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6 sn: admin givenName: admin memberOf: cn=adminGroup,ou=tvb,dc=test,dc=com EOF 查看用户的memberof属性\ntext 1 $ ldapsearch -x -H ldaps://10.0.0.4 -b dc=test,dc=com -D \"cn=admin,dc=test,dc=com\" -w 111 memberOf Referential Integrity 引用完整 (Referential Integrity) 模块是指在两个属性互相引用时，如果自动修改或删除了一端的值，将保持另一端也能够保持一致性，删除或更新。\n例如下面示例，uid=eve,ou=users,dc=tvb,dc=com 是一个管理员用户，uid=mallory,ou=users,dc=tvb,dc=com 是一个普通用户，普通用户mallory的管理员是eve用户，当eve用户修改名称或者被删除时，mallory对应的 manager 也应该保持更新或删除\nldif dn: uid=eve,ou=users,dc=tvb,dc=com\robjectClass: posixAccount\robjectClass: shadowAccount\robjectClass: inetOrgPerson\rcn: Eve\rsn: Eavesdropper\ruid: eve\ruidNumber: 5000\rgidNumber: 5000\rhomeDirectory: /home/eve\rloginShell: /bin/sh\rgecos: Eve Eavesdropper\rdn: uid=mallory,ou=users,dc=tvb,dc=com\robjectClass: posixAccount\robjectClass: shadowAccount\robjectClass: inetOrgPerson\rcn: Mallory\rsn: Malicious\ruid: eve\ruidNumber: 5001\rgidNumber: 5000\rhomeDirectory: /home/mallory\rloginShell: /bin/sh\rgecos: Mallory Malicious\rmanager: uid=eve,ou=users,dc=tvb,dc=com 在OpenLDAP配置Referential Integrity模块 步骤一：可以检查在允许的slapd服务是否已经启用该模块\nbash 1 $ slapcat -n 0 | grep olcModuleLoad 可以在线更改一个正在运行的slapd服务，使其加载 refint 模块，需要主义对应的 module{0} 是否正确\nbash 1 2 3 4 5 6 cat \u003c\u003c EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: refint.la EOF 另外如果 模块目录不为标准的路径，也需要配置 olcModulePath ，当然这个参数只能指定一次\nldif dn: cn=module,cn=config\rcn: module objectClass: olcModuleList\rolcModulePath: /opt/openldap-current/libexec/openldap\rolcModuleLoad: refint.la 下表是关于各操作系统内置 openldap 服务模块的标准路径\nOS PATH CentOS 7 /usr/lib64/openldap openSUSE /usr/lib64/openldap Debian (Stretch) /usr/lib/ldap Source (Default) /usr/local/libexec/openldap 由于overlay的特性，需要指定为database的子模块\nbash 1 2 3 4 5 6 7 8 $ cat \u003c\u003c EOF | ldapadd -Y EXTERNAL -H ldapi:/// dn: olcOverlay=refint,olcDatabase={1}mdb,cn=config objectClass: olcOverlayConfig objectClass: olcRefintConfig olcOverlay: refint olcRefintAttribute: manager secretary olcRefintNothing: cn=config EOF 这里需要注意的属性为：\nolcDatabase={1}mdb 数据库这里需要指定要配置的数据库 olcRefintAttribute 这个属性指明了两个条目间关联的属性 olcRefintNothing 可选参数，因为两端需要关联时，例如memberOf，组对象至少保留一个 memberOf 属性，当删除最后一个关联用户时，会提示非法，这个参数就是在删除最后一个用户时，指定一个占位符的该属性 Password Policy openldap中 Password Policy 是指用户的密码策略，如过期时间，密码安全最低要求等\n在OpenLDAP配置ppolicy模块 可以在线更改一个正在运行的slapd服务，使其加载 ppolicy 模块，需要主义对应的 module{0} 是否正确\nbash 1 2 3 4 5 6 cat \u003c\u003c EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:/// dn: cn=module{0},cn=config changetype: modify add: olcModuleLoad olcModuleLoad: ppolicy.la EOF 在加载完成后，需要叠加到database上才可以生效，如下列配置\nldif dn: olcOverlay=ppolicy,olcDatabase={1}mdb,cn=config\robjectClass: olcPPolicyConfig\rolcOverlay: ppolicy\rolcPPolicyDefault: cn=default,ou=tvb,dc=test,dc=com\rolcPPolicyUseLockout: FALSE\rolcPPolicyHashCleartext: TRUE 这里需要注意的一点是，olcPPolicyDefault 是指定的一个默认密码策略，即没有为用户配置密码策略时，将使用这个默认策略\n为用户配置默认策略 如果需要使用模块 ppolicy ，必须做下述三个步骤其一才可满足为用户密码提供一个管理策略\n需要创建一个默认策略 为用户 ldift 添加属性 pwdPolicySubentry ，这可以为不同的用户设置不同的密码策略 属性 pwdPolicy 可以作为用户 ldif 中被多次引用，这代表可以设置多种不同的策略，这种比较繁琐 场景一：创建一个默认策略\n例如在配置ppolicy的overlay时，默认策略名称填写了 cn=default,ou=tvb,dc=test,dc=com 那么需要用这个DN创建一个默认策略，而创建DN需要按层级创建，顾需要创建 ou=plicies\nbash 1 2 3 4 5 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: ou=tvb,dc=test,dc=com objectClass: organizationalUnit ou: policies EOF 接下来创建默认的密码策略\nbash 1 2 3 4 5 6 7 8 9 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: cn=default,ou=tvb,dc=test,dc=com objectClass: pwdPolicy objectClass: organizationalRole cn: default pwdAttribute: userPassword pwdMinLength: 3 pwdCheckQuality: 2 EOF 下表是对于一些密码策略的属性说明\n属性 说明 pwdAttribute 指定那个字段是密码 pwdMinAge 多少秒之间必须经过更改密码，默认0 pwdMaxAge 密码最大期限，如果密码过期用户将被拒绝登录。 默认的是密码永不过期。 pwdInHistory 存储多少个历史旧密码，例如更改密码时提示与历史使用密码类似。 默认为0，即可以重复使用旧密码 pwdMinLength 密码的最小的长度。 默认没有长度的要求。 这个属性将与 pwdCheckQuality 同时生效，当 pwdCheckQuality 为0，则长度限制不生效 pwdCheckQuality 如何对用户长度进行检查。 默认0不检查，\n2 ：总是强制执行的质量检查；如果它不能检查它，密码就会被拒绝。\n1 ：可被接受的密码 pwdMaxFailure 密码错误几次用户被锁定，默认0 代表不会被锁定，他们是锁着的。 为了对此采取影响， 必须关联属性 pwdLockout=TRUE pwdLockout pwdLockout=TRUE 时 pwdMaxFailure 会生效，否则忽略 pwdMaxFailure 配置 pwdLockoutDuration 账户自动解锁的时间 pwdMustChange 这是当管理员创建用户后，第一次登陆时需要必须修改密码 pwdPolicySubentry 表示设置密码的策略。 DN对应适用密码政策的条目。 默认策略由 olcPPolicyDefault 属性的配置。如果不存在，会使用 olcPPolicyDefault ，当存在时会覆盖 olcPPolicyDefault 如果需要上述的策略，需要引入对象 objectClass: pwdPolicy 例如修改一个用户的密码策略\nbash 1 2 3 4 5 6 7 8 9 10 11 12 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: uid=searchUser,ou=tvb,dc=test,dc=com changetype: modify add: pwdMinLength pwdMinLength: 4 - add: pwdCheckQuality pwdCheckQuality: 2 - replace: pwdPolicySubentry pwdPolicySubentry: cn=example2,ou=tvb,dc=tvb,dc=com EOF 而上述属性 pwdPolicySubentry 代表那个策略适用于那个条目。 如果不存在则默认策略生效。如果需要引入存在的密码策略可以使用该属性进行应用。\n例如，下述是创建两天密码策略\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: cn=example1,ou=tvb,dc=test,dc=com cn: example1 objectClass: organizationalRole objectClass: pwdPolicy pwdAttribute: userPassword pwdMinLength: 5 pwdCheckQuality: 2 dn: cn=example2,ou=tvb,dc=test,dc=com cn: example2 objectClass: organizationalRole objectClass: pwdPolicy pwdAttribute: userPassword pwdMinLength: 6 pwdCheckQuality: 2 pwdMaxFailure: 3 pwdLockout: TRUE pwdLockoutDuration: 10 pwdInHistory: 5 EOF 当需要创建一个用户引用现有的一组密码策略时，可以对用户添加属性 pwdPolicySubentry，而不是重复的设置每条策略，例如下面示例\nbash 1 2 3 4 5 6 7 8 9 10 11 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.10 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: uid=admin1,ou=tvb,dc=test,dc=com changetype: modify add: pwdPolicySubentry pwdPolicySubentry: cn=example1,ou=tvb,dc=tvb,dc=com dn: uid=searchUser,ou=tvb,dc=test,dc=com changetype: modify add: pwdPolicySubentry pwdPolicySubentry: cn=example2,ou=tvb,dc=tvb,dc=com EOF Reference [1] slapd-config\n","wordCount":"963","inLanguage":"zh","datePublished":"2019-09-24T00:00:00Z","dateModified":"2022-11-28T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2019/09/ch9-openldap-configuration/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">理解ldap配置 - openldap中的一些高级配置</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2019-09-24</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>963 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>5 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/ldap/>#Ldap</a>
<a href=https://www.oomkill.com/tags/databases/>#Databases</a></ul>&nbsp;·&nbsp;<span id=busuanzi_container_page_pv>本文阅读量 <span id=busuanzi_value_page_pv></span> 次</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#memberof aria-label=memberOf>memberOf</a><ul><li><a href=#%e5%9c%a8openldap%e9%85%8d%e7%bd%aememberof%e6%a8%a1%e5%9d%97 aria-label=在OpenLDAP配置MemberOf模块>在OpenLDAP配置MemberOf模块</a></ul><li><a href=#referential-integrity aria-label="Referential Integrity">Referential Integrity</a><ul><li><a href=#%e5%9c%a8openldap%e9%85%8d%e7%bd%aereferential-integrity%e6%a8%a1%e5%9d%97 aria-label="在OpenLDAP配置Referential Integrity模块">在OpenLDAP配置Referential Integrity模块</a></ul><li><a href=#password-policy aria-label="Password Policy">Password Policy</a><ul><li><a href=#%e5%9c%a8openldap%e9%85%8d%e7%bd%aeppolicy%e6%a8%a1%e5%9d%97 aria-label=在OpenLDAP配置ppolicy模块>在OpenLDAP配置ppolicy模块</a><li><a href=#%e4%b8%ba%e7%94%a8%e6%88%b7%e9%85%8d%e7%bd%ae%e9%bb%98%e8%ae%a4%e7%ad%96%e7%95%a5 aria-label=为用户配置默认策略>为用户配置默认策略</a></ul><li><a href=#reference aria-label=Reference><strong>Reference</strong></a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=memberof>memberOf<a hidden class=anchor aria-hidden=true href=#memberof>#</a></h2><p>默认情况下，openldap提供的Posixgroup组，实际上并不能很有效的区分组与用户之间的关系。而 <code>memberOf</code> 则可以有效地检索用户与组的关系</p><h3 id=在openldap配置memberof模块>在OpenLDAP配置MemberOf模块<a hidden class=anchor aria-hidden=true href=#在openldap配置memberof模块>#</a></h3><p><strong>步骤一</strong>：可以检查在允许的slapd服务是否已经启用该模块</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ slapcat -n <span class=m>0</span> <span class=p>|</span> grep olcModuleLoad</span></span></code></pre></td></tr></table></div></div></div></div><p>对于新部署的服务，可以按照如下方式添加</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>dn: cn=module,cn=config
</span></span><span class=line><span class=cl>objectClass: olcModuleList
</span></span><span class=line><span class=cl>cn: module
</span></span><span class=line><span class=cl>olcModuleload: memberof.la</span></span></code></pre></td></tr></table></div></div></div></div><p>可以在线更改一个正在运行的slapd服务，使其加载 <code>memberOf</code> 模块，需要主义对应的 <code>module{0}</code> 是否正确</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:///
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=module{0},cn=config
</span></span></span><span class=line><span class=cl><span class=s>changetype: modify
</span></span></span><span class=line><span class=cl><span class=s>add: olcModuleLoad
</span></span></span><span class=line><span class=cl><span class=s>olcModuleLoad: memberof.la
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p><strong>步骤二</strong>：配置overlay</p><p>在官方指南中看到<code>olcOverlay</code> 必须要配置到特定数据库的子条目。即此配置段需要在database配置后面。</p><blockquote><p>Overlays must be configured as child entries of a specific database. <sup><a href=#1>[1]</a></sup></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>dn: olcOverlay={0}memberof,olcDatabase={2}hdb,cn=config
</span></span><span class=line><span class=cl>objectClass: olcConfig
</span></span><span class=line><span class=cl>objectClass: olcMemberOf
</span></span><span class=line><span class=cl>objectClass: olcOverlayConfig
</span></span><span class=line><span class=cl>objectClass: top
</span></span><span class=line><span class=cl>olcOverlay: memberof
</span></span><span class=line><span class=cl>olcMemberOfDangling: ignore
</span></span><span class=line><span class=cl>olcMemberOfRefInt: TRUE
</span></span><span class=line><span class=cl>olcMemberOfGroupOC: groupOfUniqueNames
</span></span><span class=line><span class=cl>olcMemberOfMemberAD: uniqueMember
</span></span><span class=line><span class=cl>olcMemberOfMemberOfAD: memberOf</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>步骤三</strong>：配置refint</p><p>refint为 (<em><strong>referential integrity</strong></em>)，所引用完整性。是保持属性与所引用的条目保持一致。在使用 <code>memberOf</code> 时，当一个用户被归为 <code>memberOf</code> 组时，会存在 <code>memberOf</code> 的属性。当这个用户组重命名或删除时，<code>refintOverlay</code> 将自动修改或删除对应的属性。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif>dn: olcOverlay=refint,olcDatabase={2}hdb,cn=config
objectClass: olcConfig
objectClass: olcOverlayConfig
objectClass: olcRefintConfig
objectClass: top
olcOverlay: refint
olcRefintAttribute: memberOf uniqueMember uid cn ## 哪些属性被改动时修改其他所属关系。</code></pre></div></div><p><strong>步骤四</strong>：配置memberOf</p><p>新建一个groupOfUniqueNames用户组，将用户放入组内</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>cat &lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span><span class=line><span class=cl>dn: ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>objectClass: organizationalUnit
</span></span><span class=line><span class=cl>ou: tvb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dn: cn=adminGroup,ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>objectClass: groupOfUniqueNames
</span></span><span class=line><span class=cl>cn: adminGroup
</span></span><span class=line><span class=cl>uniqueMember: uid=admin,ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dn: cn=dirGroup,ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>objectClass: groupOfUniqueNames
</span></span><span class=line><span class=cl>cn: dirGroup
</span></span><span class=line><span class=cl>uniqueMember: uid=searchUser,ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dn: cn=confGroup,ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>objectClass: groupOfUniqueNames
</span></span><span class=line><span class=cl>cn: confGroup
</span></span><span class=line><span class=cl>uniqueMember: uid=syncUser,ou=tvb,dc=test,dc=com
</span></span><span class=line><span class=cl>EOF</span></span></code></pre></td></tr></table></div></div></div></div><p>创建测试用户</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=syncUser,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: inetOrgPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: person
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixAccount
</span></span></span><span class=line><span class=cl><span class=s>uid: syncUser
</span></span></span><span class=line><span class=cl><span class=s>cn: syncUser
</span></span></span><span class=line><span class=cl><span class=s>uidNumber: 10006
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 10002
</span></span></span><span class=line><span class=cl><span class=s>userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6
</span></span></span><span class=line><span class=cl><span class=s>homeDirectory: /home/syncUser
</span></span></span><span class=line><span class=cl><span class=s>loginShell: /bin/bash
</span></span></span><span class=line><span class=cl><span class=s>sn: syncUser
</span></span></span><span class=line><span class=cl><span class=s>givenName: syncUser
</span></span></span><span class=line><span class=cl><span class=s>memberOf: cn=confGroup,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=searchUser,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: inetOrgPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: person
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixAccount
</span></span></span><span class=line><span class=cl><span class=s>uid: searchUser
</span></span></span><span class=line><span class=cl><span class=s>cn: searchUser
</span></span></span><span class=line><span class=cl><span class=s>uidNumber: 10005
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 10001
</span></span></span><span class=line><span class=cl><span class=s>homeDirectory: /home/searchUser
</span></span></span><span class=line><span class=cl><span class=s>loginShell: /bin/bash
</span></span></span><span class=line><span class=cl><span class=s>userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6
</span></span></span><span class=line><span class=cl><span class=s>sn: searchUser
</span></span></span><span class=line><span class=cl><span class=s>givenName: searchUser
</span></span></span><span class=line><span class=cl><span class=s>memberOf: cn=dirGroup,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=admin,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: inetOrgPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: person
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixAccount
</span></span></span><span class=line><span class=cl><span class=s>uid: admin
</span></span></span><span class=line><span class=cl><span class=s>cn: admin
</span></span></span><span class=line><span class=cl><span class=s>uidNumber: 0
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 0
</span></span></span><span class=line><span class=cl><span class=s>homeDirectory: /home/admin
</span></span></span><span class=line><span class=cl><span class=s>loginShell: /bin/bash
</span></span></span><span class=line><span class=cl><span class=s>userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6
</span></span></span><span class=line><span class=cl><span class=s>sn: admin
</span></span></span><span class=line><span class=cl><span class=s>givenName: admin
</span></span></span><span class=line><span class=cl><span class=s>memberOf: cn=adminGroup,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=admin1,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: inetOrgPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: person
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixAccount
</span></span></span><span class=line><span class=cl><span class=s>uid: admin1
</span></span></span><span class=line><span class=cl><span class=s>cn: admin
</span></span></span><span class=line><span class=cl><span class=s>uidNumber: 0
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 0
</span></span></span><span class=line><span class=cl><span class=s>homeDirectory: /home/admin
</span></span></span><span class=line><span class=cl><span class=s>loginShell: /bin/bash
</span></span></span><span class=line><span class=cl><span class=s>userPassword: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6
</span></span></span><span class=line><span class=cl><span class=s>sn: admin
</span></span></span><span class=line><span class=cl><span class=s>givenName: admin
</span></span></span><span class=line><span class=cl><span class=s>memberOf: cn=adminGroup,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>查看用户的memberof属性</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ldapsearch -x -H ldaps://10.0.0.4 -b dc=test,dc=com -D &#34;cn=admin,dc=test,dc=com&#34; -w 111 memberOf</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=referential-integrity>Referential Integrity<a hidden class=anchor aria-hidden=true href=#referential-integrity>#</a></h2><p>引用完整 (<em><strong>Referential Integrity</strong></em>) 模块是指在两个属性互相引用时，如果自动修改或删除了一端的值，将保持另一端也能够保持一致性，删除或更新。</p><p>例如下面示例，<code>uid=eve,ou=users,dc=tvb,dc=com</code> 是一个管理员用户，<code>uid=mallory,ou=users,dc=tvb,dc=com</code> 是一个普通用户，普通用户mallory的管理员是eve用户，当eve用户修改名称或者被删除时，mallory对应的 <code>manager</code> 也应该保持更新或删除</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif>dn: uid=eve,ou=users,dc=tvb,dc=com
objectClass: posixAccount
objectClass: shadowAccount
objectClass: inetOrgPerson
cn: Eve
sn: Eavesdropper
uid: eve
uidNumber: 5000
gidNumber: 5000
homeDirectory: /home/eve
loginShell: /bin/sh
gecos: Eve Eavesdropper

dn: uid=mallory,ou=users,dc=tvb,dc=com
objectClass: posixAccount
objectClass: shadowAccount
objectClass: inetOrgPerson
cn: Mallory
sn: Malicious
uid: eve
uidNumber: 5001
gidNumber: 5000
homeDirectory: /home/mallory
loginShell: /bin/sh
gecos: Mallory Malicious
manager: uid=eve,ou=users,dc=tvb,dc=com</code></pre></div></div><h3 id=在openldap配置referential-integrity模块>在OpenLDAP配置Referential Integrity模块<a hidden class=anchor aria-hidden=true href=#在openldap配置referential-integrity模块>#</a></h3><p><strong>步骤一</strong>：可以检查在允许的slapd服务是否已经启用该模块</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ slapcat -n <span class=m>0</span> <span class=p>|</span> grep olcModuleLoad</span></span></code></pre></td></tr></table></div></div></div></div><p>可以在线更改一个正在运行的slapd服务，使其加载 <code>refint</code> 模块，需要主义对应的 <code>module{0}</code> 是否正确</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:///
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=module{0},cn=config
</span></span></span><span class=line><span class=cl><span class=s>changetype: modify
</span></span></span><span class=line><span class=cl><span class=s>add: olcModuleLoad
</span></span></span><span class=line><span class=cl><span class=s>olcModuleLoad: refint.la
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>另外如果 模块目录不为标准的路径，也需要配置 <code>olcModulePath</code> ，当然这个参数只能指定一次</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif>dn: cn=module,cn=config
cn: module 
objectClass: olcModuleList
olcModulePath: /opt/openldap-current/libexec/openldap
olcModuleLoad: refint.la</code></pre></div></div><p>下表是关于各操作系统内置 openldap 服务模块的标准路径</p><table><thead><tr><th>OS</th><th>PATH</th></tr></thead><tbody><tr><td>CentOS 7</td><td>/usr/lib64/openldap</td></tr><tr><td>openSUSE</td><td>/usr/lib64/openldap</td></tr><tr><td>Debian (Stretch)</td><td>/usr/lib/ldap</td></tr><tr><td>Source (Default)</td><td>/usr/local/libexec/openldap</td></tr></tbody></table><p>由于overlay的特性，需要指定为database的子模块</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat <span class=s>&lt;&lt; EOF | ldapadd -Y EXTERNAL -H ldapi:///
</span></span></span><span class=line><span class=cl><span class=s>dn: olcOverlay=refint,olcDatabase={1}mdb,cn=config
</span></span></span><span class=line><span class=cl><span class=s>objectClass: olcOverlayConfig
</span></span></span><span class=line><span class=cl><span class=s>objectClass: olcRefintConfig
</span></span></span><span class=line><span class=cl><span class=s>olcOverlay: refint
</span></span></span><span class=line><span class=cl><span class=s>olcRefintAttribute: manager secretary
</span></span></span><span class=line><span class=cl><span class=s>olcRefintNothing: cn=config
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>这里需要注意的属性为：</p><ul><li><code>olcDatabase={1}mdb</code> 数据库这里需要指定要配置的数据库</li><li><code>olcRefintAttribute</code> 这个属性指明了两个条目间关联的属性</li><li><code>olcRefintNothing</code> 可选参数，因为两端需要关联时，例如memberOf，组对象至少保留一个 <code>memberOf</code> 属性，当删除最后一个关联用户时，会提示非法，这个参数就是在删除最后一个用户时，指定一个占位符的该属性</li></ul><h2 id=password-policy>Password Policy<a hidden class=anchor aria-hidden=true href=#password-policy>#</a></h2><p>openldap中 Password Policy 是指用户的密码策略，如过期时间，密码安全最低要求等</p><h3 id=在openldap配置ppolicy模块>在OpenLDAP配置ppolicy模块<a hidden class=anchor aria-hidden=true href=#在openldap配置ppolicy模块>#</a></h3><p>可以在线更改一个正在运行的slapd服务，使其加载 <code>ppolicy</code> 模块，需要主义对应的 <code>module{0}</code> 是否正确</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapmodify -Q -Y EXTERNAL -H ldapi:///
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=module{0},cn=config
</span></span></span><span class=line><span class=cl><span class=s>changetype: modify
</span></span></span><span class=line><span class=cl><span class=s>add: olcModuleLoad
</span></span></span><span class=line><span class=cl><span class=s>olcModuleLoad: ppolicy.la
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>在加载完成后，需要叠加到database上才可以生效，如下列配置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif>dn: olcOverlay=ppolicy,olcDatabase={1}mdb,cn=config
objectClass: olcPPolicyConfig
olcOverlay: ppolicy
olcPPolicyDefault: cn=default,ou=tvb,dc=test,dc=com
olcPPolicyUseLockout: FALSE
olcPPolicyHashCleartext: TRUE</code></pre></div></div><p>这里需要注意的一点是，<code>olcPPolicyDefault</code> 是指定的一个默认密码策略，即没有为用户配置密码策略时，将使用这个默认策略</p><h3 id=为用户配置默认策略>为用户配置默认策略<a hidden class=anchor aria-hidden=true href=#为用户配置默认策略>#</a></h3><p>如果需要使用模块 <code>ppolicy</code> ，必须做下述三个步骤其一才可满足为用户密码提供一个管理策略</p><ul><li>需要创建一个默认策略</li><li>为用户 ldift 添加属性 <code>pwdPolicySubentry</code> ，这可以为不同的用户设置不同的密码策略</li><li>属性 <code>pwdPolicy</code> 可以作为用户 ldif 中被多次引用，这代表可以设置多种不同的策略，这种比较繁琐</li></ul><p><strong>场景一</strong>：创建一个默认策略</p><p>例如在配置ppolicy的overlay时，默认策略名称填写了 <code>cn=default,ou=tvb,dc=test,dc=com</code> 那么需要用这个DN创建一个默认策略，而创建DN需要按层级创建，顾需要创建 <code>ou=plicies</code></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalUnit
</span></span></span><span class=line><span class=cl><span class=s>ou: policies
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>接下来创建默认的密码策略</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=default,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: pwdPolicy
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalRole
</span></span></span><span class=line><span class=cl><span class=s>cn: default
</span></span></span><span class=line><span class=cl><span class=s>pwdAttribute: userPassword
</span></span></span><span class=line><span class=cl><span class=s>pwdMinLength: 3
</span></span></span><span class=line><span class=cl><span class=s>pwdCheckQuality: 2
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>下表是对于一些密码策略的属性说明</p><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>pwdAttribute</td><td>指定那个字段是密码</td></tr><tr><td>pwdMinAge</td><td>多少秒之间必须经过更改密码，默认0</td></tr><tr><td>pwdMaxAge</td><td>密码最大期限，如果密码过期用户将被拒绝登录。 默认的是密码永不过期。</td></tr><tr><td>pwdInHistory</td><td>存储多少个历史旧密码，例如更改密码时提示与历史使用密码类似。 默认为0，即可以重复使用旧密码</td></tr><tr><td>pwdMinLength</td><td>密码的最小的长度。 默认没有长度的要求。 这个属性将与 <code>pwdCheckQuality</code> 同时生效，当 <code>pwdCheckQuality</code> 为0，则长度限制不生效</td></tr><tr><td>pwdCheckQuality</td><td>如何对用户长度进行检查。 默认0不检查，<br>2 ：总是强制执行的质量检查；如果它不能检查它，密码就会被拒绝。<br>1 ：可被接受的密码</td></tr><tr><td>pwdMaxFailure</td><td>密码错误几次用户被锁定，默认0 代表不会被锁定，他们是锁着的。 为了对此采取影响， 必须关联属性 <code>pwdLockout=TRUE</code></td></tr><tr><td>pwdLockout</td><td><code>pwdLockout=TRUE</code> 时 pwdMaxFailure 会生效，否则忽略 <code>pwdMaxFailure</code> 配置</td></tr><tr><td>pwdLockoutDuration</td><td>账户自动解锁的时间</td></tr><tr><td>pwdMustChange</td><td>这是当管理员创建用户后，第一次登陆时需要必须修改密码</td></tr><tr><td>pwdPolicySubentry</td><td>表示设置密码的策略。 DN对应适用密码政策的条目。 默认策略由 <code>olcPPolicyDefault</code> 属性的配置。如果不存在，会使用 <code>olcPPolicyDefault</code> ，当存在时会覆盖 <code>olcPPolicyDefault</code></td></tr></tbody></table><p>如果需要上述的策略，需要引入对象 <code>objectClass: pwdPolicy</code> 例如修改一个用户的密码策略</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=searchUser,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>changetype: modify
</span></span></span><span class=line><span class=cl><span class=s>add: pwdMinLength
</span></span></span><span class=line><span class=cl><span class=s>pwdMinLength: 4
</span></span></span><span class=line><span class=cl><span class=s>-
</span></span></span><span class=line><span class=cl><span class=s>add: pwdCheckQuality
</span></span></span><span class=line><span class=cl><span class=s>pwdCheckQuality: 2
</span></span></span><span class=line><span class=cl><span class=s>-
</span></span></span><span class=line><span class=cl><span class=s>replace: pwdPolicySubentry
</span></span></span><span class=line><span class=cl><span class=s>pwdPolicySubentry: cn=example2,ou=tvb,dc=tvb,dc=com
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>而上述属性 <code>pwdPolicySubentry</code> 代表那个策略适用于那个条目。 如果不存在则默认策略生效。如果需要引入存在的密码策略可以使用该属性进行应用。</p><p>例如，下述是创建两天密码策略</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=example1,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>cn: example1
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalRole
</span></span></span><span class=line><span class=cl><span class=s>objectClass: pwdPolicy
</span></span></span><span class=line><span class=cl><span class=s>pwdAttribute: userPassword
</span></span></span><span class=line><span class=cl><span class=s>pwdMinLength: 5
</span></span></span><span class=line><span class=cl><span class=s>pwdCheckQuality: 2
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=example2,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>cn: example2
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalRole
</span></span></span><span class=line><span class=cl><span class=s>objectClass: pwdPolicy
</span></span></span><span class=line><span class=cl><span class=s>pwdAttribute: userPassword
</span></span></span><span class=line><span class=cl><span class=s>pwdMinLength: 6
</span></span></span><span class=line><span class=cl><span class=s>pwdCheckQuality: 2
</span></span></span><span class=line><span class=cl><span class=s>pwdMaxFailure: 3
</span></span></span><span class=line><span class=cl><span class=s>pwdLockout: TRUE
</span></span></span><span class=line><span class=cl><span class=s>pwdLockoutDuration: 10
</span></span></span><span class=line><span class=cl><span class=s>pwdInHistory: 5
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>当需要创建一个用户引用现有的一组密码策略时，可以对用户添加属性 <code>pwdPolicySubentry</code>，而不是重复的设置每条策略，例如下面示例</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.10 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=admin1,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>changetype: modify
</span></span></span><span class=line><span class=cl><span class=s>add: pwdPolicySubentry
</span></span></span><span class=line><span class=cl><span class=s>pwdPolicySubentry: cn=example1,ou=tvb,dc=tvb,dc=com
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=searchUser,ou=tvb,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>changetype: modify
</span></span></span><span class=line><span class=cl><span class=s>add: pwdPolicySubentry
</span></span></span><span class=line><span class=cl><span class=s>pwdPolicySubentry: cn=example2,ou=tvb,dc=tvb,dc=com
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=reference><strong>Reference</strong><a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><p><sup id=1>[1]</sup> <a href="https://www.openldap.org/software/man.cgi?query=slapd-config&amp;sektion=5&amp;apropos=0&amp;manpath=OpenLDAP+2.4-Release#OVERLAYS" target=_blank rel="noopener nofollow noreferrer"><em><strong>slapd-config</strong></em></a></p></blockquote></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：理解ldap配置 - openldap中的一些高级配置</p><p>文章链接：<a href=https://www.oomkill.com/2019/09/ch9-openldap-configuration/ target=_blank>https://www.oomkill.com/2019/09/ch9-openldap-configuration/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2019/09/ch8-backup-and-restore/><span>理解ldap配置 - OpenLDAP备份与恢复策略</span></a></li><li><a href=/2019/09/ch7-acl/><span>理解ldap配置 - OpenLDAP访问控制（ACL）</span></a></li><li><a href=/2019/09/ch6-replication/><span>理解ldap配置 - OpenLDAP中的4种复制机制</span></a></li><li><a href=/2019/09/ch05-openldap-ssl/><span>理解ldap配置 - OpenLDAP使用SSL/TLS通信安全</span></a></li><li><a href=/2019/09/ch4-schema/><span>理解ldap配置 - OpenLDAP架构与Schema设计</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/ldap/>Ldap</a></li><li><a href=https://www.oomkill.com/tags/databases/>Databases</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2019/09/ch10-linux-with-ldap/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>理解ldap应用 - Linux系统接入OpenLDAP做认证后端</span>
</a><a class=next href=https://www.oomkill.com/2019/09/ch8-backup-and-restore/><span class=title></span>
<span>理解ldap配置 - OpenLDAP备份与恢复策略&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/ch9-openldap-configuration","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span><div class=busuanzi-footer style="font-family:helvetica neue,Helvetica,Arial,sans-serif;text-align:center;padding:4px 0;color:#999"><span id=busuanzi_container_site_pv style=margin-right:8px;font-size:.85em>本站总访问量<span id=busuanzi_value_site_pv style=font-weight:500>0</span>次
</span><span id=busuanzi_container_site_uv style=font-size:.85em>本站访客数<span id=busuanzi_value_site_uv style=font-weight:500>0</span>人次</span></div></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>