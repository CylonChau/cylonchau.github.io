<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>理解ldap - OpenLDAP安装 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="ldap,linux,openldap安装"><meta name=description content="生产服务器硬件配置需求 ldap服务对系统环境的要求不高，一般在生产场景，ldap服务应该最少是两台，这样某一台物理服务器岩机才不会因单点问题影响生产业务故障，对于硬件要求，本质上openldap使用硬件资源并不大，网上有两个帖子提出了openldap的硬件需求：
2003年openldap官网留言，我想安装一个 LDAP 服务器来验证邮件服务器的用户，目前有200个用户需要多少内存和CPU？[1] 1GHZ PIII/512MB 足以 运行于Ubuntu LXC 之上的openldap，用户150,000，sladp进程常驻内存为200-300MB，mdb数据库文件大小为377MB，10 并发平均响应时间为 9-11 毫秒 [13] 操作系统：Centos7/8 64bit。
操 作 系 统 其 它 CentOS-7.6 当前很稳定且免费的Linux版本。 网卡及IP资源
名 称 接 口 IP 用途 ldap主服务器01 eth0 10.0.0.17 外部管理IP，用于WAN数据转发。 eth1 10.0.0.17 备用管理IP，用于LAN内数据转发。 ldap从服务器02 eth0 10.0.0.8 管理IP，用于LAN数据转发。 eth1 10.0.0.18 外部管理IP，用于WAN数据转发。 Tips：内外网IP分配可采用最后8位相同的方式，这样使于管理。
openldap master服务安装 CentOS/Redhat 安装OpenLDAP组件
bash 1 2 3 4 5 6 yum install -y \ openldap \ openldap-servers \ openldap-clients \ openldap-devel \ compat-openldap Ubuntu18."><meta name=author content="cylon"><link rel=canonical href=http://localhost:1313/2019/08/ch2-install/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/favicon.ico><link rel=mask-icon href=http://localhost:1313/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/2019/08/ch2-install/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="理解ldap - OpenLDAP安装"><meta property="og:description" content="生产服务器硬件配置需求 ldap服务对系统环境的要求不高，一般在生产场景，ldap服务应该最少是两台，这样某一台物理服务器岩机才不会因单点问题影响生产业务故障，对于硬件要求，本质上openldap使用硬件资源并不大，网上有两个帖子提出了openldap的硬件需求：
2003年openldap官网留言，我想安装一个 LDAP 服务器来验证邮件服务器的用户，目前有200个用户需要多少内存和CPU？[1] 1GHZ PIII/512MB 足以 运行于Ubuntu LXC 之上的openldap，用户150,000，sladp进程常驻内存为200-300MB，mdb数据库文件大小为377MB，10 并发平均响应时间为 9-11 毫秒 [13] 操作系统：Centos7/8 64bit。
操 作 系 统 其 它 CentOS-7.6 当前很稳定且免费的Linux版本。 网卡及IP资源
名 称 接 口 IP 用途 ldap主服务器01 eth0 10.0.0.17 外部管理IP，用于WAN数据转发。 eth1 10.0.0.17 备用管理IP，用于LAN内数据转发。 ldap从服务器02 eth0 10.0.0.8 管理IP，用于LAN数据转发。 eth1 10.0.0.18 外部管理IP，用于WAN数据转发。 Tips：内外网IP分配可采用最后8位相同的方式，这样使于管理。
openldap master服务安装 CentOS/Redhat 安装OpenLDAP组件
bash 1 2 3 4 5 6 yum install -y \ openldap \ openldap-servers \ openldap-clients \ openldap-devel \ compat-openldap Ubuntu18."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/2019/08/ch2-install/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-25T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-28T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="理解ldap - OpenLDAP安装"><meta name=twitter:description content="生产服务器硬件配置需求 ldap服务对系统环境的要求不高，一般在生产场景，ldap服务应该最少是两台，这样某一台物理服务器岩机才不会因单点问题影响生产业务故障，对于硬件要求，本质上openldap使用硬件资源并不大，网上有两个帖子提出了openldap的硬件需求：
2003年openldap官网留言，我想安装一个 LDAP 服务器来验证邮件服务器的用户，目前有200个用户需要多少内存和CPU？[1] 1GHZ PIII/512MB 足以 运行于Ubuntu LXC 之上的openldap，用户150,000，sladp进程常驻内存为200-300MB，mdb数据库文件大小为377MB，10 并发平均响应时间为 9-11 毫秒 [13] 操作系统：Centos7/8 64bit。
操 作 系 统 其 它 CentOS-7.6 当前很稳定且免费的Linux版本。 网卡及IP资源
名 称 接 口 IP 用途 ldap主服务器01 eth0 10.0.0.17 外部管理IP，用于WAN数据转发。 eth1 10.0.0.17 备用管理IP，用于LAN内数据转发。 ldap从服务器02 eth0 10.0.0.8 管理IP，用于LAN数据转发。 eth1 10.0.0.18 外部管理IP，用于WAN数据转发。 Tips：内外网IP分配可采用最后8位相同的方式，这样使于管理。
openldap master服务安装 CentOS/Redhat 安装OpenLDAP组件
bash 1 2 3 4 5 6 yum install -y \ openldap \ openldap-servers \ openldap-clients \ openldap-devel \ compat-openldap Ubuntu18."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"理解ldap - OpenLDAP安装","item":"http://localhost:1313/2019/08/ch2-install/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"理解ldap - OpenLDAP安装","name":"理解ldap - OpenLDAP安装","description":"生产服务器硬件配置需求 ldap服务对系统环境的要求不高，一般在生产场景，ldap服务应该最少是两台，这样某一台物理服务器岩机才不会因单点问题影响生产业务故障，对于硬件要求，本质上openldap使用硬件资源并不大，网上有两个帖子提出了openldap的硬件需求：\n2003年openldap官网留言，我想安装一个 LDAP 服务器来验证邮件服务器的用户，目前有200个用户需要多少内存和CPU？[1] 1GHZ PIII/512MB 足以 运行于Ubuntu LXC 之上的openldap，用户150,000，sladp进程常驻内存为200-300MB，mdb数据库文件大小为377MB，10 并发平均响应时间为 9-11 毫秒 [13] 操作系统：Centos7/8 64bit。\n操 作 系 统 其 它 CentOS-7.6 当前很稳定且免费的Linux版本。 网卡及IP资源\n名 称 接 口 IP 用途 ldap主服务器01 eth0 10.0.0.17 外部管理IP，用于WAN数据转发。 eth1 10.0.0.17 备用管理IP，用于LAN内数据转发。 ldap从服务器02 eth0 10.0.0.8 管理IP，用于LAN数据转发。 eth1 10.0.0.18 外部管理IP，用于WAN数据转发。 Tips：内外网IP分配可采用最后8位相同的方式，这样使于管理。\nopenldap master服务安装 CentOS/Redhat 安装OpenLDAP组件\nbash 1 2 3 4 5 6 yum install -y \\ openldap \\ openldap-servers \\ openldap-clients \\ openldap-devel \\ compat-openldap Ubuntu18.","keywords":["ldap","linux","openldap安装"],"articleBody":"生产服务器硬件配置需求 ldap服务对系统环境的要求不高，一般在生产场景，ldap服务应该最少是两台，这样某一台物理服务器岩机才不会因单点问题影响生产业务故障，对于硬件要求，本质上openldap使用硬件资源并不大，网上有两个帖子提出了openldap的硬件需求：\n2003年openldap官网留言，我想安装一个 LDAP 服务器来验证邮件服务器的用户，目前有200个用户需要多少内存和CPU？[1] 1GHZ PIII/512MB 足以 运行于Ubuntu LXC 之上的openldap，用户150,000，sladp进程常驻内存为200-300MB，mdb数据库文件大小为377MB，10 并发平均响应时间为 9-11 毫秒 [13] 操作系统：Centos7/8 64bit。\n操 作 系 统 其 它 CentOS-7.6 当前很稳定且免费的Linux版本。 网卡及IP资源\n名 称 接 口 IP 用途 ldap主服务器01 eth0 10.0.0.17 外部管理IP，用于WAN数据转发。 eth1 10.0.0.17 备用管理IP，用于LAN内数据转发。 ldap从服务器02 eth0 10.0.0.8 管理IP，用于LAN数据转发。 eth1 10.0.0.18 外部管理IP，用于WAN数据转发。 Tips：内外网IP分配可采用最后8位相同的方式，这样使于管理。\nopenldap master服务安装 CentOS/Redhat 安装OpenLDAP组件\nbash 1 2 3 4 5 6 yum install -y \\ openldap \\ openldap-servers \\ openldap-clients \\ openldap-devel \\ compat-openldap Ubuntu18.04/22.04/20.04\nbash 1 sudo apt -y install slapd ldap-utils 默认OpenLDAP服务所使用的端口为389，此端口采用明文传输数据，数据信息得不到保障。所以可以通过配置CA及结合TLS/SASL实现数据加密传输，所使用端口为636。\n编译安装\ntext 1 2 3 4 5 6 yum install -y \\ libtool-ltdl \\ libtool-ltdl-devel \\ gcc \\ openssl \\ openssl-devel Openldap依赖的相关软件：\nhttp://www.openldap.org/doc/admin24/install.html openldap参数配置优化 openldap配置文件分为五部分\nsladp进程配置部分 frontend：是一个特殊的 olcDatabaseConfig 配置提供权限认证 database：存储的真实引擎 backend：backend在slapd中不是真是的数据库，而是提供的一种转发方式 openldap目录布局 /etc/openldap/slapd.d/*： /etc/openldap/slapd.ldif配置信息生成的文件，每修改一次配置信息，这里的东西就要重新生成。 /var/lib/ldap/*：OpenLDAP的数据文件。 /usr/share/openldap-servers/DB_CONFIG.example：模板数据库配置文件。 /usr/share/openldap-servers/slapd.ldif：默认模板配置文件。 默认OpenLdap服务所使用的端口为389，此端口采用明文传输数据，数据信息得不到保障。所以可以通过配置CA及结合TLS/SSL实现数据加密传输，所使用端口为636。\ntext 1 cp /usr/share/openldap-servers/slapd.ldif /etc/openldap/ 指定密码，不提示\ntext 1 2 $ slappasswd -s 111 {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6 ldif # 指定要搜索的后缀\rolcSuffix: dc=cylon,dc=org\r# rootdn，使用这个dn可以登录服务器\rolcRootDN: cn=admin,dc=cylon,dc=org\rolcDbDirectory: /var/lib/ldap\r# 指定ldapserver管理员密码==\rolcRootPW: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6 日志及缓存参数。 text 1 2 3 4 5 6 7 8 # 设置日志级别，记录日志信息方便调试 stats 256（日志连接/操作/结果） olcLogLevel: stats # 设置ldap可以缓存的记录数 olcDbCacheSize: 1000 # checkpoint 可以吧内存中的数据写会数据文件的操作，此设置表示每达到2048kb或者10分钟执行一次 olcDbCheckpoint: 1024 10 开启扩展schema openldap自带一些ldif文件 [10]，LDIF 是 LDAP Data Interchange Format 的缩写，是作为存储与LDAP中 ” 文本格式 “ 的数据交换格式，每个条目代表的存入LDAP中记录的属性，记录之间用空行分隔，每行都是 “属性:值” 的格式，例如我们存入LDAP中一个记录，其属性有\ndn (distinguished name) 用于标识目录中名称的唯一标识符 dc (domain component) 表示域组成，例如域名 www.mydomain.com 那么dc 应该配置为DC=www,DC=mydomain,DC=com ou (organizational unit) 这是指用户的组织，这里也可以代表用户组，例如 OU=Lawyer,OU=Developer cn (common name) 表示查询的个体对象的名称，这里可以代表用户名，服务名等，例如 cn=cylon 具有多个属性条目，在ldap中代表一条记录，例如\ntext 1 2 3 dn: cn=The Postmaster,dc=example,dc=com objectClass: organizationalRole cn: The Postmaster 而ldif文件就是定义这些属性的文件，下面是openldap安装后默认的ldif文件说明：\ncollective.ldif ：Collective Attribute 组成LDAP条目的共享属性\ncorba.ldif：Common Object Request Broker Architecture 的缩写，旨在促进部署在不同平台上的系统的通信 [2]\ncosine.ldif：Cooperation for Open Systems Interconnection Networking in Europe的缩写，用于给 cosine 与 Internet X.500 模式项目提供LDAP中的属性格式 [3]\nduaconf.ldif：Directory User Agents 的缩写，DUA是协议客户端，是向ldap或Internet X.500 DSA发起请求的一端，这是为DUA客户端提供了通用配置 [4]\ndyngroup.ldif：Dynamic Group的缩写，动态组是LDAP中的一种组，与静态组相反，DG是以URL形式为搜索条件来隐式定义一组用户。[5]\n静态组 Static Groups 使用一组DN显式定义一组用户 inetorgperson.ldif：inetOrgPerson类是 RFC2798中 定义的类。在LDAP中为 user 的父类，比如说用户密码，登录时间等属性，更多可以参考 [6]\njava.ldif：用于java的一些属性\nmisc.ldif：Miscellaneous 的简写，这里主要是一些电子邮件相关属性\nnis.ldif：Network Information Service 的缩写，NIS是一种发现机制，这里是一种server-client的目录属性，例如网络中的主机名，用户名之类 [7]\nopenldap.ldif：\npmi.ldif：Privilege Management Infrastructure 的缩写，是基于x.509的授权访问控制模型，这里是提供了基于PMI的一些属性\nppolicy.ldif：password policy 的缩写，提供了增强的密码管理功能，例如账户到期时间，锁定等\ntext 1 2 3 4 5 6 7 8 9 10 11 12 include: file:///etc/openldap/schema/collective.ldif # OpenLDAP的核心schema必须 include: file:///etc/openldap/schema/corba.ldif # include: file:///etc/openldap/schema/cosine.ldif include: file:///etc/openldap/schema/duaconf.ldif include: file:///etc/openldap/schema/dyngroup.ldif include: file:///etc/openldap/schema/inetorgperson.ldif include: file:///etc/openldap/schema/java.ldif include: file:///etc/openldap/schema/misc.ldif include: file:///etc/openldap/schema/nis.ldif include: file:///etc/openldap/schema/openldap.ldif include: file:///etc/openldap/schema/pmi.ldif include: file:///etc/openldap/schema/ppolicy.ldif 授权及安全参数配置 ldif access to dn=\"cn=subschema\" by * read\raccess to by self write by dn subtree=\"ou=sysusers,dc=test,dc=com\" read\rby anonymous auth 关于更多权限管理的说明，可以参考官方手册第八章 [12]\n提示:\n参数在文件中的先后位置不能随意动。\n空行和以“#”开头的注释行将被忽略。如果一行以空格开头，它将被认为是接着前一行的（即使前一行是注释）。\n配置syslog记录ldap服务日志配置syslog 记录ldap服务日志，默认级别为256；\nsh 1 2 echo 'local4.* /var/log/slapd.log' \u003e\u003e /etc/rsyslog.conf local4.* /var/log/slapd.log 配置LDAP数据库存放路径 注意：\nslapd.conf中设定了LDAP数据库格式为hdb，存储路径/var/1ib/ldap\ntext 1 2 3 4 cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG chown ldap.ldap /var/lib/ldap/DB_CONFIG chmod 700 /var/lib/ldap/DB_CONFIG 整合的配置 ldif #\r# See slapd-config(5) for details on configuration options.\r# This file should NOT be world readable.\r#\rdn: cn=config\robjectClass: olcGlobal\rcn: config\rolcArgsFile: /var/run/openldap/slapd.args\rolcPidFile: /var/run/openldap/slapd.pid\rolcLogLevel: stats\rolcDisallows: bind_anon\r#\r# TLS settings\r#\rolcTLSCACertificatePath: /etc/openldap/certs\rolcTLSCertificateFile: \"OpenLDAP Server\"\rolcTLSCertificateKeyFile: /etc/openldap/certs/password\r#\r# Do not enable referrals until AFTER you have a working directory\r# service AND an understanding of referrals.\r#\r#olcReferral: ldap://root.openldap.org\r#\r# Sample security restrictions\r#\tRequire integrity protection (prevent hijacking)\r#\tRequire 112-bit (3DES or better) encryption for updates\r#\tRequire 64-bit encryption for simple bind\r#\r#olcSecurity: ssf=1 update_ssf=112 simple_bind=64\r#\r# Load dynamic backend modules:\r# - modulepath is architecture dependent value (32/64-bit system)\r# - back_sql.la backend requires openldap-servers-sql package\r# - dyngroup.la and dynlist.la cannot be used at the same time\r#\r#dn: cn=module,cn=config\r#objectClass: olcModuleList\r#cn: module\r#olcModulepath:\t/usr/lib/openldap\r#olcModulepath:\t/usr/lib64/openldap\r#olcModuleload: accesslog.la\r#olcModuleload: auditlog.la\r#olcModuleload: back_dnssrv.la\r#olcModuleload: back_ldap.la\r#olcModuleload: back_mdb.la\r#olcModuleload: back_meta.la\r#olcModuleload: back_null.la\r#olcModuleload: back_passwd.la\r#olcModuleload: back_relay.la\r#olcModuleload: back_shell.la\r#olcModuleload: back_sock.la\r#olcModuleload: collect.la\r#olcModuleload: constraint.la\r#olcModuleload: dds.la\r#olcModuleload: deref.la\r#olcModuleload: dyngroup.la\r#olcModuleload: dynlist.la\r#olcModuleload: memberof.la\r#olcModuleload: pcache.la\r#olcModuleload: ppolicy.la\r#olcModuleload: refint.la\r#olcModuleload: retcode.la\r#olcModuleload: rwm.la\r#olcModuleload: seqmod.la\r#olcModuleload: smbk5pwd.la\r#olcModuleload: sssvlv.la\r#olcModuleload: syncprov.la\r#olcModuleload: translucent.la\r#olcModuleload: unique.la\r#olcModuleload: valsort.la\r#\r# Schema settings\r#\rdn: cn=schema,cn=config\robjectClass: olcSchemaConfig\rcn: schema\rinclude: file:///etc/openldap/schema/core.ldif\rinclude: file:///etc/openldap/schema/collective.ldif\rinclude: file:///etc/openldap/schema/corba.ldif\rinclude: file:///etc/openldap/schema/cosine.ldif\rinclude: file:///etc/openldap/schema/duaconf.ldif\rinclude: file:///etc/openldap/schema/dyngroup.ldif\rinclude: file:///etc/openldap/schema/inetorgperson.ldif\rinclude: file:///etc/openldap/schema/java.ldif\rinclude: file:///etc/openldap/schema/misc.ldif\rinclude: file:///etc/openldap/schema/nis.ldif\rinclude: file:///etc/openldap/schema/openldap.ldif\rinclude: file:///etc/openldap/schema/pmi.ldif\rinclude: file:///etc/openldap/schema/ppolicy.ldif\r#\r# Frontend settings\r#\r# 这里是对前端权限的配置，通常默认，不添加权限\rdn: olcDatabase=frontend,cn=config\robjectClass: olcDatabaseConfig\robjectClass: olcFrontendConfig\rolcDatabase: frontend\r#\r# Sample global access control policy:\r#\tRoot DSE: allow anyone to read it\r#\tSubschema (sub)entry DSE: allow anyone to read it\r#\tOther DSEs:\r#\tAllow self write access\r#\tAllow authenticated users read access\r#\tAllow anonymous users to authenticate\r#\r#olcAccess: to dn.base=\"\" by * read\r#olcAccess: to dn.base=\"cn=Subschema\" by * read\r#olcAccess: to *\r#\tby self write\r#\tby users read\r#\tby anonymous auth\r#\r# if no access controls are present, the default policy\r# allows anyone and everyone to read anything but restricts\r# updates to rootdn. (e.g., \"access to * by * read\")\r#\r# rootdn can always read and write EVERYTHING!\r#\r#\r# Configuration database\r#\r# 这里是对后端数据库权限的配置\rdn: olcDatabase=config,cn=config\robjectClass: olcDatabaseConfig\rolcDatabase: config\rolcAccess: to attrs=userPassword,shadowLastChange\rby dn.children=\"cn=admin,dc=test,dc=com\" write\rby anonymous auth\rby self write\rby * none\rolcAccess: to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\" manage\rby group.exact=\"cn=configadmin,ou=admin,dc=seal,dc=com\" write\rby * none\r#\r# Server status monitoring\r#\rdn: olcDatabase=monitor,cn=config\robjectClass: olcDatabaseConfig\rolcDatabase: monitor\rolcAccess: to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external,c\rn=auth\" read by dn.base=\"cn=Manager,dc=my-domain,dc=com\" read by * none\r#\r# Backend database definitions\r#\r# 这里是数据库的参数配置\rdn: olcDatabase=mdb,cn=config\robjectClass: olcDatabaseConfig\r# 使用的数据库引擎是mdb\robjectClass: olcMdbConfig\rolcDatabase: mdb\r# Suffix 为数据库的后缀，每个数据库至少一个，在搜索时-D 后面的域后缀为dc=test,dc=com将被pass到这里\rolcSuffix: dc=test,dc=com\r# 指不收前面配置的权限控制的管理员账户，拥有最最高权限\rolcRootDN: cn=admin,dc=test,dc=com\r# 特权账户的登录密码\rolcRootPW: {SSHA}xU9xFym/s7rawpmzpsYE+Q1qPsVPOwDw\rolcDbDirectory:\t/var/lib/ldap\r# 这是索引属性，下面是默认的属性\r# 下列注释行意思为\r# olcDbIndex: default pres,eq\r# olcDbIndex: uid\r# olcDbIndex: cn,sn pres,eq,sub\r# olcDbIndex: objectClass eq\r# pres,eq 为 present equality\r# 第二行意思为，为uid属性类型维护默认索引集\r# 第三行意思为，为cn,sn属性维护pres,eq,sub索引集\r# 索引集类型有 pres,eq,approx,sub,none\rolcDbIndex: objectClass eq,pres\rolcDbIndex: uid,ou,cn,mail,surname,givenname eq,pres,sub\r# 配置从缓冲区写入磁盘的，两个参数分别为多少kbyte大小的数据自上次（第二个参数）分钟则发生一次写入\rolcDbCheckpoint: 1024 10 更多配置文件选项说明可以参考 [14]\n生成配置文件 修改配置文件后需要重新生成配置文件\ntext 1 slapadd -n 0 -F /etc/openldap/slapd.d -l /etc/openldap/slapd.ldif 生成配置文件时的错误\nbash 1 2 3 4 $ slapadd -n 0 -F /etc/openldap/slapd.d -l /etc/openldap/slapd.ldif 63678619 str2entry: entry -1 has no dn slapadd: could not parse entry (line=31) _######## 43.66% eta none elapsed none spd 7.0 M/s 对于 slapd.ldif 需要注意下列事项\n行首 # 为注释 行尾不能有任何空白，这里也是很难排查的一个点 对于不同的属性需要放对位置快否则会报错，例如 olcDbCacheSize: 1000 是hdb配置，mdb添加会报错，有明显提示 如果生产配置失败后，修改配置文件后再次生成需要删除 rm -fr slapd.d/* 例如下面就是一个有提示的典型例子\nbash 1 2 63678513 Entry (cn=config), attribute 'olcDbCacheSize' not allowed slapadd: dn=\"cn=config\" (line=1): (65) attribute 'olcDbCacheSize' not allowed 下面的报错比较不明显，通常删除 rm -fr slapd.d/* 后重试\nbash 1 2 slapadd: could not add entry dn=\"cn=config\" (line=1): _### 17.92% eta none elapsed none spd 6.3 M/s 为LDAP初始化数据 部署完成后就是访问，ldap了，此时向OpenLDAP 搜索会发现没有内容\ntext 1 2 3 4 $ ldapsearch -LLL -x -W -H ldap://10.0.0.4 -D \"cn=admin,dc=test,dc=com\" -b \"dc=test,dc=com\" \"(uid=*)\" Enter LDAP Password: No such object (32) Reference http://www.openldap.org/faq/data/cache/1.html http://www.openldap.org/doc/admin24/appendix-common-errors.html 创建Root条目 在第一次部署好openldap中，实际上是没有任何条目的，此时是无法存入数据，有人说在 database setting中配置了 olcRootDN ，这里是指标识用哪个数据库的（即那个root存入哪里），而不是一个具体的root dn，所以需要手动创建一个\n例如下列，是创建一个RootDN\nbash 1 2 3 4 5 6 7 8 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.3 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: dc=test,dc=com objectclass: top objectClass: organizationalUnit objectclass: extensibleObject description: US Organization ou: people EOF 这里需要注意几点：\ndn: dc=test,dc=com 是指定存储的地方，如果在database配置中为配置 olcRootDN 则报错不会被存储 由于创建的的是root，所以ou的 objectClass 会报错，需要用一个 extensibleObject 才可以创建 [15] 创建子域 此时因为有了RootDN，可以指定dn为子域了，并且 objectClass: organizationalUnit 可以单独使用\n这里子域其实可以理解为二级域名了，在公司中也可以为子公司\nbash 1 2 3 4 5 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.3 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: ou=group,dc=test,dc=com objectClass: organizationalUnit ou: group EOF 创建组 这里使用 posixGroup Portable Operating System Interface of UNIX 的简写，这里可以理解为Linux用户管理的标准，包含一些标准的属性，类似于 /etc/group\n下面创建一个gid为10001的组，组名为tech\nbash 1 2 3 4 5 6 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.3 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: cn=tech,ou=group,dc=test,dc=com objectClass: posixGroup gidNumber: 10001 cn: tech EOF 创建用户 创建用户user01\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.3 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: uid=user01,ou=Group,dc=test,dc=com objectClass: posixAccount objectClass: inetOrgPerson objectClass: organizationalPerson objectClass: person homeDirectory: /home/user01 loginShell: /bin/bash uid: user01 cn: user01 uidNumber: 10004 gidNumber: 10001 userPassword: {SSHA}hJpIIVxj1qS9g05qUlgG+o7MO14EXbFQ sn: user01 givenName: user01 创建用户cylon\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 cat \u003c\u003c EOF | ldapadd -x -H ldap://10.0.0.3 -D \"cn=admin,dc=test,dc=com\" -w 111 dn: uid=cylon,ou=Group,dc=test,dc=com objectClass: posixAccount objectClass: inetOrgPerson objectClass: organizationalPerson objectClass: person homeDirectory: /home/cylon loginShell: /bin/bash uid: cylon cn: cylon userPassword: {SSHA}2pvE4C6xy8dkmW2aD/eEocVajg8BujWW uidNumber: 10005 gidNumber: 10001 sn: cylon EOF 如上面所示，objectClass [11] 表示这个ldap条目拥有的属性，可以看到 posixAccount，inetOrgPerson 等都是导入的schema文件，其中 uidNumber ，userPassword 都是 NIS 定义的，cn 则是 core定义的\n提示:\n以上信息中ldap 用户1：user01密码 111 用户2：cylon 密码 123456 这些原始信息是如何获得的？ 检查初始化测试数据。 查询导入的结果，默认查的是所有数据\ntext 1 ldapsearch -LLL -w 111 -x -H ldap://10.0.0.3 -D \"cn=admin,dc=test,dc=com\" -b \"dc=test,dc=com\" 备份ldap数据库数据 bash 1 2 ldapadd -x -H ldap://cylon.org -D \"cn=admin,dc=cylon,dc=org\" -W -f base.ldif \u003ebase.ldif ldapadd -x -H ldap://cylon.org -D \"cn=admin,dc=cylon,dc=org\" -W -f test.ldif \u003etest.ldif Reference [1] msg00281\n[2] Object Request Broker Architecture\n[3] Cooperation for Open Systems Interconnection Networking in Europe\n[4] DUA\n[5] DynamicGroup\n[6] InetOrgPerson\n[7] Network Information Service\n[8] Privilege Management Infrastructure\n[9] Password Policy\n[10] LDAP Data Interchange Format\n[11] Object Class\n[12] 8. Access Control\n[13] openldap system requirements for virtualization\n[14] slapdconf2\n[15] attribute dc is not allowed\n","wordCount":"1387","inLanguage":"zh","datePublished":"2019-08-25T00:00:00Z","dateModified":"2022-11-28T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/2019/08/ch2-install/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/><img src=http://localhost:1313/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives><span>归档</span></a></li><li><a href=http://localhost:1313/tags><span>标签</span></a></li><li><a href=http://localhost:1313/search><span>搜索</span></a></li><li><a href=http://localhost:1313/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">理解ldap - OpenLDAP安装</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2019-08-25</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1387 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>7 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=http://localhost:1313/tags/ldap/>#Ldap</a>
<a href=http://localhost:1313/tags/databases/>#Databases</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e7%94%9f%e4%ba%a7%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%a1%ac%e4%bb%b6%e9%85%8d%e7%bd%ae%e9%9c%80%e6%b1%82 aria-label=生产服务器硬件配置需求>生产服务器硬件配置需求</a><li><a href=#openldap-master%e6%9c%8d%e5%8a%a1%e5%ae%89%e8%a3%85 aria-label="openldap master服务安装">openldap master服务安装</a><li><a href=#openldap%e5%8f%82%e6%95%b0%e9%85%8d%e7%bd%ae%e4%bc%98%e5%8c%96 aria-label=openldap参数配置优化>openldap参数配置优化</a><ul><li><a href=#openldap%e7%9b%ae%e5%bd%95%e5%b8%83%e5%b1%80 aria-label=openldap目录布局>openldap目录布局</a><li><a href=#%e6%97%a5%e5%bf%97%e5%8f%8a%e7%bc%93%e5%ad%98%e5%8f%82%e6%95%b0 aria-label=日志及缓存参数。>日志及缓存参数。</a><li><a href=#%e5%bc%80%e5%90%af%e6%89%a9%e5%b1%95schema aria-label=开启扩展schema>开启扩展schema</a><li><a href=#%e6%8e%88%e6%9d%83%e5%8f%8a%e5%ae%89%e5%85%a8%e5%8f%82%e6%95%b0%e9%85%8d%e7%bd%ae aria-label=授权及安全参数配置>授权及安全参数配置</a><li><a href=#%e9%85%8d%e7%bd%aesyslog%e8%ae%b0%e5%bd%95ldap%e6%9c%8d%e5%8a%a1%e6%97%a5%e5%bf%97%e9%85%8d%e7%bd%aesyslog aria-label=配置syslog记录ldap服务日志配置syslog>配置syslog记录ldap服务日志配置syslog</a><li><a href=#%e9%85%8d%e7%bd%aeldap%e6%95%b0%e6%8d%ae%e5%ba%93%e5%ad%98%e6%94%be%e8%b7%af%e5%be%84 aria-label=配置LDAP数据库存放路径>配置LDAP数据库存放路径</a><li><a href=#%e6%95%b4%e5%90%88%e7%9a%84%e9%85%8d%e7%bd%ae aria-label=整合的配置>整合的配置</a><li><a href=#%e7%94%9f%e6%88%90%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=生成配置文件>生成配置文件</a></ul><li><a href=#%e4%b8%baldap%e5%88%9d%e5%a7%8b%e5%8c%96%e6%95%b0%e6%8d%ae aria-label=为LDAP初始化数据>为LDAP初始化数据</a><li><a href=#reference aria-label=Reference>Reference</a><ul><li><a href=#%e5%88%9b%e5%bb%baroot%e6%9d%a1%e7%9b%ae aria-label=创建Root条目>创建Root条目</a><li><a href=#%e5%88%9b%e5%bb%ba%e5%ad%90%e5%9f%9f aria-label=创建子域>创建子域</a><li><a href=#%e5%88%9b%e5%bb%ba%e7%bb%84 aria-label=创建组>创建组</a><li><a href=#%e5%88%9b%e5%bb%ba%e7%94%a8%e6%88%b7 aria-label=创建用户>创建用户</a><li><a href=#%e6%a3%80%e6%9f%a5%e5%88%9d%e5%a7%8b%e5%8c%96%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae aria-label=检查初始化测试数据。>检查初始化测试数据。</a><li><a href=#%e5%a4%87%e4%bb%bdldap%e6%95%b0%e6%8d%ae%e5%ba%93%e6%95%b0%e6%8d%ae aria-label=备份ldap数据库数据>备份ldap数据库数据</a></ul><li><a href=#reference-1 aria-label=Reference>Reference</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=生产服务器硬件配置需求>生产服务器硬件配置需求<a hidden class=anchor aria-hidden=true href=#生产服务器硬件配置需求>#</a></h2><p>ldap服务对系统环境的要求不高，一般在生产场景，ldap服务应该最少是两台，这样某一台物理服务器岩机才不会因单点问题影响生产业务故障，对于硬件要求，本质上openldap使用硬件资源并不大，网上有两个帖子提出了openldap的硬件需求：</p><ul><li>2003年openldap官网留言，我想安装一个 LDAP 服务器来验证邮件服务器的用户，目前有200个用户需要多少内存和CPU？<sup><a href=#1>[1]</a></sup><ul><li>1GHZ PIII/512MB 足以</li></ul></li><li>运行于Ubuntu LXC 之上的openldap，用户150,000，sladp进程常驻内存为200-300MB，mdb数据库文件大小为377MB，10 并发平均响应时间为 9-11 毫秒 <sup><a href=#13>[13]</a></sup></li></ul><p>操作系统：Centos7/8 64bit。</p><table><thead><tr><th>操 作 系 统</th><th>其 它</th></tr></thead><tbody><tr><td>CentOS-7.6</td><td>当前很稳定且免费的Linux版本。</td></tr></tbody></table><p>网卡及IP资源</p><table><thead><tr><th>名 称</th><th>接 口</th><th>IP</th><th>用途</th></tr></thead><tbody><tr><td>ldap主服务器01</td><td>eth0</td><td>10.0.0.17</td><td>外部管理IP，用于WAN数据转发。</td></tr><tr><td></td><td>eth1</td><td>10.0.0.17</td><td>备用管理IP，用于LAN内数据转发。</td></tr><tr><td>ldap从服务器02</td><td>eth0</td><td>10.0.0.8</td><td>管理IP，用于LAN数据转发。</td></tr><tr><td></td><td>eth1</td><td>10.0.0.18</td><td>外部管理IP，用于WAN数据转发。</td></tr></tbody></table><hr><blockquote><p>Tips：内外网IP分配可采用最后8位相同的方式，这样使于管理。</p></blockquote><hr><h2 id=openldap-master服务安装>openldap master服务安装<a hidden class=anchor aria-hidden=true href=#openldap-master服务安装>#</a></h2><p>CentOS/Redhat 安装OpenLDAP组件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install -y <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	openldap <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	openldap-servers <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	openldap-clients <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	openldap-devel <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	compat-openldap</span></span></code></pre></td></tr></table></div></div></div></div><p>Ubuntu18.04/22.04/20.04</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt -y install slapd ldap-utils</span></span></code></pre></td></tr></table></div></div></div></div><p>默认OpenLDAP服务所使用的端口为389，此端口采用明文传输数据，数据信息得不到保障。所以可以通过配置CA及结合TLS/SASL实现数据加密传输，所使用端口为636。</p><p>编译安装</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>yum install -y \
</span></span><span class=line><span class=cl>	libtool-ltdl \
</span></span><span class=line><span class=cl>	libtool-ltdl-devel \
</span></span><span class=line><span class=cl>	gcc \
</span></span><span class=line><span class=cl>	openssl \
</span></span><span class=line><span class=cl>	openssl-devel</span></span></code></pre></td></tr></table></div></div></div></div><p>Openldap依赖的相关软件：</p><ul><li><a href=http://www.openldap.org/doc/admin24/install.html target=_blank rel="noopener nofollow noreferrer">http://www.openldap.org/doc/admin24/install.html</a></li></ul><h2 id=openldap参数配置优化>openldap参数配置优化<a hidden class=anchor aria-hidden=true href=#openldap参数配置优化>#</a></h2><p>openldap配置文件分为五部分</p><ul><li>sladp进程配置部分</li><li>frontend：是一个特殊的 <code>olcDatabaseConfig</code> 配置提供权限认证</li><li>database：存储的真实引擎</li><li>backend：backend在slapd中不是真是的数据库，而是提供的一种转发方式</li></ul><h3 id=openldap目录布局>openldap目录布局<a hidden class=anchor aria-hidden=true href=#openldap目录布局>#</a></h3><ul><li><code>/etc/openldap/slapd.d/*</code>： <code>/etc/openldap/slapd.ldif</code>配置信息生成的文件，每修改一次配置信息，这里的东西就要重新生成。</li><li><code>/var/lib/ldap/*</code>：OpenLDAP的数据文件。</li><li><code>/usr/share/openldap-servers/DB_CONFIG.example</code>：模板数据库配置文件。</li><li><code>/usr/share/openldap-servers/slapd.ldif</code>：默认模板配置文件。</li></ul><p>默认OpenLdap服务所使用的端口为<strong>389</strong>，此端口采用明文传输数据，数据信息得不到保障。所以可以通过配置CA及结合TLS/SSL实现数据加密传输，所使用端口为<strong>636</strong>。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>cp /usr/share/openldap-servers/slapd.ldif /etc/openldap/</span></span></code></pre></td></tr></table></div></div></div></div><p>指定密码，不提示</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ slappasswd -s 111
</span></span><span class=line><span class=cl>{SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif># 指定要搜索的后缀
olcSuffix: dc=cylon,dc=org
# rootdn，使用这个dn可以登录服务器
olcRootDN: cn=admin,dc=cylon,dc=org
olcDbDirectory: /var/lib/ldap
# 指定ldapserver管理员密码==
olcRootPW: {SSHA}QnB7dO98+hoCUgiaAYaiJWnDzlhn2Tn6</code></pre></div></div><h3 id=日志及缓存参数>日志及缓存参数。<a hidden class=anchor aria-hidden=true href=#日志及缓存参数>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># 设置日志级别，记录日志信息方便调试 stats 256（日志连接/操作/结果） 
</span></span><span class=line><span class=cl>olcLogLevel: stats
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 设置ldap可以缓存的记录数
</span></span><span class=line><span class=cl>olcDbCacheSize: 1000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># checkpoint 可以吧内存中的数据写会数据文件的操作，此设置表示每达到2048kb或者10分钟执行一次
</span></span><span class=line><span class=cl>olcDbCheckpoint: 1024 10</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=开启扩展schema>开启扩展schema<a hidden class=anchor aria-hidden=true href=#开启扩展schema>#</a></h3><p>openldap自带一些ldif文件 <sup><a href=#10>[10]</a></sup>，LDIF 是 <em><strong>LDAP Data Interchange Format</strong></em> 的缩写，是作为存储与LDAP中 ” <strong>文本格式</strong> “ 的数据交换格式，每个条目代表的存入LDAP中记录的属性，记录之间用空行分隔，每行都是 “属性:值” 的格式，例如我们存入LDAP中一个记录，其属性有</p><ul><li>dn (<em><strong>distinguished name</strong></em>) 用于标识目录中名称的唯一标识符</li><li>dc (<em><strong>domain component</strong></em>) 表示域组成，例如域名 <code>www.mydomain.com</code> 那么dc 应该配置为<code>DC=www,DC=mydomain,DC=com</code></li><li>ou (<em><strong>organizational unit</strong></em>) 这是指用户的组织，这里也可以代表用户组，例如 <code>OU=Lawyer,OU=Developer</code></li><li>cn (<em><strong>common name</strong></em>) 表示查询的个体对象的名称，这里可以代表用户名，服务名等，例如 <code>cn=cylon</code></li></ul><p>具有多个属性条目，在ldap中代表一条记录，例如</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> dn: cn=The Postmaster,dc=example,dc=com
</span></span><span class=line><span class=cl> objectClass: organizationalRole
</span></span><span class=line><span class=cl> cn: The Postmaster</span></span></code></pre></td></tr></table></div></div></div></div><p>而ldif文件就是定义这些属性的文件，下面是openldap安装后默认的ldif文件说明：</p><ul><li><p><code>collective.ldif </code><strong>：<em>Collective Attribute</em></strong> 组成LDAP条目的共享属性</p></li><li><p><code>corba.ldif</code><strong>：<em>Common Object Request Broker Architecture</em></strong> 的缩写，旨在促进部署在不同平台上的系统的通信 <sup><a href=#2>[2]</a></sup></p></li><li><p><code>cosine.ldif</code><strong>：<em>Cooperation for Open Systems Interconnection Networking in Europe</em></strong>的缩写，用于给 <code>cosine</code> 与 <code>Internet X.500</code> 模式项目提供LDAP中的属性格式 <sup><a href=#3>[3]</a></sup></p></li><li><p><code>duaconf.ldif</code><strong>：<em>Directory User Agents</em></strong> 的缩写，DUA是协议客户端，是向ldap或<code>Internet X.500</code> DSA发起请求的一端，这是为DUA客户端提供了通用配置 <sup><a href=#4>[4]</a></sup></p></li><li><p><code>dyngroup.ldif</code><strong>：<em>Dynamic Group</em></strong>的缩写，动态组是LDAP中的一种组，与静态组相反，DG是以URL形式为搜索条件来隐式定义一组用户。<sup><a href=#5>[5]</a></sup></p><ul><li>静态组 <em><strong>Static Groups</strong></em> 使用一组DN显式定义一组用户</li></ul></li><li><p><code>inetorgperson.ldif</code><strong>：inetOrgPerson</strong>类是 <code>RFC2798中</code> 定义的类。在LDAP中为 <strong>user</strong> 的父类，比如说用户密码，登录时间等属性，更多可以参考 <sup><a href=#6>[6]</a></sup></p></li><li><p><code>java.ldif</code>：用于java的一些属性</p></li><li><p><code>misc.ldif</code><strong>：<em>Miscellaneous</em></strong> 的简写，这里主要是一些电子邮件相关属性</p></li><li><p><code>nis.ldif</code><strong>：<em>Network Information Service</em></strong> 的缩写，NIS是一种发现机制，这里是一种server-client的目录属性，例如网络中的主机名，用户名之类 <sup><a href=#7>[7]</a></sup></p></li><li><p><code>openldap.ldif</code>：</p></li><li><p><code>pmi.ldif</code><strong>：<em>Privilege Management Infrastructure</em></strong> 的缩写，是基于x.509的授权访问控制模型，这里是提供了基于PMI的一些属性</p></li><li><p><code>ppolicy.ldif</code><strong>：<em>password policy</em></strong> 的缩写，提供了增强的密码管理功能，例如账户到期时间，锁定等</p></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>include: file:///etc/openldap/schema/collective.ldif   # OpenLDAP的核心schema必须
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/corba.ldif # 
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/cosine.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/duaconf.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/dyngroup.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/inetorgperson.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/java.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/misc.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/nis.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/openldap.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/pmi.ldif
</span></span><span class=line><span class=cl>include: file:///etc/openldap/schema/ppolicy.ldif</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=授权及安全参数配置>授权及安全参数配置<a hidden class=anchor aria-hidden=true href=#授权及安全参数配置>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif>access to dn=&#34;cn=subschema&#34; by * read
access to 
    by self write 
    by dn subtree=&#34;ou=sysusers,dc=test,dc=com&#34; read
    by anonymous auth</code></pre></div></div><p><strong>关于更多权限管理的说明，可以参考官方手册第八章</strong> <sup><a href=#12>[12]</a></sup></p><hr><blockquote><p><strong>提示</strong>:</p><p>参数在文件中的先后位置不能随意动。</p><p>空行和以“#”开头的注释行将被忽略。如果一行以空格开头，它将被认为是接着前一行的（即使前一行是注释）。</p></blockquote><hr><h3 id=配置syslog记录ldap服务日志配置syslog>配置syslog记录ldap服务日志配置syslog<a hidden class=anchor aria-hidden=true href=#配置syslog记录ldap服务日志配置syslog>#</a></h3><p>记录ldap服务日志，默认级别为256；</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;local4.*          /var/log/slapd.log&#39;</span> &gt;&gt; /etc/rsyslog.conf
</span></span><span class=line><span class=cl>local4.*                /var/log/slapd.log</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=配置ldap数据库存放路径>配置LDAP数据库存放路径<a hidden class=anchor aria-hidden=true href=#配置ldap数据库存放路径>#</a></h3><hr><blockquote><p><strong>注意</strong>：</p><p>slapd.conf中设定了LDAP数据库格式为hdb，存储路径<code>/var/1ib/ldap</code></p></blockquote><hr><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chown ldap.ldap /var/lib/ldap/DB_CONFIG
</span></span><span class=line><span class=cl>chmod 700 /var/lib/ldap/DB_CONFIG</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=整合的配置>整合的配置<a hidden class=anchor aria-hidden=true href=#整合的配置>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ldif</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-ldif data-lang=ldif>#
# See slapd-config(5) for details on configuration options.
# This file should NOT be world readable.
#

dn: cn=config
objectClass: olcGlobal
cn: config
olcArgsFile: /var/run/openldap/slapd.args
olcPidFile: /var/run/openldap/slapd.pid
olcLogLevel: stats
olcDisallows: bind_anon
#
# TLS settings
#
olcTLSCACertificatePath: /etc/openldap/certs
olcTLSCertificateFile: &#34;OpenLDAP Server&#34;
olcTLSCertificateKeyFile: /etc/openldap/certs/password
#
# Do not enable referrals until AFTER you have a working directory
# service AND an understanding of referrals.
#
#olcReferral: ldap://root.openldap.org
#
# Sample security restrictions
#	Require integrity protection (prevent hijacking)
#	Require 112-bit (3DES or better) encryption for updates
#	Require 64-bit encryption for simple bind
#
#olcSecurity: ssf=1 update_ssf=112 simple_bind=64

#
# Load dynamic backend modules:
# - modulepath is architecture dependent value (32/64-bit system)
# - back_sql.la backend requires openldap-servers-sql package
# - dyngroup.la and dynlist.la cannot be used at the same time
#

#dn: cn=module,cn=config
#objectClass: olcModuleList
#cn: module
#olcModulepath:	/usr/lib/openldap
#olcModulepath:	/usr/lib64/openldap
#olcModuleload: accesslog.la
#olcModuleload: auditlog.la
#olcModuleload: back_dnssrv.la
#olcModuleload: back_ldap.la
#olcModuleload: back_mdb.la
#olcModuleload: back_meta.la
#olcModuleload: back_null.la
#olcModuleload: back_passwd.la
#olcModuleload: back_relay.la
#olcModuleload: back_shell.la
#olcModuleload: back_sock.la
#olcModuleload: collect.la
#olcModuleload: constraint.la
#olcModuleload: dds.la
#olcModuleload: deref.la
#olcModuleload: dyngroup.la
#olcModuleload: dynlist.la
#olcModuleload: memberof.la
#olcModuleload: pcache.la
#olcModuleload: ppolicy.la
#olcModuleload: refint.la
#olcModuleload: retcode.la
#olcModuleload: rwm.la
#olcModuleload: seqmod.la
#olcModuleload: smbk5pwd.la
#olcModuleload: sssvlv.la
#olcModuleload: syncprov.la
#olcModuleload: translucent.la
#olcModuleload: unique.la
#olcModuleload: valsort.la


#
# Schema settings
#

dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

include: file:///etc/openldap/schema/core.ldif
include: file:///etc/openldap/schema/collective.ldif
include: file:///etc/openldap/schema/corba.ldif
include: file:///etc/openldap/schema/cosine.ldif
include: file:///etc/openldap/schema/duaconf.ldif
include: file:///etc/openldap/schema/dyngroup.ldif
include: file:///etc/openldap/schema/inetorgperson.ldif
include: file:///etc/openldap/schema/java.ldif
include: file:///etc/openldap/schema/misc.ldif
include: file:///etc/openldap/schema/nis.ldif
include: file:///etc/openldap/schema/openldap.ldif
include: file:///etc/openldap/schema/pmi.ldif
include: file:///etc/openldap/schema/ppolicy.ldif

#
# Frontend settings
#
# 这里是对前端权限的配置，通常默认，不添加权限
dn: olcDatabase=frontend,cn=config
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcDatabase: frontend
#
# Sample global access control policy:
#	Root DSE: allow anyone to read it
#	Subschema (sub)entry DSE: allow anyone to read it
#	Other DSEs:
#		Allow self write access
#		Allow authenticated users read access
#		Allow anonymous users to authenticate
#
#olcAccess: to dn.base=&#34;&#34; by * read
#olcAccess: to dn.base=&#34;cn=Subschema&#34; by * read
#olcAccess: to *
#	by self write
#	by users read
#	by anonymous auth
#
# if no access controls are present, the default policy
# allows anyone and everyone to read anything but restricts
# updates to rootdn.  (e.g., &#34;access to * by * read&#34;)
#
# rootdn can always read and write EVERYTHING!
#

#
# Configuration database
#
# 这里是对后端数据库权限的配置
dn: olcDatabase=config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: config
olcAccess: to attrs=userPassword,shadowLastChange
    by dn.children=&#34;cn=admin,dc=test,dc=com&#34; write
    by anonymous auth
    by self write
    by * none
olcAccess: to * by dn.base=&#34;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&#34; manage
    by group.exact=&#34;cn=configadmin,ou=admin,dc=seal,dc=com&#34; write
    by * none

#
# Server status monitoring
#

dn: olcDatabase=monitor,cn=config
objectClass: olcDatabaseConfig
olcDatabase: monitor
olcAccess: to * by dn.base=&#34;gidNumber=0+uidNumber=0,cn=peercred,cn=external,c
 n=auth&#34; read by dn.base=&#34;cn=Manager,dc=my-domain,dc=com&#34; read by * none

#
# Backend database definitions
#
# 这里是数据库的参数配置
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
# 使用的数据库引擎是mdb
objectClass: olcMdbConfig
olcDatabase: mdb
# Suffix 为数据库的后缀，每个数据库至少一个，在搜索时-D 后面的域后缀为dc=test,dc=com将被pass到这里
olcSuffix: dc=test,dc=com
# 指不收前面配置的权限控制的管理员账户，拥有最最高权限
olcRootDN: cn=admin,dc=test,dc=com
# 特权账户的登录密码
olcRootPW: {SSHA}xU9xFym/s7rawpmzpsYE+Q1qPsVPOwDw
olcDbDirectory:	/var/lib/ldap
# 这是索引属性，下面是默认的属性
# 下列注释行意思为
#        olcDbIndex: default pres,eq
#        olcDbIndex: uid
#        olcDbIndex: cn,sn pres,eq,sub
#        olcDbIndex: objectClass eq
# pres,eq 为 present equality
# 第二行意思为，为uid属性类型维护默认索引集
# 第三行意思为，为cn,sn属性维护pres,eq,sub索引集
# 索引集类型有 pres,eq,approx,sub,none
olcDbIndex: objectClass eq,pres
olcDbIndex: uid,ou,cn,mail,surname,givenname eq,pres,sub
# 配置从缓冲区写入磁盘的，两个参数分别为多少kbyte大小的数据自上次（第二个参数）分钟则发生一次写入
olcDbCheckpoint: 1024 10</code></pre></div></div><p>更多配置文件选项说明可以参考 <sup><a href=#14>[14]</a></sup></p><h3 id=生成配置文件>生成配置文件<a hidden class=anchor aria-hidden=true href=#生成配置文件>#</a></h3><p>修改配置文件后需要重新生成配置文件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>slapadd -n 0 -F /etc/openldap/slapd.d -l /etc/openldap/slapd.ldif</span></span></code></pre></td></tr></table></div></div></div></div><p>生成配置文件时的错误</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ slapadd -n <span class=m>0</span> -F /etc/openldap/slapd.d -l /etc/openldap/slapd.ldif
</span></span><span class=line><span class=cl><span class=m>63678619</span> str2entry: entry -1 has no dn
</span></span><span class=line><span class=cl>slapadd: could not parse entry <span class=o>(</span><span class=nv>line</span><span class=o>=</span>31<span class=o>)</span>
</span></span><span class=line><span class=cl>_########              43.66% eta   none elapsed            none spd   7.0 M/s </span></span></code></pre></td></tr></table></div></div></div></div><p>对于 <code>slapd.ldif</code> 需要注意下列事项</p><ul><li>行首 <code>#</code> 为注释</li><li>行尾不能有任何空白，这里也是很难排查的一个点</li><li>对于不同的属性需要放对位置快否则会报错，例如 <code>olcDbCacheSize: 1000</code> 是hdb配置，mdb添加会报错，有明显提示</li><li>如果生产配置失败后，修改配置文件后再次生成需要删除 <code>rm -fr slapd.d/*</code></li></ul><p>例如下面就是一个有提示的典型例子</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=m>63678513</span> Entry <span class=o>(</span><span class=nv>cn</span><span class=o>=</span>config<span class=o>)</span>, attribute <span class=s1>&#39;olcDbCacheSize&#39;</span> not allowed
</span></span><span class=line><span class=cl>slapadd: <span class=nv>dn</span><span class=o>=</span><span class=s2>&#34;cn=config&#34;</span> <span class=o>(</span><span class=nv>line</span><span class=o>=</span>1<span class=o>)</span>: <span class=o>(</span>65<span class=o>)</span> attribute <span class=s1>&#39;olcDbCacheSize&#39;</span> not allowed</span></span></code></pre></td></tr></table></div></div></div></div><p>下面的报错比较不明显，通常删除 <code>rm -fr slapd.d/*</code> 后重试</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>slapadd: could not add entry <span class=nv>dn</span><span class=o>=</span><span class=s2>&#34;cn=config&#34;</span> <span class=o>(</span><span class=nv>line</span><span class=o>=</span>1<span class=o>)</span>: 
</span></span><span class=line><span class=cl>_###                   17.92% eta   none elapsed            none spd   6.3 M/s </span></span></code></pre></td></tr></table></div></div></div></div><h2 id=为ldap初始化数据>为LDAP初始化数据<a hidden class=anchor aria-hidden=true href=#为ldap初始化数据>#</a></h2><p>部署完成后就是访问，ldap了，此时向OpenLDAP 搜索会发现没有内容</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ldapsearch -LLL -x -W -H ldap://10.0.0.4 -D &#34;cn=admin,dc=test,dc=com&#34; -b &#34;dc=test,dc=com&#34; &#34;(uid=*)&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Enter LDAP Password: 
</span></span><span class=line><span class=cl>No such object (32)</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><ul><li><a href=http://www.openldap.org/faq/data/cache/1.html target=_blank rel="noopener nofollow noreferrer">http://www.openldap.org/faq/data/cache/1.html</a></li><li><a href=http://www.openldap.org/doc/admin24/appendix-common-errors.html target=_blank rel="noopener nofollow noreferrer">http://www.openldap.org/doc/admin24/appendix-common-errors.html</a></li></ul></blockquote><h3 id=创建root条目>创建Root条目<a hidden class=anchor aria-hidden=true href=#创建root条目>#</a></h3><p>在第一次部署好openldap中，实际上是没有任何条目的，此时是无法存入数据，有人说在 database setting中配置了 <code>olcRootDN</code> ，这里是指标识用哪个数据库的（即那个root存入哪里），而不是一个具体的root dn，所以需要手动创建一个</p><p>例如下列，是创建一个RootDN</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.3 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectclass: top
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalUnit
</span></span></span><span class=line><span class=cl><span class=s>objectclass: extensibleObject
</span></span></span><span class=line><span class=cl><span class=s>description: US Organization
</span></span></span><span class=line><span class=cl><span class=s>ou: people
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>这里需要注意几点：</p><ul><li><code>dn: dc=test,dc=com</code> 是指定存储的地方，如果在database配置中为配置 <code>olcRootDN</code> 则报错不会被存储</li><li>由于创建的的是root，所以ou的 <code>objectClass</code> 会报错，需要用一个 <code>extensibleObject</code> 才可以创建 <sup><a href=#15>[15]</a></sup></li></ul><h3 id=创建子域>创建子域<a hidden class=anchor aria-hidden=true href=#创建子域>#</a></h3><p>此时因为有了RootDN，可以指定dn为子域了，并且 <code>objectClass: organizationalUnit</code> 可以单独使用</p><p>这里子域其实可以理解为二级域名了，在公司中也可以为子公司</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.3 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: ou=group,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalUnit
</span></span></span><span class=line><span class=cl><span class=s>ou: group
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=创建组>创建组<a hidden class=anchor aria-hidden=true href=#创建组>#</a></h3><p>这里使用 <code>posixGroup</code> <em><strong>Portable Operating System Interface of UNIX</strong></em> 的简写，这里可以理解为Linux用户管理的标准，包含一些标准的属性，类似于 <code>/etc/group</code></p><p>下面创建一个gid为10001的组，组名为tech</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.3 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: cn=tech,ou=group,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixGroup
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 10001
</span></span></span><span class=line><span class=cl><span class=s>cn: tech
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=创建用户>创建用户<a hidden class=anchor aria-hidden=true href=#创建用户>#</a></h3><p>创建用户user01</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.3 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=user01,ou=Group,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixAccount
</span></span></span><span class=line><span class=cl><span class=s>objectClass: inetOrgPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: person
</span></span></span><span class=line><span class=cl><span class=s>homeDirectory: /home/user01
</span></span></span><span class=line><span class=cl><span class=s>loginShell: /bin/bash
</span></span></span><span class=line><span class=cl><span class=s>uid: user01
</span></span></span><span class=line><span class=cl><span class=s>cn: user01
</span></span></span><span class=line><span class=cl><span class=s>uidNumber: 10004
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 10001
</span></span></span><span class=line><span class=cl><span class=s>userPassword: {SSHA}hJpIIVxj1qS9g05qUlgG+o7MO14E</span>XbFQ
</span></span><span class=line><span class=cl>sn: user01
</span></span><span class=line><span class=cl>givenName: user01</span></span></code></pre></td></tr></table></div></div></div></div><p>创建用户cylon</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | ldapadd -x -H ldap://10.0.0.3 -D &#34;cn=admin,dc=test,dc=com&#34; -w 111
</span></span></span><span class=line><span class=cl><span class=s>dn: uid=cylon,ou=Group,dc=test,dc=com
</span></span></span><span class=line><span class=cl><span class=s>objectClass: posixAccount
</span></span></span><span class=line><span class=cl><span class=s>objectClass: inetOrgPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: organizationalPerson
</span></span></span><span class=line><span class=cl><span class=s>objectClass: person
</span></span></span><span class=line><span class=cl><span class=s>homeDirectory: /home/cylon
</span></span></span><span class=line><span class=cl><span class=s>loginShell: /bin/bash
</span></span></span><span class=line><span class=cl><span class=s>uid: cylon
</span></span></span><span class=line><span class=cl><span class=s>cn: cylon
</span></span></span><span class=line><span class=cl><span class=s>userPassword: {SSHA}2pvE4C6xy8dkmW2aD/eEocVajg8BujWW
</span></span></span><span class=line><span class=cl><span class=s>uidNumber: 10005
</span></span></span><span class=line><span class=cl><span class=s>gidNumber: 10001
</span></span></span><span class=line><span class=cl><span class=s>sn: cylon
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></td></tr></table></div></div></div></div><p>如上面所示，<code>objectClass</code> <sup><a href=#11>[11]</a></sup> 表示这个ldap条目拥有的属性，可以看到 <code>posixAccount</code>，<code>inetOrgPerson</code> 等都是导入的schema文件，其中 <code>uidNumber</code> ，<code>userPassword</code> 都是 NIS 定义的，<code>cn</code> 则是 core定义的</p><hr><blockquote><p><strong>提示</strong>:</p><ul><li>以上信息中ldap<ul><li>用户1：user01密码 <code>111</code></li><li>用户2：cylon 密码 <code>123456</code></li></ul></li><li>这些原始信息是如何获得的？</li></ul></blockquote><hr><h3 id=检查初始化测试数据>检查初始化测试数据。<a hidden class=anchor aria-hidden=true href=#检查初始化测试数据>#</a></h3><p>查询导入的结果，默认查的是所有数据</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ldapsearch -LLL -w 111 -x -H ldap://10.0.0.3 -D &#34;cn=admin,dc=test,dc=com&#34; -b &#34;dc=test,dc=com&#34;</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=备份ldap数据库数据>备份ldap数据库数据<a hidden class=anchor aria-hidden=true href=#备份ldap数据库数据>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ldapadd -x -H ldap://cylon.org -D <span class=s2>&#34;cn=admin,dc=cylon,dc=org&#34;</span> -W -f base.ldif &gt;base.ldif
</span></span><span class=line><span class=cl>ldapadd -x -H ldap://cylon.org -D <span class=s2>&#34;cn=admin,dc=cylon,dc=org&#34;</span> -W -f test.ldif &gt;test.ldif</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=reference-1>Reference<a hidden class=anchor aria-hidden=true href=#reference-1>#</a></h2><blockquote><p><sup id=1>[1]</sup> <a href=https://www.openldap.org/lists/openldap-software/200306/msg00281.html target=_blank rel="noopener nofollow noreferrer"><em><strong>msg00281</strong></em></a></p><p><sup id=2>[2]</sup> <a href=https://ldapwiki.com/wiki/Common%20Object%20Request%20Broker%20Architecture target=_blank rel="noopener nofollow noreferrer"><em><strong>Object Request Broker Architecture</strong></em></a></p><p><sup id=3>[3]</sup> <a href=https://ldapwiki.com/wiki/Cooperation%20for%20Open%20Systems%20Interconnection%20Networking%20in%20Europe target=_blank rel="noopener nofollow noreferrer"><em><strong>Cooperation for Open Systems Interconnection Networking in Europe</strong></em></a></p><p><sup id=4>[4]</sup> <a href=https://ldapwiki.com/wiki/DUA target=_blank rel="noopener nofollow noreferrer"><em><strong>DUA</strong></em></a></p><p><sup id=5>[5]</sup> <a href=https://ldapwiki.com/wiki/DynamicGroup target=_blank rel="noopener nofollow noreferrer"><em><strong>DynamicGroup</strong></em></a></p><p><sup id=6>[6]</sup> <a href=https://ldapwiki.com/wiki/InetOrgPerson target=_blank rel="noopener nofollow noreferrer"><em><strong>InetOrgPerson</strong></em></a></p><p><sup id=7>[7]</sup> <a href=https://ldapwiki.com/wiki/Network%20Information%20Service target=_blank rel="noopener nofollow noreferrer"><em><strong>Network Information Service</strong></em></a></p><p><sup id=8>[8]</sup> <a href=https://ldapwiki.com/wiki/Privilege%20Management%20Infrastructure target=_blank rel="noopener nofollow noreferrer"><em><strong>Privilege Management Infrastructure</strong></em></a></p><p><sup id=9>[9]</sup> <a href=https://ldapwiki.com/wiki/Password%20Policy target=_blank rel="noopener nofollow noreferrer"><em><strong>Password Policy</strong></em></a></p><p><sup id=10>[10]</sup> <a href=https://ldapwiki.com/wiki/LDAP%20Data%20Interchange%20Format target=_blank rel="noopener nofollow noreferrer"><em><strong>LDAP Data Interchange Format</strong></em></a></p><p><sup id=11>[11]</sup> <a href=https://ldapwiki.com/wiki/ObjectClass target=_blank rel="noopener nofollow noreferrer"><em><strong>Object Class</strong></em></a></p><p><sup id=12>[12]</sup> <a href=https://www.openldap.org/doc/admin24/access-control.html target=_blank rel="noopener nofollow noreferrer"><em><strong>8. Access Control</strong></em></a></p><p><sup id=13>[13]</sup> <a href=https://stackoverflow.com/questions/40080921/openldap-system-requirements-for-virtualization target=_blank rel="noopener nofollow noreferrer"><em><strong>openldap system requirements for virtualization</strong></em></a></p><p><sup id=14>[14]</sup> <a href=https://www.openldap.org/doc/admin24/slapdconf2.html target=_blank rel="noopener nofollow noreferrer"><em><strong>slapdconf2</strong></em></a></p><p><sup id=15>[15]</sup> <a href=https://community.oracle.com/tech/apps-infra/discussion/2013873/attribute-dc-is-not-allowed target=_blank rel="noopener nofollow noreferrer"><em><strong>attribute dc is not allowed</strong></em></a></p></blockquote></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：理解ldap - OpenLDAP安装</p><p>文章链接：<a href=http://localhost:1313/2019/08/ch2-install/ target=_blank>http://localhost:1313/2019/08/ch2-install/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2019/08/ch1-understanding-ldap/><span>理解ldap - 什么是ldap</span></a></li><li><a href=/2017/05/rsync/><span>同步工具rsync使用指南</span></a></li><li><a href=/2017/05/ch8-mysql-engine/><span>ch08 - MySQL存储引擎</span></a></li><li><a href=/2017/05/ch7-mysql-non-interact/><span>ch07 - 实现和MySQL非交互式对话</span></a></li><li><a href=/2017/05/ch04-mysql-log/><span>ch04 - MySQL数据库服务日志类型</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/ldap/>Ldap</a></li><li><a href=http://localhost:1313/tags/databases/>Databases</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/2019/08/ch3-commandline/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>理解ldap - OpenLDAP客户端命令行使用</span>
</a><a class=next href=http://localhost:1313/2019/08/ch1-understanding-ldap/><span class=title></span>
<span>理解ldap - 什么是ldap&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/ch2 install","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>