<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用go语言颁发CA证书 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="golang"><meta name=description content='本篇文章中，将描述如何使用go创建CA，并使用CA签署证书。在使用openssl创建证书时，遵循的步骤是 创建秘钥 > 创建CA > 生成要颁发证书的秘钥 > 使用CA签发证书。这种步骤，那么我们现在就来尝试下。
创建证书的颁发机构 首先，会从将从创建 CA 开始。CA 会被用来签署其他证书
go 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // 对证书进行签名 ca := &amp;x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ CommonName: "domain name", Organization: []string{"Company, INC."}, Country: []string{"US"}, Province: []string{""}, Locality: []string{"San Francisco"}, StreetAddress: []string{"Golden Gate Bridge"}, PostalCode: []string{"94016"}, }, NotBefore: time.Now(), // 生效时间 NotAfter: time.Now().AddDate(10, 0, 0), // 过期时间 年月日 IsCA: true, // 表示用于CA // openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段 ExtKeyUsage: []x509.'><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2019/10/goskill-x509-in-go/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2019/10/goskill-x509-in-go/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="使用go语言颁发CA证书"><meta property="og:description" content='本篇文章中，将描述如何使用go创建CA，并使用CA签署证书。在使用openssl创建证书时，遵循的步骤是 创建秘钥 > 创建CA > 生成要颁发证书的秘钥 > 使用CA签发证书。这种步骤，那么我们现在就来尝试下。
创建证书的颁发机构 首先，会从将从创建 CA 开始。CA 会被用来签署其他证书
go 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // 对证书进行签名 ca := &amp;x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ CommonName: "domain name", Organization: []string{"Company, INC."}, Country: []string{"US"}, Province: []string{""}, Locality: []string{"San Francisco"}, StreetAddress: []string{"Golden Gate Bridge"}, PostalCode: []string{"94016"}, }, NotBefore: time.Now(), // 生效时间 NotAfter: time.Now().AddDate(10, 0, 0), // 过期时间 年月日 IsCA: true, // 表示用于CA // openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段 ExtKeyUsage: []x509.'><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2019/10/goskill-x509-in-go/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-02T00:00:00+00:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用go语言颁发CA证书"><meta name=twitter:description content='本篇文章中，将描述如何使用go创建CA，并使用CA签署证书。在使用openssl创建证书时，遵循的步骤是 创建秘钥 > 创建CA > 生成要颁发证书的秘钥 > 使用CA签发证书。这种步骤，那么我们现在就来尝试下。
创建证书的颁发机构 首先，会从将从创建 CA 开始。CA 会被用来签署其他证书
go 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // 对证书进行签名 ca := &amp;x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ CommonName: "domain name", Organization: []string{"Company, INC."}, Country: []string{"US"}, Province: []string{""}, Locality: []string{"San Francisco"}, StreetAddress: []string{"Golden Gate Bridge"}, PostalCode: []string{"94016"}, }, NotBefore: time.Now(), // 生效时间 NotAfter: time.Now().AddDate(10, 0, 0), // 过期时间 年月日 IsCA: true, // 表示用于CA // openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段 ExtKeyUsage: []x509.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"使用go语言颁发CA证书","item":"https://www.oomkill.com/2019/10/goskill-x509-in-go/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用go语言颁发CA证书","name":"使用go语言颁发CA证书","description":"本篇文章中，将描述如何使用go创建CA，并使用CA签署证书。在使用openssl创建证书时，遵循的步骤是 创建秘钥 \u0026gt; 创建CA \u0026gt; 生成要颁发证书的秘钥 \u0026gt; 使用CA签发证书。这种步骤，那么我们现在就来尝试下。\n创建证书的颁发机构 首先，会从将从创建 CA 开始。CA 会被用来签署其他证书\ngo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // 对证书进行签名 ca := \u0026amp;x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ CommonName: \u0026#34;domain name\u0026#34;, Organization: []string{\u0026#34;Company, INC.\u0026#34;}, Country: []string{\u0026#34;US\u0026#34;}, Province: []string{\u0026#34;\u0026#34;}, Locality: []string{\u0026#34;San Francisco\u0026#34;}, StreetAddress: []string{\u0026#34;Golden Gate Bridge\u0026#34;}, PostalCode: []string{\u0026#34;94016\u0026#34;}, }, NotBefore: time.Now(), // 生效时间 NotAfter: time.Now().AddDate(10, 0, 0), // 过期时间 年月日 IsCA: true, // 表示用于CA // openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段 ExtKeyUsage: []x509.","keywords":["golang"],"articleBody":"本篇文章中，将描述如何使用go创建CA，并使用CA签署证书。在使用openssl创建证书时，遵循的步骤是 创建秘钥 \u003e 创建CA \u003e 生成要颁发证书的秘钥 \u003e 使用CA签发证书。这种步骤，那么我们现在就来尝试下。\n创建证书的颁发机构 首先，会从将从创建 CA 开始。CA 会被用来签署其他证书\ngo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // 对证书进行签名 ca := \u0026x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ CommonName: \"domain name\", Organization: []string{\"Company, INC.\"}, Country: []string{\"US\"}, Province: []string{\"\"}, Locality: []string{\"San Francisco\"}, StreetAddress: []string{\"Golden Gate Bridge\"}, PostalCode: []string{\"94016\"}, }, NotBefore: time.Now(), // 生效时间 NotAfter: time.Now().AddDate(10, 0, 0), // 过期时间 年月日 IsCA: true, // 表示用于CA // openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段 ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth, x509.ExtKeyUsageServerAuth}, // openssl 中的 keyUsage 字段 KeyUsage: x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign, BasicConstraintsValid: true, } 接下来需要对证书生成公钥和私钥\ngo 1 2 3 4 caPrivKey, err := rsa.GenerateKey(rand.Reader, 4096) if err != nil { return err } 然后生成证书：\ngo 1 2 3 4 caBytes, err := x509.CreateCertificate(rand.Reader, ca, ca, \u0026caPrivKey.PublicKey, caPrivKey) if err != nil { return err } 我们看到的证书内容是PEM编码后的，现在caBytes我们有了生成的证书，我们将其进行 PEM 编码以供以后使用：\ngo 1 2 3 4 5 6 7 8 9 10 11 caPEM := new(bytes.Buffer) pem.Encode(caPEM, \u0026pem.Block{ Type: \"CERTIFICATE\", Bytes: caBytes, }) caPrivKeyPEM := new(bytes.Buffer) pem.Encode(caPrivKeyPEM, \u0026pem.Block{ Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(caPrivKey), }) 创建证书 证书的 x509.Certificate 与CA的 x509.Certificate 属性有稍微不同，需要进行一些修改\ngo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 cert := \u0026x509.Certificate{ SerialNumber: big.NewInt(1658), Subject: pkix.Name{ CommonName: \"domain name\", Organization: []string{\"Company, INC.\"}, Country: []string{\"US\"}, Province: []string{\"\"}, Locality: []string{\"San Francisco\"}, StreetAddress: []string{\"Golden Gate Bridge\"}, PostalCode: []string{\"94016\"}, }, IPAddresses: []net.IP{}, // 这里就是openssl配置文件中 subjectAltName 里的 IP:/IP= DNSNames: []string{}, // 这里就是openssl配置文件中 subjectAltName 里的 DNS:/DNS= NotBefore: time.Now(), NotAfter: time.Now().AddDate(10, 0, 0), SubjectKeyId: []byte{1, 2, 3, 4, 6}, // 这里就是openssl中的extendedKeyUsage ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth, x509.ExtKeyUsageServerAuth}, KeyUsage: x509.KeyUsageDigitalSignature, } 注：这里会在证书中特别添加了 DNS 和 IP （这个不是必须的），这个选项的增加代表的我们的证书可以支持多域名\n为该证书创建私钥和公钥：\ngo 1 2 3 4 certPrivKey, err := rsa.GenerateKey(rand.Reader, 4096) if err != nil { return err } 使用CA签署证书 有了上述的内容后，可以创建证书并用CA进行签名\ngo 1 2 3 4 certBytes, err := x509.CreateCertificate(rand.Reader, cert, ca, \u0026certPrivKey.PublicKey, caPrivKey) if err != nil { return err } 要保存成证书格式需要做PEM编码\ngo 1 2 3 4 5 6 7 8 9 10 11 certPEM := new(bytes.Buffer) pem.Encode(certPEM, \u0026pem.Block{ Type: \"CERTIFICATE\", Bytes: certBytes, }) certPrivKeyPEM := new(bytes.Buffer) pem.Encode(certPrivKeyPEM, \u0026pem.Block{ Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(certPrivKey), }) 把上面内容融合为一起 创建一个 ca.go 里面是创建ca和颁发证书的逻辑\ngo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 package main import ( \"bytes\" cr \"crypto/rand\" \"crypto/rsa\" \"crypto/x509\" \"crypto/x509/pkix\" \"encoding/pem\" \"math/big\" \"math/rand\" \"net\" \"os\" \"time\" ) type CERT struct { CERT []byte CERTKEY *rsa.PrivateKey CERTPEM *bytes.Buffer CERTKEYPEM *bytes.Buffer CSR *x509.Certificate } func CreateCA(sub *pkix.Name, expire int) (*CERT, error) { var ( ca = new(CERT) err error ) if expire \u003c 1 { expire = 1 } // 为ca生成私钥 ca.CERTKEY, err = rsa.GenerateKey(cr.Reader, 4096) if err != nil { return nil, err } // 对证书进行签名 ca.CSR = \u0026x509.Certificate{ SerialNumber: big.NewInt(rand.Int63n(2000)), Subject: *sub, NotBefore: time.Now(), // 生效时间 NotAfter: time.Now().AddDate(expire, 0, 0), // 过期时间 IsCA: true, // 表示用于CA // openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段 ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth, x509.ExtKeyUsageServerAuth}, // openssl 中的 keyUsage 字段 KeyUsage: x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign, BasicConstraintsValid: true, } // 创建证书 // caBytes 就是生成的证书 ca.CERT, err = x509.CreateCertificate(cr.Reader, ca.CSR, ca.CSR, \u0026ca.CERTKEY.PublicKey, ca.CERTKEY) if err != nil { return nil, err } ca.CERTPEM = new(bytes.Buffer) pem.Encode(ca.CERTPEM, \u0026pem.Block{ Type: \"CERTIFICATE\", Bytes: ca.CERT, }) ca.CERTKEYPEM = new(bytes.Buffer) pem.Encode(ca.CERTKEYPEM, \u0026pem.Block{ Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(ca.CERTKEY), }) // 进行PEM编码，编码就是直接cat证书里面内容显示的东西 return ca, nil } func Req(ca *x509.Certificate, sub *pkix.Name, expire int, dns []string, ip []net.IP) (*CERT, error) { var ( cert = \u0026CERT{} err error ) cert.CERTKEY, err = rsa.GenerateKey(cr.Reader, 4096) if err != nil { return nil, err } if expire \u003c 1 { expire = 1 } cert.CSR = \u0026x509.Certificate{ SerialNumber: big.NewInt(rand.Int63n(2000)), Subject: *sub, IPAddresses: ip, DNSNames: dns, NotBefore: time.Now(), NotAfter: time.Now().AddDate(expire, 0, 0), SubjectKeyId: []byte{1, 2, 3, 4, 6}, ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth, x509.ExtKeyUsageServerAuth}, KeyUsage: x509.KeyUsageDigitalSignature, } cert.CERT, err = x509.CreateCertificate(cr.Reader, cert.CSR, ca, \u0026cert.CERTKEY.PublicKey, cert.CERTKEY) if err != nil { return nil, err } cert.CERTPEM = new(bytes.Buffer) pem.Encode(cert.CERTPEM, \u0026pem.Block{ Type: \"CERTIFICATE\", Bytes: cert.CERT, }) cert.CERTKEYPEM = new(bytes.Buffer) pem.Encode(cert.CERTKEYPEM, \u0026pem.Block{ Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(cert.CERTKEY), }) return cert, nil } func Write(cert *CERT, file string) error { keyFileName := file + \".key\" certFIleName := file + \".crt\" kf, err := os.Create(keyFileName) if err != nil { return err } defer kf.Close() if _, err := kf.Write(cert.CERTKEYPEM.Bytes()); err != nil { return err } cf, err := os.Create(certFIleName) if err != nil { return err } if _, err := cf.Write(cert.CERTPEM.Bytes()); err != nil { return err } return nil } 如果需要使用的话，可以引用这些函数\ngo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 package main import ( \"crypto/x509/pkix\" \"log\" \"net\" ) func main() { subj := \u0026pkix.Name{ CommonName: \"chinamobile.com\", Organization: []string{\"Company, INC.\"}, Country: []string{\"US\"}, Province: []string{\"\"}, Locality: []string{\"San Francisco\"}, StreetAddress: []string{\"Golden Gate Bridge\"}, PostalCode: []string{\"94016\"}, } ca, err := CreateCA(subj, 10) if err != nil { log.Panic(err) } Write(ca, \"./ca\") crt, err := Req(ca.CSR, subj, 10, []string{\"test.default.svc\", \"test\"}, []net.IP{}) if err != nil { log.Panic(err) } Write(crt, \"./tls\") } 遇到的问题 panic: x509: unsupported public key type: rsa.PublicKey\n这里是因为 x509.CreateCertificate 的参数 privatekey 需要传入引用变量，而传入的是一个普通变量\n注：x509: only RSA and ECDSA public keys supported\n一些参数的意思 extendedKeyUsage ：增强型密钥用法(参见\"new_oids\"字段)：服务器身份验证、客户端身份验证、时间戳。\ncnf extendedKeyUsage = critical,serverAuth, clientAuth, timeStamping keyUsage ： 密钥用法，防否认(nonRepudiation)、数字签名(digitalSignature)、密钥加密(keyEncipherment)。\nconf keyUsage = nonRepudiation, digitalSignature, keyEncipherment Reference golang ca and signed cert go\npackage x509\n","wordCount":"997","inLanguage":"zh","datePublished":"2019-10-02T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2019/10/goskill-x509-in-go/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">使用go语言颁发CA证书</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2019-10-02</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>997 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>5 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/go/>#Go</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><ul><li><a href=#%e5%88%9b%e5%bb%ba%e8%af%81%e4%b9%a6%e7%9a%84%e9%a2%81%e5%8f%91%e6%9c%ba%e6%9e%84 aria-label=创建证书的颁发机构>创建证书的颁发机构</a><li><a href=#%e5%88%9b%e5%bb%ba%e8%af%81%e4%b9%a6 aria-label=创建证书>创建证书</a><li><a href=#%e4%bd%bf%e7%94%a8ca%e7%ad%be%e7%bd%b2%e8%af%81%e4%b9%a6 aria-label=使用CA签署证书>使用CA签署证书</a><li><a href=#%e6%8a%8a%e4%b8%8a%e9%9d%a2%e5%86%85%e5%ae%b9%e8%9e%8d%e5%90%88%e4%b8%ba%e4%b8%80%e8%b5%b7 aria-label=把上面内容融合为一起>把上面内容融合为一起</a><li><a href=#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98 aria-label=遇到的问题>遇到的问题</a><li><a href=#%e4%b8%80%e4%ba%9b%e5%8f%82%e6%95%b0%e7%9a%84%e6%84%8f%e6%80%9d aria-label=一些参数的意思>一些参数的意思</a></ul><li><a href=#reference aria-label=Reference>Reference</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><p>本篇文章中，将描述如何使用go创建CA，并使用CA签署证书。在使用openssl创建证书时，遵循的步骤是 创建秘钥 > 创建CA > 生成要颁发证书的秘钥 > 使用CA签发证书。这种步骤，那么我们现在就来尝试下。</p><h3 id=创建证书的颁发机构>创建证书的颁发机构<a hidden class=anchor aria-hidden=true href=#创建证书的颁发机构>#</a></h3><p>首先，会从将从创建 <em>CA</em> 开始。<em>CA</em> 会被用来签署其他证书</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 对证书进行签名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ca</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>x509</span><span class=p>.</span><span class=nx>Certificate</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>SerialNumber</span><span class=p>:</span> <span class=nx>big</span><span class=p>.</span><span class=nf>NewInt</span><span class=p>(</span><span class=mi>2019</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nx>Subject</span><span class=p>:</span> <span class=nx>pkix</span><span class=p>.</span><span class=nx>Name</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>CommonName</span><span class=p>:</span>    <span class=s>&#34;domain name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Organization</span><span class=p>:</span>  <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Company, INC.&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Country</span><span class=p>:</span>       <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;US&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Province</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Locality</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;San Francisco&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>StreetAddress</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Golden Gate Bridge&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>PostalCode</span><span class=p>:</span>    <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;94016&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>NotBefore</span><span class=p>:</span>             <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span>  <span class=c1>// 生效时间
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>NotAfter</span><span class=p>:</span>              <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>AddDate</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=c1>// 过期时间 年月日
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>IsCA</span><span class=p>:</span>                  <span class=kc>true</span><span class=p>,</span> <span class=c1>// 表示用于CA
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ExtKeyUsage</span><span class=p>:</span>           <span class=p>[]</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsage</span><span class=p>{</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageClientAuth</span><span class=p>,</span> <span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageServerAuth</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// openssl 中的 keyUsage 字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>KeyUsage</span><span class=p>:</span>              <span class=nx>x509</span><span class=p>.</span><span class=nx>KeyUsageDigitalSignature</span> <span class=p>|</span> <span class=nx>x509</span><span class=p>.</span><span class=nx>KeyUsageCertSign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>BasicConstraintsValid</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>接下来需要对证书生成公钥和私钥</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>caPrivKey</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rsa</span><span class=p>.</span><span class=nf>GenerateKey</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>然后生成证书：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>caBytes</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>CreateCertificate</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=nx>ca</span><span class=p>,</span> <span class=nx>ca</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>caPrivKey</span><span class=p>.</span><span class=nx>PublicKey</span><span class=p>,</span> <span class=nx>caPrivKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>我们看到的证书内容是PEM编码后的，现在<code>caBytes</code>我们有了生成的证书，我们将其进行 PEM 编码以供以后使用：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>caPEM</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>caPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;CERTIFICATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>caBytes</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>caPrivKeyPEM</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>caPrivKeyPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;RSA PRIVATE KEY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>MarshalPKCS1PrivateKey</span><span class=p>(</span><span class=nx>caPrivKey</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>})</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=创建证书>创建证书<a hidden class=anchor aria-hidden=true href=#创建证书>#</a></h3><p>证书的 <code>x509.Certificate</code> 与CA的 <code>x509.Certificate</code> 属性有稍微不同，需要进行一些修改</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>cert</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>x509</span><span class=p>.</span><span class=nx>Certificate</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>SerialNumber</span><span class=p>:</span> <span class=nx>big</span><span class=p>.</span><span class=nf>NewInt</span><span class=p>(</span><span class=mi>1658</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nx>Subject</span><span class=p>:</span> <span class=nx>pkix</span><span class=p>.</span><span class=nx>Name</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>CommonName</span><span class=p>:</span>    <span class=s>&#34;domain name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Organization</span><span class=p>:</span>  <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Company, INC.&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Country</span><span class=p>:</span>       <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;US&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Province</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Locality</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;San Francisco&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>StreetAddress</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Golden Gate Bridge&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>PostalCode</span><span class=p>:</span>    <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;94016&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>IPAddresses</span><span class=p>:</span>  <span class=p>[]</span><span class=nx>net</span><span class=p>.</span><span class=nx>IP</span><span class=p>{},</span> <span class=c1>// 这里就是openssl配置文件中 subjectAltName 里的 IP:/IP=
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>DNSNames</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span> <span class=c1>// 这里就是openssl配置文件中 subjectAltName 里的 DNS:/DNS=
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>NotBefore</span><span class=p>:</span>    <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>	<span class=nx>NotAfter</span><span class=p>:</span>     <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>AddDate</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nx>SubjectKeyId</span><span class=p>:</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 这里就是openssl中的extendedKeyUsage 
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ExtKeyUsage</span><span class=p>:</span>  <span class=p>[]</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsage</span><span class=p>{</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageClientAuth</span><span class=p>,</span> <span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageServerAuth</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>KeyUsage</span><span class=p>:</span>     <span class=nx>x509</span><span class=p>.</span><span class=nx>KeyUsageDigitalSignature</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p>注：这里会在证书中特别添加了 <code>DNS</code> 和 <code>IP</code> （这个不是必须的），这个选项的增加代表的我们的证书可以支持多域名</p></blockquote><p>为该证书创建私钥和公钥：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>certPrivKey</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rsa</span><span class=p>.</span><span class=nf>GenerateKey</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=使用ca签署证书>使用CA签署证书<a hidden class=anchor aria-hidden=true href=#使用ca签署证书>#</a></h3><p>有了上述的内容后，可以创建证书并用CA进行签名</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>certBytes</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>CreateCertificate</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=nx>cert</span><span class=p>,</span> <span class=nx>ca</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>certPrivKey</span><span class=p>.</span><span class=nx>PublicKey</span><span class=p>,</span> <span class=nx>caPrivKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>要保存成证书格式需要做PEM编码</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>certPEM</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>certPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;CERTIFICATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>certBytes</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>certPrivKeyPEM</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>certPrivKeyPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;RSA PRIVATE KEY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>MarshalPKCS1PrivateKey</span><span class=p>(</span><span class=nx>certPrivKey</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>})</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=把上面内容融合为一起>把上面内容融合为一起<a hidden class=anchor aria-hidden=true href=#把上面内容融合为一起>#</a></h3><p>创建一个 <code>ca.go</code> 里面是创建ca和颁发证书的逻辑</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;bytes&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>cr</span> <span class=s>&#34;crypto/rand&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;crypto/rsa&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;crypto/x509&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;crypto/x509/pkix&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;encoding/pem&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;math/big&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;math/rand&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CERT</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CERT</span>       <span class=p>[]</span><span class=kt>byte</span>
</span></span><span class=line><span class=cl>	<span class=nx>CERTKEY</span>    <span class=o>*</span><span class=nx>rsa</span><span class=p>.</span><span class=nx>PrivateKey</span>
</span></span><span class=line><span class=cl>	<span class=nx>CERTPEM</span>    <span class=o>*</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=nx>CERTKEYPEM</span> <span class=o>*</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=nx>CSR</span>        <span class=o>*</span><span class=nx>x509</span><span class=p>.</span><span class=nx>Certificate</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>CreateCA</span><span class=p>(</span><span class=nx>sub</span> <span class=o>*</span><span class=nx>pkix</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>expire</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>CERT</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>ca</span>  <span class=p>=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>CERT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>expire</span> <span class=p>&lt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>expire</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 为ca生成私钥
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ca</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>rsa</span><span class=p>.</span><span class=nf>GenerateKey</span><span class=p>(</span><span class=nx>cr</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 对证书进行签名
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ca</span><span class=p>.</span><span class=nx>CSR</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>x509</span><span class=p>.</span><span class=nx>Certificate</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>SerialNumber</span><span class=p>:</span> <span class=nx>big</span><span class=p>.</span><span class=nf>NewInt</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nf>Int63n</span><span class=p>(</span><span class=mi>2000</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>		<span class=nx>Subject</span><span class=p>:</span>      <span class=o>*</span><span class=nx>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>NotBefore</span><span class=p>:</span>    <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span>                       <span class=c1>// 生效时间
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>NotAfter</span><span class=p>:</span>     <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>AddDate</span><span class=p>(</span><span class=nx>expire</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=c1>// 过期时间
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>IsCA</span><span class=p>:</span>         <span class=kc>true</span><span class=p>,</span>                             <span class=c1>// 表示用于CA
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// openssl 中的 extendedKeyUsage = clientAuth, serverAuth 字段
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>ExtKeyUsage</span><span class=p>:</span> <span class=p>[]</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsage</span><span class=p>{</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageClientAuth</span><span class=p>,</span> <span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageServerAuth</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=c1>// openssl 中的 keyUsage 字段
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>KeyUsage</span><span class=p>:</span>              <span class=nx>x509</span><span class=p>.</span><span class=nx>KeyUsageDigitalSignature</span> <span class=p>|</span> <span class=nx>x509</span><span class=p>.</span><span class=nx>KeyUsageCertSign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>BasicConstraintsValid</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 创建证书
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// caBytes 就是生成的证书
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ca</span><span class=p>.</span><span class=nx>CERT</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>CreateCertificate</span><span class=p>(</span><span class=nx>cr</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=nx>ca</span><span class=p>.</span><span class=nx>CSR</span><span class=p>,</span> <span class=nx>ca</span><span class=p>.</span><span class=nx>CSR</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>ca</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>.</span><span class=nx>PublicKey</span><span class=p>,</span> <span class=nx>ca</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>ca</span><span class=p>.</span><span class=nx>CERTPEM</span> <span class=p>=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>ca</span><span class=p>.</span><span class=nx>CERTPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;CERTIFICATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>ca</span><span class=p>.</span><span class=nx>CERT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=nx>ca</span><span class=p>.</span><span class=nx>CERTKEYPEM</span> <span class=p>=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>ca</span><span class=p>.</span><span class=nx>CERTKEYPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;RSA PRIVATE KEY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>MarshalPKCS1PrivateKey</span><span class=p>(</span><span class=nx>ca</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 进行PEM编码，编码就是直接cat证书里面内容显示的东西
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=nx>ca</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Req</span><span class=p>(</span><span class=nx>ca</span> <span class=o>*</span><span class=nx>x509</span><span class=p>.</span><span class=nx>Certificate</span><span class=p>,</span> <span class=nx>sub</span> <span class=o>*</span><span class=nx>pkix</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>expire</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>dns</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span> <span class=nx>ip</span> <span class=p>[]</span><span class=nx>net</span><span class=p>.</span><span class=nx>IP</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>CERT</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>cert</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>CERT</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span>  <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>rsa</span><span class=p>.</span><span class=nf>GenerateKey</span><span class=p>(</span><span class=nx>cr</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>expire</span> <span class=p>&lt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>expire</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>cert</span><span class=p>.</span><span class=nx>CSR</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>x509</span><span class=p>.</span><span class=nx>Certificate</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>SerialNumber</span><span class=p>:</span> <span class=nx>big</span><span class=p>.</span><span class=nf>NewInt</span><span class=p>(</span><span class=nx>rand</span><span class=p>.</span><span class=nf>Int63n</span><span class=p>(</span><span class=mi>2000</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>		<span class=nx>Subject</span><span class=p>:</span>      <span class=o>*</span><span class=nx>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>IPAddresses</span><span class=p>:</span>  <span class=nx>ip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>DNSNames</span><span class=p>:</span>     <span class=nx>dns</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>NotBefore</span><span class=p>:</span>    <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>		<span class=nx>NotAfter</span><span class=p>:</span>     <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>AddDate</span><span class=p>(</span><span class=nx>expire</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>SubjectKeyId</span><span class=p>:</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>ExtKeyUsage</span><span class=p>:</span>  <span class=p>[]</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsage</span><span class=p>{</span><span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageClientAuth</span><span class=p>,</span> <span class=nx>x509</span><span class=p>.</span><span class=nx>ExtKeyUsageServerAuth</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>KeyUsage</span><span class=p>:</span>     <span class=nx>x509</span><span class=p>.</span><span class=nx>KeyUsageDigitalSignature</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>cert</span><span class=p>.</span><span class=nx>CERT</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>CreateCertificate</span><span class=p>(</span><span class=nx>cr</span><span class=p>.</span><span class=nx>Reader</span><span class=p>,</span> <span class=nx>cert</span><span class=p>.</span><span class=nx>CSR</span><span class=p>,</span> <span class=nx>ca</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>.</span><span class=nx>PublicKey</span><span class=p>,</span> <span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>cert</span><span class=p>.</span><span class=nx>CERTPEM</span> <span class=p>=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>cert</span><span class=p>.</span><span class=nx>CERTPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;CERTIFICATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>cert</span><span class=p>.</span><span class=nx>CERT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEYPEM</span> <span class=p>=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>pem</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEYPEM</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pem</span><span class=p>.</span><span class=nx>Block</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Type</span><span class=p>:</span>  <span class=s>&#34;RSA PRIVATE KEY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Bytes</span><span class=p>:</span> <span class=nx>x509</span><span class=p>.</span><span class=nf>MarshalPKCS1PrivateKey</span><span class=p>(</span><span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEY</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>cert</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Write</span><span class=p>(</span><span class=nx>cert</span> <span class=o>*</span><span class=nx>CERT</span><span class=p>,</span> <span class=nx>file</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>keyFileName</span> <span class=o>:=</span> <span class=nx>file</span> <span class=o>+</span> <span class=s>&#34;.key&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>certFIleName</span> <span class=o>:=</span> <span class=nx>file</span> <span class=o>+</span> <span class=s>&#34;.crt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>kf</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>keyFileName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>kf</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>kf</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>cert</span><span class=p>.</span><span class=nx>CERTKEYPEM</span><span class=p>.</span><span class=nf>Bytes</span><span class=p>());</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>cf</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>certFIleName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cf</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>cert</span><span class=p>.</span><span class=nx>CERTPEM</span><span class=p>.</span><span class=nf>Bytes</span><span class=p>());</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>如果需要使用的话，可以引用这些函数</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>go</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;crypto/x509/pkix&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>subj</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>pkix</span><span class=p>.</span><span class=nx>Name</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>CommonName</span><span class=p>:</span>    <span class=s>&#34;chinamobile.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Organization</span><span class=p>:</span>  <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Company, INC.&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Country</span><span class=p>:</span>       <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;US&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Province</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Locality</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;San Francisco&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>StreetAddress</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Golden Gate Bridge&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>PostalCode</span><span class=p>:</span>    <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;94016&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>ca</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>CreateCA</span><span class=p>(</span><span class=nx>subj</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nf>Write</span><span class=p>(</span><span class=nx>ca</span><span class=p>,</span> <span class=s>&#34;./ca&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>crt</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>Req</span><span class=p>(</span><span class=nx>ca</span><span class=p>.</span><span class=nx>CSR</span><span class=p>,</span> <span class=nx>subj</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;test.default.svc&#34;</span><span class=p>,</span> <span class=s>&#34;test&#34;</span><span class=p>},</span> <span class=p>[]</span><span class=nx>net</span><span class=p>.</span><span class=nx>IP</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nf>Write</span><span class=p>(</span><span class=nx>crt</span><span class=p>,</span> <span class=s>&#34;./tls&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=遇到的问题>遇到的问题<a hidden class=anchor aria-hidden=true href=#遇到的问题>#</a></h3><p><strong>panic: x509: unsupported public key type: rsa.PublicKey</strong></p><p>这里是因为 <code>x509.CreateCertificate</code> 的参数 <code>privatekey</code> 需要传入引用变量，而传入的是一个普通变量</p><blockquote><p><strong>注</strong>：x509: only RSA and ECDSA public keys supported</p></blockquote><h3 id=一些参数的意思>一些参数的意思<a hidden class=anchor aria-hidden=true href=#一些参数的意思>#</a></h3><p><code>extendedKeyUsage</code> ：增强型密钥用法(参见"new_oids"字段)：服务器身份验证、客户端身份验证、时间戳。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>cnf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-cnf data-lang=cnf>extendedKeyUsage = critical,serverAuth, clientAuth, timeStamping</code></pre></div></div><p><code>keyUsage </code>： 密钥用法，防否认(nonRepudiation)、数字签名(digitalSignature)、密钥加密(keyEncipherment)。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>keyUsage = nonRepudiation, digitalSignature, keyEncipherment</code></pre></div></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><p><a href=https://shaneutt.com/blog/golang-ca-and-signed-cert-go/ target=_blank rel="noopener nofollow noreferrer">golang ca and signed cert go</a></p><p><a href=https://golang.google.cn/pkg/crypto/x509/ target=_blank rel="noopener nofollow noreferrer">package x509</a></p></blockquote></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：使用go语言颁发CA证书</p><p>文章链接：<a href=https://www.oomkill.com/2019/10/goskill-x509-in-go/ target=_blank>https://www.oomkill.com/2019/10/goskill-x509-in-go/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2019/10/go-mod/><span>Go mod</span></a></li><li><a href=/2019/10/go-tcp-in-go/><span>Go socket TCP协议实现</span></a></li><li><a href=/2019/10/go-function/><span>Go 函数 function</span></a></li><li><a href=/2019/10/go-datastruct/><span>Go 数据结构</span></a></li><li><a href=/2019/10/go-arithmetic/><span>Go 运算符</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/go/>Go</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2019/10/goskill-process-id/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>如何使用golang通过进程ID找到进程名称</span>
</a><a class=next href=https://www.oomkill.com/2019/10/go-tcp-hadshake/><span class=title></span>
<span>通过Go语言中阐述TCP Handshake&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/goskill-x509-in-go","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>