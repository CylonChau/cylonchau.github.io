<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Ceph集群安装 - ceph-deploy | Cylon&#39;s Collection</title>
<meta name="keywords" content="Install Ceph with ceph-deploy on Centos7, 在Centos7上使用ceph-deploy安装ceph集群, ceph-deploy, ceph install">
<meta name="description" content="Ceph集群安装 - ceph-deploy - Cylon&#39;s Collection">
<meta name="author" content="cylon">
<link rel="canonical" href="https://www.oomkill.com/2019/11/02-2-install-ceph-with-ceph-deploy/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.df0e7f0648f287aca44f5b657ff5602f436346895340daaa6589b3049a979f73.css" integrity="sha256-3w5/Bkjyh6ykT1tlf/VgL0NjRolTQNqqZYmzBJqXn3M=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.oomkill.com/favicon.ico">
<link rel="apple-touch-icon" href="https://www.oomkill.com/apple-touch-icon.png">

<meta name="twitter:title" content="Ceph集群安装 - ceph-deploy | Cylon&#39;s Collection" />
<meta name="twitter:description" content="" />
<meta property="og:title" content="Ceph集群安装 - ceph-deploy | Cylon&#39;s Collection" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.oomkill.com/2019/11/02-2-install-ceph-with-ceph-deploy/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2019-11-18T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2023-09-10T23:10:36&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.oomkill.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Ceph集群安装 - ceph-deploy",
      "item": "https://www.oomkill.com/2019/11/02-2-install-ceph-with-ceph-deploy/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Ceph集群安装 - ceph-deploy | Cylon's Collection",
  "name": "Ceph集群安装 - ceph-deploy",
  "description": "",
  "keywords": [
    "Install Ceph with ceph-deploy on Centos7", "在Centos7上使用ceph-deploy安装ceph集群", "ceph-deploy", "ceph install"
  ],
  "wordCount" : "5840",
  "inLanguage": "zh",
  "datePublished": "2019-11-18T00:00:00Z",
  "dateModified": "2023-09-10T23:10:36+08:00",
  "author":{
    "@type": "Person",
    "name": "cylon"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.oomkill.com/2019/11/02-2-install-ceph-with-ceph-deploy/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cylon's Collection",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.oomkill.com/favicon.ico"
    }
  }
}
</script><script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.oomkill.com" accesskey="h" title="Cylon&#39;s Collection (Alt + H)">Cylon&#39;s Collection</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.oomkill.com/archives/" title="归档"
                >归档
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/tags/" title="标签"
                >标签
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/search/" title="搜索 (Alt &#43; /)"data-no-instant accesskey=/
                >搜索
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/about/" title="关于"
                >关于
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header"><h1 class="post-title">Ceph集群安装 - ceph-deploy</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2019-11-18</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>Edited on 2023-09-10</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="https://www.oomkill.com/tags/storage/">storage</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>12 分钟</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" aria-label="环境配置">环境配置</a><ul>
                        
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2%e5%b7%a5%e5%85%b7" aria-label="部署工具">部署工具</a></li>
                <li>
                    <a href="#ceph-%e9%9b%86%e7%be%a4%e6%8b%93%e6%89%91%e5%8f%8a%e7%bd%91%e7%bb%9c" aria-label="CEPH 集群拓扑及网络">CEPH 集群拓扑及网络</a></li></ul>
                </li>
                <li>
                    <a href="#ceph-deploy-%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6%e9%85%8d%e7%bd%ae" aria-label="ceph-deploy 先决条件配置">ceph-deploy 先决条件配置</a><ul>
                        
                <li>
                    <a href="#debianubuntu" aria-label="Debian/Ubuntu">Debian/Ubuntu</a></li>
                <li>
                    <a href="#rhelcentos" aria-label="RHEL/CentOS">RHEL/CentOS</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e9%9b%86%e7%be%a4%e7%9a%84%e9%a2%84%e5%85%88%e6%9d%a1%e4%bb%b6---ceph-node" aria-label="安装集群的预先条件 - CEPH NODE">安装集群的预先条件 - CEPH NODE</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%94%a8%e4%ba%8e-ceph-deploy-%e7%9a%84%e7%94%a8%e6%88%b7" aria-label="创建用于 ceph-deploy 的用户">创建用于 <em>ceph-deploy</em> 的用户</a></li>
                <li>
                    <a href="#%e5%90%af%e7%94%a8-ssh-%e6%97%a0%e5%af%86%e7%a0%81%e7%99%bb%e5%bd%95" aria-label="启用 SSH 无密码登录">启用 SSH 无密码登录</a></li>
                <li>
                    <a href="#%e7%bd%91%e5%8d%a1%e5%bc%80%e6%9c%ba%e8%87%aa%e5%90%af%e5%8a%a8" aria-label="网卡开机自启动">网卡开机自启动</a></li>
                <li>
                    <a href="#%e5%bc%80%e6%94%be%e6%89%80%e9%9c%80%e7%ab%af%e5%8f%a3" aria-label="开放所需端口">开放所需端口</a></li>
                <li>
                    <a href="#%e7%a1%ae%e4%bf%9d%e5%85%b3%e9%97%ad-selinux" aria-label="确保关闭 SELinux">确保关闭 SELinux</a></li>
                <li>
                    <a href="#preferences" aria-label="Preferences">Preferences</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e6%96%b0%e7%9a%84-ceph-%e9%9b%86%e7%be%a4" aria-label="初始化新的 CEPH 集群">初始化新的 CEPH 集群</a><ul>
                        
                <li>
                    <a href="#%e7%a1%ae%e4%bf%9d%e9%9b%86%e7%be%a4%e8%8a%82%e7%82%b9%e6%b8%85%e6%b4%81%e6%80%a7" aria-label="确保集群节点清洁性">确保集群节点清洁性</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e9%9b%86%e7%be%a4" aria-label="创建集群">创建集群</a></li></ul>
                </li>
                <li>
                    <a href="#troubleshooting" aria-label="Troubleshooting">Troubleshooting</a><ul>
                        
                <li>
                    <a href="#no-module-named-pkg_resources" aria-label="No module named pkg_resources">No module named pkg_resources</a></li>
                <li>
                    <a href="#runtimeerror-nosectionerror-no-section-ceph" aria-label="RuntimeError: NoSectionError: No section: &amp;lsquo;ceph&amp;rsquo;">RuntimeError: NoSectionError: No section: &lsquo;ceph&rsquo;</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%90%91-rados-%e9%9b%86%e7%be%a4%e6%b7%bb%e5%8a%a0-osd" aria-label="向 RADOS 集群添加 OSD">向 RADOS 集群添加 OSD</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%88%97%e5%87%ba%e5%b9%b6%e6%93%a6%e5%87%80%e7%a3%81%e7%9b%98" aria-label="列出并擦净磁盘">列出并擦净磁盘</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e6%89%a9%e5%b1%95%e9%9b%86%e7%be%a4" aria-label="扩展集群">扩展集群</a><ul>
                        
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0-osd" aria-label="添加 OSD">添加 OSD</a></li>
                <li>
                    <a href="#%e7%a7%bb%e9%99%a4-osd-%e7%9a%84" aria-label="移除 OSD 的">移除 OSD 的</a></li>
                <li>
                    <a href="#%e6%89%a9%e5%b1%95-ceph-mon" aria-label="扩展 ceph-mon">扩展 ceph-mon</a></li>
                <li>
                    <a href="#%e6%89%a9%e5%b1%95-manager-%e8%8a%82%e7%82%b9" aria-label="扩展 Manager 节点">扩展 Manager 节点</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8-rgw" aria-label="启动 RGW">启动 RGW</a></li>
                <li>
                    <a href="#%e5%90%af%e7%94%a8%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f-cephfs-%e6%8e%a5%e5%8f%a3" aria-label="启用文件系统 (CephFS) 接口">启用文件系统 (CephFS) 接口</a></li></ul>
                </li>
                <li>
                    <a href="#reference" aria-label="Reference">Reference</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    





<div class="copyrightTopBlock">
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <div class="articleSuffix-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
</div><h2 id="环境配置">环境配置<a hidden class="anchor" aria-hidden="true" href="#环境配置">¶</a></h2>
<p>Ceph 是一个开源去中心化存储平台，专为满足现代存储需求而设计。  Ceph可扩展至 EB 级，并且设计为无单点故障，使其成为需要高度可用的灵活存储的应用程序的理想选择。</p>
<p>下图显示了具有 Ceph 存储的示例 3 节点集群的布局。   两个网络接口可用于增加带宽和冗余，这有助于保持足够的带宽来满足存储要求，而不影响客户端应用程序。</p>
<p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/cylonchau/imgbed/img/image-20230910161024448.png" alt="image-20230910161024448"  /></p>
<center>图：Ceph存储集群</center>
<center><em>Source：</em>https://www.jamescoyle.net/how-to/1244-create-a-3-node-ceph-storage-cluster</center><br>
<p>图中架构表示了一个无单点故障的 3 节点 Ceph 集群，以提供高度冗余的存储。   每个节点都配置了两个磁盘；   一台运行 Linux 操作系统，另一台将用于 Ceph 存储。   下面的输出显示了可用的存储空间，每个主机上的存储空间完全相同。   <strong>/dev/sda</strong> 是包含操作系统安装的根分区，  <strong>/dev/sdb</strong> 是一个未触及的分区，将用于部署 Ceph 集群，对应的硬件信息如下表所示。</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>public IP</th>
<th>cluster IP</th>
<th>数据盘</th>
</tr>
</thead>
<tbody>
<tr>
<td>ceph-nautilus01</td>
<td>10.0.0.50</td>
<td>10.0.0.50</td>
<td>/dev/sda<br>/dev/sdb</td>
</tr>
<tr>
<td>ceph-nautilus02</td>
<td>10.0.0.51</td>
<td>10.0.0.51</td>
<td>/dev/sda<br/>/dev/sdb</td>
</tr>
<tr>
<td>ceph-nautilus03</td>
<td>10.0.0.52</td>
<td>10.0.0.52</td>
<td>/dev/sda<br/>/dev/sdb</td>
</tr>
<tr>
<td>ceph-control</td>
<td>10.0.0.49</td>
<td>10.0.0.49</td>
<td>/dev/sda</td>
</tr>
</tbody>
</table>
<h3 id="部署工具">部署工具<a hidden class="anchor" aria-hidden="true" href="#部署工具">¶</a></h3>
<p><em>ceph-deploy</em> 工具是在 “管理节点” (ceph-admin) 上的目录中运行。</p>
<ul>
<li>ceph-deploy 部署ceph的原生工具 (最后支持版本 octopus 15)
<ul>
<li>借助于ssh来管理目标主机，sudo,和一些 python 模块来完成 ceph 集群的部署和后期维护。</li>
<li>一般讲 <em>ceph-deploy</em>  放置在专用节点，作为 ceph 集群的管理节点。</li>
<li>ceph-deploy 不是一个通用的部署工具，只是用于管理Ceph集群的，专门为用户快速部署并运行一个Ceph集群，这些功能和特性不依赖于其他的编排工具。</li>
<li>它无法处理客户端的配置，因此在部署客户端时就无法使用此工具。</li>
</ul>
</li>
</ul>
<p>下图是来自 ceph 官网的 <em>ceph-deploy</em> 部署工具的一个模型图</p>
<p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/cylonchau/imgbed/img/image-20230910164114089.png" alt="image-20230910164114089"  /></p>
<center>图：ceph-deploy部署模型</center>
<center><em>Source：</em>https://docs.ceph.com/en/nautilus/start/quick-start-preflight/</center><br>
<h3 id="ceph-集群拓扑及网络">CEPH 集群拓扑及网络<a hidden class="anchor" aria-hidden="true" href="#ceph-集群拓扑及网络">¶</a></h3>
<p>在Ceph内部存在两种流量：</p>
<ul>
<li>Ceph内部各节点之间用来处理OSD之间数据复制，因此为了避免正常向客户端提供服务请求，</li>
<li><strong>public network</strong> 必须，所有客户端都应位于public network</li>
<li><strong>cluster network</strong> 可选</li>
</ul>
<h2 id="ceph-deploy-先决条件配置">ceph-deploy 先决条件配置<a hidden class="anchor" aria-hidden="true" href="#ceph-deploy-先决条件配置">¶</a></h2>
<p>将 Ceph 安装仓库添加到 “管理节点”。然后，安装 <em>ceph-deploy</em>。</p>
<h3 id="debianubuntu">Debian/Ubuntu<a hidden class="anchor" aria-hidden="true" href="#debianubuntu">¶</a></h3>
<ol>
<li>添加 release key</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget -q -O- <span class="s1">&#39;https://download.ceph.com/keys/release.asc&#39;</span> <span class="p">|</span> sudo apt-key add -
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>将 Ceph deb添加到您的存储库。并替换为安装的 Ceph 版本（例如 nautilus）。例如：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CEPH_VERSION</span><span class="o">=</span>nautilus
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> deb https://download.ceph.com/debian-<span class="si">${</span><span class="nv">CEPH_VERSION</span><span class="si">}</span>/ <span class="k">$(</span>lsb_release -sc<span class="k">)</span> main <span class="p">|</span> sudo tee /etc/apt/sources.list.d/ceph.list
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>更新仓库并安装 <em>ceph-deploy</em></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">sudo apt install ceph-deploy
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="rhelcentos">RHEL/CentOS<a hidden class="anchor" aria-hidden="true" href="#rhelcentos">¶</a></h3>
<ol>
<li>安装 epel 源，这里方式很多可以任意选择 “<strong>你所在地区可用的 epel 源</strong>”</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>添加 Ceph rpm 仓库</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CEPH_VERSION</span><span class="o">=</span>nautilus
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt; EOF &gt; /etc/yum.repos.d/ceph.repo
</span></span></span><span class="line"><span class="cl"><span class="s">[ceph]
</span></span></span><span class="line"><span class="cl"><span class="s">name=Ceph packages for $basearch
</span></span></span><span class="line"><span class="cl"><span class="s">baseurl=https://download.ceph.com/rpm-${CEPH_VERSION}/el7/\$basearch
</span></span></span><span class="line"><span class="cl"><span class="s">enabled=1
</span></span></span><span class="line"><span class="cl"><span class="s">priority=2
</span></span></span><span class="line"><span class="cl"><span class="s">gpgcheck=1
</span></span></span><span class="line"><span class="cl"><span class="s">gpgkey=https://download.ceph.com/keys/release.asc
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">[ceph-noarch]
</span></span></span><span class="line"><span class="cl"><span class="s">name=Ceph noarch packages
</span></span></span><span class="line"><span class="cl"><span class="s">baseurl=https://download.ceph.com/rpm-${CEPH_VERSION}/el7/noarch
</span></span></span><span class="line"><span class="cl"><span class="s">enabled=1
</span></span></span><span class="line"><span class="cl"><span class="s">priority=2
</span></span></span><span class="line"><span class="cl"><span class="s">gpgcheck=1
</span></span></span><span class="line"><span class="cl"><span class="s">gpgkey=https://download.ceph.com/keys/release.asc
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">[ceph-source]
</span></span></span><span class="line"><span class="cl"><span class="s">name=Ceph source packages
</span></span></span><span class="line"><span class="cl"><span class="s">baseurl=https://download.ceph.com/rpm-${CEPH_VERSION}/el7/SRPMS
</span></span></span><span class="line"><span class="cl"><span class="s">enabled=0
</span></span></span><span class="line"><span class="cl"><span class="s">priority=2
</span></span></span><span class="line"><span class="cl"><span class="s">gpgcheck=1
</span></span></span><span class="line"><span class="cl"><span class="s">gpgkey=https://download.ceph.com/keys/release.asc
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>更新缓存并安装 <em>ceph-deploy</em></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo yum clean all <span class="o">&amp;&amp;</span> sudo yum makecache
</span></span><span class="line"><span class="cl">sudo yum install ceph-deploy
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装集群的预先条件---ceph-node">安装集群的预先条件 - CEPH NODE<a hidden class="anchor" aria-hidden="true" href="#安装集群的预先条件---ceph-node">¶</a></h2>
<ul>
<li>管理节点必须拥有所有 ceph node 的无密码登录权限</li>
<li>ntp</li>
<li>开放端口</li>
<li>关闭 selinux</li>
</ul>
<h3 id="创建用于-ceph-deploy-的用户">创建用于 <em>ceph-deploy</em> 的用户<a hidden class="anchor" aria-hidden="true" href="#创建用于-ceph-deploy-的用户">¶</a></h3>
<p>ceph-deploy 实用程序必须以具有无密码 sudo 权限的用户身份登录 Ceph node，因为它需要在不提示输入密码的情况下安装软件和配置文件。</p>
<p>最新版本的 ceph-deploy 支持 &ndash;username 选项，因此您可以指定任何具有无密码的 sudo 用户（包括 root，但不推荐）。要使用 ceph-deploy &ndash;username {username}，“所指定的用户必须具有对 Ceph Node 的无密码 SSH 访问权限”，因为 ceph-deploy 不会提示您输入密码。</p>
<p>Ceph 官方建议在集群中的所有 Ceph 节点上为 ceph-deploy 创建特定用户。==请不要使用 “ceph” 作为用户名==。整个集群中的统一用户名可能会提高易用性（不是必需的），但您应该避免使用明显的用户名，因为黑客通常会通过暴力破解来使用它们（例如 root, admin, 或使用项目名称）。以下过程将 <code>{username}</code> 替换为您定义的用户名，描述了如何使用无密码 sudo 创建用户。</p>
<ol>
<li>在每个 Ceph Node 创建一个用户</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CEPH_USERNAME</span><span class="o">=</span>ceph
</span></span><span class="line"><span class="cl">sudo useradd -d /home/<span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span> -m <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> 1<span class="p">|</span>sudo passwd <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span> --stdin
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>对于添加到每个 Ceph Node 的新用户，请确保该用户具有 sudo 权限。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span><span class="s2"> ALL = (root) NOPASSWD:ALL&#34;</span> <span class="p">|</span> sudo tee /etc/sudoers.d/<span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">sudo chmod <span class="m">0440</span> /etc/sudoers.d/<span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="启用-ssh-无密码登录">启用 SSH 无密码登录<a hidden class="anchor" aria-hidden="true" href="#启用-ssh-无密码登录">¶</a></h3>
<p>由于 ceph-deploy 不会提示输入密码，因此必须在管理节点上生成 SSH 密钥并将公钥分发到每个 Ceph 节点。 <em>ceph-deploy</em> 将尝试为初始 monitor 生成 SSH 密钥。</p>
<ol>
<li>生成 ssh key，不要使用 sudo 或者是 root 用户</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ssh-keygen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Generating public/private key pair.
</span></span><span class="line"><span class="cl">Enter file in which to save the key <span class="o">(</span>/ceph-admin/.ssh/id_rsa<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter same passphrase again:
</span></span><span class="line"><span class="cl">Your identification has been saved in /ceph-admin/.ssh/id_rsa.
</span></span><span class="line"><span class="cl">Your public key has been saved in /ceph-admin/.ssh/id_rsa.pub.
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>将 SSH 密钥复制到每个 Ceph Node，将变量 “CEPH_USERNAME” 替换为创建 Ceph 部署用户创建的用户名。</li>
</ol>
<blockquote>
<p>通常情况下，主机名需要解析的，如果没有需要配置在 /etc/hosts 内</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh-copy-id <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>@ceph-nautilus01
</span></span><span class="line"><span class="cl">ssh-copy-id <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>@ceph-nautilus02
</span></span><span class="line"><span class="cl">ssh-copy-id <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>@ceph-nautilus03
</span></span><span class="line"><span class="cl"><span class="c1"># 如果是 root 用户执行下面命令</span>
</span></span><span class="line"><span class="cl">sudo -u <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span> ssh-copy-id <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>@ceph-nautilus01
</span></span><span class="line"><span class="cl">sudo -u <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span> ssh-copy-id <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>@ceph-nautilus02
</span></span><span class="line"><span class="cl">sudo -u <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span> ssh-copy-id <span class="si">${</span><span class="nv">CEPH_USERNAME</span><span class="si">}</span>@ceph-nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>添加主机名到 /etc/hosts (可选)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tee &gt;&gt; /etc/hosts <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">10.0.0.50 ceph-nautilus01
</span></span></span><span class="line"><span class="cl"><span class="s">10.0.0.51 ceph-nautilus02
</span></span></span><span class="line"><span class="cl"><span class="s">10.0.0.52 ceph-nautilus03
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="网卡开机自启动">网卡开机自启动<a hidden class="anchor" aria-hidden="true" href="#网卡开机自启动">¶</a></h3>
<p>Ceph OSD Peer 并通过网络向 Ceph monitor 报告。如果默认情况下网络处于关闭状态，则在启用网络之前，Ceph 集群无法在启动期间联机。</p>
<p>在一些 Linux 发行版下（例如 CentOS）上的默认配置默认关闭网络接口。确保在启动过程中网络接口打开，以便 Ceph 守护进程可以通过网络进行通信。(如果你的系统是新装的)</p>
<h3 id="开放所需端口">开放所需端口<a hidden class="anchor" aria-hidden="true" href="#开放所需端口">¶</a></h3>
<p>Ceph Monitor (ceph-mon) 默认使用端口 <strong>6789</strong> 进行通信。默认情况下，Ceph OSD 在 <strong>6800:7300</strong> 端口范围内进行通信。详细信息请参见网络配置参考 <sup><a href="#1">[1]</a></sup>。</p>
<h3 id="确保关闭-selinux">确保关闭 SELinux<a hidden class="anchor" aria-hidden="true" href="#确保关闭-selinux">¶</a></h3>
<p>在 CentOS 和 RHEL 上，SELinux 默认设置为“Enforcing”。为了简化您的安装，我们建议将 SELinux 设置为 Permissive 或完全禁用，这是 Ceph 官方给出的建议</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo setenforce <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>要持久配置 SELinux（如果 SELinux 存在问题，则建议这样做），请修改 <code>/etc/selinux/config</code> 中的配置文件。</p>
<h3 id="preferences">Preferences<a hidden class="anchor" aria-hidden="true" href="#preferences">¶</a></h3>
<p>确保您的 “包管理器” 已安装并启用 “priority/preferences”。在 CentOS 上，您可能需要安装 EPEL。在 RHEL 上，您可能需要启用可选存储库。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo yum install yum-plugin-priorities
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如，在 RHEL 7 服务器上，执行以下命令安装 yum-plugin-priorities 并启用 rhel-7-server-optional-rpms 存储库：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo yum install yum-plugin-priorities --enablerepo=rhel-7-server-optional-rpms
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="初始化新的-ceph-集群">初始化新的 CEPH 集群<a hidden class="anchor" aria-hidden="true" href="#初始化新的-ceph-集群">¶</a></h2>
<p>在这里我们创建一个包含一个 Ceph Monitor (<em>ceph-mon</em>) 和 三个 Ceph OSD (<em>osd daemon</em>) 的 Ceph 集群。通常使用 <em>ceph-deploy</em> 部署集群，最佳方式是在 “管理节点” 上创建一个目录，用于维护 ceph-deploy 为集群生成的配置文件和密钥。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir ceph-cluster <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ceph-cluster
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意的是，<em>ceph-deploy</em> 将文件输出到当前目录。执行 ceph-deploy 时需要确保位于此目录中。</p>
<p>还需要注意的是，需要使用 “<strong>SSH 免密的那个用户</strong>”</p>
<h3 id="确保集群节点清洁性">确保集群节点清洁性<a hidden class="anchor" aria-hidden="true" href="#确保集群节点清洁性">¶</a></h3>
<p>如果在任何时候遇到问题后并想重新开始，可以执行下列命令清除所有安装包和配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy purge <span class="o">{</span>ceph-node<span class="o">}</span> <span class="o">[{</span>ceph-node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">ceph-deploy purgedata <span class="o">{</span>ceph-node<span class="o">}</span> <span class="o">[{</span>ceph-node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">ceph-deploy forgetkeys
</span></span><span class="line"><span class="cl">rm ceph.*
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意的是，执行 ceph-deploy，必须执行第四条命令 <code>rm ceph.*</code></p>
<h3 id="创建集群">创建集群<a hidden class="anchor" aria-hidden="true" href="#创建集群">¶</a></h3>
<p>创建集群会生成配置文件保存到当前工作目录中，使用 ceph-deploy 执行命令新建一个集群。</p>
<ol>
<li>创建集群</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 语法</span>
</span></span><span class="line"><span class="cl">ceph-deploy new <span class="o">{</span>initial-monitor-node<span class="o">(</span>s<span class="o">)}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 示例, 指定节点的 hostname, fqdn or hostname:fqdn</span>
</span></span><span class="line"><span class="cl">ceph-deploy new ceph-nautilus01 ceph-nautilus02 ceph-nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><p>ceph-deploy 会输出到当前文件夹下的文件包含，Ceph 配置文件 (ceph.conf)、ceph-mon 的 keyring 文件 (ceph.mon.keyring) 以及新集群的日志文件。</p>
<ol start="2">
<li>如果主机存在多个网络接口（即公共网络和集群网络是分开的），需要在 Ceph 配置文件的 [global] 部分下添加公共网络设置。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">public <span class="nv">network</span> <span class="o">=</span> <span class="o">{</span>ip-address<span class="o">}</span>/<span class="o">{</span>bits<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 示例</span>
</span></span><span class="line"><span class="cl">public <span class="nv">network</span> <span class="o">=</span> 10.1.2.0/24
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者通过命令指定两个网络的 IP</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy new ceph-nautilus01 ceph-nautilus02 ceph-nautilus03 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--cluster-network 172.18.0.0/24 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--public-network 10.0.0.0/24
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>如果在 IPv6 环境中部署，请将以下内容添加到本地目录中的 ceph.conf 中：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> ms <span class="nb">bind</span> <span class="nv">ipv6</span> <span class="o">=</span> <span class="nb">true</span> &gt;&gt; ceph.conf
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>现在可以安装 ceph 软件包了，执行下列命令</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy install <span class="o">{</span>ceph-node<span class="o">}</span> <span class="o">[</span>...<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 示例</span>
</span></span><span class="line"><span class="cl">ceph-deploy install ceph-nautilus01 ceph-nautilus02 ceph-nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><p>在命令执行后，<em>ceph-deploy</em> 将在每个节点上安装 Ceph，所以要确保对应节点需要提前安装好了 ceph yum 仓库文件</p>
<p>也可以通过  <code>--release</code> 指定版本进行安装</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy install --release<span class="o">=</span>nautilus ceph-nautilus01 ceph-nautilus02 ceph-nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>部署 <em>ceph-mon</em> 并收集密钥：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy mon create-initial
</span></span></code></pre></td></tr></table>
</div>
</div><p>​	通常完成步骤5后，本地工作目录应具有以下 keyring 文件：</p>
<ul>
<li><code>ceph.client.admin.keyring</code></li>
<li><code>ceph.bootstrap-mgr.keyring</code></li>
<li><code>ceph.bootstrap-osd.keyring</code></li>
<li><code>ceph.bootstrap-mds.keyring</code></li>
<li><code>ceph.bootstrap-rgw.keyring</code></li>
<li><code>ceph.bootstrap-rbd.keyring</code></li>
<li><code>ceph.bootstrap-rbd-mirror.keyring</code></li>
</ul>
<ol start="6">
<li>使用 <em>ceph-deploy</em> 将配置文件和管理密钥复制到管理节点和 Ceph Node，以便可以在这些节点上使用 ceph CLI 时而无需在每次执行命令时指定 ceph-mon 地址和 keyring文件 (ceph.client.admin.keyring)。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy admin <span class="o">{</span>ceph-node<span class="o">(</span>s<span class="o">)}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 示例</span>
</span></span><span class="line"><span class="cl">ceph-deploy admin ceph-nautilus01 ceph-nautilus02 ceph-nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="7">
<li>部署 CEPH MANAGER (ceph-mgr)，此步骤仅需要 ==luminous+== 以上版本</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy mgr create <span class="o">{</span>ceph-node<span class="o">(</span>s<span class="o">)}</span>  *Required only <span class="k">for</span> luminous+ builds, i.e &gt;<span class="o">=</span> 12.x builds*
</span></span><span class="line"><span class="cl"><span class="c1"># 示例</span>
</span></span><span class="line"><span class="cl">ceph-deploy mgr create ceph-nautilus01
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="8">
<li>到步骤8时，只差 OSD 就完成了 RADOS 集群的安装，下面为集群添加 OSD</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy osd create --data <span class="o">{</span>device<span class="o">}</span> <span class="o">{</span>ceph-node<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 示例</span>
</span></span><span class="line"><span class="cl">ceph-deploy osd create --data /dev/sdb ceph-nautilus01
</span></span><span class="line"><span class="cl">ceph-deploy osd create --data /dev/sdb ceph-nautilus02
</span></span><span class="line"><span class="cl">ceph-deploy osd create --data /dev/sdb ceph-nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Note：如果要在 LVM 卷上创建 OSD，则 &ndash;data 的参数必须是 <code>{volume_group}/{lv_name}</code>，而不是卷的块设备的路径</p>
</blockquote>
<ol start="9">
<li>检查集群状态</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh node1 sudo ceph health
</span></span><span class="line"><span class="cl"><span class="c1"># or </span>
</span></span><span class="line"><span class="cl">ceph -s
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="troubleshooting">Troubleshooting<a hidden class="anchor" aria-hidden="true" href="#troubleshooting">¶</a></h2>
<h3 id="no-module-named-pkg_resources">No module named pkg_resources<a hidden class="anchor" aria-hidden="true" href="#no-module-named-pkg_resources">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ceph-deploy new ceph-nautilus01 ceph-nautilus02 ceph-nautilus03
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;/usr/bin/ceph-deploy&#34;</span>, line 18, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    from ceph_deploy.cli import main
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;/usr/lib/python2.7/site-packages/ceph_deploy/cli.py&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    import pkg_resources
</span></span><span class="line"><span class="cl">ImportError: No module named pkg_resources
</span></span></code></pre></td></tr></table>
</div>
</div><p>解决：This issue can be solved by installing <code>yum install -y python-setuptools</code>.</p>
<h3 id="runtimeerror-nosectionerror-no-section-ceph">RuntimeError: NoSectionError: No section: &lsquo;ceph&rsquo;<a hidden class="anchor" aria-hidden="true" href="#runtimeerror-nosectionerror-no-section-ceph">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,640<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span>   Installing : ceph-release-1-1.el7.noarch                                  1/1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,640<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span> warning: /etc/yum.repos.d/ceph.repo created as /etc/yum.repos.d/ceph.repo.rpmnew
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span>   Verifying  : ceph-release-1-1.el7.noarch                                  1/1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span> Installed:
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span>   ceph-release.noarch 0:1-1.el7                                                 
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>DEBUG <span class="o">]</span> Complete!
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,759<span class="o">][</span>ceph-nautilus01<span class="o">][</span>WARNING<span class="o">]</span> ensuring that /etc/yum.repos.d/ceph.repo contains a high priority
</span></span><span class="line"><span class="cl"><span class="o">[</span>2019-09-11 05:31:42,767<span class="o">][</span>ceph_deploy<span class="o">][</span>ERROR <span class="o">]</span> RuntimeError: NoSectionError: No section: <span class="s1">&#39;ceph&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>解决：CEPH Node 上不要安装 yum 仓库，<em>ceph-deploy</em> 会自动安装，如果存在新的文件会被命名为 <code>ceph.repo.rpmnew</code></p>
<h2 id="向-rados-集群添加-osd">向 RADOS 集群添加 OSD<a hidden class="anchor" aria-hidden="true" href="#向-rados-集群添加-osd">¶</a></h2>
<h4 id="列出并擦净磁盘">列出并擦净磁盘<a hidden class="anchor" aria-hidden="true" href="#列出并擦净磁盘">¶</a></h4>
<p><em>ceph-deploy disk</em> 命令可以检查并列出OSD节点上所有可用的磁盘相关的信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ceph-deploy disk list stor01 stor02 stor03 stor04
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果遇到 <code>Running command: sudo fdisk -l</code> 无输出，原因为系统问中文，修改 <em>en_us.utf8</em> 后可正常显示。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ceph-deploy disk list stor01
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/cephadmin/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /bin/ceph-deploy disk list stor01
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : list
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf instance at 0x7fab61201488&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : <span class="o">[</span><span class="s1">&#39;stor01&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> disk at 0x7fab6144e9b0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>stor01<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>stor01<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: stor01 
</span></span><span class="line"><span class="cl"><span class="o">[</span>stor01<span class="o">][</span>DEBUG <span class="o">]</span> detect platform information from remote host
</span></span><span class="line"><span class="cl"><span class="o">[</span>stor01<span class="o">][</span>DEBUG <span class="o">]</span> detect machine <span class="nb">type</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>stor01<span class="o">][</span>DEBUG <span class="o">]</span> find the location of an executable
</span></span><span class="line"><span class="cl"><span class="o">[</span>stor01<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo fdisk -l
</span></span></code></pre></td></tr></table>
</div>
</div><p>而后，在管理节点上使用 <em>ceph-deploy</em> 命令 擦除计划专用于OSD磁盘上的所有分区表和数据以便用于OSD，命令格式为<code>ceph-deploy disk zab {osd-server-name} {disk-name}</code>，需要注意的是此步会清除目标设备上的所有数据。</p>
<p>擦除一个磁盘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ceph-deploy disk zap
</span></span><span class="line"><span class="cl">ceph-deploy disk zap <span class="o">{</span>ceph_node<span class="o">}</span> /dev/sdb
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Note：如果是未格式化的块设备不需要额外擦除，ceph 集群要求 ceph 管理的块设备必须是未格式化的，如果格式化过的需要擦除</p>
</blockquote>
<p><em>ceph-deploy osd &ndash;help</em>：</p>
<ul>
<li><code>block-db</code> 可以理解为RocksDB数据库，元数据存放的位置</li>
<li><code>block-wal</code> 数据库的数据日志存放的位置</li>
<li><code>filestore</code> 如果使用<code>filestore</code>,明确指定选项<code>--filestore</code> 指明数据放哪，并指明日志放哪（日志指的是文件系统日志）<code>ceph-deploy osd create {node} --filestore --data /path/to/data --journal /path/to/journal</code></li>
<li>bluestore自身没有文件系统，故无需日志，数据库需要日志</li>
</ul>
<h2 id="扩展集群">扩展集群<a hidden class="anchor" aria-hidden="true" href="#扩展集群">¶</a></h2>
<h3 id="添加-osd">添加 OSD<a hidden class="anchor" aria-hidden="true" href="#添加-osd">¶</a></h3>
<p>当一个 “基本集群” 部署好并运行，下一步就是扩展集群。通常会扩展集群，扩展集群存在两种类型，集群组件与OSD，这里主要围绕 扩展 OSD</p>
<p>早期版本的ceph-deploy命令支持在将添加OSD的过程分为两个步骤：准备OSD，激活OSD，但新版本中，此种操作方式已被废除，添加OSD的步骤只能由命令 <em>ceph-deploy osd create create {node} &ndash;data {data-disk}</em> ，一次完成，默认存储引擎为 <strong>bluestore</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ceph-deploy osd create <span class="o">{</span>node<span class="o">}</span> --data /dev/sdb 
</span></span><span class="line"><span class="cl">ceph-deploy osd create <span class="o">{</span>node<span class="o">}</span> --data /dev/sdc
</span></span></code></pre></td></tr></table>
</div>
</div><p>而后可使用 <em>ceph-deploy osd list {node}</em> 命令列出指定节点上的OSD：</p>
<h3 id="移除-osd-的">移除 OSD 的<a hidden class="anchor" aria-hidden="true" href="#移除-osd-的">¶</a></h3>
<p>Ceph集群中的一个OSD通常对应一个设备，且运行于专用的守护进程。在某OSD设备出现故障，或管理员出于管理只需确实要移除特定的OSD设备时，需要先停止相关的守护进程，而后再进行移除操作。对于Luminous及其之后的版本来说，停止和移除命令的格式如下</p>
<ul>
<li>停止设备:  <em>ceph osd out {osd-num}</em></li>
<li>停止进程:  <em>sudo systemctl stop ceph-osd@{osd-num}</em></li>
<li>移除设备: <em>ceph osd purge {id} &ndash;yes-i-really-mean-it</em></li>
</ul>
<p>若类似如下的OSD的设备信息存在于ceph.conf配置文件中，管理员在删除OSD之后手动将其删除。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[osd.1]
</span></span><span class="line"><span class="cl">    host = {hostname}
</span></span></code></pre></td></tr></table>
</div>
</div><p>不过，对于 <em>Luminous</em> 之前的版本来说，管理员需要依次手动执行如下步骤删除OSD设备</p>
<ul>
<li>于CRUSH运行图中移除设备: <em>ceph osd crush remove {name}</em></li>
<li>移除OSD的认证key: <em>ceph auth del osd.{osd-num}</em></li>
<li>移除设备: <em>ceph osd purge {id} &ndash;yes-i-really-mean-it</em></li>
</ul>
<h3 id="扩展-ceph-mon">扩展 ceph-mon<a hidden class="anchor" aria-hidden="true" href="#扩展-ceph-mon">¶</a></h3>
<p>Ceph 集群需要至少一个 <em>Ceph Monitor</em> 和一个 <em>Ceph Manager</em>，生产环境中，为了实现高可用，Ceph集群通常运行多个监视器，以免单监视器整个存储集群崩溃。Ceph使用 Paxos 算法，改算法是需要至少需要板书以上的监视器（大于n/2，其中n为总监视器数量），才能形成法定人数，尽管此非必须，<strong>奇数个</strong> ceph-mon 往往更好。</p>
<p>使用 <em>ceph-deploy mon add {nodes}</em> 命令可以一次添加一个 ceph-mon 到集群中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ceph-deploy mon add nautilus02  <span class="c1">## 此处使用短格式名称，长格式名称会报错。</span>
</span></span><span class="line"><span class="cl">ceph-deploy mon add nautilus03
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置完成后，可以在ceph客户端上查看监视器及法定人数的相关信息:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ceph quorum_status --format json-pretty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;election_epoch&#34;</span>: 20,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;quorum&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">        0,
</span></span><span class="line"><span class="cl">        1,
</span></span><span class="line"><span class="cl">        <span class="m">2</span>
</span></span><span class="line"><span class="cl">    <span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;quorum_names&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;stor01&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;stor02&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;stor03&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;quorum_leader_name&#34;</span>: <span class="s2">&#34;stor01&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;monmap&#34;</span>: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;epoch&#34;</span>: 3,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;fsid&#34;</span>: <span class="s2">&#34;69fb9b55-3fb5-42d0-8cf7-239a3b569791&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;modified&#34;</span>: <span class="s2">&#34;2019-06-06 21:19:41.274199&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;2019-06-05 12:35:31.143594&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;persistent&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;osdmap-prune&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="o">]</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;optional&#34;</span>: <span class="o">[]</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;mons&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;rank&#34;</span>: 0,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;stor01&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.0.0.4:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.0.0.4:6789/0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>,
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;rank&#34;</span>: 1,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;stor02&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.0.0.5:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.0.0.5:6789/0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>,
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;rank&#34;</span>: 2,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;stor03&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.0.0.6:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.0.0.6:6789/0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="扩展-manager-节点">扩展 Manager 节点<a hidden class="anchor" aria-hidden="true" href="#扩展-manager-节点">¶</a></h3>
<p>Ceph Manager (ceph-mgr) 以 <em>Active/Standy</em> 模式运行，部署其他 ceph-mgr 守护进程可确保在 Active 节点的 ceph-mgr 守护进程故障时，其中一个 Standby 实例可以在不中断服务的情况下接管其任务。</p>
<p>mgr 就是无状态的 web 服务，一般来讲两个足够了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ceph-deploy mgr create <span class="o">{</span>ceph_node<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="启动-rgw">启动 RGW<a hidden class="anchor" aria-hidden="true" href="#启动-rgw">¶</a></h3>
<p>RGW (<strong>R</strong>ados <strong>G</strong>ateway) 必要组件，仅在需要用到对象存储兼容 “S3” 和 “Swift” 的 RESTful 接口时才需要部署 RGW 实例，相关的命令为<em>ceph-deploy rgw create (gateway-node)</em> 。</p>
<p>radosgw需要用自用的存储池不能与RBD混合使用，RGW 会在创建时自动初始化出存储池来，RGW 需要有相应服务才能运行起来。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ceph-deploy rgw create nautilus02
</span></span></code></pre></td></tr></table>
</div>
</div><p>添加完成后，<em>ceph -s</em>  命令的 service 一段中会输出相关信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ceph -s
</span></span><span class="line"><span class="cl">  cluster:
</span></span><span class="line"><span class="cl">    id:     69fb9b55-3fb5-42d0-8cf7-239a3b569791
</span></span><span class="line"><span class="cl">    health: HEALTH_WARN
</span></span><span class="line"><span class="cl">            application not enabled on <span class="m">1</span> pool<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  services:
</span></span><span class="line"><span class="cl">    mon: <span class="m">3</span> daemons, quorum stor01,stor02,stor03
</span></span><span class="line"><span class="cl">    mgr: stor01<span class="o">(</span>active<span class="o">)</span>, standbys: stor04
</span></span><span class="line"><span class="cl">    osd: <span class="m">8</span> osds: <span class="m">8</span> up, <span class="m">8</span> in
</span></span><span class="line"><span class="cl">    rgw: <span class="m">1</span> daemon active
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  data:
</span></span><span class="line"><span class="cl">    pools:   <span class="m">7</span> pools, <span class="m">160</span> pgs
</span></span><span class="line"><span class="cl">    objects: <span class="m">196</span>  objects, 1.5 KiB
</span></span><span class="line"><span class="cl">    usage:   <span class="m">21</span> GiB used, <span class="m">79</span> GiB / <span class="m">100</span> GiB avail
</span></span><span class="line"><span class="cl">    pgs:     <span class="m">160</span> active+clean
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况下，RGW 实例监听于 TCP 协议的 7480 端口，需要修改，可以通过在运行 RGW 的节点上编辑其主配置文件 ceph.conf 进行修改，相关参数如下所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[client]
</span></span><span class="line"><span class="cl">rgw_frontends = &#34;civetweb port=8080&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>RGW 会在 RADOWS 集群上生成包括如下存储池的一系列存储池</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$  ceph osd pool ls
</span></span><span class="line"><span class="cl">mypool
</span></span><span class="line"><span class="cl">rbdpool
</span></span><span class="line"><span class="cl">testpool
</span></span><span class="line"><span class="cl">.rgw.root
</span></span><span class="line"><span class="cl">default.rgw.control
</span></span><span class="line"><span class="cl">default.rgw.meta
</span></span><span class="line"><span class="cl">default.rgw.log
</span></span></code></pre></td></tr></table>
</div>
</div><p>RGW 提供的是兼容 S3 和 Swift 的 REST 接口，客户端通过 HTTP 进行交互，完成数据的增删改查等管理操作。</p>
<h3 id="启用文件系统-cephfs-接口">启用文件系统 (CephFS) 接口<a hidden class="anchor" aria-hidden="true" href="#启用文件系统-cephfs-接口">¶</a></h3>
<p>CephFS 需要至少运行一个 Metadata (MDS) 守护进程 (ceph-mds)，此进程管理与 CephFS 上存储的文件相关的元数据，并协调对 Ceph存储集群的访问。因此，若要使用 CephFS ，需要在存储集群中至少部署一个 MDS 实例，增加 MDS 可以使用命令 <em>ceph-deploy mds create {ceph-node}</em>  完成</p>
<p>还需主义的是，每个 CephFS 都至少需要两个存储池，一个用来存放元数据 (Metadata Pool)，一个存放数据 (Data Pool)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ceph-deploy mds create stor01
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看 MDS 的相关状态可以发现，刚添加的 MDS 处于 standby 状态</p>
<p>在运行起来还不够，还没为其创建存储池，故其不能正常工作，处于standby模式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ ceph mds stat
</span></span><span class="line"><span class="cl">, 1 up:standby
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 CephFS 之前需要事先于集群中创建一个文件系统，并为其分别指定 “元数据” 和 “数据” 相关的存储池，下面创建一个名为 <em>cephfs</em> 的文件系统用于测试，使用cephfs-metadata为数据存储池，使用cephfs-data为数据存储池。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 创建存储池</span>
</span></span><span class="line"><span class="cl">ceph osd pool create cephfs-metadata <span class="m">64</span>
</span></span><span class="line"><span class="cl">ceph osd pool create cephfs-data <span class="m">64</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 cephfs</span>
</span></span><span class="line"><span class="cl"><span class="c1">## 语法</span>
</span></span><span class="line"><span class="cl">ceph fs new <span class="o">{</span>fs_name<span class="o">}</span> <span class="o">{</span>meatadata-pool<span class="o">}</span> <span class="o">{</span>data-pool<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">## 示例</span>
</span></span><span class="line"><span class="cl">ceph fs new cephfs cephfs-metadata cephfs-data
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><em>ceph fs add_data_pool</em>： 额外添加数据池</li>
<li><em>ceph fs new</em>： 创建新文件系统</li>
<li><em>ceph fs status</em>： 查看CephFS 文件系统状态</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ceph fs status cephfs
</span></span><span class="line"><span class="cl">cephfs - <span class="m">0</span> <span class="nv">clients</span>
</span></span><span class="line"><span class="cl"><span class="o">======</span>
</span></span><span class="line"><span class="cl">+------+--------+--------+---------------+-------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Rank <span class="p">|</span> State  <span class="p">|</span>  MDS   <span class="p">|</span>    Activity   <span class="p">|</span>  dns  <span class="p">|</span>  inos <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------+--------+--------+---------------+-------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">0</span>   <span class="p">|</span> active <span class="p">|</span> stor02 <span class="p">|</span> Reqs:    <span class="m">0</span> /s <span class="p">|</span>   <span class="m">10</span>  <span class="p">|</span>   <span class="m">13</span>  <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------+--------+--------+---------------+-------+-------+
</span></span><span class="line"><span class="cl">+-----------------+----------+-------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>       Pool      <span class="p">|</span>   <span class="nb">type</span>   <span class="p">|</span>  used <span class="p">|</span> avail <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------------+----------+-------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> cephfs-metadata <span class="p">|</span> metadata <span class="p">|</span> <span class="m">2286</span>  <span class="p">|</span> 21.7G <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   cephfs-data   <span class="p">|</span>   data   <span class="p">|</span>    <span class="m">0</span>  <span class="p">|</span> 21.7G <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------------+----------+-------+-------+
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Standby MDS <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">+-------------+
</span></span><span class="line"><span class="cl">MDS version: ceph version 13.2.6 <span class="o">(</span>7b695f835b03642f85998b2ae7b6dd093d9fbce4<span class="o">)</span> mimic <span class="o">(</span>stable<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="reference">Reference<a hidden class="anchor" aria-hidden="true" href="#reference">¶</a></h2>
<p><sup id="1">[1]</sup> <a href="https://docs.ceph.com/en/nautilus/rados/configuration/network-config-ref/"><em><strong>Network Configuration Reference</strong></em></a></p>
<p><sup id="2">[2]</sup> <a href="https://unix.stackexchange.com/questions/379791/ceph-deployerror-runtimeerror-nosectionerror-no-section-ceph"><em><strong>ceph_deploy RuntimeError: NoSectionError: No section: &lsquo;ceph&rsquo;</strong></em></a></p>


    
    


<div class="copyrightBlock" >
    <div class="articleSuffix-bg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <p>链接：<a href="https://www.oomkill.com/2019/11/02-2-install-ceph-with-ceph-deploy/" target="_blank">https://www.oomkill.com/2019/11/02-2-install-ceph-with-ceph-deploy/</a></p>
    <p style="margin-bottom: 0px;">版权：本作品采用<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">「署名-非商业性使用-相同方式共享 4.0 国际」</a> 许可协议进行许可。</p>
    </div>
</div>
  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://www.oomkill.com/2019/11/helm/">
    <span class="title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline>
      </polyline></svg>&nbsp; </span>
    
    <span>Kubernetes包管理 - Helm</span>
  </a>
  <a class="next" href="https://www.oomkill.com/2019/11/ch1-introduction/" >
    <span class="title"> </span>
    
    <span>ch1 VPN与OpenVPN应用场景分析&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg></span>
  </a>
</nav>

  </footer>

  
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
  </div>
  
  
  
  
    <div class="comments-separator"></div>
    

<h3>相关阅读</h3>
<ul>
	
	<li><a href="/2019/09/03-1-acquaintance-rdb/">Ceph RBD - 初识块存储RBD</a></li>
	
	<li><a href="/2019/07/03-2-rbd-management/">Ceph RBD - 关于RBD的操作与管理</a></li>
	
	<li><a href="/2019/07/05-1-rgw/">Ceph对象存储概述</a></li>
	
	<li><a href="/2019/07/04-1-cephfs/">Ceph文件系统概述</a></li>
	
	<li><a href="/2019/06/07-1-cephx/">Ceph安全 - CephX</a></li>
	
</ul>

  

  
    
      <div class="comments-separator"></div>
<div class="comments">
    <script>
    function loadComment() {
        let theme = localStorage.getItem('pref-theme') === 'dark' ? 'dark' : 'light';
        let s = document.createElement('script');
        s.src = 'https://giscus.app/client.js';
        s.setAttribute('data-repo', 'cylonchau\/cylonchau.github.io');
        s.setAttribute('data-repo-id', 'R_kgDOIRlNSQ');
        s.setAttribute('data-category', 'Announcements');
        s.setAttribute('data-category-id', 'DIC_kwDOIRlNSc4CXy1U');
        s.setAttribute('data-mapping', 'title');
        s.setAttribute('data-reactions-enabled', '1');
        s.setAttribute('data-emit-metadata', '1');
        s.setAttribute('data-input-position', 'top');
        s.setAttribute('data-lang', 'zh-TW');
        s.setAttribute('data-theme', theme);
        s.setAttribute('crossorigin', 'anonymous');
        s.setAttribute('async', '');
        document.querySelector('div.comments').innerHTML = '';
        document.querySelector('div.comments').appendChild(s);
    }
    loadComment();
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
  <p>
  Copyright
  <span>&copy; 2024 <a href="https://www.oomkill.com">Cylon&#39;s Collection</a></span></p>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> on github-page & Theme
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

<script>
  document.addEventListener('scroll', function (e) {
      const readProgress = document.getElementById("read_progress");
      const scrollHeight = document.documentElement.scrollHeight;
      const clientHeight = document.documentElement.clientHeight;
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
  })
</script>

<script>
  var menu = document.getElementById('menu')
  if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                  behavior: "smooth"
              });
          } else {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
          }
          if (id === "top") {
              history.replaceState(null, null, " ");
          } else {
              history.pushState(null, null, `#${id}`);
          }
      });
  });
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
      } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
      }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.6.0/mermaid.min.js" crossorigin="anonymous"></script>
<script>
    mermaid.init(undefined, '.language-mermaid');
</script>
</body>

</html>
