<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Spinnaker 自定义Pipeline模板思路 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="Spinnaker"><meta name=description content='流水线模板组合思路 官方流水线示例中没有给出完整的流水线模板和完整的字段，只给出了一个大致的 schema [1]，如下所示
json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { "schema": "v2", "variables": [ { "type": "<type>", "defaultValue": <value>, "description": "<description>", "name": "<varName>" } ], "id": "<templateName>", # The pipeline instance references the template using this "protect": <true | false>, "metadata": { "name": "displayName", # The display name shown in Deck "description": "<description>", "owner": "example@example.'><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2024/07/spinnaker-custom-template/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2024/07/spinnaker-custom-template/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="Spinnaker 自定义Pipeline模板思路"><meta property="og:description" content='流水线模板组合思路 官方流水线示例中没有给出完整的流水线模板和完整的字段，只给出了一个大致的 schema [1]，如下所示
json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { "schema": "v2", "variables": [ { "type": "<type>", "defaultValue": <value>, "description": "<description>", "name": "<varName>" } ], "id": "<templateName>", # The pipeline instance references the template using this "protect": <true | false>, "metadata": { "name": "displayName", # The display name shown in Deck "description": "<description>", "owner": "example@example.'><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2024/07/spinnaker-custom-template/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-27T00:00:00+00:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spinnaker 自定义Pipeline模板思路"><meta name=twitter:description content='流水线模板组合思路 官方流水线示例中没有给出完整的流水线模板和完整的字段，只给出了一个大致的 schema [1]，如下所示
json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { "schema": "v2", "variables": [ { "type": "<type>", "defaultValue": <value>, "description": "<description>", "name": "<varName>" } ], "id": "<templateName>", # The pipeline instance references the template using this "protect": <true | false>, "metadata": { "name": "displayName", # The display name shown in Deck "description": "<description>", "owner": "example@example.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"Spinnaker 自定义Pipeline模板思路","item":"https://www.oomkill.com/2024/07/spinnaker-custom-template/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spinnaker 自定义Pipeline模板思路","name":"Spinnaker 自定义Pipeline模板思路","description":"流水线模板组合思路 官方流水线示例中没有给出完整的流水线模板和完整的字段，只给出了一个大致的 schema [1]，如下所示\njson 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { \u0026#34;schema\u0026#34;: \u0026#34;v2\u0026#34;, \u0026#34;variables\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;\u0026lt;type\u0026gt;\u0026#34;, \u0026#34;defaultValue\u0026#34;: \u0026lt;value\u0026gt;, \u0026#34;description\u0026#34;: \u0026#34;\u0026lt;description\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;\u0026lt;varName\u0026gt;\u0026#34; } ], \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;templateName\u0026gt;\u0026#34;, # The pipeline instance references the template using this \u0026#34;protect\u0026#34;: \u0026lt;true | false\u0026gt;, \u0026#34;metadata\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;displayName\u0026#34;, # The display name shown in Deck \u0026#34;description\u0026#34;: \u0026#34;\u0026lt;description\u0026gt;\u0026#34;, \u0026#34;owner\u0026#34;: \u0026#34;example@example.","keywords":["Spinnaker"],"articleBody":"流水线模板组合思路 官方流水线示例中没有给出完整的流水线模板和完整的字段，只给出了一个大致的 schema [1]，如下所示\njson 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { \"schema\": \"v2\", \"variables\": [ { \"type\": \"\", \"defaultValue\": , \"description\": \"\", \"name\": \"\" } ], \"id\": \"\", # The pipeline instance references the template using this \"protect\": \u003ctrue | false\u003e, \"metadata\": { \"name\": \"displayName\", # The display name shown in Deck \"description\": \"\", \"owner\": \"example@example.com\", \"scopes\": [\"global\"] # Not used }, \"pipeline\": { # Contains the templatized pipeline itself \"lastModifiedBy\": \"anonymous\", # Not used \"updateTs\": \"0\", # Not used \"parameterConfig\": [], # Same as in a regular pipeline \"limitConcurrent\": true, # Same as in a regular pipeline \"keepWaitingPipelines\": false, # Same as in a regular pipeline \"description\": \"\", # Same as in a regular pipeline \"triggers\": [], # Same as in a regular pipeline \"notifications\": [], # Same as in a regular pipeline \"stages\": [ # Contains the templated stages { # This one is an example stage: \"waitTime\": \"${ templateVariables.waitTime }\", # Templated field. \"name\": \"My Wait Stage\", \"type\": \"wait\", \"refId\": \"wait1\", \"requisiteStageRefIds\": [] } ] } } 这个流水线模板的 Schema 只包含了大的框架，但是 Spinnaker 的每种类型的 Stage 的 Schema 并没有包含里面，需要自行定义，最好的一个思路就是，先手动先创建一个 {ipeline，然后编辑这个 Pipeline 的 Json 复制出想要的 Stage 的内容，然后再根据 Pipeline Template 的模板进行填充。\n例如，我们想顶一个选择 “多路分支” 的流水线，那么流水线类型如下\n图：spinnaker流水线结构 然后选择 “Edit stage as Json” 或者选择 “Pipeline Actions” 中 “Edit as JSON” 可以查看到该 Stage 或该 Pipelin 完整的 JSON 格式数据。\n图：Pipeline Stage JSON 图：Pipeline JSON 最后将 Stage 的 JSON 复制 到 template Stage 的 数组中即可，下面是一个 Check Precondition 类型的 State 的 JSON\njson 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \"completeOtherBranchesThenFail\": false, \"continuePipeline\": false, \"failPipeline\": false, \"name\": \"选择禁用是否启用配置注册\", \"notifications\": [], \"preconditions\": [ { \"context\": { \"expression\": \"${ #judgment('check condition') == 'disable' }\" }, \"failPipeline\": true, \"type\": \"expression\" } ], \"type\": \"checkPreconditions\" } 完整的基于分支判断的流水线模板示例 该模板是一个为 k8s deployment 启用/禁用 HPA 功能的流水线模板\nyaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 { \"id\": \"a422e02d0ab94ce23jk92a6d2bf8ff9c\", \"lastModifiedBy\": \"cylon\", \"metadata\": { \"description\": \"启用或停用 HPA\", \"name\": \"HPA Turn on or Turn off\", \"owner\": \"cylonchau@outlook.com\", \"scopes\": [ \"global\" ] }, \"pipeline\": { \"expectedArtifacts\": [ { \"defaultArtifact\": { \"artifactAccount\": \"k8s-cluster-102\", \"reference\": \"https://git.chinamobile.cn/api/v4/projects/154/repository/files/hpa%2Fk8s-cluster-102%2F${ templateVariables.appName }.yaml/raw\", \"type\": \"gitlab/file\", \"version\": \"master\" }, \"displayName\": \"${ templateVariables.appName }-hpa-file\", \"id\": \"${ templateVariables.appName }-hpa\", \"matchArtifact\": { \"artifactAccount\": \"k8s-cluster-102\", \"name\": \"https://git.chinamobile.cn/api/v4/projects/154/repository/files/hpa%2Fk8s-cluster-102%2F${ templateVariables.appName }.yaml/raw\", \"type\": \"gitlab/file\" }, \"useDefaultArtifact\": true, \"usePriorArtifact\": false } ], \"keepWaitingPipelines\": false, \"limitConcurrent\": true, \"parameterConfig\": [], \"stages\": [ { \"instructions\": \"请选择条件: \\n\\tenable 启用 ${ templateVariables.appName } HPA Autoscaler\\n\\tdisable 禁用HPA Autoscaler\\n\", \"judgmentInputs\": [ { \"value\": \"enable\" }, { \"value\": \"disable\" } ], \"name\": \"Apply\", \"completeOtherBranchesThenFail\": false, \"continuePipeline\": false, \"failPipeline\": false, \"notifications\": [], \"propagateAuthenticationContext\": false, \"refId\": \"7\", \"requisiteStageRefIds\": [], \"type\": \"manualJudgment\" }, { \"completeOtherBranchesThenFail\": false, \"continuePipeline\": false, \"failPipeline\": false, \"name\": \"选择禁用 ${ templateVariables.appName } HPA\", \"preconditions\": [ { \"context\": { \"expression\": \"${ #judgment('Apply') == 'disable' }\" }, \"failPipeline\": true, \"type\": \"expression\" } ], \"refId\": \"9\", \"requisiteStageRefIds\": [ \"7\" ], \"type\": \"checkPreconditions\" }, { \"name\": \"选择启用 ${ templateVariables.appName } HPA\", \"completeOtherBranchesThenFail\": false, \"continuePipeline\": false, \"failPipeline\": false, \"preconditions\": [ { \"context\": { \"expression\": \"${ #judgment('Apply HPA') == 'enable' }\" }, \"failPipeline\": true, \"type\": \"expression\" } ], \"refId\": \"10\", \"requisiteStageRefIds\": [ \"7\" ], \"type\": \"checkPreconditions\" }, { \"account\": \"${ templateVariables.dcName }\", \"app\": \"${ templateVariables.appName }\", \"cloudProvider\": \"kubernetes\", \"completeOtherBranchesThenFail\": false, \"continuePipeline\": false, \"failPipeline\": false, \"isNew\": true, \"location\": \" ${ templateVariables.appLocation }\", \"manifestName\": \"horizontalpodautoscaler ${ templateVariables.appName }-autoscaler\", \"mode\": \"static\", \"name\": \"禁用 ${ templateVariables.appName } HPA\", \"options\": { \"cascading\": false, \"gracePeriodSeconds\": 300 }, \"refId\": \"12\", \"requisiteStageRefIds\": [ \"9\" ], \"type\": \"deleteManifest\" }, { \"account\": \"${ templateVariables.dcName }\", \"cloudProvider\": \"kubernetes\", \"manifestArtifactAccount\": \"k8s-cluster-102\", \"manifestArtifactId\": \"${ templateVariables.appName }-hpa\", \"completeOtherBranchesThenFail\": false, \"continuePipeline\": false, \"failPipeline\": false, \"moniker\": { \"app\": \"${ templateVariables.appName }\" }, \"name\": \"启用 ${ templateVariables.appName } HPA\", \"refId\": \"11\", \"requisiteStageRefIds\": [ \"10\" ], \"skipExpressionEvaluation\": false, \"source\": \"artifact\", \"stageTimeoutMs\": 500000, \"trafficManagement\": { \"enabled\": false, \"options\": { \"enableTraffic\": false, \"services\": [] } }, \"type\": \"deployManifest\" } ], \"triggers\": [] }, \"protect\": false, \"schema\": \"v2\", \"tag\": null, \"updateTs\": \"1701832158029\", \"variables\": [ { \"defaultValue\": \"k8s-cluster-102\", \"description\": \"要部署到的集群\", \"name\": \"dcName\", \"type\": \"string\" }, { \"defaultValue\": \"\", \"description\": \"模块名称\", \"name\": \"appName\", \"type\": \"string\" }, { \"defaultValue\": \"public\", \"description\": \"名称空间\", \"name\": \"appLocation\", \"type\": \"string\" } ] } Reference [1] Pipeline template JSON\n","wordCount":"860","inLanguage":"zh","datePublished":"2024-07-27T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2024/07/spinnaker-custom-template/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Spinnaker 自定义Pipeline模板思路</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2024-07-27</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>860 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>5 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/cicd/>#Cicd</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e6%b5%81%e6%b0%b4%e7%ba%bf%e6%a8%a1%e6%9d%bf%e7%bb%84%e5%90%88%e6%80%9d%e8%b7%af aria-label=流水线模板组合思路>流水线模板组合思路</a><li><a href=#%e5%ae%8c%e6%95%b4%e7%9a%84%e5%9f%ba%e4%ba%8e%e5%88%86%e6%94%af%e5%88%a4%e6%96%ad%e7%9a%84%e6%b5%81%e6%b0%b4%e7%ba%bf%e6%a8%a1%e6%9d%bf%e7%a4%ba%e4%be%8b aria-label=完整的基于分支判断的流水线模板示例>完整的基于分支判断的流水线模板示例</a><li><a href=#reference aria-label=Reference>Reference</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=流水线模板组合思路>流水线模板组合思路<a hidden class=anchor aria-hidden=true href=#流水线模板组合思路>#</a></h2><p>官方流水线示例中没有给出完整的流水线模板和完整的字段，只给出了一个大致的 schema <sup><a href=#1>[1]</a></sup>，如下所示</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;schema&#34;</span><span class=p>:</span> <span class=s2>&#34;v2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;variables&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;type&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;defaultValue&#34;</span><span class=p>:</span> <span class=err>&lt;value&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;description&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;varName&gt;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;templateName&gt;&#34;</span><span class=p>,</span>           <span class=err>#</span> <span class=err>The</span> <span class=err>pipeline</span> <span class=err>instance</span> <span class=err>references</span> <span class=err>the</span> <span class=err>template</span> <span class=err>using</span> <span class=err>this</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;protect&#34;</span><span class=p>:</span> <span class=err>&lt;</span><span class=kc>true</span> <span class=err>|</span> <span class=kc>false</span><span class=err>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;displayName&#34;</span><span class=p>,</span>          <span class=err>#</span> <span class=err>The</span> <span class=err>display</span> <span class=err>name</span> <span class=err>shown</span> <span class=err>in</span> <span class=err>Deck</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;description&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;owner&#34;</span><span class=p>:</span> <span class=s2>&#34;example@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;scopes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;global&#34;</span><span class=p>]</span>            <span class=err>#</span> <span class=err>Not</span> <span class=err>used</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pipeline&#34;</span><span class=p>:</span> <span class=p>{</span>                     <span class=err>#</span> <span class=err>Contains</span> <span class=err>the</span> <span class=err>templatized</span> <span class=err>pipeline</span> <span class=err>itself</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;lastModifiedBy&#34;</span><span class=p>:</span> <span class=s2>&#34;anonymous&#34;</span><span class=p>,</span>  <span class=err>#</span> <span class=err>Not</span> <span class=err>used</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;updateTs&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>                <span class=err>#</span> <span class=err>Not</span> <span class=err>used</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;parameterConfig&#34;</span><span class=p>:</span> <span class=p>[],</span>          <span class=err>#</span> <span class=err>Same</span> <span class=err>as</span> <span class=err>in</span> <span class=err>a</span> <span class=err>regular</span> <span class=err>pipeline</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;limitConcurrent&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>        <span class=err>#</span> <span class=err>Same</span> <span class=err>as</span> <span class=err>in</span> <span class=err>a</span> <span class=err>regular</span> <span class=err>pipeline</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;keepWaitingPipelines&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>  <span class=err>#</span> <span class=err>Same</span> <span class=err>as</span> <span class=err>in</span> <span class=err>a</span> <span class=err>regular</span> <span class=err>pipeline</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>              <span class=err>#</span> <span class=err>Same</span> <span class=err>as</span> <span class=err>in</span> <span class=err>a</span> <span class=err>regular</span> <span class=err>pipeline</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;triggers&#34;</span><span class=p>:</span> <span class=p>[],</span>                 <span class=err>#</span> <span class=err>Same</span> <span class=err>as</span> <span class=err>in</span> <span class=err>a</span> <span class=err>regular</span> <span class=err>pipeline</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;notifications&#34;</span><span class=p>:</span> <span class=p>[],</span>            <span class=err>#</span> <span class=err>Same</span> <span class=err>as</span> <span class=err>in</span> <span class=err>a</span> <span class=err>regular</span> <span class=err>pipeline</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stages&#34;</span><span class=p>:</span> <span class=p>[</span>                     <span class=err>#</span> <span class=err>Contains</span> <span class=err>the</span> <span class=err>templated</span> <span class=err>stages</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>#</span> <span class=err>This</span> <span class=err>one</span> <span class=err>is</span> <span class=err>an</span> <span class=err>example</span> <span class=err>stage:</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;waitTime&#34;</span><span class=p>:</span> <span class=s2>&#34;${ templateVariables.waitTime }&#34;</span><span class=p>,</span>  <span class=err>#</span> <span class=err>Templated</span> <span class=err>field.</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;My Wait Stage&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;wait&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;refId&#34;</span><span class=p>:</span> <span class=s2>&#34;wait1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;requisiteStageRefIds&#34;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>这个流水线模板的 Schema 只包含了大的框架，但是 Spinnaker 的每种类型的 Stage 的 Schema 并没有包含里面，需要自行定义，最好的一个思路就是，先手动先创建一个 {ipeline，然后编辑这个 Pipeline 的 Json 复制出想要的 Stage 的内容，然后再根据 Pipeline Template 的模板进行填充。</p><p>例如，我们想顶一个选择 “多路分支” 的流水线，那么流水线类型如下</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20240727212507497.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20240727212507497.png#center alt=image-20240727212507497 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><center>图：spinnaker流水线结构</center><p>然后选择 “Edit stage as Json” 或者选择 “Pipeline Actions” 中 “Edit as JSON” 可以查看到该 Stage 或该 Pipelin 完整的 JSON 格式数据。</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20240727212652058.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20240727212652058.png#center alt=image-20240727212652058 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><center>图：Pipeline Stage JSON</center><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20240727212803192.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20240727212803192.png#center alt=image-20240727212803192 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><center>图：Pipeline JSON</center><p>最后将 Stage 的 JSON 复制 到 template Stage 的 数组中即可，下面是一个 Check Precondition 类型的 State 的 JSON</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>json</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;completeOtherBranchesThenFail&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;continuePipeline&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;failPipeline&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;选择禁用是否启用配置注册&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;notifications&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;preconditions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;context&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;expression&#34;</span><span class=p>:</span> <span class=s2>&#34;${ #judgment(&#39;check condition&#39;) == &#39;disable&#39; }&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;failPipeline&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;expression&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;checkPreconditions&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=完整的基于分支判断的流水线模板示例>完整的基于分支判断的流水线模板示例<a hidden class=anchor aria-hidden=true href=#完整的基于分支判断的流水线模板示例>#</a></h2><p>该模板是一个为 k8s deployment 启用/禁用 HPA 功能的流水线模板</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>yaml</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;id&#34;: </span><span class=s2>&#34;a422e02d0ab94ce23jk92a6d2bf8ff9c&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;lastModifiedBy&#34;: </span><span class=s2>&#34;cylon&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;metadata&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;description&#34;: </span><span class=s2>&#34;启用或停用 HPA&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;HPA Turn on or Turn off&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;owner&#34;: </span><span class=s2>&#34;cylonchau@outlook.com&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;scopes&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=s2>&#34;global&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;pipeline&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;expectedArtifacts&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;defaultArtifact&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;artifactAccount&#34;: </span><span class=s2>&#34;k8s-cluster-102&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;reference&#34;: </span><span class=s2>&#34;https://git.chinamobile.cn/api/v4/projects/154/repository/files/hpa%2Fk8s-cluster-102%2F${ templateVariables.appName }.yaml/raw&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;gitlab/file&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;version&#34;: </span><span class=s2>&#34;master&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;displayName&#34;: </span><span class=s2>&#34;${ templateVariables.appName }-hpa-file&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;id&#34;: </span><span class=s2>&#34;${ templateVariables.appName }-hpa&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;matchArtifact&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;artifactAccount&#34;: </span><span class=s2>&#34;k8s-cluster-102&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;https://git.chinamobile.cn/api/v4/projects/154/repository/files/hpa%2Fk8s-cluster-102%2F${ templateVariables.appName }.yaml/raw&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;gitlab/file&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;useDefaultArtifact&#34;: </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;usePriorArtifact&#34;: </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;keepWaitingPipelines&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;limitConcurrent&#34;: </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;parameterConfig&#34;: </span><span class=p>[],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;stages&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;instructions&#34;: </span><span class=s2>&#34;请选择条件: \n\tenable 启用 ${ templateVariables.appName } HPA Autoscaler\n\tdisable 禁用HPA Autoscaler\n&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;judgmentInputs&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;value&#34;: </span><span class=s2>&#34;enable&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;value&#34;: </span><span class=s2>&#34;disable&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;Apply&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;completeOtherBranchesThenFail&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;continuePipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;notifications&#34;: </span><span class=p>[],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;propagateAuthenticationContext&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;refId&#34;: </span><span class=s2>&#34;7&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;requisiteStageRefIds&#34;: </span><span class=p>[],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;manualJudgment&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;completeOtherBranchesThenFail&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;continuePipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;选择禁用 ${ templateVariables.appName } HPA&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;preconditions&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;context&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>&#34;expression&#34;: </span><span class=s2>&#34;${ #judgment(&#39;Apply&#39;) == &#39;disable&#39; }&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;expression&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;refId&#34;: </span><span class=s2>&#34;9&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;requisiteStageRefIds&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=s2>&#34;7&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;checkPreconditions&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;选择启用 ${ templateVariables.appName } HPA&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;completeOtherBranchesThenFail&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;continuePipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;preconditions&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;context&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>&#34;expression&#34;: </span><span class=s2>&#34;${ #judgment(&#39;Apply HPA&#39;) == &#39;enable&#39; }&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;expression&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;refId&#34;: </span><span class=s2>&#34;10&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;requisiteStageRefIds&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=s2>&#34;7&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;checkPreconditions&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;account&#34;: </span><span class=s2>&#34;${ templateVariables.dcName }&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;app&#34;: </span><span class=s2>&#34;${ templateVariables.appName }&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;cloudProvider&#34;: </span><span class=s2>&#34;kubernetes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;completeOtherBranchesThenFail&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;continuePipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;isNew&#34;: </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;location&#34;: </span><span class=s2>&#34; ${ templateVariables.appLocation }&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;manifestName&#34;: </span><span class=s2>&#34;horizontalpodautoscaler ${ templateVariables.appName }-autoscaler&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;mode&#34;: </span><span class=s2>&#34;static&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;禁用 ${ templateVariables.appName } HPA&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;options&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;cascading&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;gracePeriodSeconds&#34;: </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;refId&#34;: </span><span class=s2>&#34;12&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;requisiteStageRefIds&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=s2>&#34;9&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;deleteManifest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;account&#34;: </span><span class=s2>&#34;${ templateVariables.dcName }&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;cloudProvider&#34;: </span><span class=s2>&#34;kubernetes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;manifestArtifactAccount&#34;: </span><span class=s2>&#34;k8s-cluster-102&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;manifestArtifactId&#34;: </span><span class=s2>&#34;${ templateVariables.appName }-hpa&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;completeOtherBranchesThenFail&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;continuePipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;failPipeline&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;moniker&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;app&#34;: </span><span class=s2>&#34;${ templateVariables.appName }&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;启用 ${ templateVariables.appName } HPA&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;refId&#34;: </span><span class=s2>&#34;11&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;requisiteStageRefIds&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=s2>&#34;10&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;skipExpressionEvaluation&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;source&#34;: </span><span class=s2>&#34;artifact&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;stageTimeoutMs&#34;: </span><span class=m>500000</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;trafficManagement&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;enabled&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>&#34;options&#34;: </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;enableTraffic&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;services&#34;: </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;deployManifest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;triggers&#34;: </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;protect&#34;: </span><span class=kc>false</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;schema&#34;: </span><span class=s2>&#34;v2&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;tag&#34;: </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;updateTs&#34;: </span><span class=s2>&#34;1701832158029&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;variables&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;defaultValue&#34;: </span><span class=s2>&#34;k8s-cluster-102&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;description&#34;: </span><span class=s2>&#34;要部署到的集群&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;dcName&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;string&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;defaultValue&#34;: </span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;description&#34;: </span><span class=s2>&#34;模块名称&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;appName&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;string&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;defaultValue&#34;: </span><span class=s2>&#34;public&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;description&#34;: </span><span class=s2>&#34;名称空间&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;name&#34;: </span><span class=s2>&#34;appLocation&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;type&#34;: </span><span class=s2>&#34;string&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></td></tr></table></div></div></div></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><p><sup id=1>[1]</sup> <a href=https://spinnaker.io/docs/reference/pipeline/templates/#pipeline-template-json target=_blank rel="noopener nofollow noreferrer">Pipeline template JSON</a></p></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：Spinnaker 自定义Pipeline模板思路</p><p>文章链接：<a href=https://www.oomkill.com/2024/07/spinnaker-custom-template/ target=_blank>https://www.oomkill.com/2024/07/spinnaker-custom-template/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2024/07/spinnaker-branching-judgment/><span>Spinnaker 基于判断的条件分支流水线</span></a></li><li><a href=/2023/12/spinnaker-canary/><span>使用Spinnaker进行金丝雀分析</span></a></li><li><a href=/2023/07/offline-installtation/><span>无互联网环境下安装Spinnaker - Offline Install Spinnaker</span></a></li><li><a href=/2023/11/ch03-argo-add-cluster/><span>初识Argo cd - 注册/删除k8s集群</span></a></li><li><a href=/2023/11/ch04-application/><span>深入Argo - Application resources</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/cicd/>Cicd</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2024/07/spinnaker-branching-judgment/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>Spinnaker 基于判断的条件分支流水线</span>
</a><a class=next href=https://www.oomkill.com/2024/07/hugo-add-related-content-section/><span class=title></span>
<span>Hugo - 为文章页面增加相关阅读区域&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/spinnaker-custom-template","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>