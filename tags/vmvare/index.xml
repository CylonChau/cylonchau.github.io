<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>vmvare on Cylon&#39;s Collection</title>
    <link>https://www.oomkill.com/tags/vmvare/</link>
    <description>Recent content in vmvare on Cylon&#39;s Collection</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 17 Feb 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://www.oomkill.com/tags/vmvare/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Linux VMware Tools详解</title>
      <link>https://www.oomkill.com/2021/02/vmvaretool/</link>
      <pubDate>Wed, 17 Feb 2021 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2021/02/vmvaretool/</guid>
      <description></description>
      <content:encoded><![CDATA[<h2 id="vmware-tools描述">VMware Tools描述</h2>
<p>VMware Tools 中包含一系列服务和模块，可在 VMware 产品中实现多种功能，从而使用户能够更好地管理客户机操作系统，以及与客户机系统进行无缝交互。</p>
<h2 id="在linux虚拟机中安装vmware-tools">在Linux虚拟机中安装VMware Tools</h2>
<p><strong>安装前准备</strong></p>
<ul>
<li>虚拟机必须打开cd/dvd驱动器，否则<code>安装VMware Tools</code>的选项无法选择</li>
<li>VMware Tools安装程序是使用Perl编写的，必须确认操作系统中安装Perl。</li>
</ul>
<p><strong>安装步骤</strong></p>
<ol>
<li>
<p>在虚拟机菜单中右键单击虚拟机，然后单击客户机 &gt; 安装/升级 VMware Tools。</p>
</li>
<li>
<p>要创建一个挂载点 <code>mkdir /mnt/cdrom</code></p>
</li>
<li>
<p>要装载 CDROM，<code>mount /dev/cdrom /mnt/cdrom</code></p>
</li>
<li>
<p>要将安装文件文件复制到临时目录：<code>cp /mnt/cdrom/VMwareTools*.tar.gz /tmp/</code>；其中，<code>*</code> <em>部分是 VMware Tools 软件包的版本号，故以</em>替代*。</p>
</li>
<li>
<p>解压文件：<code>cd /tmp &amp;&amp; tar -zxvf VMwareTools*.tar.gz</code></p>
</li>
<li>
<p>运行PERL脚本以安装<code>VMware Tools</code>：<code>cd vmware-tools-distrib &amp;&amp; ./vmware-install.pl</code>，<em>若要求选择，一路回车即可</em>。</p>
</li>
<li>
<p>安装完成后清理 <code>rm -fr {/tmp/VMwareTools*,/tmp/vmware-tools-distrib} ; yum remove perl -y</code>，如不需要perl可以卸载</p>
</li>
</ol>
<p>命令集合</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /mnt/cdrom
</span></span><span class="line"><span class="cl">mount /dev/cdrom /mnt/cdrom
</span></span><span class="line"><span class="cl">cp /mnt/cdrom/VMwareTools*.tar.gz /tmp/
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /tmp <span class="o">&amp;&amp;</span> tar -xf VMwareTools*.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> vmware-tools-distrib <span class="o">&amp;&amp;</span> ./vmware-install.pl
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装后清理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rm -fr <span class="o">{</span>/tmp/VMwareTools*,/tmp/vmware-tools-distrib<span class="o">}</span>
</span></span><span class="line"><span class="cl">yum remove perl -y <span class="c1"># 选择性执行</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="vmware-tools服务">VMware Tools服务</h2>
<p>VMware Tools守护进程在后台运行。它在 Windows 客户机操作系统中名为 vmtoolsd.exe，在 Mac OS X 客户机操作系统中名为 vmware-tools-daemon，在 Linux、FreeBSD 和 Solaris 客户机操作系统中名为 vmtoolsd。</p>
<p>安装完成后，<code>VMware Tools</code>守护进程并未开机启动，可以设置开机启动，该守护进程在主机和客户机操作系统之间传递信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">systemctl enable vmtoolsd
</span></span><span class="line"><span class="cl">systemctl start vmtoolsd 
</span></span><span class="line"><span class="cl">systemctl status vmtoolsd
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置虚拟机与宿主机系统之间的时间同步">配置虚拟机与宿主机系统之间的时间同步</h2>
<p>启用时间同步时，VMware Tools会将虚拟机操作系统的时间设置为与宿主机的时间相同。</p>
<blockquote>
<p>注意：无论 <code>VMware Tools</code>时间同步是否打开，在执行以下操作后都会进行时间同步：</p>
<ul>
<li>当启动 <code>VMware Tools</code>守护进程时，例如重新引导或打开电源操作过程中。</li>
<li>在从某个挂起操作恢复虚拟机时</li>
<li>恢复到快照后</li>
<li>压缩磁盘后</li>
</ul>
</blockquote>
<p><strong>命令</strong></p>
<table>
<thead>
<tr>
<th>操作系统</th>
<th>程序名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows</td>
<td>VMwareToolboxCmd.exe</td>
</tr>
<tr>
<td>Linux、Solaris 和 FreeBSD</td>
<td>vmware-toolbox-cmd</td>
</tr>
<tr>
<td>MAC OS X</td>
<td>vmware-tools-cli</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">vmware-toolbox-cmd timesync enable|disable
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="reference">Reference</h2>
<blockquote>
<p><a href="https://docs.vmware.com/cn/VMware-Tools/11.2.0/com.vmware.vsphere.vmwaretools.doc/GUID-C0D8326A-B6E7-4E61-8470-6C173FDDF656.html">配置客户机与主机操作系统之间的时间同步</a></p>
<p><a href="https://kb.vmware.com/s/article/1018414?lang=zh_cn">在 Linux 虚拟机中安装 VMware Tools (1018414)</a></p>
<p><a href="https://docs.vmware.com/cn/VMware-Tools/index.html">VMware Tools 产品文档</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>Powershell阻止确认</title>
      <link>https://www.oomkill.com/2020/04/powershell-confirm/</link>
      <pubDate>Sun, 19 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2020/04/powershell-confirm/</guid>
      <description></description>
      <content:encoded><![CDATA[<p>要阻止弹出确认提示，需要设置-Confirm为false,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">new-VM -Name $hostname -Template $template -VMHost 10.11.31.5 -OSCustomizationspec TestLinux -Confirm:$false
</span></span></code></pre></td></tr></table>
</div>
</div><p>获得当前确认级别</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ConfirmPreference
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看确认级别（$ConfirmPreference）支持的选项，类型为枚举</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[ENUM]::GetNames($ConfirmPreference.GetType())
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置确认级别</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ConfirmPreference=&#34;None&#34;
</span></span></code></pre></td></tr></table>
</div>
</div>]]></content:encoded>
    </item>
    
    <item>
      <title>centos安装powershell和powercli</title>
      <link>https://www.oomkill.com/2019/10/centos-install-powershellpowercli/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/centos-install-powershellpowercli/</guid>
      <description></description>
      <content:encoded><![CDATA[<p>poershell <a href="https://github.com/PowerShell/PowerShell/releases">github</a></p>
<p>本次采用github下载对应的rpm进行安装</p>
<p>windows下安装方法</p>
<p><a href="https://code.vmware.com/web/tool/12.0.0/vmware-powercli">离线安装包下载地址</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y https://github.com/PowerShell/PowerShell/releases/download/v7.0.0/powershell-lts-7.0.0-1.rhel.7.x86_64.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装完成后再终端输入以下命令 <code>pwsh</code>。在一个PowerShell会话，您可以通过运行以下命令来检查的PowerShell的版本。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS /root&gt; $PSVersionTable.PSVersion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Major  Minor  Patch  PreReleaseLabel BuildLabel
</span></span><span class="line"><span class="cl">-----  -----  -----  --------------- ----------
</span></span><span class="line"><span class="cl">7      0      0  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Set-PSRepository -Name &#34;PSGallery&#34; -InstallationPolicy &#34;Trusted&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，运行以下命令来安装VMware.PowerCLI模块。这将发现和在PSGallery安装最新版本的模块</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Find-Module &#34;VMware.PowerCLI&#34; | Install-Module -Scope &#34;CurrentUser&#34; -AllowClobber
</span></span></code></pre></td></tr></table>
</div>
</div><p>完成后，通过运行以下命令进行检查，以确保该模块安装。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-Module &#34;VMware.PowerCLI&#34; -ListAvailable | FT -Autosize
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS /root&gt; Get-Module &#34;VMware.PowerCLI&#34; -ListAvailable | FT -Autosize
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Directory: /root/.local/share/powershell/Modules
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ModuleType Version         PreRelease Name            PSEdition ExportedCommands
</span></span><span class="line"><span class="cl">---------- -------         ---------- ----            --------- ----------------
</span></span><span class="line"><span class="cl">Manifest   12.0.0.15947286            VMware.PowerCLI Desk 
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你想看到所有的VMware安装的模块，运行以下命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS /root&gt; Get-Module &#34;VMware.*&#34; -ListAvailable | FT -Autosize
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Directory: /root/.local/share/powershell/Modules
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ModuleType Version         PreRelease Name                                    PSEdition ExportedCommands
</span></span><span class="line"><span class="cl">---------- -------         ---------- ----                                    --------- ----------------
</span></span><span class="line"><span class="cl">Script     12.0.0.15947289            VMware.CloudServices                    Desk      {Connect-Vcs, Get-VcsOrganizationRole, Get-VcsService, Get-VcsServiceRole…
</span></span><span class="line"><span class="cl">Script     7.0.0.15902843             VMware.DeployAutomation                 Desk      {Add-DeployRule, Add-ProxyServer, Add-ScriptBundle, Copy-DeployRule…}
</span></span><span class="line"><span class="cl">Script     7.0.0.15902843             VMware.ImageBuilder                     Desk      {Add-EsxSoftwareDepot, Add-EsxSoftwarePackage, Compare-EsxImageProfile, E…
</span></span><span class="line"><span class="cl">Manifest   12.0.0.15947286            VMware.PowerCLI                         Desk      
</span></span><span class="line"><span class="cl">Script     7.0.0.15939650             VMware.Vim                              Desk      
</span></span><span class="line"><span class="cl">Script     12.0.0.15939657            VMware.VimAutomation.Cis.Core           Desk      {Connect-CisServer, Disconnect-CisServer, Get-CisService}
</span></span><span class="line"><span class="cl">Script     12.0.0.15940183            VMware.VimAutomation.Cloud              Desk      {Add-CIDatastore, Connect-CIServer, Disconnect-CIServer, Get-Catalog…}
</span></span><span class="line"><span class="cl">Script     12.0.0.15939652            VMware.VimAutomation.Common             Desk      {Get-Task, New-OAuthSecurityContext, Stop-Task, Wait-Task}
</span></span><span class="line"><span class="cl">Script     12.0.0.15939655            VMware.VimAutomation.Core               Desk      {Add-PassthroughDevice, Add-VirtualSwitchPhysicalNetworkAdapter, Add-VMHo…
</span></span><span class="line"><span class="cl">Script     12.0.0.15939647            VMware.VimAutomation.Hcx                Desk      {Connect-HCXServer, Disconnect-HCXServer, Get-HCXAppliance, Get-HCXComput…
</span></span><span class="line"><span class="cl">Script     7.12.0.15718406            VMware.VimAutomation.HorizonView        Desk      {Connect-HVServer, Disconnect-HVServer}
</span></span><span class="line"><span class="cl">Script     12.0.0.15939670            VMware.VimAutomation.License            Desk      Get-LicenseDataManager
</span></span><span class="line"><span class="cl">Script     12.0.0.15939671            VMware.VimAutomation.Nsxt               Desk      {Connect-NsxtServer, Disconnect-NsxtServer, Get-NsxtPolicyService, Get-Ns…
</span></span><span class="line"><span class="cl">Script     12.0.0.15939651            VMware.VimAutomation.Sdk                Desk      {Get-ErrorReport, Get-PSVersion, Get-InstallPath}
</span></span><span class="line"><span class="cl">Script     12.0.0.15939672            VMware.VimAutomation.Security           Desk      {Add-AttestationServiceInfo, Add-KeyProviderServiceInfo, Add-TrustAuthori…
</span></span><span class="line"><span class="cl">Script     11.5.0.14899557            VMware.VimAutomation.Srm                Desk      {Connect-SrmServer, Disconnect-SrmServer}
</span></span><span class="line"><span class="cl">Script     12.0.0.15939648            VMware.VimAutomation.Storage            Desk      {Add-EntityDefaultKeyProvider, Add-KeyManagementServer, Add-VsanFileServi…
</span></span><span class="line"><span class="cl">Script     1.3.0.0                    VMware.VimAutomation.StorageUtility     Desk      Update-VmfsDatastore
</span></span><span class="line"><span class="cl">Script     12.0.0.15940185            VMware.VimAutomation.Vds                Desk      {Add-VDSwitchPhysicalNetworkAdapter, Add-VDSwitchVMHost, Export-VDPortGro…
</span></span><span class="line"><span class="cl">Script     12.0.0.15947287            VMware.VimAutomation.Vmc                Desk      {Add-VmcSddcHost, Connect-Vmc, Disconnect-Vmc, Get-AwsAccount…}
</span></span><span class="line"><span class="cl">Script     12.0.0.15940184            VMware.VimAutomation.vROps              Desk      {Connect-OMServer, Disconnect-OMServer, Get-OMAlert, Get-OMAlertDefinitio…
</span></span><span class="line"><span class="cl">Script     12.0.0.15947288            VMware.VimAutomation.WorkloadManagement Desk      {Get-WMNamespace, Get-WMNamespacePermission, Get-WMNamespaceStoragePolicy…
</span></span><span class="line"><span class="cl">Script     6.5.1.7862888              VMware.VumAutomation                    Desk      {Add-EntityBaseline, Copy-Patch, Get-Baseline, Get-Compliance…}
</span></span></code></pre></td></tr></table>
</div>
</div><p>当VMware.PowerCLI发布新版本，你可以运行下面的命令来更新。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Update-Module &#34;VMware.PowerCLI&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>VMware.PowerCLI现在已安装完成，可以连接到您的vCenter Server或ESXi主机</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS /root&gt; Set-PowerCLIConfiguration -InvalidCertificateAction &#34;Ignore&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Perform operation?
</span></span><span class="line"><span class="cl">Performing operation &#39;Update PowerCLI configuration.&#39;?
</span></span><span class="line"><span class="cl">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &#34;Y&#34;): Y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Scope    ProxyPolicy     DefaultVIServerMode InvalidCertificateAction  DisplayDeprecationWarnings WebOperationTimeout
</span></span><span class="line"><span class="cl">                                                                                                  Seconds
</span></span><span class="line"><span class="cl">-----    -----------     ------------------- ------------------------  -------------------------- -------------------
</span></span><span class="line"><span class="cl">Session  UseSystemProxy  Multiple            Ignore                    True                       300
</span></span><span class="line"><span class="cl">User                                         Ignore                                               
</span></span><span class="line"><span class="cl">AllUsers  
</span></span></code></pre></td></tr></table>
</div>
</div>]]></content:encoded>
    </item>
    
    <item>
      <title>powercli The SSL connection could not be established, see inner exception. 问题解决</title>
      <link>https://www.oomkill.com/2019/10/powercli-the-ssl-connection-could-not-be-established-see-inner-exception/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/powercli-the-ssl-connection-could-not-be-established-see-inner-exception/</guid>
      <description></description>
      <content:encoded><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Connect-VIServer -Server 
</span></span></code></pre></td></tr></table>
</div>
</div><p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/1380340-20210801143141181-1047906479.png" alt=""  /></p>
<p>这里是“SSL连接不能建立&hellip;&hellip;”这实际上意味着你没有一个有效的证书。如果你想连接到vCenter没有一个有效的证书，您必须允许可以改变你的vCenter证书到受信任的一个，这是正确的解决方案，也可以忽略无效的证书，以规避所有的安全性，但使它现在的工作。</p>
<p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/1380340-20210801143200019-1825949412.png" alt=""  /></p>
<p>忽略无效证书</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Set-PowerCLIConfiguration -InvalidCertificateAction:ignore
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次登陆可正常登陆

  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/1380340-20210801143232415-1036597499.png" alt=""  /></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>powercli常用命令</title>
      <link>https://www.oomkill.com/2019/10/powercli-vsphere-command/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/powercli-vsphere-command/</guid>
      <description></description>
      <content:encoded><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Connect-VIServer -Server 10.11.17.20 -User administrator@vsphere.local -Password DC02@123456
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-OSCustomizationSpec linux1|Get-OSCustomizationNicMapping|Set-OSCustomizationNicMapping -IpMode UseStaticIP -SubnetMask 255.255.255.0 -DefaultGateway 10.10.12.254 -IpAddress 10.10.12.114
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">new-VM -Name zy-ntw-prod-dbvm-pushredis01  -Template template-centos76 -VMHost 10.10.12.14  -OSCustomizationspec linux1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-VM -name zy-ntw-prod-dbvm-pushredis01|set-VM -MemoryGB 96 -NumCPU 16
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">get-vm zy-ntw-prod-dbvm-pushredis01|New-HardDisk -CapacityGB 100
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">New-Snapshot -Name &#34;20200622&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Connect-VIServer -Server 10.11.17.20 -User administrator@vsphere.local -Password DC@123456
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Connect-VIServer -Server 10.11.17.20 -User administrator@vsphere.local -Password DC02@123456
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Connect-VIServer -Server 10.10.200.20 -User administrator@vsphere.local -Password DC@123456
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-OSCustomizationSpec linux1|Get-OSCustomizationNicMapping|Set-OSCustomizationNicMapping -IpMode UseStaticIP -SubnetMask 255.255.255.0 -DefaultGateway 10.11.31.254 -IpAddress 10.11.31.65
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">new-VM -Name zy-ntw-zr-prod-vip-upgrade01 -Template template-centos76 -VMHost 10.11.31.4 -OSCustomizationspec linux1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-OSCustomizationSpec linux1|Get-OSCustomizationNicMapping|Set-OSCustomizationNicMapping -IpMode UseStaticIP -SubnetMask 255.255.255.0 -DefaultGateway 10.11.31.254 -IpAddress 10.11.31.66
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">new-VM -Name zy-ntw-zr-prod-vip-upgrade02 -Template template-centos76 -VMHost 10.11.31.5 -OSCustomizationspec linux1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">get-vm zy-ntw-zr-prod-vip-upgrade*|set-VM -MemoryGB 8 -NumCPU 4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">get-harddisk zy-ntw-zr-prod-vip-upgrade*      
</span></span><span class="line"><span class="cl">get-harddisk zy-ntw-zr-prod-vip-upgrade*|set-harddisk -CapacityGB 100 
</span></span><span class="line"><span class="cl"># 现有硬盘扩容
</span></span><span class="line"><span class="cl">get-vm zy-ntw-zr-prod-vip-upgrade* |get-harddisk|set-harddisk -CapacityGB 100
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 删除虚拟机
</span></span><span class="line"><span class="cl">remove-vm –deletepermanently 
</span></span></code></pre></td></tr></table>
</div>
</div>]]></content:encoded>
    </item>
    
    <item>
      <title>powercli创建虚拟机步骤及批量创建脚本</title>
      <link>https://www.oomkill.com/2019/10/powercli-vsphere-command/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/powercli-vsphere-command/</guid>
      <description></description>
      <content:encoded><![CDATA[<blockquote>
<p>文档中心
<a href="https://pubs.vmware.com/vsphere-51/index.jsp?topic=%2Fcom.vmware.powercli.cmdletref.doc%2FSet-OSCustomizationSpec.html">https://pubs.vmware.com/vsphere-51/index.jsp?topic=%2Fcom.vmware.powercli.cmdletref.doc%2FSet-OSCustomizationSpec.html</a>
<a href="https://blogs.vmware.com/PowerCLI/2014/05/working-customization-specifications-powercli-part-1.html">https://blogs.vmware.com/PowerCLI/2014/05/working-customization-specifications-powercli-part-1.html</a>
<a href="http://powershelldistrict.com/powercli-oscustomizationspec/">http://powershelldistrict.com/powercli-oscustomizationspec/</a>
<a href="https://powercli-core.readthedocs.io/en/latest/cmd_new.html#new-oscustomizationspec">https://powercli-core.readthedocs.io/en/latest/cmd_new.html#new-oscustomizationspec</a>
<a href="https://pubs.vmware.com/vsphere-51/index.jsp?topic=%2Fcom.vmware.powercli.cmdletref.doc%2FSet-OSCustomizationSpec.html">官方文档中心</a></p>
</blockquote>
<p>添加一块新硬盘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">get-vm {vmname}|New-HardDisk -CapacityGB 300
</span></span></code></pre></td></tr></table>
</div>
</div><p>批量设置硬件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Get-VM -name {hostname}*|set-VM -MemoryGB 4 -NumCPU 2
</span></span></code></pre></td></tr></table>
</div>
</div><p>基于模板创建虚拟机</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">new-VM -Name {hostname}  -Template template-centos76 -VMHost 10.112.131.5  -OSCustomizationspec TestLinux
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置规范模板</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-OSCustomizationSpec TestLinux|Get-OSCustomizationNicMapping|Set-OSCustomizationNicMapping \
</span></span><span class="line"><span class="cl">-IpMode UseStaticIP \
</span></span><span class="line"><span class="cl">-SubnetMask 255.255.255.0 \
</span></span><span class="line"><span class="cl">-DefaultGateway 10.11.121.254 \
</span></span><span class="line"><span class="cl">-IpAddress 10.11.121.203
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Get-OSCustomizationSpec TestLinux|Get-OSCustomizationNicMapping|Set-OSCustomizationNicMapping \
</span></span><span class="line"><span class="cl">-IpMode UseStaticIP \
</span></span><span class="line"><span class="cl">-SubnetMask 255.255.255.0 \
</span></span><span class="line"><span class="cl">-DefaultGateway 10.11.131.254 \
</span></span><span class="line"><span class="cl">-IpAddress 10.11.131.64
</span></span></code></pre></td></tr></table>
</div>
</div><p>获得规范信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Get-OSCustomizationSpec liunx
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建一个新的规范</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">New-OSCustomizationSpec -OSType &#34;Linux&#34; -Name linux1 -Type Persistent –DnsServer &#34;8.8.8.8&#34;  –Domain &#34;vmware.com&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>批量创建脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$vserver=&#34;10.111.111.22&#34;
</span></span><span class="line"><span class="cl">$vuser=&#34;youname&#34;
</span></span><span class="line"><span class="cl">$vpwd=&#34;yourpasswd&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">filter Convert-IP2Decimal 
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    ([IPAddress][String]([IPAddress]$_)).Address
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">filter Convert-Decimal2IP
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	([System.Net.IPAddress]$_).IPAddressToString
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$IPPrefix=&#34;10.111.31&#34;
</span></span><span class="line"><span class="cl">$startIp=$args[0]
</span></span><span class="line"><span class="cl">$startHostname=$args[1]
</span></span><span class="line"><span class="cl">$num=$args[2]
</span></span><span class="line"><span class="cl">$gateway=&#34;10.111.31.254&#34;
</span></span><span class="line"><span class="cl">$netmask=&#34;255.255.255.0&#34;
</span></span><span class="line"><span class="cl">$cpu=4
</span></span><span class="line"><span class="cl">$mem=8
</span></span><span class="line"><span class="cl">$template=&#34;template-centos7&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$vhost17=,&#34;10.111.17.1&#34;,&#34;10.111.17.2&#34;,&#34;10.111.17.3&#34;,&#34;10.111.17.4&#34;
</span></span><span class="line"><span class="cl">$vhost20=,&#34;10.111.20.1&#34;,&#34;10.111.20.2&#34;,&#34;10.111.20.3&#34;,&#34;10.111.20.4&#34;
</span></span><span class="line"><span class="cl">$vhost31=,&#34;10.111.31.1&#34;,&#34;10.111.31.2&#34;,&#34;10.111.31.3&#34;,&#34;10.111.31.4&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">function LoginVSphere($server,$user,$pwd){
</span></span><span class="line"><span class="cl">	Connect-VIServer -Server $server[0] -User $server[1] -Password $server[2] -EA &#34;Stop&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">LoginVSphere($vserver, $vuser, $vpwd)
</span></span><span class="line"><span class="cl">$temp=Get-OSCustomizationSpec TestLinux 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">for($n=[int]$startIp;$n -le [int]$num; $n++)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	$ipaddr=-Join($IPPrefix,&#39;.&#39;,$n)
</span></span><span class="line"><span class="cl">	$hostname=-Join($startHostname,$n)
</span></span><span class="line"><span class="cl">	$temp|Get-OSCustomizationNicMapping|Set-OSCustomizationNicMapping -IpMode UseStaticIP -SubnetMask $netmask -DefaultGateway $gateway -IpAddress $ipaddr
</span></span><span class="line"><span class="cl">	new-VM -Name $hostname -Template $template -VMHost 10.111.31.5 -OSCustomizationspec TestLinux -Confirm:$false
</span></span><span class="line"><span class="cl">	Get-VM -Name $hostname|Set-VM -MemoryGB $mem -NumCPU $cpu -Confirm:$false
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="reference">Reference</h2>
<blockquote>
<p><a href="https://communities.vmware.com/thread/567585">https://communities.vmware.com/thread/567585</a></p>
<p><a href="https://www.itnotebooks.com/?p=716">脚本参考</a></p>
<p><a href="https://blogs.vmware.com/PowerCLI/2014/05/working-customization-specifications-powercli-part-1.html">https://blogs.vmware.com/PowerCLI/2014/05/working-customization-specifications-powercli-part-1.html</a></p>
<p><a href="http://powershelldistrict.com/powercli-oscustomizationspec/">http://powershelldistrict.com/powercli-oscustomizationspec/</a></p>
<p><a href="https://pubs.vmware.com/vsphere-51/index.jsp?topic=%2Fcom.vmware.powercli.cmdletref.doc%2FSet-OSCustomizationSpec.html">https://pubs.vmware.com/vsphere-51/index.jsp?topic=%2Fcom.vmware.powercli.cmdletref.doc%2FSet-OSCustomizationSpec.html</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
