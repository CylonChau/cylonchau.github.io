<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>zimbra on Cylon&#39;s Collection</title>
    <link>https://www.oomkill.com/tags/zimbra/</link>
    <description>Recent content in zimbra on Cylon&#39;s Collection</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 02 Oct 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://www.oomkill.com/tags/zimbra/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>zimbra安装故障记录</title>
      <link>https://www.oomkill.com/2020/10/zimbra-troubleshooing/</link>
      <pubDate>Fri, 02 Oct 2020 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2020/10/zimbra-troubleshooing/</guid>
      <description></description>
      <content:encoded><![CDATA[<h2 id="启动故障zimbra-postsuper-fatal-scan_dir_push-open-directory-defer-permission-denied">启动故障：<code>zimbra postsuper: fatal: scan_dir_push: open directory defer: Permission denied</code></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Host mail.domain.com
</span></span><span class="line"><span class="cl">        Starting ldap...Done.
</span></span><span class="line"><span class="cl">        Starting zmconfigd...Done.
</span></span><span class="line"><span class="cl">        Starting dnscache...Done.
</span></span><span class="line"><span class="cl">        Starting logger...Done.
</span></span><span class="line"><span class="cl">        Starting mailbox...Done.
</span></span><span class="line"><span class="cl">        Starting memcached...Done.
</span></span><span class="line"><span class="cl">        Starting proxy...Done.
</span></span><span class="line"><span class="cl">        Starting amavis...Done.
</span></span><span class="line"><span class="cl">        Starting antispam...Done.
</span></span><span class="line"><span class="cl">        Starting antivirus...Done.
</span></span><span class="line"><span class="cl">        Starting opendkim...Done.
</span></span><span class="line"><span class="cl">        Starting snmp...Done.
</span></span><span class="line"><span class="cl">        Starting spell...Done.
</span></span><span class="line"><span class="cl">        Starting mta...Failed.
</span></span><span class="line"><span class="cl">Starting saslauthd...done.
</span></span><span class="line"><span class="cl">postsuper: fatal: scan_dir_push: open directory defer: Permission denied
</span></span><span class="line"><span class="cl">postfix failed to start
</span></span><span class="line"><span class="cl">        Starting stats...Done.
</span></span><span class="line"><span class="cl">        Starting service webapp...Done.
</span></span><span class="line"><span class="cl">        Starting zimbra webapp...Done.
</span></span><span class="line"><span class="cl">        Starting zimbraAdmin webapp...Done.
</span></span><span class="line"><span class="cl">        Starting zimlet webapp...Done.
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看服务器状态：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mta   Stopped
</span></span><span class="line"><span class="cl">postfix is not running
</span></span></code></pre></td></tr></table>
</div>
</div><p>经查看mta服务是由postfix启动。</p>
<ul>
<li>
<p>查看系统是否已经对自带的sendmail和postfix进行关闭，端口25是否被占用，如果是请关闭并重启zimbra</p>
</li>
<li>
<p>如果不是则执行/opt/zimbra/libexec/zmfixperms (run as root)</p>
</li>
</ul>
<blockquote>
<p>Refer：<a href="https://www.chenxie.net/archives/635.html">Zimbra 启动时mta无法启动  postsuper: fatal: scan_dir_push: open directory defer: Permission denied</a></p>
</blockquote>
<h2 id="错误">错误：</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">opendkim: /opt/zimbra/conf/opendkim.conf: ldap://xxxx333.com:389/?DKIMSelector?sub?<span class="o">(</span><span class="nv">DKIMIdentity</span><span class="o">=</span><span class="nv">$d</span><span class="o">)</span>: dkimf_db_open<span class="o">()</span>: Connect error
</span></span><span class="line"><span class="cl">Failed to start opendkim: <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>原因：无法连接至ldap服务，检查ldap服务是否正常</p>
<blockquote>
<p>Refer：<a href="https://forums.zimbra.org/viewtopic.php?t=13946">ZCS 8.0 mta error with zmopendkimctl error </a></p>
</blockquote>
<h2 id="错误error-queue-report-unavailable">错误：Error: Queue report unavailable</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zmcontrol status
</span></span><span class="line"><span class="cl">Host mail.ttdconline.com
</span></span><span class="line"><span class="cl">amavis                  Running
</span></span><span class="line"><span class="cl">antispam                Running
</span></span><span class="line"><span class="cl">antivirus               Running
</span></span><span class="line"><span class="cl">ldap                    Running
</span></span><span class="line"><span class="cl">logger                  Running
</span></span><span class="line"><span class="cl">mailbox                 Running
</span></span><span class="line"><span class="cl">memcached               Running
</span></span><span class="line"><span class="cl">mta                     Running
</span></span><span class="line"><span class="cl">opendkim                Running
</span></span><span class="line"><span class="cl">proxy                   Running
</span></span><span class="line"><span class="cl">service webapp          Running
</span></span><span class="line"><span class="cl">snmp                    Running
</span></span><span class="line"><span class="cl">spell                   Running
</span></span><span class="line"><span class="cl">stats                   Running
</span></span><span class="line"><span class="cl">zimbra webapp           Running
</span></span><span class="line"><span class="cl">zimbraAdmin webapp      Running
</span></span><span class="line"><span class="cl">zimlet webapp           Running
</span></span><span class="line"><span class="cl">zmconfigd               Running
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">We reviewed logs and services and we see that the MTA is down:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ tail -f /var/log/mail.log
</span></span><span class="line"><span class="cl">Jan 22 11:08:00 zcs postfix/postqueue[19195]: fatal: Queue report unavailable – mail system is down
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Refer: <a href="https://dilliganesh.wordpress.com/2016/10/12/error-queue-report-unavailable-mail-system-is-down/">Error: Queue report unavailable – mail system is down					</a></p>
</blockquote>
<h2 id="错误-logswatch-failed">错误 Logswatch Failed</h2>
<p>zimbra logswatch failed</p>
<p>. /opt/zimbra/.bashrc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Starting logger...Failed.
</span></span><span class="line"><span class="cl">[b]Starting logswatch...failed.[/b]
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Refer: <a href="https://forums.zimbra.org/viewtopic.php?f=13&amp;t=66900">8.8.15 Starting Logswatch Failed</a></p>
</blockquote>
<h2 id="修改管理员账户密码">修改管理员账户密码</h2>
<p>server.domain.com (<code>https://server.domain.com:7071</code>) 是当前运行的zimbra的域名或者IP地址，默认的http监听端口为7071
输入用户名： <a href="https://link.jianshu.com?t=mailto:admin@domain.com">admin@domain.com</a> 和密码，完成登录</p>
<p>在zimbra安装配置时创建了管理员账户，可以在web端的账户工具栏任何时候进行账户密码修改，选择administrator 用户并选择密码修改
也可以在命令行中运行zmprov进行管理员账户密码的修改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">zmprov sp admin@domain.com &lt;password&gt;
</span></span><span class="line"><span class="cl">zmprov gaaa //列出所有管理员
</span></span><span class="line"><span class="cl">zmprov sp admin q1w2e3r4 或 zmprov sp admin@wish.com q12e3r4  <span class="c1"># 修改管理员账号密码</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="清除队列">清除队列</h2>
<p>查看发送队列数量:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/opt/zimbra/libexec/zmqstat
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看队列内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mailq
</span></span></code></pre></td></tr></table>
</div>
</div><p>删除队列</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/opt/zimbra/postfix/sbin/postqueue -f
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看邮件队列</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/opt/zimbra/postfix/sbin/postcat -qv EC753D0D00
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Refer：</p>
<p><a href="https://wiki.zimbra.com/wiki/Managing-The-Postfix-Queues">Managing The Postfix Queues</a></p>
<p>[Zimbra – deleting all email in queue by sender](Zimbra – deleting all email in queue by sender)</p>
</blockquote>
<h2 id="被攻击状态">被攻击状态</h2>
<p>查看邮件状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ /opt/zimbra/libexec/zmqstat
</span></span><span class="line"><span class="cl">hold=0
</span></span><span class="line"><span class="cl">corrupt=0
</span></span><span class="line"><span class="cl">deferred=563344
</span></span><span class="line"><span class="cl">active=19992
</span></span><span class="line"><span class="cl">incoming=45830
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">postmap /opt/zimbra/conf/restricted_senders
</span></span><span class="line"><span class="cl">postmap /opt/zimbra/conf/local_domains 
</span></span><span class="line"><span class="cl">postmap ../common/conf/main.cf
</span></span></code></pre></td></tr></table>
</div>
</div><p>问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Feb 23 00:36:56 ${domainname} postfix/postscreen[7614]: PASS OLD [193.26.3.10]:63396
</span></span><span class="line"><span class="cl">Feb 23 00:36:56 ${domainname} postfix/smtpd[7615]: connect from mail.health.kiev.ua[193.26.3.10]
</span></span><span class="line"><span class="cl">Feb 23 00:36:57 ${domainname} postfix/smtpd[7615]: Anonymous TLS connection established from mail.health.kiev.ua[193.26.3.10]: TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits)
</span></span><span class="line"><span class="cl">Feb 23 00:36:58 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders is unavailable. open database /opt/zimbra/conf/restricted_senders.lmdb: MDB_INVALID: File is not an LMDB file
</span></span><span class="line"><span class="cl">Feb 23 00:36:58 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders: table lookup problem
</span></span><span class="line"><span class="cl">Feb 23 00:36:58 ${domainname} postfix/smtpd[7615]: NOQUEUE: reject: RCPT from mail.health.kiev.ua[193.26.3.10]: 451 4.3.5 &lt;&gt;: Sender address rejected: Server configuration error; from=&lt;&gt; to=&lt;vivian@${domainname}.com&gt; proto=ESMTP helo=&lt;mail.health.kiev.ua&gt;
</span></span><span class="line"><span class="cl">Feb 23 00:36:59 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders is unavailable. open database /opt/zimbra/conf/restricted_senders.lmdb: MDB_INVALID: File is not an LMDB file
</span></span><span class="line"><span class="cl">Feb 23 00:36:59 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders: table lookup problem
</span></span><span class="line"><span class="cl">Feb 23 00:36:59 ${domainname} postfix/smtpd[7615]: NOQUEUE: reject: RCPT from mail.health.kiev.ua[193.26.3.10]: 451 4.3.5 &lt;&gt;: Sender address rejected: Server configuration error; from=&lt;&gt; to=&lt;vivian@${domainname}.com&gt; proto=ESMTP helo=&lt;mail.health.kiev.ua&gt;
</span></span><span class="line"><span class="cl">Feb 23 00:37:00 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders is unavailable. open database /opt/zimbra/conf/restricted_senders.lmdb: MDB_INVALID: File is not an LMDB file
</span></span><span class="line"><span class="cl">Feb 23 00:37:00 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders: table lookup problem
</span></span><span class="line"><span class="cl">Feb 23 00:37:00 ${domainname} postfix/smtpd[7615]: NOQUEUE: reject: RCPT from mail.health.kiev.ua[193.26.3.10]: 451 4.3.5 &lt;&gt;: Sender address rejected: Server configuration error; from=&lt;&gt; to=&lt;vivian@${domainname}.com&gt; proto=ESMTP helo=&lt;mail.health.kiev.ua&gt;
</span></span><span class="line"><span class="cl">Feb 23 00:37:00 ${domainname} postfix/postqueue[13129]: fatal: Queue report unavailable - mail system is down
</span></span><span class="line"><span class="cl">Feb 23 00:37:01 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders is unavailable. open database /opt/zimbra/conf/restricted_senders.lmdb: MDB_INVALID: File is not an LMDB file
</span></span><span class="line"><span class="cl">Feb 23 00:37:01 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders: table lookup problem
</span></span><span class="line"><span class="cl">Feb 23 00:37:01 ${domainname} postfix/smtpd[7615]: NOQUEUE: reject: RCPT from mail.health.kiev.ua[193.26.3.10]: 451 4.3.5 &lt;&gt;: Sender address rejected: Server configuration error; from=&lt;&gt; to=&lt;vivian@${domainname}.com&gt; proto=ESMTP helo=&lt;mail.health.kiev.ua&gt;
</span></span><span class="line"><span class="cl">Feb 23 00:37:01 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders is unavailable. open database /opt/zimbra/conf/restricted_senders.lmdb: MDB_INVALID: File is not an LMDB file
</span></span><span class="line"><span class="cl">Feb 23 00:37:01 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders: table lookup problem
</span></span><span class="line"><span class="cl">Feb 23 00:37:01 ${domainname} postfix/smtpd[7615]: NOQUEUE: reject: RCPT from mail.health.kiev.ua[193.26.3.10]: 451 4.3.5 &lt;&gt;: Sender address rejected: Server configuration error; from=&lt;&gt; to=&lt;vivian@${domainname}.com&gt; proto=ESMTP helo=&lt;mail.health.kiev.ua&gt;
</span></span><span class="line"><span class="cl">Feb 23 00:37:05 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders is unavailable. open database /opt/zimbra/conf/restricted_senders.lmdb: MDB_INVALID: File is not an LMDB file
</span></span><span class="line"><span class="cl">Feb 23 00:37:05 ${domainname} postfix/smtpd[7615]: warning: lmdb:/opt/zimbra/conf/restricted_senders: table lookup problem
</span></span></code></pre></td></tr></table>
</div>
</div><p>解决：找其他服务器处理这个问题并修改配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">local_only = check_recipient_access lmdb:/opt/zimbra/conf/local_domains, reject
</span></span></code></pre></td></tr></table>
</div>
</div><p>正常</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Feb 23 00:49:31 ${domainname} postfix/smtpd[24306]: connect from iZj6c4jc5vsy383um5cgomZ[172.31.108.227]
</span></span><span class="line"><span class="cl">Feb 23 00:49:31 ${domainname} postfix/smtpd[24306]: NOQUEUE: reject: RCPT from iZj6c4jc5vsy383um5cgomZ[172.31.108.227]: 554 5.7.1 &lt;test1@${domainname}.com&gt;: Sender address rejected: Access denied; from=&lt;test1@${domainname}.com&gt; to=&lt;test@163.com&gt; proto=ESMTP helo=&lt;${domainname}.com&gt;
</span></span><span class="line"><span class="cl">Feb 23 00:49:31 ${domainname} postfix/smtpd[24306]: disconnect from iZj6c4jc5vsy383um5cgomZ[172.31.108.227] ehlo=1 mail=1 rcpt=0/1 quit=1 commands=3/4
</span></span><span class="line"><span class="cl">Feb 23 00:49:31 ${domainname} zmconfigd[17300]: Tracking service snmp
</span></span><span class="line"><span class="cl">Feb 23 00:49:32 ${domainname} zmconfigd[17300]: Watchdog: service antivirus status is OK.
</span></span><span class="line"><span class="cl">Feb 23 00:49:32 ${domainname} zmconfigd[17300]: All rewrite threads completed in 0.00 se
</span></span></code></pre></td></tr></table>
</div>
</div><p>配置安全策略</p>
<blockquote>
<p><a href="https://blog.csdn.net/qq_38209584/article/details/73867569">Zimbra 8.7.11规则：只能发送内部邮件</a></p>
<p><a href="https://wiki.zimbra.com/wiki/Domain_level_blocking_of_users#ZCS_8.7_and_later">Domain level blocking of users</a></p>
<p><a href="https://wiki.zimbra.com/wiki/Rejecting_Emails_at_SMTP_Level">Rejecting Emails at SMTP Level</a></p>
</blockquote>
<p>配置监控策略</p>
<blockquote>
<p><a href="https://zimbra.github.io/adminguide/latest/#_configuring_disk_space_notifications">配置磁盘空间的告警</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>zimbra安装三方颁发的证书</title>
      <link>https://www.oomkill.com/2020/01/zimbra-install-buisness-cert/</link>
      <pubDate>Thu, 09 Jan 2020 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2020/01/zimbra-install-buisness-cert/</guid>
      <description></description>
      <content:encoded><![CDATA[<h2 id="步骤1取得ssl凭证">步骤1：取得SSL凭证</h2>
<p>证书需要取的从根证书每一级的证书</p>
<h2 id="步骤2合成ssl证书">步骤2：合成SSL证书</h2>
<p>将中级、根证书合成为一个证书</p>
<p>顺序：按照从后到前合成为一个证书  如，三级 ==》二级 ==》 根</p>
<p>合成后的格式如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE----- 
</span></span><span class="line"><span class="cl">你的crt內容
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE----- 
</span></span><span class="line"><span class="cl">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/
</span></span><span class="line"><span class="cl">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT
</span></span><span class="line"><span class="cl">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow
</span></span><span class="line"><span class="cl">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD
</span></span><span class="line"><span class="cl">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
</span></span><span class="line"><span class="cl">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O
</span></span><span class="line"><span class="cl">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq
</span></span><span class="line"><span class="cl">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b
</span></span><span class="line"><span class="cl">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw
</span></span><span class="line"><span class="cl">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD
</span></span><span class="line"><span class="cl">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV
</span></span><span class="line"><span class="cl">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG
</span></span><span class="line"><span class="cl">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69
</span></span><span class="line"><span class="cl">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr
</span></span><span class="line"><span class="cl">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz
</span></span><span class="line"><span class="cl">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5
</span></span><span class="line"><span class="cl">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo
</span></span><span class="line"><span class="cl">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="步骤3验证你的商业证书">步骤3：验证你的商业证书</h2>
<p>复制生成的所有证书到目录 <code>/opt/zimbra/ssl/zimbra/commercial</code> 下，（合成后的根证书、证书、与秘钥）</p>
<p>切換到 zimbra 用戶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ zmcertmgr verifycrt comm  {{privkey.key}} {{cert.crt}} {{ca.crt}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ zmcertmgr verifycrt  comm commercial.key commercial.crt  commercial_ca.crt
</span></span><span class="line"><span class="cl">** Verifying &#39;commercial.crt&#39; against &#39;commercial.key&#39;
</span></span><span class="line"><span class="cl">Certificate &#39;commercial.crt&#39; and private key &#39;commercial.key&#39; match.
</span></span><span class="line"><span class="cl">** Verifying &#39;commercial.crt&#39; against &#39;commercial_ca.crt&#39;
</span></span><span class="line"><span class="cl">Valid certificate chain: commercial.crt: OK
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="步骤4部署证书">步骤4：部署证书</h2>
<p><strong>注意：以下所有命令应以zimbra用户</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ /opt/zimbra/bin/zmcertmgr deploycrt comm {{cert.crt}} {{ca.crt}}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ zmcertmgr deploycrt  comm commercial.crt  commercial_ca.crt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">** Fixing newlines in &#39;commercial.crt&#39;
</span></span><span class="line"><span class="cl">** Fixing newlines in &#39;commercial_ca.crt&#39;
</span></span><span class="line"><span class="cl">** Verifying &#39;commercial.crt&#39; against &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39;
</span></span><span class="line"><span class="cl">Certificate &#39;commercial.crt&#39; and private key &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; match.
</span></span><span class="line"><span class="cl">** Verifying &#39;commercial.crt&#39; against &#39;commercial_ca.crt&#39;
</span></span><span class="line"><span class="cl">Valid certificate chain: commercial.crt: OK
</span></span><span class="line"><span class="cl">** Copying &#39;commercial.crt&#39; to &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39;
</span></span><span class="line"><span class="cl">&#39;commercial.crt&#39; and &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39; are identical (not copied) at /opt/zimbra/bin/zmcertmgr line 1278.
</span></span><span class="line"><span class="cl">** Copying &#39;commercial_ca.crt&#39; to &#39;/opt/zimbra/ssl/zimbra/commercial/commercial_ca.crt&#39;
</span></span><span class="line"><span class="cl">&#39;commercial_ca.crt&#39; and &#39;/opt/zimbra/ssl/zimbra/commercial/commercial_ca.crt&#39; are identical (not copied) at /opt/zimbra/bin/zmcertmgr line 1278.
</span></span><span class="line"><span class="cl">** Appending ca chain &#39;commercial_ca.crt&#39; to &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39;
</span></span><span class="line"><span class="cl">** Importing cert &#39;/opt/zimbra/ssl/zimbra/commercial/commercial_ca.crt&#39; as &#39;zcs-user-commercial_ca&#39; into cacerts &#39;/opt/zimbra/common/lib/jvm/java/lib/security/cacerts&#39;
</span></span><span class="line"><span class="cl">** NOTE: restart mailboxd to use the imported certificate.
</span></span><span class="line"><span class="cl">** Saving config key &#39;zimbraSSLCertificate&#39; via zmprov modifyServer mail.com...ok
</span></span><span class="line"><span class="cl">** Saving config key &#39;zimbraSSLPrivateKey&#39; via zmprov modifyServer mail.com...ok
</span></span><span class="line"><span class="cl">** Installing imapd certificate &#39;/opt/zimbra/conf/imapd.crt&#39; and key &#39;/opt/zimbra/conf/imapd.key&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39; to &#39;/opt/zimbra/conf/imapd.crt&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; to &#39;/opt/zimbra/conf/imapd.key&#39;
</span></span><span class="line"><span class="cl">** Creating file &#39;/opt/zimbra/ssl/zimbra/jetty.pkcs12&#39;
</span></span><span class="line"><span class="cl">** Creating keystore &#39;/opt/zimbra/conf/imapd.keystore&#39;
</span></span><span class="line"><span class="cl">** Installing ldap certificate &#39;/opt/zimbra/conf/slapd.crt&#39; and key &#39;/opt/zimbra/conf/slapd.key&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39; to &#39;/opt/zimbra/conf/slapd.crt&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; to &#39;/opt/zimbra/conf/slapd.key&#39;
</span></span><span class="line"><span class="cl">** Creating file &#39;/opt/zimbra/ssl/zimbra/jetty.pkcs12&#39;
</span></span><span class="line"><span class="cl">** Creating keystore &#39;/opt/zimbra/mailboxd/etc/keystore&#39;
</span></span><span class="line"><span class="cl">** Installing mta certificate &#39;/opt/zimbra/conf/smtpd.crt&#39; and key &#39;/opt/zimbra/conf/smtpd.key&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39; to &#39;/opt/zimbra/conf/smtpd.crt&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; to &#39;/opt/zimbra/conf/smtpd.key&#39;
</span></span><span class="line"><span class="cl">** Installing proxy certificate &#39;/opt/zimbra/conf/nginx.crt&#39; and key &#39;/opt/zimbra/conf/nginx.key&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.crt&#39; to &#39;/opt/zimbra/conf/nginx.crt&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; to &#39;/opt/zimbra/conf/nginx.key&#39;
</span></span><span class="line"><span class="cl">** NOTE: restart services to use the new certificates.
</span></span><span class="line"><span class="cl">** Cleaning up 3 files from &#39;/opt/zimbra/conf/ca&#39;
</span></span><span class="line"><span class="cl">** Removing /opt/zimbra/conf/ca/629b96f7.0
</span></span><span class="line"><span class="cl">** Removing /opt/zimbra/conf/ca/ca.key
</span></span><span class="line"><span class="cl">** Removing /opt/zimbra/conf/ca/ca.pem
</span></span><span class="line"><span class="cl">** Copying CA to /opt/zimbra/conf/ca
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/ca/ca.key&#39; to &#39;/opt/zimbra/conf/ca/ca.key&#39;
</span></span><span class="line"><span class="cl">** Copying &#39;/opt/zimbra/ssl/zimbra/ca/ca.pem&#39; to &#39;/opt/zimbra/conf/ca/ca.pem&#39;
</span></span><span class="line"><span class="cl">** Creating CA hash symlink &#39;629b96f7.0&#39; -&gt; &#39;ca.pem&#39;
</span></span><span class="line"><span class="cl">** Creating /opt/zimbra/conf/ca/commercial_ca_1.crt
</span></span><span class="line"><span class="cl">** Creating CA hash symlink &#39;65ff7287.0&#39; -&gt; &#39;commercial_ca_1.crt&#39;
</span></span><span class="line"><span class="cl">** Creating /opt/zimbra/conf/ca/commercial_ca_2.crt
</span></span><span class="line"><span class="cl">** Creating CA hash symlink &#39;fc5a8f99.0&#39; -&gt; &#39;commercial_ca_2.crt&#39;
</span></span><span class="line"><span class="cl">** Creating /opt/zimbra/conf/ca/commercial_ca_3.crt
</span></span><span class="line"><span class="cl">** Creating CA hash symlink &#39;157753a5.0&#39; -&gt; &#39;commercial_ca_3.crt&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>重启zimbra服务</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zmcontrol restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>瀏覽器訪問地址</p>
<p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/1380340-20210801141804014-521206040.png" alt=""  /></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>zimbra启用SMTP认证</title>
      <link>https://www.oomkill.com/2020/01/zimbra-enable-smtp-authentication/</link>
      <pubDate>Wed, 08 Jan 2020 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2020/01/zimbra-enable-smtp-authentication/</guid>
      <description></description>
      <content:encoded><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zmprov modifyServer {{ you domain }} zimbraMtaTlsAuthOnly FALSE
</span></span><span class="line"><span class="cl">zmcontrol  restart 
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看对应配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zmprov getServer {{ you domain }} |  grep  Auth
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看SMTP是否开启成功</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ telnet localhost 25
</span></span><span class="line"><span class="cl">Trying 127.0.0.1...
</span></span><span class="line"><span class="cl">Connected to localhost.
</span></span><span class="line"><span class="cl">Escape character is &#39;^]&#39;.
</span></span><span class="line"><span class="cl">220 xxxx ESMTP Postfix
</span></span><span class="line"><span class="cl">ehlo xxxx      
</span></span><span class="line"><span class="cl">250-xxxxx
</span></span><span class="line"><span class="cl">250-PIPELINING
</span></span><span class="line"><span class="cl">250-SIZE 10240000
</span></span><span class="line"><span class="cl">250-VRFY
</span></span><span class="line"><span class="cl">250-ETRN
</span></span><span class="line"><span class="cl">250-STARTTLS
</span></span><span class="line"><span class="cl">250-AUTH LOGIN PLAIN      #SMTP认证相关参数
</span></span><span class="line"><span class="cl">250-AUTH=LOGIN PLAIN     #SMTP认证相关参数
</span></span><span class="line"><span class="cl">250-ENHANCEDSTATUSCODES
</span></span><span class="line"><span class="cl">250-8BITMIME
</span></span><span class="line"><span class="cl">250 DSN
</span></span></code></pre></td></tr></table>
</div>
</div>]]></content:encoded>
    </item>
    
    <item>
      <title>使用ldap客户端创建zimbra ldap用户的格式</title>
      <link>https://www.oomkill.com/2019/12/zimbra-ldap-createaccount/</link>
      <pubDate>Mon, 16 Dec 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/12/zimbra-ldap-createaccount/</guid>
      <description></description>
      <content:encoded><![CDATA[<p>命令如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat &lt;&lt; EOF | ldapadd -x -W -H ldap://:389 -D &#34;uid=zimbra,cn=admins,cn=zimbra&#34;
</span></span><span class="line"><span class="cl">dn: uid=jak1,ou=people,dc=mail,dc=xxxxx2021,dc=com
</span></span><span class="line"><span class="cl">zimbraAccountStatus: active
</span></span><span class="line"><span class="cl">displayName: jak1
</span></span><span class="line"><span class="cl">givenName: jak1
</span></span><span class="line"><span class="cl">sn: jak1
</span></span><span class="line"><span class="cl">zimbraMailStatus: enabled
</span></span><span class="line"><span class="cl">objectClass: inetOrgPerson
</span></span><span class="line"><span class="cl">objectClass: zimbraAccount
</span></span><span class="line"><span class="cl">objectClass: amavisAccount
</span></span><span class="line"><span class="cl">zimbraId: e2214a66-3ga2-4241-9223-44f222ce0522
</span></span><span class="line"><span class="cl">zimbraCreateTimestamp: 20191102062818.876Z
</span></span><span class="line"><span class="cl">zimbraMailHost: mail.xxxx2021.com
</span></span><span class="line"><span class="cl">zimbraMailTransport: lmtp:mail.xxxx2021.com:7025
</span></span><span class="line"><span class="cl">zimbraMailDeliveryAddress: scott8@mail.xxxx2021.com
</span></span><span class="line"><span class="cl">mail: jak1@mail.xxxx2021.com
</span></span><span class="line"><span class="cl">cn: jak1
</span></span><span class="line"><span class="cl">uid: jak1
</span></span><span class="line"><span class="cl">userPassword:: e1NTSEE1MTJ9ZzBzZGlXRlBjbDQxa2xmZ200YXc1ZkJzSGQzVXNBdVBydUlKRnZ
</span></span><span class="line"><span class="cl"> LTExYby9HWXBoUkNTMzZYMEx5VnpCZUJPMGJNTCtTV2IwSnhkaHdudTViR0c1bTJabFVhU3R1N1J3
</span></span><span class="line"><span class="cl">EOF
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>zimbraAccountStatus 为账户设置中的状态</li>
<li>zimbraId 唯一的值</li>
<li>givenName 姓</li>
<li>displayName 显示名字</li>
</ul>
<p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221125182349029.png" alt="image-20221125182349029"  /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ldapsearch -LLL -w 99tJFkhVfn -H ldap://172.31.110.115:389 -D <span class="s2">&#34;uid=zimbra,cn=admins,cn=zimbra&#34;</span><span class="p">|</span>less
</span></span></code></pre></td></tr></table>
</div>
</div>]]></content:encoded>
    </item>
    
    <item>
      <title>zimbra安装ssl证书</title>
      <link>https://www.oomkill.com/2019/10/zimbra-ssl/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/zimbra-ssl/</guid>
      <description></description>
      <content:encoded><![CDATA[<p>zimbra在后台安装证书签发机构签发证书出现时候出现错误：{RemoteManager: mail.domain.com-&gt;zimbra@mail.domain.com:22}</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">com.zimbra.common.service.ServiceException: system failure: exception during auth {RemoteManager: mail.domain.com-&gt;zimbra@mail.domain.com:22}
</span></span><span class="line"><span class="cl">ExceptionId:qtp1068934215-357:https:https ://mail.domain.com:7071/service/admin/soap/GetMailQueueRequest:
</span></span><span class="line"><span class="cl">Code:service.FAILURE
</span></span></code></pre></td></tr></table>
</div>
</div><p>
  <img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/1380340-20210801141357701-503029310.png" alt=""  /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">com.zimbra.common.service.ServiceException: system failure: exception during auth {RemoteManager: mail.domain.com-&gt;zimbra@mail.domain.com:22}
</span></span><span class="line"><span class="cl">ExceptionId:qtp1068934215-357:https:https ://mail.domain.com:7071/service/admin/soap/GetMailQueueRequest:
</span></span><span class="line"><span class="cl">Code:service.FAILURE
</span></span><span class="line"><span class="cl">       at com.zimbra.common.service.ServiceException.FAILURE(ServiceException.java:286)
</span></span><span class="line"><span class="cl">       at com.zimbra.cs.rmgmt.RemoteManager.getSession(RemoteManager.java:209)
</span></span><span class="line"><span class="cl">       at com.zimbra.cs.rmgmt.RemoteManager.execute(RemoteManager.java:139)
</span></span><span class="line"><span class="cl">       at com.zimbra.cert.GetCert.addCertsOnServer(GetCert.java:112)
</span></span><span class="line"><span class="cl">       at com.zimbra.cert.GetCert.handle(GetCert.java:75)
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">       Caused by: java.io.IOException: There was a problem while connecting to mail.domain.com:22
</span></span><span class="line"><span class="cl">               at ch.ethz.ssh2.Connection.connect(Connection.java:699)
</span></span><span class="line"><span class="cl">               at ch.ethz.ssh2.Connection.connect(Connection.java:490)
</span></span><span class="line"><span class="cl">               at com.zimbra.cs.rmgmt.RemoteManager.getSession(RemoteManager.java:200)
</span></span><span class="line"><span class="cl">               ... 59 more
</span></span></code></pre></td></tr></table>
</div>
</div><p>检查ssh的配置与zimbra的配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$  zmprov gacf | grep Remote
</span></span><span class="line"><span class="cl">zimbraRemoteImapBindPort: 8143
</span></span><span class="line"><span class="cl">zimbraRemoteImapSSLBindPort: 8993
</span></span><span class="line"><span class="cl">zimbraRemoteImapSSLServerEnabled: TRUE
</span></span><span class="line"><span class="cl">zimbraRemoteImapServerEnabled: TRUE
</span></span><span class="line"><span class="cl">zimbraRemoteManagementCommand: /opt/zimbra/libexec/zmrcd
</span></span><span class="line"><span class="cl">zimbraRemoteManagementPort: 22
</span></span><span class="line"><span class="cl">zimbraRemoteManagementPrivateKeyPath: /opt/zimbra/.ssh/zimbra_identity
</span></span><span class="line"><span class="cl">zimbraRemoteManagementUser: zimbra
</span></span></code></pre></td></tr></table>
</div>
</div><p>看到ssh端口为22，修改为当前系统使用的ssh端口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zmprov mcf zimbraRemoteManagementPort {sshport}
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次查看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">zmprov gacf | grep Remote
</span></span><span class="line"><span class="cl">zimbraRemoteImapBindPort: 8143
</span></span><span class="line"><span class="cl">zimbraRemoteImapSSLBindPort: 8993
</span></span><span class="line"><span class="cl">zimbraRemoteImapSSLServerEnabled: TRUE
</span></span><span class="line"><span class="cl">zimbraRemoteImapServerEnabled: TRUE
</span></span><span class="line"><span class="cl">zimbraRemoteManagementCommand: /opt/zimbra/libexec/zmrcd
</span></span><span class="line"><span class="cl">zimbraRemoteManagementPort: 9955
</span></span><span class="line"><span class="cl">zimbraRemoteManagementPrivateKeyPath: /opt/zimbra/.ssh/zimbra_identity
</span></span><span class="line"><span class="cl">zimbraRemoteManagementUser: zimbra
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改zimbra用户可以被允许登陆ssh</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">AllowUsers root zimbra
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时可以正确提交</p>
<h2 id="reference">Reference</h2>
<blockquote>
<p><a href="http://thaiserv.blogspot.com/2015/05/get-message-failure-exception-during.html">http://thaiserv.blogspot.com/2015/05/get-message-failure-exception-during.html</a>
<a href="https://wiki.zimbra.com/wiki/RemoteManager_exception">https://wiki.zimbra.com/wiki/RemoteManager_exception</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>zimbra修改ServerName</title>
      <link>https://www.oomkill.com/2019/10/zimbra-change-servername/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/zimbra-change-servername/</guid>
      <description></description>
      <content:encoded><![CDATA[<p>文章概述了如何使用 <strong>zmsetservername</strong> 更改 Zimbra 服务器的主机名。请注意，此 CLI 命令的用法因您运行的 ZCS 版本而异。</p>
<p>语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./zmsetservername <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-d<span class="o">]</span> <span class="o">[</span>-f<span class="o">]</span> <span class="o">[</span>-s<span class="o">]</span> <span class="o">[</span>-o &lt;上一个服务器名称&gt;<span class="o">]</span> <span class="o">[</span>-v+<span class="o">]</span> -n &lt;服务器名称&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>参数说明</p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&ndash;help</td>
<td style="text-align:left">显示 zmsetservername 的使用选项。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;force</td>
<td style="text-align:left">强制重命名，绕过安全检查。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;oldServerName</td>
<td style="text-align:left"><strong><oldname></strong> 服务器以前的名称。默认为 LC zimbra_server_hostname。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;newServerName</td>
<td style="text-align:left"><strong><newname></strong> 服务器的新名称。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;deletelogger</td>
<td style="text-align:left">删除旧服务器的记录器数据库。默认是将其数据重新映射到新主机名。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;skipusers</td>
<td style="text-align:left">跳过使用新服务器修改用户数据库。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;usersonly</td>
<td style="text-align:left">仅更新用户数据库。这样，您可以运行一次来完成所有服务器更新，然后运行第二次来更新帐户。可能需要 <code>--force</code>。</td>
</tr>
<tr>
<td style="text-align:left">&ndash;verbose</td>
<td style="text-align:left">设置详细级别。可以多次指定以提高级别。</td>
</tr>
</tbody>
</table>
<h2 id="reference">Reference</h2>
<p><a href="https://wiki.zimbra.com/wiki/ZmSetServerName">zm设置服务器名称</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>zimbra用户管理员脚本</title>
      <link>https://www.oomkill.com/2019/10/zimbra-admin-script/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://www.oomkill.com/2019/10/zimbra-admin-script/</guid>
      <description></description>
      <content:encoded><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1"># $1 domain</span>
</span></span><span class="line"><span class="cl"><span class="c1"># $2 email</span>
</span></span><span class="line"><span class="cl">zmprov ma <span class="nv">$2</span> zimbraIsDelegatedAdminAccount TRUE
</span></span><span class="line"><span class="cl">zmprov ma <span class="nv">$2</span> zimbraAdminConsoleUIComponents cartBlancheUI zimbraAdminConsoleUIComponents domainListView zimbraAdminConsoleUIComponents accountListView zimbraAdminConsoleUIComponents DLListView
</span></span><span class="line"><span class="cl">zmprov ma <span class="nv">$2</span> zimbraDomainAdminMaxMailQuota <span class="m">0</span>
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +createAccount
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +createAlias
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +createCalendarResource
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +createDistributionList
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +deleteAlias
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +listDomain
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> +domainAdminRights
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> set.account.zimbraAccountStatus
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> set.account.sn
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> set.account.displayName
</span></span><span class="line"><span class="cl">zmprov grantRight domain <span class="nv">$1</span> usr <span class="nv">$2</span> set.account.zimbraPasswordMustChange
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +deleteAccount
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +getAccountInfo
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +getAccountMembership
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +listAccount
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +removeAccountAlias
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +renameAccount
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +setAccountPassword
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +viewAccountAdminUI
</span></span><span class="line"><span class="cl">zmprov grantRight account <span class="nv">$2</span> usr <span class="nv">$2</span> +configureQuota
</span></span></code></pre></td></tr></table>
</div>
</div>]]></content:encoded>
    </item>
    
  </channel>
</rss>
