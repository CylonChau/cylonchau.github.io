<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用fpm制作rpm包与搭建本地yum源 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="Linux,rpm,fpm"><meta name=description content="rpm与fpm 软件的安装方式 编译安装：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长 yum安装：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。 编译源码：根据自己的需求做成 RMP包 ==> 搭建yum仓库 ==> yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。 RPM概述 RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。
rpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。
关于rpm命令的使用可以用rpm &ndash;help来获得
rpmbuild rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。
作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候
fpm fpm 是将一种类型的包转换成另一种类型
支持的源类型包
类型 说明 dir 将目录打包成所需要的类型，可以用于源码编译安装的软件包 rpm 对rpm进行转换 gem 对rubygem包进行转换 python 将python模块打包成相对应的类型 支持目标类型包 rpm 转换为rpm包 deb 转换为deb包 solaris 装环卫solaris包 puppet 转换为puppet模块 fpm安装 fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。
yum安装ruby模块 bash 1 yum install ruby rubygems ruby-devel -y 查看ruby的版本
bash 1 2 3 4 5 6 7 $ rpm -qa|grep ruby ruby-libs-1.8.7.374-4.el6_6.x86_64 rubygems-1.3.7-5.el6.noarch ruby-1."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2016/12/fpm/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2016/12/fpm/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="使用fpm制作rpm包与搭建本地yum源"><meta property="og:description" content="rpm与fpm 软件的安装方式 编译安装：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长 yum安装：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。 编译源码：根据自己的需求做成 RMP包 ==> 搭建yum仓库 ==> yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。 RPM概述 RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。
rpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。
关于rpm命令的使用可以用rpm &ndash;help来获得
rpmbuild rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。
作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候
fpm fpm 是将一种类型的包转换成另一种类型
支持的源类型包
类型 说明 dir 将目录打包成所需要的类型，可以用于源码编译安装的软件包 rpm 对rpm进行转换 gem 对rubygem包进行转换 python 将python模块打包成相对应的类型 支持目标类型包 rpm 转换为rpm包 deb 转换为deb包 solaris 装环卫solaris包 puppet 转换为puppet模块 fpm安装 fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。
yum安装ruby模块 bash 1 yum install ruby rubygems ruby-devel -y 查看ruby的版本
bash 1 2 3 4 5 6 7 $ rpm -qa|grep ruby ruby-libs-1.8.7.374-4.el6_6.x86_64 rubygems-1.3.7-5.el6.noarch ruby-1."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2016/12/fpm/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-15T23:10:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用fpm制作rpm包与搭建本地yum源"><meta name=twitter:description content="rpm与fpm 软件的安装方式 编译安装：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长 yum安装：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。 编译源码：根据自己的需求做成 RMP包 ==> 搭建yum仓库 ==> yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。 RPM概述 RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。
rpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。
关于rpm命令的使用可以用rpm &ndash;help来获得
rpmbuild rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。
作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候
fpm fpm 是将一种类型的包转换成另一种类型
支持的源类型包
类型 说明 dir 将目录打包成所需要的类型，可以用于源码编译安装的软件包 rpm 对rpm进行转换 gem 对rubygem包进行转换 python 将python模块打包成相对应的类型 支持目标类型包 rpm 转换为rpm包 deb 转换为deb包 solaris 装环卫solaris包 puppet 转换为puppet模块 fpm安装 fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。
yum安装ruby模块 bash 1 yum install ruby rubygems ruby-devel -y 查看ruby的版本
bash 1 2 3 4 5 6 7 $ rpm -qa|grep ruby ruby-libs-1.8.7.374-4.el6_6.x86_64 rubygems-1.3.7-5.el6.noarch ruby-1."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"使用fpm制作rpm包与搭建本地yum源","item":"https://www.oomkill.com/2016/12/fpm/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用fpm制作rpm包与搭建本地yum源","name":"使用fpm制作rpm包与搭建本地yum源","description":"rpm与fpm 软件的安装方式 编译安装：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长 yum安装：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。 编译源码：根据自己的需求做成 RMP包 ==\u0026gt; 搭建yum仓库 ==\u0026gt; yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。 RPM概述 RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。\nrpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。\n关于rpm命令的使用可以用rpm \u0026ndash;help来获得\nrpmbuild rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。\n作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候\nfpm fpm 是将一种类型的包转换成另一种类型\n支持的源类型包\n类型 说明 dir 将目录打包成所需要的类型，可以用于源码编译安装的软件包 rpm 对rpm进行转换 gem 对rubygem包进行转换 python 将python模块打包成相对应的类型 支持目标类型包 rpm 转换为rpm包 deb 转换为deb包 solaris 装环卫solaris包 puppet 转换为puppet模块 fpm安装 fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。\nyum安装ruby模块 bash 1 yum install ruby rubygems ruby-devel -y 查看ruby的版本\nbash 1 2 3 4 5 6 7 $ rpm -qa|grep ruby ruby-libs-1.8.7.374-4.el6_6.x86_64 rubygems-1.3.7-5.el6.noarch ruby-1.","keywords":["Linux","rpm","fpm"],"articleBody":"rpm与fpm 软件的安装方式 编译安装：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长 yum安装：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。 编译源码：根据自己的需求做成 RMP包 ==\u003e 搭建yum仓库 ==\u003e yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。 RPM概述 RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。\nrpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。\n关于rpm命令的使用可以用rpm –help来获得\nrpmbuild rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。\n作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候\nfpm fpm 是将一种类型的包转换成另一种类型\n支持的源类型包\n类型 说明 dir 将目录打包成所需要的类型，可以用于源码编译安装的软件包 rpm 对rpm进行转换 gem 对rubygem包进行转换 python 将python模块打包成相对应的类型 支持目标类型包 rpm 转换为rpm包 deb 转换为deb包 solaris 装环卫solaris包 puppet 转换为puppet模块 fpm安装 fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。\nyum安装ruby模块 bash 1 yum install ruby rubygems ruby-devel -y 查看ruby的版本\nbash 1 2 3 4 5 6 7 $ rpm -qa|grep ruby ruby-libs-1.8.7.374-4.el6_6.x86_64 rubygems-1.3.7-5.el6.noarch ruby-1.8.7.374-4.el6_6.x86_64 ruby-rdoc-1.8.7.374-4.el6_6.x86_64 ruby-devel-1.8.7.374-4.el6_6.x86_64 ruby-irb-1.8.7.374-4.el6_6.x86_64 替换gem源 ruby中国镜像：https://ruby-china.org/\nbash 1 gem source -a http://gems.ruby-china.org -r remove xx 删除一个gem源列表 -l list gem源列表 安装错误 此问题提示 ruby的版本至少要求为1.9.3，在我们yum安装的ruby为1.8.7\nbash 1 2 3 4 5 $ gem install fpm Building native extensions. This could take a while... Building native extensions. This could take a while... ERROR: Error installing fpm: ruby-xz requires Ruby version \u003e= 1.9.3. 解决方法：\n升级ruby版本\n安装低版本fpm\nERROR: Could not find a valid gem 'fpm' (\u003e= 0) in any repository\n原因：gem源失效，替换gem源即可\nbash 1 ERROR: Could not find a valid gem 'fpm' (\u003e= 0) in any repository 升级ruby 下载rvm bash 1 2 3 4 gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 curl -sSL https://get.rvm.io | bash -s stable # 如果上面的连接失败，可以尝试: curl -L https://raw.githubusercontent.com/wayneeseguin/rvm/master/binscripts/rvm-installer | bash -s stable rvm会下载安装到/usr/local/rvm下\n列出已知的ruby版本 bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ /usr/local/rvm/bin/rvm list known # MRI Rubies [ruby-]1.8.6[-p420] [ruby-]1.8.7[-head]$ security released on head [ruby-]1.9.1[-p431] [ruby-]1.9.2[-p330] [ruby-]1.9.3[-p551] ... [ruby-]2.3[.3] [ruby-]2.4[.0] ruby-head ... # IronRuby ironruby[-1.1.3] ironruby-head 按照提示安装ruby1.9.3 bash 1 /usr/local/rvm/bin/rvm install ruby-1.9.3 将安装的ruby切换为默认 如果想设置为默认版本，这样一来以后新打开的控制台默认的 Ruby 就是这个版本\n错误：RVM is not a function\nbash 1 2 3 4 5 6 $ /usr/local/rvm/bin/rvm use 1.9.3 --default RVM is not a function, selecting rubies with 'rvm use ...' will not work. You need to change your terminal emulator preferences to allow login shell. Sometimes it is required to use `/bin/bash --login` as the command. Please visit https://rvm.io/integration/gnome-terminal/ for an example. 原因：需要添加到系统变量\nbash 1 2 [[ -s \"$HOME/.rvm/scripts/rvm\" ]] \u0026\u0026 . \"$HOME/.rvm/scripts/rvm\" source /etc/profile 安装低版本fpm 指定版本安装\nbash 1 gem install fpm -v 1.4 查看安装完的fpm版本号\nbash 1 2 $ fpm --version 1.4.0 卸载一个安装版本\nbash 1 rvm remove 1.9.2 https://www.ruby-lang.org/zh_cn/downloads/\n编译安装ruby\n参考资料：\nDownload RubyGems\nruby的升级过程\n如何快速正确的安装 Ruby, Rails 运行环境\nRVM 解决 Ruby 的版本问题 fpm使用 参数 说明 -s 指定源类型 -t 指定目标类型，即想要制作为什么包 -n 指定包的名字 -v 指定包的版本号 -C 指定打包的相对路径 -d 指定依赖于哪些包 -f 第二次包时目录下如果有同名安装包存在，则覆盖它 -p 输出的安装包的目录，不想放在当前目录下就需要指定 –post-install 软件包安装完成之后所要运行的脚本；同–offer-install –pre-install 软件包安装完成之前所要运行的脚本；同–before-install –post-uninstall 软件包卸载完成之后所要运行的脚本；同–offer-remove –pre-uninstall 软件包卸载完成之前所要运行的脚本；同—before-remove yum安装是如何解决依赖问题的？ 在使用yum安装软件A时，yum会在下载完A的rpm包后，对该rpm包进行检查（rpm包会给出安装该rpm包所依赖的基础库和软件）。如果检查出A的安装还要依赖软件B，那么此时yum就会自动下载并安装B。B安装完毕后，就会继续安装A。如果是内网yum源的话，我们只需要把B放在内网yum源即可。如果检查出A的安装不需要其他软件的支持，那么yum会自动安装A。因此使用rpm -d添加依赖关系\n打包fpm bash 1 fpm -s dir -t rpm -n sphinx -v 5.5.54 -d 'libaio-devel,ncurses-devel' --post-install /app/mysql.sh /app/mysql 相对路径问题\n使用相对路径打包，会直接保存为/目录。这样就不会是我们指定的目录了。\nbash 1 2 3 4 5 6 7 8 $ rpm -pql sphinx-1.0-1.x86_64.rpm /bin/indexer /bin/indextool /bin/searchd ... /var/data/test1stemmed.spp /var/data/test1stemmed.sps /var/log 制定依赖包\nbash 1 fpm -d 'libaio-devel,ncurses-devel' 在安装时就会检测依赖包，如无此包就报错\nbash 1 2 3 4 $ rpm -ivh mysql-5.5.54-1.x86_64.rpm error: Failed dependencies: libaio-devel is needed by mysql-5.5.54-1.x86_64 ncurses-devel is needed by mysql-5.5.54-1.x86_64 安装完成后指定要执行的脚本\nbash 1 fpm --post-install 'mysql.sh' 本地模拟yum安装自己打包的软件\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ yum localinstall mysql-5.5.54-1.x86_64.rpm 已加载插件：fastestmirror, security 设置本地安装进程 诊断 mysql-5.5.54-1.x86_64.rpm: mysql-5.5.54-1.x86_64 mysql-5.5.54-1.x86_64.rpm 将被安装 .... .... Non-fatal POSTIN scriptlet failure in rpm package mysql-5.5.54-1.x86_64 useradd: user 'mysql' already exists # 安装后执行脚本中创建的用户，因已创建用户，故提示 warning: %post(mysql-5.5.54-1.x86_64) scriptlet failed, exit status 9 已安装: mysql.x86_64 0:5.5.54-1 作为依赖被安装: libaio-devel.x86_64 0:0.3.107-10.el6 ncurses-devel.x86_64 0:5.7-4.20090207.el6 作为依赖被升级: ncurses-base.x86_64 0:5.7-4.20090207.el6 ncurses-libs.x86_64 0:5.7-4.20090207.el6 初始化后启动MySQL并登陆\nbash 1 2 3 4 5 6 7 $ /etc/init.d/mysqld start Starting MySQL.. SUCCESS! $ bin/mysql Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 1 .. mysql\u003e 打包错误 原因未知\n解决方法：可能是打包时会产生大量的缓存，导致空间不够，删除一些文件后问题再没出现过\nbash 1 2 $ fpm -s dir -t rpm -n mysqld -v 5.5.54 -f --post-install /app/m.in.sh --post-uninstall /app/un.m.sh /app/mariadb-5.5.54/ Process failed: rpmbuild failed (exit code 1). Full command was:[\"rpmbuild\", \"-bb\", \"--define\", \"buildroot /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/BUILD\", \"--define\", \"_topdir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61\", \"--define\", \"_sourcedir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61\", \"--define\", \"_rpmdir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/RPMS\", \"--define\", \"_tmppath /tmp\", \"/tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/SPECS/mysqld.spec\"] {:level=\u003e:error} YUM 什么是yum yum主要用于自动安装、升级rpm软件包，他能自动查找并解决rpm包之间的依赖关系。要成功的使用yum工具安装更新软件或系统，就需要有一个包含各种rpm软件包的repository（软件仓库），这个软件仓库我们习惯称为yum源，网络上有大量的yum源，但由于收到网络环境的限制，导致软件安装耗时过长甚至失败。特别是当有大量服务器大量软件包需要安装时，缓慢的进度条令人难以忍受。因此我们在优化系统时，都会更换国内的源。\n相比较而言，本地yum源服务器最大优点是局域网的快速网络连接和稳定性。有了局域网中的yum源服务器，即使在internet连接中断的情况下，也不会影响其他yum客户端的软件安装和升级\n创建yum源 上传rpm包到此目录，此目录下面还可以包括文件夹\nbash 1 mkdir -p /tools/yum/centos6/x86_64 yum下载的文件缓存在\nbash 1 /var/cache/yum/x86_64/6/base/ 安装createrepo工具 bash 1 yum install -y createrepo 初始化repodata索引文件\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ createrepo -pdo /tools/yum/centos6/x86_64/ /tools/yum/centos6/x86_64/ Spawning worker 0 with 4 pkgs Workers Finished Gathering worker results Saving Primary metadata Saving file lists metadata Saving other metadata Generating sqlite DBs Sqlite DBs complete $ cd /tools/yum/centos6/x86_64/ $ ls libaio-devel-0.3.107-10.el6.i686.rpm libaio-devel-0.3.107-10.el6.x86_64.rpm ncurses-devel-5.7-4.20090207.el6.i686.rpm ncurses-devel-5.7-4.20090207.el6.x86_64.rpm repodata $ ls repodata/. 1453d96f9216e7c230abfe7921a2fd1dd11541568934832306342c89ad04ff1d-other.sqlite.bz2 2475630f1247fc6ac2b822541d6ad71ed83d733792c7d52de580fdebd3abda2c-filelists.sqlite.bz2 9e22eb60f06501a3f4399dc3c2d3e3858567804e7ab352679fa650b93d279fb9-other.xml.gz c3ee9c8d8508c55c77f3f058f056bdd617587ee5a906f22bc9a512bc8b950ded-filelists.xml.gz d9d57f7733cb42831001e915ddd51bb126b67c26bca64bf6c7e7390eed9a54d9-primary.sqlite.bz2 e9616244b93c46350e33dc04d4cb442e49ae375b7400a262bd72e8ba90a1f4a8-primary.xml.gz repomd.xml 提供yum服务 可以用apache或nginx提供web服务，但用Python的http模块更简单，适用于内网环境。CentOS 6最小化安装后自带python。\n利用python的http模块提供服务 bash 1 2 python -m SimpleHTTPServer 80 \u0026\u003e/dev/null # 提供服务的目录是执行命令时的目录 利用nginx提供yum源服务 bash 1 2 3 4 5 6 location / { root /tools; index index.html index.htm; autoindex on; # 当找不到首页文件时，会展示目录结构，这个功能一般不要用除非有需求。 # 如没有此选项，会报403 } 添加新的rpm包 bash 1 2 # 只下载软件不安装 yumdownlocaler pcre-devel openssl-devel 每当该目录新增软件包需要更新源\nbash 1 createrepo --update /tools 本地客户端配置 conf /etc/yum.repos.d/test.repo [test] name=Server baseurl=http://192.168.2.110 enable=1 gpgchek=0 使用配置的自定义的源安装PHP\nbash 1 2 3 yum --enablerepo=test --disablerepo=base,extras,updates install php # --enbalerepo使用的源 # --disablerepo禁用源 yum命令 选项 说明 install 安装软件包 yum install httpd list 列出yum仓库内文件 yum list httpd，可搜索带名称的特定软件包 search 不急的软件报的确切名称，可以使用search函数，搜索与指定软件包的名称相匹配的所有可用软件包yum search httpd provides 查找某个特定文件属于哪个软件包。yum provides /app/apache/confi/http.conf grouplist 列出所有可用群组 groupinstall 安装群组软件包yum groupinstall develment-tools repolist 列出启用的软件库 repolist all 列出所有软件库，包括禁用的也列出 –enablerepo 安装来自特定软件库的软件包 –disablerepo 不安装来自指定软件库的软件包yum –enablerepo=test –disablerepo=base,extras… install httpd chean all 清理yum缓存内容 history 查看yum历史记录 yum源 Yum源分为三大类：\nBase：就是你下载的光盘镜像里面的DVD1 Extra：就是你下载光盘镜像的DVD2 Epel：属于额外的，得到Epel官方获取 将光盘挂载到系统上，你会发现里面有个packages目录，里面全是rpm包\nbash 1 2 3 4 5 6 7 8 9 $ ls CentOS_BuildTag images ... Packages RPM-GPG-KEY-CentOS-Security-6 $ ll|wc -l 4186 配置yum源 找一个镜像站点，国内常用镜像站点\nhttp://mirrors.aliyun.com\nhttp://mirrors.163.com\n系统yum源路径，执行yum时，它只会读取yum.repo.d下这个目录下的所有以.repo结尾的文件。\nbash 1 2 3 4 5 6 7 $ ls /etc/yum.repos.d/ CentOS-Base.repo CentOS-fasttrack.repo CentOS-Vault.repo CentOS-Debuginfo.repo CentOS-Media.repo epel.repo repo文件的写入是有其特殊格式的，如下：\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [aaa] name=aaa baseurl=http://192.168.2.110 enable=1 gpgchek=0 [bbb] name=bbb baseurl=http://192.168.2.110 enable=1 gpgchek=0 [ccc] name=ccc baseurl=http://192.168.2.110 enable=1 gpgchek=0 所谓的自己配置Yum仓库就是把网上那些程序包全下载下来，在本地(内网)提供Yum。除了epel提供的所有包外，还有镜像光盘DVD1,DVD2！\nyum服务配置文件 配置文件分为两部分main和repository\n配置本地yum源\n禁用默认的yum网络源，将yum网络源配置文件改名为CentOS-Base.repo.bak，否则会现在网络源中寻找适合的包，改名之后直接从本地源读取。也可以向上面一样自己写一个文件。\n全局配置文件 main部分定义了全局配置选项，整个yum配置文件应该只有一个main，/etc/yum.conf\nconf # /etc/yum.conf [main] # cachedir：yum缓存的目录，yum在此存储下载的rpm包和数据库，一般是/var/cache/yum/$basearch/$releasever。 cachedir=/var/cache/yum/$basearch/$releasever # 设置 keepcache=1，yum 在成功安装软件包之后保留缓存的头文件 (headers) 和软件包。默认值为 keepcache=0 不保存 keepcache=[1 or 0] # debuglevel：除错级别，0──10,默认是2 貌似只记录安装和删除记录 debuglevel=2 logfile=/var/log/yum.log # pkgpolicy： 包的策略。一共有两个选项，newest和last，这个作用是如果你设置了多个repository，而同一软件在不同的repository中同时存 在，yum应该安装哪一个，如果是newest，则yum会安装最新的那个版本。如果是last，则yum会将服务器id以字母表排序，并选择最后的那个 服务器上的软件安装。一般都是选newest。 pkgpolicy=newest # 指定一个软件包，yum会根据这个包判断你的发行版本，默认是RedHat-release，也可以是安装的任何针对自己发行版的rpm包 distroverpkg=CentOS-release # tolerent，也有1和0两个选项，表示yum是否容忍命令行发生与软件包有关的错误，比如你要安装1,2,3三个包，而其中3此前已经安装了，如果你设为1,则yum不会出现错误信息。默认是0。 tolerant=1 # exactarch，有两个选项1和0,代表是否只升级和你安装软件包cpu体系一致的包，如果设为1，则如你安装了一个i386的rpm，则yum不会用1686的包来升级。 exactarch=1 # retries，网络连接发生错误后的重试次数，如果设为0，则会无限重试。 retries=20 obsoletes=1 # gpgchkeck= 有1和0两个选择，分别代表是否是否进行gpg校验，如果没有这一项，默认是检查的。 gpgcheck=1 # 该选项用户指定 .repo 文件的绝对路径。.repo 文件包含软件仓库的信息 (作用与 /etc/yum.conf 文件中的 [repository] 片段相同)。 reposdir=[包含 .repo 文件的目录的绝对路径] # 默认是 /etc/yum.repos.d/ 低下的 xx.repo后缀文件 # exclude 排除某些软件在升级名单之外，可以用通配符，列表中各个项目要用空格隔开，这个对于安装了诸如美化包，中文补丁的朋友特别有用。 exclude=xxx 第二部分repoitory repoitory部分定义了每个源/服务器的具体配置，可以有一到多个，位于/etc/yum.repos.d/目录下的各文件中。这个字段其实也可以在yum.conf里面直接配置\nrepo文件的格式\nbash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # serverid用于区别各个不同的repository，必须有一个独一无二的名称。 重复了前面覆盖后面--还是反过来呢？？？用enabled 测试是后面覆盖前面 [serverid] # name是对repository的描述，支持像$releasever $basearch这样的变量; name=Fedora Core $releasever - $basearch - Released Updates name=Some name for this server # baseurl是服务器设置中最重要的部分，只有设置正确，才能从上面获取软件。它的格式是： # 其中url支持的协议有 http:// ftp:// file://三种。baseurl后可以跟多个url，你可以自己改为速度比较快的镜像站，但baseurl只能有一个，也就是说不能像如下格式： baseurl=url://server1/path/to/repository/ baseurl=url://server2/path/to/repository/ baseurl=url://server3/path/to/repository/ 其中url指向的目录必须是这个repository header目录的上一级，它也支持$releasever $basearch这样的变量。 baseurl=url://path/to/repository/ baseurl=url://server1/path/to/repository/ url://server2/path/to/repository/ url://server3/path/to/repository/ # 这一行是指定一个镜像服务器的地址列表，通常是开启的，本例中加了注释符号禁用了，我们可以试试，将$releasever和$basearch替换成自己对应的版本和架构，例如10和i386，在浏览器中打开，我们就能看到一长串镜可用的镜像服务器地址列表。 mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever\u0026arch=$basearch url之后可以加上多个选项，如gpgcheck、exclude、failovermethod等，比如： # 其中gpgcheck，exclude的含义和[main]部分相同，但只对此服务器起作用 gpgcheck=1 exclude=gaim # failovermethode 有两个选项roundrobin和priority，意思分别是有多个url可供选择时，yum选择的次序，roundrobin是随机选择，如果连接失 败则使用下一个，依次循环，priority则根据url的次序从第一个开始。如果不指明，默认是roundrobin。 failovermethod=priority # 当某个软件仓库被配置成 enabled=0 时，yum 在安装或升级软件包时不会将该仓库做为软件包提供源。使用这个选项，可以启用或禁用软件仓库。 # 通过 yum 的 --enablerepo=[repo_name] 和 --disablerepo=[repo_name] 选项，或者通过 PackageKit 的\"添加/删除软件\"工具，也能够方便地启用和禁用指定的软件仓库 enabled=[1 or 0] 变量\nconf $releasever，发行版的版本，从[main]部分的distroverpkg获取，如果没有，则根据redhat-release包进行判断。 $arch，cpu体系，如i686,athlon等 $basearch，cpu的基本体系组，如i686和athlon同属i386，alpha和alphaev6同属alpha。 ","wordCount":"1093","inLanguage":"zh","datePublished":"2016-12-16T00:00:00Z","dateModified":"2022-12-15T23:10:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2016/12/fpm/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">使用fpm制作rpm包与搭建本地yum源</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2016-12-16</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1093 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>6 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/linux/>#Linux</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#rpm%e4%b8%8efpm aria-label=rpm与fpm>rpm与fpm</a><ul><li><a href=#%e8%bd%af%e4%bb%b6%e7%9a%84%e5%ae%89%e8%a3%85%e6%96%b9%e5%bc%8f aria-label=软件的安装方式>软件的安装方式</a><li><a href=#rpm%e6%a6%82%e8%bf%b0 aria-label=RPM概述>RPM概述</a><li><a href=#rpmbuild aria-label=rpmbuild>rpmbuild</a><li><a href=#fpm aria-label=fpm>fpm</a></ul><li><a href=#fpm%e5%ae%89%e8%a3%85 aria-label=fpm安装>fpm安装</a><ul><li><a href=#yum%e5%ae%89%e8%a3%85ruby%e6%a8%a1%e5%9d%97 aria-label=yum安装ruby模块>yum安装ruby模块</a><li><a href=#%e6%9b%bf%e6%8d%a2gem%e6%ba%90 aria-label=替换gem源>替换gem源</a><li><a href=#%e5%ae%89%e8%a3%85%e9%94%99%e8%af%af aria-label=安装错误>安装错误</a><li><a href=#%e5%8d%87%e7%ba%a7ruby aria-label=升级ruby>升级ruby</a><li><a href=#%e5%ae%89%e8%a3%85%e4%bd%8e%e7%89%88%e6%9c%acfpm aria-label=安装低版本fpm>安装低版本fpm</a></ul><li><a href=#fpm%e4%bd%bf%e7%94%a8 aria-label=fpm使用>fpm使用</a><ul><li><a href=#yum%e5%ae%89%e8%a3%85%e6%98%af%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e4%be%9d%e8%b5%96%e9%97%ae%e9%a2%98%e7%9a%84 aria-label=yum安装是如何解决依赖问题的？>yum安装是如何解决依赖问题的？</a><li><a href=#%e6%89%93%e5%8c%85fpm aria-label=打包fpm>打包fpm</a><li><a href=#%e6%89%93%e5%8c%85%e9%94%99%e8%af%af aria-label=打包错误>打包错误</a></ul><li><a href=#yum aria-label=YUM>YUM</a><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%afyum aria-label=什么是yum>什么是yum</a><li><a href=#%e5%88%9b%e5%bb%bayum%e6%ba%90 aria-label=创建yum源>创建yum源</a><li><a href=#%e5%ae%89%e8%a3%85createrepo%e5%b7%a5%e5%85%b7 aria-label=安装createrepo工具>安装createrepo工具</a><li><a href=#%e6%8f%90%e4%be%9byum%e6%9c%8d%e5%8a%a1 aria-label=提供yum服务>提供yum服务</a><li><a href=#%e6%b7%bb%e5%8a%a0%e6%96%b0%e7%9a%84rpm%e5%8c%85 aria-label=添加新的rpm包>添加新的rpm包</a><li><a href=#%e6%9c%ac%e5%9c%b0%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae aria-label=本地客户端配置>本地客户端配置</a><li><a href=#yum%e5%91%bd%e4%bb%a4 aria-label=yum命令>yum命令</a></ul><li><a href=#yum%e6%ba%90 aria-label=yum源>yum源</a><ul><li><a href=#%e9%85%8d%e7%bd%aeyum%e6%ba%90 aria-label=配置yum源>配置yum源</a></ul><li><a href=#yum%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=yum服务配置文件>yum服务配置文件</a><ul><li><a href=#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=全局配置文件>全局配置文件</a><li><a href=#%e7%ac%ac%e4%ba%8c%e9%83%a8%e5%88%86repoitory aria-label=第二部分repoitory>第二部分repoitory</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=rpm与fpm>rpm与fpm<a hidden class=anchor aria-hidden=true href=#rpm与fpm>#</a></h2><h3 id=软件的安装方式>软件的安装方式<a hidden class=anchor aria-hidden=true href=#软件的安装方式>#</a></h3><ul><li><strong>编译安装</strong>：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长</li><li><strong>yum安装</strong>：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。</li><li><strong>编译源码</strong>：根据自己的需求做成 RMP包 ==> 搭建yum仓库 ==> yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。</li></ul><h3 id=rpm概述>RPM概述<a hidden class=anchor aria-hidden=true href=#rpm概述>#</a></h3><p>RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。</p><p>rpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。</p><p>关于rpm命令的使用可以用rpm &ndash;help来获得</p><h3 id=rpmbuild>rpmbuild<a hidden class=anchor aria-hidden=true href=#rpmbuild>#</a></h3><p>rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。</p><p>作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候</p><h3 id=fpm>fpm<a hidden class=anchor aria-hidden=true href=#fpm>#</a></h3><p><a href=https://github.com/jordansissel/fpm target=_blank rel="noopener nofollow noreferrer">fpm</a> 是将一种类型的包转换成另一种类型</p><p>支持的源类型包</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>dir</td><td>将目录打包成所需要的类型，可以用于源码编译安装的软件包</td></tr><tr><td>rpm</td><td>对rpm进行转换</td></tr><tr><td>gem</td><td>对rubygem包进行转换</td></tr><tr><td>python</td><td>将python模块打包成相对应的类型</td></tr><tr><td>支持目标类型包</td><td></td></tr><tr><td>rpm</td><td>转换为rpm包</td></tr><tr><td>deb</td><td>转换为deb包</td></tr><tr><td>solaris</td><td>装环卫solaris包</td></tr><tr><td>puppet</td><td>转换为puppet模块</td></tr></tbody></table><h2 id=fpm安装>fpm安装<a hidden class=anchor aria-hidden=true href=#fpm安装>#</a></h2><p>fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。</p><h3 id=yum安装ruby模块>yum安装ruby模块<a hidden class=anchor aria-hidden=true href=#yum安装ruby模块>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install ruby rubygems ruby-devel -y</span></span></code></pre></td></tr></table></div></div></div></div><p>查看ruby的版本</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ rpm -qa<span class=p>|</span>grep ruby
</span></span><span class=line><span class=cl>ruby-libs-1.8.7.374-4.el6_6.x86_64
</span></span><span class=line><span class=cl>rubygems-1.3.7-5.el6.noarch
</span></span><span class=line><span class=cl>ruby-1.8.7.374-4.el6_6.x86_64
</span></span><span class=line><span class=cl>ruby-rdoc-1.8.7.374-4.el6_6.x86_64
</span></span><span class=line><span class=cl>ruby-devel-1.8.7.374-4.el6_6.x86_64
</span></span><span class=line><span class=cl>ruby-irb-1.8.7.374-4.el6_6.x86_64</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=替换gem源>替换gem源<a hidden class=anchor aria-hidden=true href=#替换gem源>#</a></h3><p>ruby中国镜像：https://ruby-china.org/</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gem <span class=nb>source</span> -a http://gems.ruby-china.org</span></span></code></pre></td></tr></table></div></div></div></div><ul><li>-r remove xx 删除一个gem源列表</li><li>-l list gem源列表</li></ul><h3 id=安装错误>安装错误<a hidden class=anchor aria-hidden=true href=#安装错误>#</a></h3><p>此问题提示 ruby的版本至少要求为1.9.3，在我们yum安装的ruby为1.8.7</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gem install fpm
</span></span><span class=line><span class=cl>Building native extensions.  This could take a <span class=k>while</span>...
</span></span><span class=line><span class=cl>Building native extensions.  This could take a <span class=k>while</span>...
</span></span><span class=line><span class=cl>ERROR:  Error installing fpm:
</span></span><span class=line><span class=cl>        ruby-xz requires Ruby version &gt;<span class=o>=</span> 1.9.3.</span></span></code></pre></td></tr></table></div></div></div></div><p>解决方法：</p><ol><li><p>升级ruby版本</p></li><li><p>安装低版本fpm</p></li></ol><p><code>ERROR: Could not find a valid gem 'fpm' (>= 0) in any repository</code></p><p>原因：gem源失效，替换gem源即可</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ERROR:  Could not find a valid gem <span class=s1>&#39;fpm&#39;</span> <span class=o>(</span>&gt;<span class=o>=</span> 0<span class=o>)</span> in any repository</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=升级ruby>升级ruby<a hidden class=anchor aria-hidden=true href=#升级ruby>#</a></h3><ol><li>下载rvm</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
</span></span><span class=line><span class=cl>curl -sSL https://get.rvm.io <span class=p>|</span> bash -s stable
</span></span><span class=line><span class=cl><span class=c1># 如果上面的连接失败，可以尝试: </span>
</span></span><span class=line><span class=cl>curl -L https://raw.githubusercontent.com/wayneeseguin/rvm/master/binscripts/rvm-installer <span class=p>|</span> bash -s stable</span></span></code></pre></td></tr></table></div></div></div></div><p>rvm会下载安装到/usr/local/rvm下</p><ol start=2><li>列出已知的ruby版本</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /usr/local/rvm/bin/rvm list known
</span></span><span class=line><span class=cl><span class=c1># MRI Rubies</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>1.8.6<span class=o>[</span>-p420<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>1.8.7<span class=o>[</span>-head<span class=o>]</span>$  security released on head
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>1.9.1<span class=o>[</span>-p431<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>1.9.2<span class=o>[</span>-p330<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>1.9.3<span class=o>[</span>-p551<span class=o>]</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>2.3<span class=o>[</span>.3<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ruby-<span class=o>]</span>2.4<span class=o>[</span>.0<span class=o>]</span>
</span></span><span class=line><span class=cl>ruby-head
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=c1># IronRuby</span>
</span></span><span class=line><span class=cl>ironruby<span class=o>[</span>-1.1.3<span class=o>]</span>
</span></span><span class=line><span class=cl>ironruby-head</span></span></code></pre></td></tr></table></div></div></div></div><ol start=3><li>按照提示安装ruby1.9.3</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/local/rvm/bin/rvm install ruby-1.9.3</span></span></code></pre></td></tr></table></div></div></div></div><ol start=4><li>将安装的ruby切换为默认</li></ol><p>如果想设置为默认版本，这样一来以后新打开的控制台默认的 Ruby 就是这个版本</p><p><strong>错误：RVM is not a function</strong></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /usr/local/rvm/bin/rvm use 1.9.3 --default
</span></span><span class=line><span class=cl>RVM is not a <span class=k>function</span>, selecting rubies with <span class=s1>&#39;rvm use ...&#39;</span> will not work.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You need to change your terminal emulator preferences to allow login shell.
</span></span><span class=line><span class=cl>Sometimes it is required to use <span class=sb>`</span>/bin/bash --login<span class=sb>`</span> as the command.
</span></span><span class=line><span class=cl>Please visit https://rvm.io/integration/gnome-terminal/ <span class=k>for</span> an example.</span></span></code></pre></td></tr></table></div></div></div></div><p>原因：需要添加到系统变量</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[[</span> -s <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.rvm/scripts/rvm&#34;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> . <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.rvm/scripts/rvm&#34;</span> 
</span></span><span class=line><span class=cl><span class=nb>source</span> /etc/profile </span></span></code></pre></td></tr></table></div></div></div></div><h3 id=安装低版本fpm>安装低版本fpm<a hidden class=anchor aria-hidden=true href=#安装低版本fpm>#</a></h3><p>指定版本安装</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gem install fpm -v 1.4</span></span></code></pre></td></tr></table></div></div></div></div><p>查看安装完的fpm版本号</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ fpm --version
</span></span><span class=line><span class=cl>1.4.0</span></span></code></pre></td></tr></table></div></div></div></div><p>卸载一个安装版本</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rvm remove 1.9.2</span></span></code></pre></td></tr></table></div></div></div></div><p><a href=https://www.ruby-lang.org/zh_cn/downloads/ target=_blank rel="noopener nofollow noreferrer">https://www.ruby-lang.org/zh_cn/downloads/</a></p><p>编译安装ruby</p><p>参考资料：</p><ul><li><p><a href=https://rubygems.org/pages/download target=_blank rel="noopener nofollow noreferrer">Download RubyGems</a></p></li><li><p><a href=http://ritto.blog.51cto.com/427838/737824 target=_blank rel="noopener nofollow noreferrer">ruby的升级过程</a></p></li><li><p><a href=https://ruby-china.org/wiki/install_ruby_guide target=_blank rel="noopener nofollow noreferrer">如何快速正确的安装 Ruby, Rails 运行环境</a></p></li><li><p><a href=https://www.cnblogs.com/Ray-liang/p/5012637.html target=_blank rel="noopener nofollow noreferrer">RVM 解决 Ruby 的版本问题</a></p></li></ul><h2 id=fpm使用>fpm使用<a hidden class=anchor aria-hidden=true href=#fpm使用>#</a></h2><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-s</td><td>指定源类型</td></tr><tr><td>-t</td><td>指定目标类型，即想要制作为什么包</td></tr><tr><td>-n</td><td>指定包的名字</td></tr><tr><td>-v</td><td>指定包的版本号</td></tr><tr><td>-C</td><td>指定打包的相对路径</td></tr><tr><td>-d</td><td>指定依赖于哪些包</td></tr><tr><td>-f</td><td>第二次包时目录下如果有同名安装包存在，则覆盖它</td></tr><tr><td>-p</td><td>输出的安装包的目录，不想放在当前目录下就需要指定</td></tr><tr><td>&ndash;post-install</td><td>软件包安装完成之后所要运行的脚本；同&ndash;offer-install</td></tr><tr><td>&ndash;pre-install</td><td>软件包安装完成之前所要运行的脚本；同&ndash;before-install</td></tr><tr><td>&ndash;post-uninstall</td><td>软件包卸载完成之后所要运行的脚本；同&ndash;offer-remove</td></tr><tr><td>&ndash;pre-uninstall</td><td>软件包卸载完成之前所要运行的脚本；同—before-remove</td></tr></tbody></table><h3 id=yum安装是如何解决依赖问题的>yum安装是如何解决依赖问题的？<a hidden class=anchor aria-hidden=true href=#yum安装是如何解决依赖问题的>#</a></h3><p>在使用yum安装软件A时，yum会在下载完A的rpm包后，对该rpm包进行检查（rpm包会给出安装该rpm包所依赖的基础库和软件）。如果检查出A的安装还要依赖软件B，那么此时yum就会自动下载并安装B。B安装完毕后，就会继续安装A。如果是内网yum源的话，我们只需要把B放在内网yum源即可。如果检查出A的安装不需要其他软件的支持，那么yum会自动安装A。因此使用rpm -d添加依赖关系</p><h3 id=打包fpm>打包fpm<a hidden class=anchor aria-hidden=true href=#打包fpm>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fpm -s dir -t rpm -n sphinx -v 5.5.54 -d <span class=s1>&#39;libaio-devel,ncurses-devel&#39;</span> --post-install /app/mysql.sh /app/mysql</span></span></code></pre></td></tr></table></div></div></div></div><p>相对路径问题</p><p>使用相对路径打包，会直接保存为/目录。这样就不会是我们指定的目录了。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ rpm -pql sphinx-1.0-1.x86_64.rpm       
</span></span><span class=line><span class=cl>/bin/indexer
</span></span><span class=line><span class=cl>/bin/indextool
</span></span><span class=line><span class=cl>/bin/searchd
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>/var/data/test1stemmed.spp
</span></span><span class=line><span class=cl>/var/data/test1stemmed.sps
</span></span><span class=line><span class=cl>/var/log</span></span></code></pre></td></tr></table></div></div></div></div><p>制定依赖包</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fpm -d <span class=s1>&#39;libaio-devel,ncurses-devel&#39;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>在安装时就会检测依赖包，如无此包就报错</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ rpm -ivh mysql-5.5.54-1.x86_64.rpm 
</span></span><span class=line><span class=cl>error: Failed dependencies:
</span></span><span class=line><span class=cl>        libaio-devel is needed by mysql-5.5.54-1.x86_64
</span></span><span class=line><span class=cl>        ncurses-devel is needed by mysql-5.5.54-1.x86_64</span></span></code></pre></td></tr></table></div></div></div></div><p>安装完成后指定要执行的脚本</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fpm --post-install <span class=s1>&#39;mysql.sh&#39;</span></span></span></code></pre></td></tr></table></div></div></div></div><p>本地模拟yum安装自己打包的软件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ yum localinstall mysql-5.5.54-1.x86_64.rpm 
</span></span><span class=line><span class=cl>已加载插件：fastestmirror, security
</span></span><span class=line><span class=cl>设置本地安装进程
</span></span><span class=line><span class=cl>诊断 mysql-5.5.54-1.x86_64.rpm: mysql-5.5.54-1.x86_64
</span></span><span class=line><span class=cl>mysql-5.5.54-1.x86_64.rpm 将被安装
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>Non-fatal POSTIN scriptlet failure in rpm package mysql-5.5.54-1.x86_64
</span></span><span class=line><span class=cl>useradd: user <span class=s1>&#39;mysql&#39;</span> already exists <span class=c1># 安装后执行脚本中创建的用户，因已创建用户，故提示</span>
</span></span><span class=line><span class=cl>warning: %post<span class=o>(</span>mysql-5.5.54-1.x86_64<span class=o>)</span> scriptlet failed, <span class=nb>exit</span> status <span class=m>9</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>已安装:
</span></span><span class=line><span class=cl>  mysql.x86_64 0:5.5.54-1                                                                                       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>作为依赖被安装:
</span></span><span class=line><span class=cl>libaio-devel.x86_64 0:0.3.107-10.el6   ncurses-devel.x86_64 0:5.7-4.20090207.el6                
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>作为依赖被升级:
</span></span><span class=line><span class=cl>ncurses-base.x86_64 0:5.7-4.20090207.el6  ncurses-libs.x86_64 0:5.7-4.20090207.el6</span></span></code></pre></td></tr></table></div></div></div></div><p>初始化后启动MySQL并登陆</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /etc/init.d/mysqld start
</span></span><span class=line><span class=cl>Starting MySQL.. SUCCESS! 
</span></span><span class=line><span class=cl>$ bin/mysql
</span></span><span class=line><span class=cl>Welcome to the MySQL monitor.  Commands end with <span class=p>;</span> or <span class=se>\g</span>.
</span></span><span class=line><span class=cl>Your MySQL connection id is <span class=m>1</span>
</span></span><span class=line><span class=cl>..
</span></span><span class=line><span class=cl>mysql&gt; </span></span></code></pre></td></tr></table></div></div></div></div><h3 id=打包错误>打包错误<a hidden class=anchor aria-hidden=true href=#打包错误>#</a></h3><p>原因未知</p><p>解决方法：可能是打包时会产生大量的缓存，导致空间不够，删除一些文件后问题再没出现过</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ fpm -s dir -t rpm -n mysqld -v 5.5.54 -f --post-install /app/m.in.sh --post-uninstall /app/un.m.sh /app/mariadb-5.5.54/
</span></span><span class=line><span class=cl>Process failed: rpmbuild failed <span class=o>(</span><span class=nb>exit</span> code 1<span class=o>)</span>. Full <span class=nb>command</span> was:<span class=o>[</span><span class=s2>&#34;rpmbuild&#34;</span>, <span class=s2>&#34;-bb&#34;</span>, <span class=s2>&#34;--define&#34;</span>, <span class=s2>&#34;buildroot /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/BUILD&#34;</span>, <span class=s2>&#34;--define&#34;</span>, <span class=s2>&#34;_topdir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61&#34;</span>, <span class=s2>&#34;--define&#34;</span>, <span class=s2>&#34;_sourcedir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61&#34;</span>, <span class=s2>&#34;--define&#34;</span>, <span class=s2>&#34;_rpmdir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/RPMS&#34;</span>, <span class=s2>&#34;--define&#34;</span>, <span class=s2>&#34;_tmppath /tmp&#34;</span>, <span class=s2>&#34;/tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/SPECS/mysqld.spec&#34;</span><span class=o>]</span> <span class=o>{</span>:level<span class=o>=</span>&gt;:error<span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=yum>YUM<a hidden class=anchor aria-hidden=true href=#yum>#</a></h2><h3 id=什么是yum>什么是yum<a hidden class=anchor aria-hidden=true href=#什么是yum>#</a></h3><p>yum主要用于自动安装、升级rpm软件包，他能自动查找并解决rpm包之间的依赖关系。要成功的使用yum工具安装更新软件或系统，就需要有一个包含各种rpm软件包的repository（软件仓库），这个软件仓库我们习惯称为yum源，网络上有大量的yum源，但由于收到网络环境的限制，导致软件安装耗时过长甚至失败。特别是当有大量服务器大量软件包需要安装时，缓慢的进度条令人难以忍受。因此我们在优化系统时，都会更换国内的源。</p><p>相比较而言，本地yum源服务器最大优点是局域网的快速网络连接和稳定性。有了局域网中的yum源服务器，即使在internet连接中断的情况下，也不会影响其他yum客户端的软件安装和升级</p><h3 id=创建yum源>创建yum源<a hidden class=anchor aria-hidden=true href=#创建yum源>#</a></h3><p>上传rpm包到此目录，此目录下面还可以包括文件夹</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p /tools/yum/centos6/x86_64</span></span></code></pre></td></tr></table></div></div></div></div><p>yum下载的文件缓存在</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/var/cache/yum/x86_64/6/base/</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=安装createrepo工具>安装createrepo工具<a hidden class=anchor aria-hidden=true href=#安装createrepo工具>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install -y createrepo</span></span></code></pre></td></tr></table></div></div></div></div><p>初始化repodata索引文件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ createrepo -pdo /tools/yum/centos6/x86_64/ /tools/yum/centos6/x86_64/
</span></span><span class=line><span class=cl>Spawning worker <span class=m>0</span> with <span class=m>4</span> pkgs
</span></span><span class=line><span class=cl>Workers Finished
</span></span><span class=line><span class=cl>Gathering worker results
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Saving Primary metadata
</span></span><span class=line><span class=cl>Saving file lists metadata
</span></span><span class=line><span class=cl>Saving other metadata
</span></span><span class=line><span class=cl>Generating sqlite DBs
</span></span><span class=line><span class=cl>Sqlite DBs <span class=nb>complete</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> /tools/yum/centos6/x86_64/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>libaio-devel-0.3.107-10.el6.i686.rpm
</span></span><span class=line><span class=cl>libaio-devel-0.3.107-10.el6.x86_64.rpm
</span></span><span class=line><span class=cl>ncurses-devel-5.7-4.20090207.el6.i686.rpm
</span></span><span class=line><span class=cl>ncurses-devel-5.7-4.20090207.el6.x86_64.rpm
</span></span><span class=line><span class=cl>repodata
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls repodata/.
</span></span><span class=line><span class=cl>1453d96f9216e7c230abfe7921a2fd1dd11541568934832306342c89ad04ff1d-other.sqlite.bz2
</span></span><span class=line><span class=cl>2475630f1247fc6ac2b822541d6ad71ed83d733792c7d52de580fdebd3abda2c-filelists.sqlite.bz2
</span></span><span class=line><span class=cl>9e22eb60f06501a3f4399dc3c2d3e3858567804e7ab352679fa650b93d279fb9-other.xml.gz
</span></span><span class=line><span class=cl>c3ee9c8d8508c55c77f3f058f056bdd617587ee5a906f22bc9a512bc8b950ded-filelists.xml.gz
</span></span><span class=line><span class=cl>d9d57f7733cb42831001e915ddd51bb126b67c26bca64bf6c7e7390eed9a54d9-primary.sqlite.bz2
</span></span><span class=line><span class=cl>e9616244b93c46350e33dc04d4cb442e49ae375b7400a262bd72e8ba90a1f4a8-primary.xml.gz
</span></span><span class=line><span class=cl>repomd.xml</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=提供yum服务>提供yum服务<a hidden class=anchor aria-hidden=true href=#提供yum服务>#</a></h3><p>可以用apache或nginx提供web服务，但用Python的http模块更简单，适用于内网环境。CentOS 6最小化安装后自带python。</p><ol><li>利用python的http模块提供服务</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python -m SimpleHTTPServer <span class=m>80</span> <span class=p>&amp;</span>&gt;/dev/null
</span></span><span class=line><span class=cl><span class=c1># 提供服务的目录是执行命令时的目录</span></span></span></code></pre></td></tr></table></div></div></div></div><ol start=2><li>利用nginx提供yum源服务</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root   /tools<span class=p>;</span>
</span></span><span class=line><span class=cl>    index  index.html index.htm<span class=p>;</span>
</span></span><span class=line><span class=cl>	autoindex on<span class=p>;</span> <span class=c1># 当找不到首页文件时，会展示目录结构，这个功能一般不要用除非有需求。</span>
</span></span><span class=line><span class=cl><span class=c1># 如没有此选项，会报403</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=添加新的rpm包>添加新的rpm包<a hidden class=anchor aria-hidden=true href=#添加新的rpm包>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 只下载软件不安装</span>
</span></span><span class=line><span class=cl>yumdownlocaler pcre-devel openssl-devel</span></span></code></pre></td></tr></table></div></div></div></div><p>每当该目录新增软件包需要更新源</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>createrepo --update /tools</span></span></code></pre></td></tr></table></div></div></div></div><h3 id=本地客户端配置>本地客户端配置<a hidden class=anchor aria-hidden=true href=#本地客户端配置>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>/etc/yum.repos.d/test.repo
[test]
name=Server
baseurl=http://192.168.2.110
enable=1
gpgchek=0</code></pre></div></div><p>使用配置的自定义的源安装PHP</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum --enablerepo<span class=o>=</span><span class=nb>test</span> --disablerepo<span class=o>=</span>base,extras,updates install php
</span></span><span class=line><span class=cl><span class=c1># --enbalerepo使用的源</span>
</span></span><span class=line><span class=cl><span class=c1># --disablerepo禁用源</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=yum命令>yum命令<a hidden class=anchor aria-hidden=true href=#yum命令>#</a></h3><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>install</td><td>安装软件包 yum install httpd</td></tr><tr><td>list</td><td>列出yum仓库内文件 yum list httpd，可搜索带名称的特定软件包</td></tr><tr><td>search</td><td>不急的软件报的确切名称，可以使用search函数，搜索与指定软件包的名称相匹配的所有可用软件包yum search httpd</td></tr><tr><td>provides</td><td>查找某个特定文件属于哪个软件包。yum provides /app/apache/confi/http.conf</td></tr><tr><td>grouplist</td><td>列出所有可用群组</td></tr><tr><td>groupinstall</td><td>安装群组软件包yum groupinstall develment-tools</td></tr><tr><td>repolist</td><td>列出启用的软件库</td></tr><tr><td>repolist all</td><td>列出所有软件库，包括禁用的也列出</td></tr><tr><td>&ndash;enablerepo</td><td>安装来自特定软件库的软件包</td></tr><tr><td>&ndash;disablerepo</td><td>不安装来自指定软件库的软件包yum &ndash;enablerepo=test &ndash;disablerepo=base,extras&mldr; install httpd</td></tr><tr><td>chean all</td><td>清理yum缓存内容</td></tr><tr><td>history</td><td>查看yum历史记录</td></tr></tbody></table><h2 id=yum源>yum源<a hidden class=anchor aria-hidden=true href=#yum源>#</a></h2><p>Yum源分为三大类：</p><ul><li>Base：就是你下载的光盘镜像里面的DVD1</li><li>Extra：就是你下载光盘镜像的DVD2</li><li>Epel：属于额外的，得到Epel官方获取</li></ul><p>将光盘挂载到系统上，你会发现里面有个packages目录，里面全是rpm包</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>CentOS_BuildTag  
</span></span><span class=line><span class=cl>images                    
</span></span><span class=line><span class=cl>...          
</span></span><span class=line><span class=cl>Packages                  
</span></span><span class=line><span class=cl>RPM-GPG-KEY-CentOS-Security-6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ll<span class=p>|</span>wc -l
</span></span><span class=line><span class=cl><span class=m>4186</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=配置yum源>配置yum源<a hidden class=anchor aria-hidden=true href=#配置yum源>#</a></h3><p>找一个镜像站点，国内常用镜像站点</p><ul><li><p><a href=http://mirrors.aliyun.com target=_blank rel="noopener nofollow noreferrer">http://mirrors.aliyun.com</a></p></li><li><p><a href=http://mirrors.163.com target=_blank rel="noopener nofollow noreferrer">http://mirrors.163.com</a></p></li></ul><p>系统yum源路径，执行yum时，它只会读取yum.repo.d下这个目录下的所有以.repo结尾的文件。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls /etc/yum.repos.d/
</span></span><span class=line><span class=cl>CentOS-Base.repo       
</span></span><span class=line><span class=cl>CentOS-fasttrack.repo  
</span></span><span class=line><span class=cl>CentOS-Vault.repo  
</span></span><span class=line><span class=cl>CentOS-Debuginfo.repo  
</span></span><span class=line><span class=cl>CentOS-Media.repo      
</span></span><span class=line><span class=cl>epel.repo</span></span></code></pre></td></tr></table></div></div></div></div><p>repo文件的写入是有其特殊格式的，如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>aaa<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>aaa
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>http://192.168.2.110
</span></span><span class=line><span class=cl><span class=nv>enable</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>gpgchek</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>bbb<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>bbb
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>http://192.168.2.110
</span></span><span class=line><span class=cl><span class=nv>enable</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>gpgchek</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ccc<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>ccc
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>http://192.168.2.110
</span></span><span class=line><span class=cl><span class=nv>enable</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>gpgchek</span><span class=o>=</span><span class=m>0</span></span></span></code></pre></td></tr></table></div></div></div></div><p>所谓的自己配置Yum仓库就是把网上那些程序包全下载下来，在本地(内网)提供Yum。除了epel提供的所有包外，还有镜像光盘DVD1,DVD2！</p><h2 id=yum服务配置文件>yum服务配置文件<a hidden class=anchor aria-hidden=true href=#yum服务配置文件>#</a></h2><p>配置文件分为两部分main和repository</p><p>配置本地yum源</p><p>禁用默认的yum网络源，将yum网络源配置文件改名为CentOS-Base.repo.bak，否则会现在网络源中寻找适合的包，改名之后直接从本地源读取。也可以向上面一样自己写一个文件。</p><h3 id=全局配置文件>全局配置文件<a hidden class=anchor aria-hidden=true href=#全局配置文件>#</a></h3><p>main部分定义了全局配置选项，整个yum配置文件应该只有一个main，/etc/yum.conf</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf># /etc/yum.conf
[main]
# cachedir：yum缓存的目录，yum在此存储下载的rpm包和数据库，一般是/var/cache/yum/$basearch/$releasever。
cachedir=/var/cache/yum/$basearch/$releasever
# 设置 keepcache=1，yum 在成功安装软件包之后保留缓存的头文件 (headers) 和软件包。默认值为 keepcache=0 不保存
keepcache=[1 or 0]
# debuglevel：除错级别，0──10,默认是2 貌似只记录安装和删除记录
debuglevel=2
logfile=/var/log/yum.log
# pkgpolicy： 包的策略。一共有两个选项，newest和last，这个作用是如果你设置了多个repository，而同一软件在不同的repository中同时存 在，yum应该安装哪一个，如果是newest，则yum会安装最新的那个版本。如果是last，则yum会将服务器id以字母表排序，并选择最后的那个 服务器上的软件安装。一般都是选newest。
pkgpolicy=newest
# 指定一个软件包，yum会根据这个包判断你的发行版本，默认是RedHat-release，也可以是安装的任何针对自己发行版的rpm包
distroverpkg=CentOS-release
# tolerent，也有1和0两个选项，表示yum是否容忍命令行发生与软件包有关的错误，比如你要安装1,2,3三个包，而其中3此前已经安装了，如果你设为1,则yum不会出现错误信息。默认是0。
tolerant=1
# exactarch，有两个选项1和0,代表是否只升级和你安装软件包cpu体系一致的包，如果设为1，则如你安装了一个i386的rpm，则yum不会用1686的包来升级。
exactarch=1
# retries，网络连接发生错误后的重试次数，如果设为0，则会无限重试。
retries=20
obsoletes=1
# gpgchkeck= 有1和0两个选择，分别代表是否是否进行gpg校验，如果没有这一项，默认是检查的。
gpgcheck=1
# 该选项用户指定 .repo 文件的绝对路径。.repo 文件包含软件仓库的信息 (作用与 /etc/yum.conf 文件中的 [repository] 片段相同)。
reposdir=[包含 .repo 文件的目录的绝对路径] # 默认是 /etc/yum.repos.d/ 低下的 xx.repo后缀文件
# exclude 排除某些软件在升级名单之外，可以用通配符，列表中各个项目要用空格隔开，这个对于安装了诸如美化包，中文补丁的朋友特别有用。
exclude=xxx</code></pre></div></div><h3 id=第二部分repoitory>第二部分repoitory<a hidden class=anchor aria-hidden=true href=#第二部分repoitory>#</a></h3><p>repoitory部分定义了每个源/服务器的具体配置，可以有一到多个，位于/etc/yum.repos.d/目录下的各文件中。这个字段其实也可以在yum.conf里面直接配置</p><p>repo文件的格式</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># serverid用于区别各个不同的repository，必须有一个独一无二的名称。 重复了前面覆盖后面--还是反过来呢？？？用enabled 测试是后面覆盖前面</span>
</span></span><span class=line><span class=cl><span class=o>[</span>serverid<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># name是对repository的描述，支持像$releasever $basearch这样的变量; name=Fedora Core $releasever - $basearch - Released Updates</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>Some name <span class=k>for</span> this server
</span></span><span class=line><span class=cl><span class=c1># baseurl是服务器设置中最重要的部分，只有设置正确，才能从上面获取软件。它的格式是：</span>
</span></span><span class=line><span class=cl><span class=c1># 其中url支持的协议有 http:// ftp:// file://三种。baseurl后可以跟多个url，你可以自己改为速度比较快的镜像站，但baseurl只能有一个，也就是说不能像如下格式：</span>
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>url://server1/path/to/repository/
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>url://server2/path/to/repository/
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>url://server3/path/to/repository/
</span></span><span class=line><span class=cl>其中url指向的目录必须是这个repository header目录的上一级，它也支持<span class=nv>$releasever</span> <span class=nv>$basearch这样的变量</span>。
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>url://path/to/repository/
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>url://server1/path/to/repository/
</span></span><span class=line><span class=cl>url://server2/path/to/repository/
</span></span><span class=line><span class=cl>url://server3/path/to/repository/
</span></span><span class=line><span class=cl><span class=c1># 这一行是指定一个镜像服务器的地址列表，通常是开启的，本例中加了注释符号禁用了，我们可以试试，将$releasever和$basearch替换成自己对应的版本和架构，例如10和i386，在浏览器中打开，我们就能看到一长串镜可用的镜像服务器地址列表。</span>
</span></span><span class=line><span class=cl><span class=nv>mirrorlist</span><span class=o>=</span>http://mirrors.fedoraproject.org/mirrorlist?repo<span class=o>=</span>fedora-<span class=nv>$releasever</span><span class=p>&amp;</span><span class=nv>arch</span><span class=o>=</span><span class=nv>$basearch</span>
</span></span><span class=line><span class=cl>url之后可以加上多个选项，如gpgcheck、exclude、failovermethod等，比如：
</span></span><span class=line><span class=cl><span class=c1># 其中gpgcheck，exclude的含义和[main]部分相同，但只对此服务器起作用</span>
</span></span><span class=line><span class=cl><span class=nv>gpgcheck</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>exclude</span><span class=o>=</span>gaim
</span></span><span class=line><span class=cl><span class=c1># failovermethode 有两个选项roundrobin和priority，意思分别是有多个url可供选择时，yum选择的次序，roundrobin是随机选择，如果连接失 败则使用下一个，依次循环，priority则根据url的次序从第一个开始。如果不指明，默认是roundrobin。</span>
</span></span><span class=line><span class=cl><span class=nv>failovermethod</span><span class=o>=</span>priority
</span></span><span class=line><span class=cl><span class=c1># 当某个软件仓库被配置成 enabled=0 时，yum 在安装或升级软件包时不会将该仓库做为软件包提供源。使用这个选项，可以启用或禁用软件仓库。</span>
</span></span><span class=line><span class=cl><span class=c1># 通过 yum 的 --enablerepo=[repo_name] 和 --disablerepo=[repo_name] 选项，或者通过 PackageKit 的&#34;添加/删除软件&#34;工具，也能够方便地启用和禁用指定的软件仓库</span>
</span></span><span class=line><span class=cl><span class=nv>enabled</span><span class=o>=[</span><span class=m>1</span> or 0<span class=o>]</span></span></span></code></pre></td></tr></table></div></div></div></div><p>变量</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>$releasever，发行版的版本，从[main]部分的distroverpkg获取，如果没有，则根据redhat-release包进行判断。
$arch，cpu体系，如i686,athlon等
$basearch，cpu的基本体系组，如i686和athlon同属i386，alpha和alphaev6同属alpha。</code></pre></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：使用fpm制作rpm包与搭建本地yum源</p><p>文章链接：<a href=https://www.oomkill.com/2016/12/fpm/ target=_blank>https://www.oomkill.com/2016/12/fpm/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2016/10/ch1-iptables-introduction/><span>ch1 iptables介绍</span></a></li><li><a href=/2016/10/ch2-iptables-command/><span>ch2 iptables命令帮助信息</span></a></li><li><a href=/2016/10/ch3-iptables-configuration/><span>ch3 iptables配置防火墙</span></a></li><li><a href=/2016/10/ch4-iptables-p/><span>ch4 生产环境如何维护iptables</span></a></li><li><a href=/2016/10/ch5-iptables-nat/><span>ch5 配置网关及服务器地址映射</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2017/01/lvs-and-keepalived/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>LVS & keepalived 集群架构</span>
</a><a class=next href=https://www.oomkill.com/2016/11/heartbeat/><span class=title></span>
<span>heartbeat权威指南&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/fpm","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>