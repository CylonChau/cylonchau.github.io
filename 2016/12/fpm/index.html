<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>使用fpm制作rpm包与搭建本地yum源 | Cylon&#39;s Collection</title>
<meta name="keywords" content="Linux, rpm, fpm">
<meta name="description" content="使用fpm制作rpm包与搭建本地yum源 - Cylon&#39;s Collection">
<meta name="author" content="cylon">
<link rel="canonical" href="https://www.oomkill.com/2016/12/fpm/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.df0e7f0648f287aca44f5b657ff5602f436346895340daaa6589b3049a979f73.css" integrity="sha256-3w5/Bkjyh6ykT1tlf/VgL0NjRolTQNqqZYmzBJqXn3M=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.oomkill.com/favicon.ico">
<link rel="apple-touch-icon" href="https://www.oomkill.com/apple-touch-icon.png">

<meta name="twitter:title" content="使用fpm制作rpm包与搭建本地yum源 | Cylon&#39;s Collection" />
<meta name="twitter:description" content="" />
<meta property="og:title" content="使用fpm制作rpm包与搭建本地yum源 | Cylon&#39;s Collection" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.oomkill.com/2016/12/fpm/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2016-12-16T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2022-12-15T23:10:36&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.oomkill.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "使用fpm制作rpm包与搭建本地yum源",
      "item": "https://www.oomkill.com/2016/12/fpm/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "使用fpm制作rpm包与搭建本地yum源 | Cylon's Collection",
  "name": "使用fpm制作rpm包与搭建本地yum源",
  "description": "",
  "keywords": [
    "Linux", "rpm", "fpm"
  ],
  "wordCount" : "5757",
  "inLanguage": "zh",
  "datePublished": "2016-12-16T00:00:00Z",
  "dateModified": "2022-12-15T23:10:36+08:00",
  "author":{
    "@type": "Person",
    "name": "cylon"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.oomkill.com/2016/12/fpm/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cylon's Collection",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.oomkill.com/favicon.ico"
    }
  }
}
</script><script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.oomkill.com" accesskey="h" title="Cylon&#39;s Collection (Alt + H)">Cylon&#39;s Collection</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.oomkill.com/archives/" title="归档"
                >归档
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/tags/" title="标签"
                >标签
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/search/" title="搜索 (Alt &#43; /)"data-no-instant accesskey=/
                >搜索
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/about/" title="关于"
                >关于
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header"><h1 class="post-title">使用fpm制作rpm包与搭建本地yum源</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2016-12-16</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>Edited on 2022-12-15</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="https://www.oomkill.com/tags/linux/">linux</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>12 分钟</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#rpm%e4%b8%8efpm" aria-label="rpm与fpm">rpm与fpm</a><ul>
                        
                <li>
                    <a href="#%e8%bd%af%e4%bb%b6%e7%9a%84%e5%ae%89%e8%a3%85%e6%96%b9%e5%bc%8f" aria-label="软件的安装方式">软件的安装方式</a></li>
                <li>
                    <a href="#rpm%e6%a6%82%e8%bf%b0" aria-label="RPM概述">RPM概述</a></li>
                <li>
                    <a href="#rpmbuild" aria-label="rpmbuild">rpmbuild</a></li>
                <li>
                    <a href="#fpm" aria-label="fpm">fpm</a></li></ul>
                </li>
                <li>
                    <a href="#fpm%e5%ae%89%e8%a3%85" aria-label="fpm安装">fpm安装</a><ul>
                        
                <li>
                    <a href="#yum%e5%ae%89%e8%a3%85ruby%e6%a8%a1%e5%9d%97" aria-label="yum安装ruby模块">yum安装ruby模块</a></li>
                <li>
                    <a href="#%e6%9b%bf%e6%8d%a2gem%e6%ba%90" aria-label="替换gem源">替换gem源</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e9%94%99%e8%af%af" aria-label="安装错误">安装错误</a></li>
                <li>
                    <a href="#%e5%8d%87%e7%ba%a7ruby" aria-label="升级ruby">升级ruby</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e4%bd%8e%e7%89%88%e6%9c%acfpm" aria-label="安装低版本fpm">安装低版本fpm</a></li></ul>
                </li>
                <li>
                    <a href="#fpm%e4%bd%bf%e7%94%a8" aria-label="fpm使用">fpm使用</a><ul>
                        
                <li>
                    <a href="#yum%e5%ae%89%e8%a3%85%e6%98%af%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e4%be%9d%e8%b5%96%e9%97%ae%e9%a2%98%e7%9a%84" aria-label="yum安装是如何解决依赖问题的？">yum安装是如何解决依赖问题的？</a></li>
                <li>
                    <a href="#%e6%89%93%e5%8c%85fpm" aria-label="打包fpm">打包fpm</a></li>
                <li>
                    <a href="#%e6%89%93%e5%8c%85%e9%94%99%e8%af%af" aria-label="打包错误">打包错误</a></li></ul>
                </li>
                <li>
                    <a href="#yum" aria-label="YUM">YUM</a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%afyum" aria-label="什么是yum">什么是yum</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%bayum%e6%ba%90" aria-label="创建yum源">创建yum源</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85createrepo%e5%b7%a5%e5%85%b7" aria-label="安装createrepo工具">安装createrepo工具</a></li>
                <li>
                    <a href="#%e6%8f%90%e4%be%9byum%e6%9c%8d%e5%8a%a1" aria-label="提供yum服务">提供yum服务</a></li>
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0%e6%96%b0%e7%9a%84rpm%e5%8c%85" aria-label="添加新的rpm包">添加新的rpm包</a></li>
                <li>
                    <a href="#%e6%9c%ac%e5%9c%b0%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae" aria-label="本地客户端配置">本地客户端配置</a></li>
                <li>
                    <a href="#yum%e5%91%bd%e4%bb%a4" aria-label="yum命令">yum命令</a></li></ul>
                </li>
                <li>
                    <a href="#yum%e6%ba%90" aria-label="yum源">yum源</a><ul>
                        
                <li>
                    <a href="#%e9%85%8d%e7%bd%aeyum%e6%ba%90" aria-label="配置yum源">配置yum源</a></li></ul>
                </li>
                <li>
                    <a href="#yum%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="yum服务配置文件">yum服务配置文件</a><ul>
                        
                <li>
                    <a href="#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="全局配置文件">全局配置文件</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e9%83%a8%e5%88%86repoitory" aria-label="第二部分repoitory">第二部分repoitory</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    





<div class="copyrightTopBlock">
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <div class="articleSuffix-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
</div><h2 id="rpm与fpm">rpm与fpm<a hidden class="anchor" aria-hidden="true" href="#rpm与fpm">¶</a></h2>
<h3 id="软件的安装方式">软件的安装方式<a hidden class="anchor" aria-hidden="true" href="#软件的安装方式">¶</a></h3>
<ul>
<li><strong>编译安装</strong>：优点是可以定制化安装目录、按需开启功能等，缺点是需要查找并实验出适合的编译参数，诸如MySQL之类的软件编译耗时过长</li>
<li><strong>yum安装</strong>：优点是全自动化安装，不需要为依赖问题发愁，缺点是自主性太差，软件的功能、存放位置都已经固定好了，不易变更。</li>
<li><strong>编译源码</strong>：根据自己的需求做成 RMP包 ==&gt; 搭建yum仓库 ==&gt; yum安装。结合前两者的优点，暂未发现什么缺点。可能的缺点就是RPM包的通用性差，一般人不会定制RPM包。</li>
</ul>
<h3 id="rpm概述">RPM概述<a hidden class="anchor" aria-hidden="true" href="#rpm概述">¶</a></h3>
<p>RPM全称是Red Hat Package Manager(RedHat包管理器)。几乎所有的Linux发型版本都使用这种形式的软件包管理安装、更新和卸载软件。</p>
<p>rpm命令有5种基本功能（不包括创建软件包）：安装、卸载、升级、查询和验证。</p>
<p>关于rpm命令的使用可以用rpm &ndash;help来获得</p>
<h3 id="rpmbuild">rpmbuild<a hidden class="anchor" aria-hidden="true" href="#rpmbuild">¶</a></h3>
<p>rpmbuild是reahat系的原声打包命令，这个命令的使用难点主要在于spec文件编写，一个类似于kickstart的ks.cfg文件。</p>
<p>作为一个使用工具，种种繁琐，在没有替代品时还能存活。当有了其他简易工具时，他就到了完蛋的时候</p>
<h3 id="fpm">fpm<a hidden class="anchor" aria-hidden="true" href="#fpm">¶</a></h3>
<p><a href="https://github.com/jordansissel/fpm">fpm</a> 是将一种类型的包转换成另一种类型</p>
<p>支持的源类型包</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>dir</td>
<td>将目录打包成所需要的类型，可以用于源码编译安装的软件包</td>
</tr>
<tr>
<td>rpm</td>
<td>对rpm进行转换</td>
</tr>
<tr>
<td>gem</td>
<td>对rubygem包进行转换</td>
</tr>
<tr>
<td>python</td>
<td>将python模块打包成相对应的类型</td>
</tr>
<tr>
<td>支持目标类型包</td>
<td></td>
</tr>
<tr>
<td>rpm</td>
<td>转换为rpm包</td>
</tr>
<tr>
<td>deb</td>
<td>转换为deb包</td>
</tr>
<tr>
<td>solaris</td>
<td>装环卫solaris包</td>
</tr>
<tr>
<td>puppet</td>
<td>转换为puppet模块</td>
</tr>
</tbody>
</table>
<h2 id="fpm安装">fpm安装<a hidden class="anchor" aria-hidden="true" href="#fpm安装">¶</a></h2>
<p>fpm是ruby写的，因此系统环境需要ruby，而且ruby版本号大于bshards运行的版本。</p>
<h3 id="yum安装ruby模块">yum安装ruby模块<a hidden class="anchor" aria-hidden="true" href="#yum安装ruby模块">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install ruby rubygems ruby-devel -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看ruby的版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ rpm -qa<span class="p">|</span>grep ruby
</span></span><span class="line"><span class="cl">ruby-libs-1.8.7.374-4.el6_6.x86_64
</span></span><span class="line"><span class="cl">rubygems-1.3.7-5.el6.noarch
</span></span><span class="line"><span class="cl">ruby-1.8.7.374-4.el6_6.x86_64
</span></span><span class="line"><span class="cl">ruby-rdoc-1.8.7.374-4.el6_6.x86_64
</span></span><span class="line"><span class="cl">ruby-devel-1.8.7.374-4.el6_6.x86_64
</span></span><span class="line"><span class="cl">ruby-irb-1.8.7.374-4.el6_6.x86_64
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="替换gem源">替换gem源<a hidden class="anchor" aria-hidden="true" href="#替换gem源">¶</a></h3>
<p>ruby中国镜像：https://ruby-china.org/</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gem <span class="nb">source</span> -a http://gems.ruby-china.org
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>-r remove xx 删除一个gem源列表</li>
<li>-l list gem源列表</li>
</ul>
<h3 id="安装错误">安装错误<a hidden class="anchor" aria-hidden="true" href="#安装错误">¶</a></h3>
<p>此问题提示 ruby的版本至少要求为1.9.3，在我们yum安装的ruby为1.8.7</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ gem install fpm
</span></span><span class="line"><span class="cl">Building native extensions.  This could take a <span class="k">while</span>...
</span></span><span class="line"><span class="cl">Building native extensions.  This could take a <span class="k">while</span>...
</span></span><span class="line"><span class="cl">ERROR:  Error installing fpm:
</span></span><span class="line"><span class="cl">        ruby-xz requires Ruby version &gt;<span class="o">=</span> 1.9.3.
</span></span></code></pre></td></tr></table>
</div>
</div><p>解决方法：</p>
<ol>
<li>
<p>升级ruby版本</p>
</li>
<li>
<p>安装低版本fpm</p>
</li>
</ol>
<p><code>ERROR:  Could not find a valid gem 'fpm' (&gt;= 0) in any repository</code></p>
<p>原因：gem源失效，替换gem源即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ERROR:  Could not find a valid gem <span class="s1">&#39;fpm&#39;</span> <span class="o">(</span>&gt;<span class="o">=</span> 0<span class="o">)</span> in any repository
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="升级ruby">升级ruby<a hidden class="anchor" aria-hidden="true" href="#升级ruby">¶</a></h3>
<ol>
<li>下载rvm</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
</span></span><span class="line"><span class="cl">curl -sSL https://get.rvm.io <span class="p">|</span> bash -s stable
</span></span><span class="line"><span class="cl"><span class="c1"># 如果上面的连接失败，可以尝试: </span>
</span></span><span class="line"><span class="cl">curl -L https://raw.githubusercontent.com/wayneeseguin/rvm/master/binscripts/rvm-installer <span class="p">|</span> bash -s stable
</span></span></code></pre></td></tr></table>
</div>
</div><p>rvm会下载安装到/usr/local/rvm下</p>
<ol start="2">
<li>列出已知的ruby版本</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ /usr/local/rvm/bin/rvm list known
</span></span><span class="line"><span class="cl"><span class="c1"># MRI Rubies</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>1.8.6<span class="o">[</span>-p420<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>1.8.7<span class="o">[</span>-head<span class="o">]</span>$  security released on head
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>1.9.1<span class="o">[</span>-p431<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>1.9.2<span class="o">[</span>-p330<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>1.9.3<span class="o">[</span>-p551<span class="o">]</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>2.3<span class="o">[</span>.3<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ruby-<span class="o">]</span>2.4<span class="o">[</span>.0<span class="o">]</span>
</span></span><span class="line"><span class="cl">ruby-head
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="c1"># IronRuby</span>
</span></span><span class="line"><span class="cl">ironruby<span class="o">[</span>-1.1.3<span class="o">]</span>
</span></span><span class="line"><span class="cl">ironruby-head
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>按照提示安装ruby1.9.3</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/usr/local/rvm/bin/rvm install ruby-1.9.3
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>将安装的ruby切换为默认</li>
</ol>
<p>如果想设置为默认版本，这样一来以后新打开的控制台默认的 Ruby 就是这个版本</p>
<p><strong>错误：RVM is not a function</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ /usr/local/rvm/bin/rvm use 1.9.3 --default
</span></span><span class="line"><span class="cl">RVM is not a <span class="k">function</span>, selecting rubies with <span class="s1">&#39;rvm use ...&#39;</span> will not work.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You need to change your terminal emulator preferences to allow login shell.
</span></span><span class="line"><span class="cl">Sometimes it is required to use <span class="sb">`</span>/bin/bash --login<span class="sb">`</span> as the command.
</span></span><span class="line"><span class="cl">Please visit https://rvm.io/integration/gnome-terminal/ <span class="k">for</span> an example.
</span></span></code></pre></td></tr></table>
</div>
</div><p>原因：需要添加到系统变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[[</span> -s <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.rvm/scripts/rvm&#34;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> . <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.rvm/scripts/rvm&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /etc/profile 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装低版本fpm">安装低版本fpm<a hidden class="anchor" aria-hidden="true" href="#安装低版本fpm">¶</a></h3>
<p>指定版本安装</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gem install fpm -v 1.4
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看安装完的fpm版本号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ fpm --version
</span></span><span class="line"><span class="cl">1.4.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>卸载一个安装版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rvm remove 1.9.2
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://www.ruby-lang.org/zh_cn/downloads/">https://www.ruby-lang.org/zh_cn/downloads/</a></p>
<p>编译安装ruby</p>
<p>参考资料：</p>
<ul>
<li>
<p><a href="https://rubygems.org/pages/download">Download RubyGems</a></p>
</li>
<li>
<p><a href="http://ritto.blog.51cto.com/427838/737824">ruby的升级过程</a></p>
</li>
<li>
<p><a href="https://ruby-china.org/wiki/install_ruby_guide">如何快速正确的安装 Ruby, Rails 运行环境</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/Ray-liang/p/5012637.html">RVM 解决 Ruby 的版本问题 </a></p>
</li>
</ul>
<h2 id="fpm使用">fpm使用<a hidden class="anchor" aria-hidden="true" href="#fpm使用">¶</a></h2>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-s</td>
<td>指定源类型</td>
</tr>
<tr>
<td>-t</td>
<td>指定目标类型，即想要制作为什么包</td>
</tr>
<tr>
<td>-n</td>
<td>指定包的名字</td>
</tr>
<tr>
<td>-v</td>
<td>指定包的版本号</td>
</tr>
<tr>
<td>-C</td>
<td>指定打包的相对路径</td>
</tr>
<tr>
<td>-d</td>
<td>指定依赖于哪些包</td>
</tr>
<tr>
<td>-f</td>
<td>第二次包时目录下如果有同名安装包存在，则覆盖它</td>
</tr>
<tr>
<td>-p</td>
<td>输出的安装包的目录，不想放在当前目录下就需要指定</td>
</tr>
<tr>
<td>&ndash;post-install</td>
<td>软件包安装完成之后所要运行的脚本；同&ndash;offer-install</td>
</tr>
<tr>
<td>&ndash;pre-install</td>
<td>软件包安装完成之前所要运行的脚本；同&ndash;before-install</td>
</tr>
<tr>
<td>&ndash;post-uninstall</td>
<td>软件包卸载完成之后所要运行的脚本；同&ndash;offer-remove</td>
</tr>
<tr>
<td>&ndash;pre-uninstall</td>
<td>软件包卸载完成之前所要运行的脚本；同—before-remove</td>
</tr>
</tbody>
</table>
<h3 id="yum安装是如何解决依赖问题的">yum安装是如何解决依赖问题的？<a hidden class="anchor" aria-hidden="true" href="#yum安装是如何解决依赖问题的">¶</a></h3>
<p>在使用yum安装软件A时，yum会在下载完A的rpm包后，对该rpm包进行检查（rpm包会给出安装该rpm包所依赖的基础库和软件）。如果检查出A的安装还要依赖软件B，那么此时yum就会自动下载并安装B。B安装完毕后，就会继续安装A。如果是内网yum源的话，我们只需要把B放在内网yum源即可。如果检查出A的安装不需要其他软件的支持，那么yum会自动安装A。因此使用rpm -d添加依赖关系</p>
<h3 id="打包fpm">打包fpm<a hidden class="anchor" aria-hidden="true" href="#打包fpm">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fpm -s dir -t rpm -n sphinx -v 5.5.54 -d <span class="s1">&#39;libaio-devel,ncurses-devel&#39;</span> --post-install /app/mysql.sh /app/mysql
</span></span></code></pre></td></tr></table>
</div>
</div><p>相对路径问题</p>
<p>使用相对路径打包，会直接保存为/目录。这样就不会是我们指定的目录了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ rpm -pql sphinx-1.0-1.x86_64.rpm       
</span></span><span class="line"><span class="cl">/bin/indexer
</span></span><span class="line"><span class="cl">/bin/indextool
</span></span><span class="line"><span class="cl">/bin/searchd
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">/var/data/test1stemmed.spp
</span></span><span class="line"><span class="cl">/var/data/test1stemmed.sps
</span></span><span class="line"><span class="cl">/var/log
</span></span></code></pre></td></tr></table>
</div>
</div><p>制定依赖包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fpm -d <span class="s1">&#39;libaio-devel,ncurses-devel&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在安装时就会检测依赖包，如无此包就报错</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ rpm -ivh mysql-5.5.54-1.x86_64.rpm 
</span></span><span class="line"><span class="cl">error: Failed dependencies:
</span></span><span class="line"><span class="cl">        libaio-devel is needed by mysql-5.5.54-1.x86_64
</span></span><span class="line"><span class="cl">        ncurses-devel is needed by mysql-5.5.54-1.x86_64
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装完成后指定要执行的脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fpm --post-install <span class="s1">&#39;mysql.sh&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>本地模拟yum安装自己打包的软件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ yum localinstall mysql-5.5.54-1.x86_64.rpm 
</span></span><span class="line"><span class="cl">已加载插件：fastestmirror, security
</span></span><span class="line"><span class="cl">设置本地安装进程
</span></span><span class="line"><span class="cl">诊断 mysql-5.5.54-1.x86_64.rpm: mysql-5.5.54-1.x86_64
</span></span><span class="line"><span class="cl">mysql-5.5.54-1.x86_64.rpm 将被安装
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">Non-fatal POSTIN scriptlet failure in rpm package mysql-5.5.54-1.x86_64
</span></span><span class="line"><span class="cl">useradd: user <span class="s1">&#39;mysql&#39;</span> already exists <span class="c1"># 安装后执行脚本中创建的用户，因已创建用户，故提示</span>
</span></span><span class="line"><span class="cl">warning: %post<span class="o">(</span>mysql-5.5.54-1.x86_64<span class="o">)</span> scriptlet failed, <span class="nb">exit</span> status <span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">已安装:
</span></span><span class="line"><span class="cl">  mysql.x86_64 0:5.5.54-1                                                                                       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">作为依赖被安装:
</span></span><span class="line"><span class="cl">libaio-devel.x86_64 0:0.3.107-10.el6   ncurses-devel.x86_64 0:5.7-4.20090207.el6                
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">作为依赖被升级:
</span></span><span class="line"><span class="cl">ncurses-base.x86_64 0:5.7-4.20090207.el6  ncurses-libs.x86_64 0:5.7-4.20090207.el6
</span></span></code></pre></td></tr></table>
</div>
</div><p>初始化后启动MySQL并登陆</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ /etc/init.d/mysqld start
</span></span><span class="line"><span class="cl">Starting MySQL.. SUCCESS! 
</span></span><span class="line"><span class="cl">$ bin/mysql
</span></span><span class="line"><span class="cl">Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MySQL connection id is <span class="m">1</span>
</span></span><span class="line"><span class="cl">..
</span></span><span class="line"><span class="cl">mysql&gt; 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="打包错误">打包错误<a hidden class="anchor" aria-hidden="true" href="#打包错误">¶</a></h3>
<p>原因未知</p>
<p>解决方法：可能是打包时会产生大量的缓存，导致空间不够，删除一些文件后问题再没出现过</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ fpm -s dir -t rpm -n mysqld -v 5.5.54 -f --post-install /app/m.in.sh --post-uninstall /app/un.m.sh /app/mariadb-5.5.54/
</span></span><span class="line"><span class="cl">Process failed: rpmbuild failed <span class="o">(</span><span class="nb">exit</span> code 1<span class="o">)</span>. Full <span class="nb">command</span> was:<span class="o">[</span><span class="s2">&#34;rpmbuild&#34;</span>, <span class="s2">&#34;-bb&#34;</span>, <span class="s2">&#34;--define&#34;</span>, <span class="s2">&#34;buildroot /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/BUILD&#34;</span>, <span class="s2">&#34;--define&#34;</span>, <span class="s2">&#34;_topdir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61&#34;</span>, <span class="s2">&#34;--define&#34;</span>, <span class="s2">&#34;_sourcedir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61&#34;</span>, <span class="s2">&#34;--define&#34;</span>, <span class="s2">&#34;_rpmdir /tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/RPMS&#34;</span>, <span class="s2">&#34;--define&#34;</span>, <span class="s2">&#34;_tmppath /tmp&#34;</span>, <span class="s2">&#34;/tmp/package-rpm-build-2570d4ce573d6b34f9153009975231fe511bee89c64018c2c7e219355d61/SPECS/mysqld.spec&#34;</span><span class="o">]</span> <span class="o">{</span>:level<span class="o">=</span>&gt;:error<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="yum">YUM<a hidden class="anchor" aria-hidden="true" href="#yum">¶</a></h2>
<h3 id="什么是yum">什么是yum<a hidden class="anchor" aria-hidden="true" href="#什么是yum">¶</a></h3>
<p>yum主要用于自动安装、升级rpm软件包，他能自动查找并解决rpm包之间的依赖关系。要成功的使用yum工具安装更新软件或系统，就需要有一个包含各种rpm软件包的repository（软件仓库），这个软件仓库我们习惯称为yum源，网络上有大量的yum源，但由于收到网络环境的限制，导致软件安装耗时过长甚至失败。特别是当有大量服务器大量软件包需要安装时，缓慢的进度条令人难以忍受。因此我们在优化系统时，都会更换国内的源。</p>
<p>相比较而言，本地yum源服务器最大优点是局域网的快速网络连接和稳定性。有了局域网中的yum源服务器，即使在internet连接中断的情况下，也不会影响其他yum客户端的软件安装和升级</p>
<h3 id="创建yum源">创建yum源<a hidden class="anchor" aria-hidden="true" href="#创建yum源">¶</a></h3>
<p>上传rpm包到此目录，此目录下面还可以包括文件夹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /tools/yum/centos6/x86_64
</span></span></code></pre></td></tr></table>
</div>
</div><p>yum下载的文件缓存在</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/var/cache/yum/x86_64/6/base/
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装createrepo工具">安装createrepo工具<a hidden class="anchor" aria-hidden="true" href="#安装createrepo工具">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install -y createrepo
</span></span></code></pre></td></tr></table>
</div>
</div><p>初始化repodata索引文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ createrepo -pdo /tools/yum/centos6/x86_64/ /tools/yum/centos6/x86_64/
</span></span><span class="line"><span class="cl">Spawning worker <span class="m">0</span> with <span class="m">4</span> pkgs
</span></span><span class="line"><span class="cl">Workers Finished
</span></span><span class="line"><span class="cl">Gathering worker results
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Saving Primary metadata
</span></span><span class="line"><span class="cl">Saving file lists metadata
</span></span><span class="line"><span class="cl">Saving other metadata
</span></span><span class="line"><span class="cl">Generating sqlite DBs
</span></span><span class="line"><span class="cl">Sqlite DBs <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> /tools/yum/centos6/x86_64/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls
</span></span><span class="line"><span class="cl">libaio-devel-0.3.107-10.el6.i686.rpm
</span></span><span class="line"><span class="cl">libaio-devel-0.3.107-10.el6.x86_64.rpm
</span></span><span class="line"><span class="cl">ncurses-devel-5.7-4.20090207.el6.i686.rpm
</span></span><span class="line"><span class="cl">ncurses-devel-5.7-4.20090207.el6.x86_64.rpm
</span></span><span class="line"><span class="cl">repodata
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls repodata/.
</span></span><span class="line"><span class="cl">1453d96f9216e7c230abfe7921a2fd1dd11541568934832306342c89ad04ff1d-other.sqlite.bz2
</span></span><span class="line"><span class="cl">2475630f1247fc6ac2b822541d6ad71ed83d733792c7d52de580fdebd3abda2c-filelists.sqlite.bz2
</span></span><span class="line"><span class="cl">9e22eb60f06501a3f4399dc3c2d3e3858567804e7ab352679fa650b93d279fb9-other.xml.gz
</span></span><span class="line"><span class="cl">c3ee9c8d8508c55c77f3f058f056bdd617587ee5a906f22bc9a512bc8b950ded-filelists.xml.gz
</span></span><span class="line"><span class="cl">d9d57f7733cb42831001e915ddd51bb126b67c26bca64bf6c7e7390eed9a54d9-primary.sqlite.bz2
</span></span><span class="line"><span class="cl">e9616244b93c46350e33dc04d4cb442e49ae375b7400a262bd72e8ba90a1f4a8-primary.xml.gz
</span></span><span class="line"><span class="cl">repomd.xml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="提供yum服务">提供yum服务<a hidden class="anchor" aria-hidden="true" href="#提供yum服务">¶</a></h3>
<p>可以用apache或nginx提供web服务，但用Python的http模块更简单，适用于内网环境。CentOS 6最小化安装后自带python。</p>
<ol>
<li>利用python的http模块提供服务</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python -m SimpleHTTPServer <span class="m">80</span> <span class="p">&amp;</span>&gt;/dev/null
</span></span><span class="line"><span class="cl"><span class="c1"># 提供服务的目录是执行命令时的目录</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>利用nginx提供yum源服务</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">    root   /tools<span class="p">;</span>
</span></span><span class="line"><span class="cl">    index  index.html index.htm<span class="p">;</span>
</span></span><span class="line"><span class="cl">	autoindex on<span class="p">;</span> <span class="c1"># 当找不到首页文件时，会展示目录结构，这个功能一般不要用除非有需求。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如没有此选项，会报403</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="添加新的rpm包">添加新的rpm包<a hidden class="anchor" aria-hidden="true" href="#添加新的rpm包">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 只下载软件不安装</span>
</span></span><span class="line"><span class="cl">yumdownlocaler pcre-devel openssl-devel
</span></span></code></pre></td></tr></table>
</div>
</div><p>每当该目录新增软件包需要更新源</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">createrepo --update /tools
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="本地客户端配置">本地客户端配置<a hidden class="anchor" aria-hidden="true" href="#本地客户端配置">¶</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/etc/yum.repos.d/test.repo
</span></span><span class="line"><span class="cl">[test]
</span></span><span class="line"><span class="cl">name=Server
</span></span><span class="line"><span class="cl">baseurl=http://192.168.2.110
</span></span><span class="line"><span class="cl">enable=1
</span></span><span class="line"><span class="cl">gpgchek=0
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用配置的自定义的源安装PHP</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum --enablerepo<span class="o">=</span><span class="nb">test</span> --disablerepo<span class="o">=</span>base,extras,updates install php
</span></span><span class="line"><span class="cl"><span class="c1"># --enbalerepo使用的源</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --disablerepo禁用源</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="yum命令">yum命令<a hidden class="anchor" aria-hidden="true" href="#yum命令">¶</a></h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>install</td>
<td>安装软件包 yum install httpd</td>
</tr>
<tr>
<td>list</td>
<td>列出yum仓库内文件 yum list httpd，可搜索带名称的特定软件包</td>
</tr>
<tr>
<td>search</td>
<td>不急的软件报的确切名称，可以使用search函数，搜索与指定软件包的名称相匹配的所有可用软件包yum search httpd</td>
</tr>
<tr>
<td>provides</td>
<td>查找某个特定文件属于哪个软件包。yum provides /app/apache/confi/http.conf</td>
</tr>
<tr>
<td>grouplist</td>
<td>列出所有可用群组</td>
</tr>
<tr>
<td>groupinstall</td>
<td>安装群组软件包yum groupinstall develment-tools</td>
</tr>
<tr>
<td>repolist</td>
<td>列出启用的软件库</td>
</tr>
<tr>
<td>repolist all</td>
<td>列出所有软件库，包括禁用的也列出</td>
</tr>
<tr>
<td>&ndash;enablerepo</td>
<td>安装来自特定软件库的软件包</td>
</tr>
<tr>
<td>&ndash;disablerepo</td>
<td>不安装来自指定软件库的软件包yum &ndash;enablerepo=test &ndash;disablerepo=base,extras&hellip; install httpd</td>
</tr>
<tr>
<td>chean all</td>
<td>清理yum缓存内容</td>
</tr>
<tr>
<td>history</td>
<td>查看yum历史记录</td>
</tr>
</tbody>
</table>
<h2 id="yum源">yum源<a hidden class="anchor" aria-hidden="true" href="#yum源">¶</a></h2>
<p>Yum源分为三大类：</p>
<ul>
<li>Base：就是你下载的光盘镜像里面的DVD1</li>
<li>Extra：就是你下载光盘镜像的DVD2</li>
<li>Epel：属于额外的，得到Epel官方获取</li>
</ul>
<p>将光盘挂载到系统上，你会发现里面有个packages目录，里面全是rpm包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls
</span></span><span class="line"><span class="cl">CentOS_BuildTag  
</span></span><span class="line"><span class="cl">images                    
</span></span><span class="line"><span class="cl">...          
</span></span><span class="line"><span class="cl">Packages                  
</span></span><span class="line"><span class="cl">RPM-GPG-KEY-CentOS-Security-6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ll<span class="p">|</span>wc -l
</span></span><span class="line"><span class="cl"><span class="m">4186</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="配置yum源">配置yum源<a hidden class="anchor" aria-hidden="true" href="#配置yum源">¶</a></h3>
<p>找一个镜像站点，国内常用镜像站点</p>
<ul>
<li>
<p><a href="http://mirrors.aliyun.com">http://mirrors.aliyun.com</a></p>
</li>
<li>
<p><a href="http://mirrors.163.com">http://mirrors.163.com</a></p>
</li>
</ul>
<p>系统yum源路径，执行yum时，它只会读取yum.repo.d下这个目录下的所有以.repo结尾的文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls /etc/yum.repos.d/
</span></span><span class="line"><span class="cl">CentOS-Base.repo       
</span></span><span class="line"><span class="cl">CentOS-fasttrack.repo  
</span></span><span class="line"><span class="cl">CentOS-Vault.repo  
</span></span><span class="line"><span class="cl">CentOS-Debuginfo.repo  
</span></span><span class="line"><span class="cl">CentOS-Media.repo      
</span></span><span class="line"><span class="cl">epel.repo
</span></span></code></pre></td></tr></table>
</div>
</div><p>repo文件的写入是有其特殊格式的，如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>aaa<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>aaa
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>http://192.168.2.110
</span></span><span class="line"><span class="cl"><span class="nv">enable</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgchek</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>bbb<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>bbb
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>http://192.168.2.110
</span></span><span class="line"><span class="cl"><span class="nv">enable</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgchek</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ccc<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>ccc
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>http://192.168.2.110
</span></span><span class="line"><span class="cl"><span class="nv">enable</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgchek</span><span class="o">=</span><span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>所谓的自己配置Yum仓库就是把网上那些程序包全下载下来，在本地(内网)提供Yum。除了epel提供的所有包外，还有镜像光盘DVD1,DVD2！</p>
<h2 id="yum服务配置文件">yum服务配置文件<a hidden class="anchor" aria-hidden="true" href="#yum服务配置文件">¶</a></h2>
<p>配置文件分为两部分main和repository</p>
<p>配置本地yum源</p>
<p>禁用默认的yum网络源，将yum网络源配置文件改名为CentOS-Base.repo.bak，否则会现在网络源中寻找适合的包，改名之后直接从本地源读取。也可以向上面一样自己写一个文件。</p>
<h3 id="全局配置文件">全局配置文件<a hidden class="anchor" aria-hidden="true" href="#全局配置文件">¶</a></h3>
<p>main部分定义了全局配置选项，整个yum配置文件应该只有一个main，/etc/yum.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># /etc/yum.conf
</span></span><span class="line"><span class="cl">[main]
</span></span><span class="line"><span class="cl"># cachedir：yum缓存的目录，yum在此存储下载的rpm包和数据库，一般是/var/cache/yum/$basearch/$releasever。
</span></span><span class="line"><span class="cl">cachedir=/var/cache/yum/$basearch/$releasever
</span></span><span class="line"><span class="cl"># 设置 keepcache=1，yum 在成功安装软件包之后保留缓存的头文件 (headers) 和软件包。默认值为 keepcache=0 不保存
</span></span><span class="line"><span class="cl">keepcache=[1 or 0]
</span></span><span class="line"><span class="cl"># debuglevel：除错级别，0──10,默认是2 貌似只记录安装和删除记录
</span></span><span class="line"><span class="cl">debuglevel=2
</span></span><span class="line"><span class="cl">logfile=/var/log/yum.log
</span></span><span class="line"><span class="cl"># pkgpolicy： 包的策略。一共有两个选项，newest和last，这个作用是如果你设置了多个repository，而同一软件在不同的repository中同时存 在，yum应该安装哪一个，如果是newest，则yum会安装最新的那个版本。如果是last，则yum会将服务器id以字母表排序，并选择最后的那个 服务器上的软件安装。一般都是选newest。
</span></span><span class="line"><span class="cl">pkgpolicy=newest
</span></span><span class="line"><span class="cl"># 指定一个软件包，yum会根据这个包判断你的发行版本，默认是RedHat-release，也可以是安装的任何针对自己发行版的rpm包
</span></span><span class="line"><span class="cl">distroverpkg=CentOS-release
</span></span><span class="line"><span class="cl"># tolerent，也有1和0两个选项，表示yum是否容忍命令行发生与软件包有关的错误，比如你要安装1,2,3三个包，而其中3此前已经安装了，如果你设为1,则yum不会出现错误信息。默认是0。
</span></span><span class="line"><span class="cl">tolerant=1
</span></span><span class="line"><span class="cl"># exactarch，有两个选项1和0,代表是否只升级和你安装软件包cpu体系一致的包，如果设为1，则如你安装了一个i386的rpm，则yum不会用1686的包来升级。
</span></span><span class="line"><span class="cl">exactarch=1
</span></span><span class="line"><span class="cl"># retries，网络连接发生错误后的重试次数，如果设为0，则会无限重试。
</span></span><span class="line"><span class="cl">retries=20
</span></span><span class="line"><span class="cl">obsoletes=1
</span></span><span class="line"><span class="cl"># gpgchkeck= 有1和0两个选择，分别代表是否是否进行gpg校验，如果没有这一项，默认是检查的。
</span></span><span class="line"><span class="cl">gpgcheck=1
</span></span><span class="line"><span class="cl"># 该选项用户指定 .repo 文件的绝对路径。.repo 文件包含软件仓库的信息 (作用与 /etc/yum.conf 文件中的 [repository] 片段相同)。
</span></span><span class="line"><span class="cl">reposdir=[包含 .repo 文件的目录的绝对路径] # 默认是 /etc/yum.repos.d/ 低下的 xx.repo后缀文件
</span></span><span class="line"><span class="cl"># exclude 排除某些软件在升级名单之外，可以用通配符，列表中各个项目要用空格隔开，这个对于安装了诸如美化包，中文补丁的朋友特别有用。
</span></span><span class="line"><span class="cl">exclude=xxx
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第二部分repoitory">第二部分repoitory<a hidden class="anchor" aria-hidden="true" href="#第二部分repoitory">¶</a></h3>
<p>repoitory部分定义了每个源/服务器的具体配置，可以有一到多个，位于/etc/yum.repos.d/目录下的各文件中。这个字段其实也可以在yum.conf里面直接配置</p>
<p>repo文件的格式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># serverid用于区别各个不同的repository，必须有一个独一无二的名称。 重复了前面覆盖后面--还是反过来呢？？？用enabled 测试是后面覆盖前面</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>serverid<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># name是对repository的描述，支持像$releasever $basearch这样的变量; name=Fedora Core $releasever - $basearch - Released Updates</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>Some name <span class="k">for</span> this server
</span></span><span class="line"><span class="cl"><span class="c1"># baseurl是服务器设置中最重要的部分，只有设置正确，才能从上面获取软件。它的格式是：</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 其中url支持的协议有 http:// ftp:// file://三种。baseurl后可以跟多个url，你可以自己改为速度比较快的镜像站，但baseurl只能有一个，也就是说不能像如下格式：</span>
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>url://server1/path/to/repository/
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>url://server2/path/to/repository/
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>url://server3/path/to/repository/
</span></span><span class="line"><span class="cl">其中url指向的目录必须是这个repository header目录的上一级，它也支持<span class="nv">$releasever</span> <span class="nv">$basearch这样的变量</span>。
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>url://path/to/repository/
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>url://server1/path/to/repository/
</span></span><span class="line"><span class="cl">url://server2/path/to/repository/
</span></span><span class="line"><span class="cl">url://server3/path/to/repository/
</span></span><span class="line"><span class="cl"><span class="c1"># 这一行是指定一个镜像服务器的地址列表，通常是开启的，本例中加了注释符号禁用了，我们可以试试，将$releasever和$basearch替换成自己对应的版本和架构，例如10和i386，在浏览器中打开，我们就能看到一长串镜可用的镜像服务器地址列表。</span>
</span></span><span class="line"><span class="cl"><span class="nv">mirrorlist</span><span class="o">=</span>http://mirrors.fedoraproject.org/mirrorlist?repo<span class="o">=</span>fedora-<span class="nv">$releasever</span><span class="p">&amp;</span><span class="nv">arch</span><span class="o">=</span><span class="nv">$basearch</span>
</span></span><span class="line"><span class="cl">url之后可以加上多个选项，如gpgcheck、exclude、failovermethod等，比如：
</span></span><span class="line"><span class="cl"><span class="c1"># 其中gpgcheck，exclude的含义和[main]部分相同，但只对此服务器起作用</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">exclude</span><span class="o">=</span>gaim
</span></span><span class="line"><span class="cl"><span class="c1"># failovermethode 有两个选项roundrobin和priority，意思分别是有多个url可供选择时，yum选择的次序，roundrobin是随机选择，如果连接失 败则使用下一个，依次循环，priority则根据url的次序从第一个开始。如果不指明，默认是roundrobin。</span>
</span></span><span class="line"><span class="cl"><span class="nv">failovermethod</span><span class="o">=</span>priority
</span></span><span class="line"><span class="cl"><span class="c1"># 当某个软件仓库被配置成 enabled=0 时，yum 在安装或升级软件包时不会将该仓库做为软件包提供源。使用这个选项，可以启用或禁用软件仓库。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 通过 yum 的 --enablerepo=[repo_name] 和 --disablerepo=[repo_name] 选项，或者通过 PackageKit 的&#34;添加/删除软件&#34;工具，也能够方便地启用和禁用指定的软件仓库</span>
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=[</span><span class="m">1</span> or 0<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>变量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$releasever，发行版的版本，从[main]部分的distroverpkg获取，如果没有，则根据redhat-release包进行判断。
</span></span><span class="line"><span class="cl">$arch，cpu体系，如i686,athlon等
</span></span><span class="line"><span class="cl">$basearch，cpu的基本体系组，如i686和athlon同属i386，alpha和alphaev6同属alpha。
</span></span></code></pre></td></tr></table>
</div>
</div>

    
    


<div class="copyrightBlock" >
    <div class="articleSuffix-bg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <p>链接：<a href="https://www.oomkill.com/2016/12/fpm/" target="_blank">https://www.oomkill.com/2016/12/fpm/</a></p>
    <p style="margin-bottom: 0px;">版权：本作品采用<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">「署名-非商业性使用-相同方式共享 4.0 国际」</a> 许可协议进行许可。</p>
    </div>
</div>
  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://www.oomkill.com/2017/01/lvs-and-keepalived/">
    <span class="title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline>
      </polyline></svg>&nbsp; </span>
    
    <span>LVS &amp; keepalived 集群架构</span>
  </a>
  <a class="next" href="https://www.oomkill.com/2016/11/heartbeat/" >
    <span class="title"> </span>
    
    <span>heartbeat权威指南&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg></span>
  </a>
</nav>

  </footer>

  
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
  </div>
  
  
  
  
    <div class="comments-separator"></div>
    

<h3>相关阅读</h3>
<ul>
	
	<li><a href="/2016/10/ch1-iptables-introduction/">ch1 iptables介绍</a></li>
	
	<li><a href="/2016/10/ch2-iptables-command/">ch2 iptables命令帮助信息</a></li>
	
	<li><a href="/2016/10/ch3-iptables-configuration/">ch3 iptables配置防火墙</a></li>
	
	<li><a href="/2016/10/ch4-iptables-p/">ch4 生产环境如何维护iptables</a></li>
	
	<li><a href="/2016/10/ch5-iptables-nat/">ch5 配置网关及服务器地址映射</a></li>
	
</ul>

  

  
    
      <div class="comments-separator"></div>
<div class="comments">
    <script>
    function loadComment() {
        let theme = localStorage.getItem('pref-theme') === 'dark' ? 'dark' : 'light';
        let s = document.createElement('script');
        s.src = 'https://giscus.app/client.js';
        s.setAttribute('data-repo', 'cylonchau\/cylonchau.github.io');
        s.setAttribute('data-repo-id', 'R_kgDOIRlNSQ');
        s.setAttribute('data-category', 'Announcements');
        s.setAttribute('data-category-id', 'DIC_kwDOIRlNSc4CXy1U');
        s.setAttribute('data-mapping', 'title');
        s.setAttribute('data-reactions-enabled', '1');
        s.setAttribute('data-emit-metadata', '1');
        s.setAttribute('data-input-position', 'top');
        s.setAttribute('data-lang', 'zh-TW');
        s.setAttribute('data-theme', theme);
        s.setAttribute('crossorigin', 'anonymous');
        s.setAttribute('async', '');
        document.querySelector('div.comments').innerHTML = '';
        document.querySelector('div.comments').appendChild(s);
    }
    loadComment();
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
  <p>
  Copyright
  <span>&copy; 2024 <a href="https://www.oomkill.com">Cylon&#39;s Collection</a></span></p>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> on github-page & Theme
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

<script>
  document.addEventListener('scroll', function (e) {
      const readProgress = document.getElementById("read_progress");
      const scrollHeight = document.documentElement.scrollHeight;
      const clientHeight = document.documentElement.clientHeight;
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
  })
</script>

<script>
  var menu = document.getElementById('menu')
  if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                  behavior: "smooth"
              });
          } else {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
          }
          if (id === "top") {
              history.replaceState(null, null, " ");
          } else {
              history.pushState(null, null, `#${id}`);
          }
      });
  });
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
      } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
      }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.6.0/mermaid.min.js" crossorigin="anonymous"></script>
<script>
    mermaid.init(undefined, '.language-mermaid');
</script>
</body>

</html>
