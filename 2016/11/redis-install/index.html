<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Redis安装 | Cylon&#39;s Collection</title>
<meta name="keywords" content="redis">
<meta name="description" content="Redis安装 - Cylon&#39;s Collection">
<meta name="author" content="cylon">
<link rel="canonical" href="https://www.oomkill.com/2016/11/redis-install/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.41a8706089174fae1769fc26da4d1d354fa88083db604a95688ff58852dd9006.css" integrity="sha256-QahwYIkXT64Xafwm2k0dNU&#43;ogIPbYEqVaI/1iFLdkAY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.oomkill.com/favicon.ico">
<link rel="apple-touch-icon" href="https://www.oomkill.com/apple-touch-icon.png">

<meta name="twitter:title" content="Redis安装 | Cylon&#39;s Collection" />
<meta name="twitter:description" content="" />
<meta property="og:title" content="Redis安装 | Cylon&#39;s Collection" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.oomkill.com/2016/11/redis-install/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2016-11-23T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2022-12-14T23:00:36&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.oomkill.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Redis安装",
      "item": "https://www.oomkill.com/2016/11/redis-install/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Redis安装 | Cylon's Collection",
  "name": "Redis安装",
  "description": "",
  "keywords": [
    "redis"
  ],
  "wordCount" : "4284",
  "inLanguage": "zh",
  "datePublished": "2016-11-23T00:00:00Z",
  "dateModified": "2022-12-14T23:00:36+08:00",
  "author":{
    "@type": "Person",
    "name": "cylon"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.oomkill.com/2016/11/redis-install/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cylon's Collection",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.oomkill.com/favicon.ico"
    }
  }
}
</script><script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.oomkill.com" accesskey="h" title="Cylon&#39;s Collection (Alt + H)">Cylon&#39;s Collection</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.oomkill.com/archives/" title="归档"
                >归档
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/tags/" title="标签"
                >标签
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/search/" title="搜索 (Alt &#43; /)"data-no-instant accesskey=/
                >搜索
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/about/" title="关于"
                >关于
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header"><h1 class="post-title">Redis安装</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2016-11-23</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>Edited on 2022-12-14</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="https://www.oomkill.com/tags/databases/">databases</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>9 分钟</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul><ul>
                <li>
                    <a href="#redis%e7%9a%84%e4%bc%98%e7%82%b9" aria-label="Redis的优点">Redis的优点</a></li>
                <li>
                    <a href="#redis%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="Redis的应用场景">Redis的应用场景</a><ul>
                        
                <li>
                    <a href="#redis%e5%9c%a8%e5%be%ae%e5%8d%9a%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" aria-label="redis在微博中的应用">redis在微博中的应用</a></li>
                <li>
                    <a href="#redis%e5%9c%a8%e7%9f%ad%e4%bf%a1%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" aria-label="redis在短信中的应用">redis在短信中的应用</a></li></ul>
                </li>
                <li>
                    <a href="#redis%e7%9a%84%e6%9c%80%e4%bd%b3%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="redis的最佳应用场景">redis的最佳应用场景</a></li>
                <li>
                    <a href="#redis%e7%9a%84%e7%94%9f%e4%ba%a7%e7%bb%8f%e9%aa%8c%e6%95%99%e8%ae%ad" aria-label="redis的生产经验教训">redis的生产经验教训</a></li>
                <li>
                    <a href="#%e4%b8%9a%e5%8a%a1%e5%9c%ba%e6%99%af" aria-label="业务场景">业务场景</a></li></ul>
                    
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e9%85%8d%e7%bd%aeredis" aria-label="安装配置Redis">安装配置Redis</a><ul>
                        
                <li>
                    <a href="#%e4%b8%8b%e8%bd%bd%e5%ae%89%e8%a3%85redis" aria-label="下载安装Redis">下载安装Redis</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e5%b9%b6%e5%90%af%e5%8a%a8redis%e6%9c%8d%e5%8a%a1" aria-label="配置并启动Redis服务">配置并启动Redis服务</a><ul>
                        
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%a4%b4%e9%83%a8%e5%88%86" aria-label="文件头部分">文件头部分</a></li>
                <li>
                    <a href="#%e6%9f%a5%e7%9c%8b%e5%91%bd%e4%bb%a4%e5%b8%ae%e5%8a%a9" aria-label="查看命令帮助">查看命令帮助</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8redis%e6%9c%8d%e5%8a%a1" aria-label="启动redis服务">启动redis服务</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8%e9%94%99%e8%af%af" aria-label="启动错误">启动错误</a></li>
                <li>
                    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e6%b5%8b%e8%af%95redis%e6%9c%8d%e5%8a%a1" aria-label="客户端测试redis服务">客户端测试redis服务</a><ul>
                        
                <li>
                    <a href="#redis-cli%e5%ae%a2%e6%88%b7%e7%ab%af%e5%b8%ae%e5%8a%a9" aria-label="redis-cli客户端帮助">redis-cli客户端帮助</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8redis-cli%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9e%e6%8e%a5redis" aria-label="使用redis-cli客户端连接redis">使用redis-cli客户端连接redis</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8telnet%e8%bf%9e%e6%8e%a5redis" aria-label="使用telnet连接redis">使用telnet连接redis</a></li>
                <li>
                    <a href="#%e9%80%9a%e8%bf%87nc%e8%bf%9e%e6%8e%a5redis" aria-label="通过NC连接redis">通过NC连接redis</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b3%e9%97%adredis%e6%9c%8d%e5%8a%a1" aria-label="关闭redis服务">关闭redis服务</a></li>
                <li>
                    <a href="#php%e5%ae%89%e8%a3%85redis%e6%89%a9%e5%b1%95" aria-label="PHP安装Redis扩展">PHP安装Redis扩展</a></li></ul>
                </li>
                <li>
                    <a href="#redis%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%b3%a8%e8%a7%a3" aria-label="Redis配置文件注解">Redis配置文件注解</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    





<div class="copyrightTopBlock">
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <div class="articleSuffix-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
</div>
<br><p>Remote Dictonary Server(Redis)是一个基于key-value键值对的持久化数据库存储系统。redis和大名鼎鼎的Memcached缓存服务很像,但是redis支持的数据存储类型更丰富,包括<font style="background:#bafe01;" size=2>string(字符串)、list(链表)、set(集合)和zset(有序集合)、Hash等</font>。</p>
<p>这些数据类型都支持push/pop,add/remove及取交集、并集和差集及更丰富的操作,而且这些操作都是原子性的。在此基础上，redis支持各种不同方式的排序。与memcached缓存服务一样，为了保证效率数据都是缓存在内存中提供服务。和memcached不同的是，<font style="background:#bafe01;" size=2>redis持久化缓存服务</font>还会周期性的把更新的数据写入到磁盘以及把修改的操作记录追加到文件里记录下来，比memcached更有优势的是，<font style="background:#bafe01;" size=2>redis还支持master-slave(主从)同步</font>,这点很类似关系型数据库MySQL。</p>
<p>Redis是一个开源的、使用C语言编写、３万多行代码、支持网络、可基于内存亦可久化的日志型、Key-Value数据库，并提供多种语言的API从2010年3月15日起，Redis开发工作由VMware主持。</p>
<p>Redis的出现，再一定程度上弥补了memcached这类key-value内存缓存服务的不足,在部分场合可以对关系数据库起到很好的补充作用.redis提供了Python, Ruby, Erlang, PHP客户端，使用很方便。redis官方文档如下：http://www.redis.io/documentation</p>
<h3 id="redis的优点">Redis的优点<a hidden class="anchor" aria-hidden="true" href="#redis的优点">¶</a></h3>
<ul>
<li>与memcached不用，redis可以持久化存储数据。</li>
<li>性能很高：Redis能支持超过10w/秒的读写频率。</li>
<li>丰富的数据类型：redis支持二进制的Strings, Lists, Hashes, Sets及sorted sets等数据类型操作。</li>
<li>原子：Redis的所有操作都是原子性的,同时Redis还支持对几个操作全并后的原子性执行。</li>
<li>丰富的特性：Redis还支持publish/subscribe(发布/订阅)，通知，key过期等等特性。</li>
<li>redis支持异步主从复制。</li>
</ul>
<h3 id="redis的应用场景">Redis的应用场景<a hidden class="anchor" aria-hidden="true" href="#redis的应用场景">¶</a></h3>
<p><strong>传统的MySQL+Memcached的网站架构遇到的问题</strong>：</p>
<p>MySQL数据库实际上是适合进行海量数据存储的,加上通过Memcached将热点数据  存放到到内存cache里,达到加速数据访问的目的,绝大部分公司都曾经使用过这样的架构,但随着业务数据量的不断增加,和访问量的增长,很多问题就会暴漏出来：</p>
<ol>
<li>需要不断的对MySQL进行拆库拆表Memcached也需不断跟着扩容,扩容和维护工作占据大量开发运维时间。</li>
<li>Memcached与MySQL数据库数据一致性问题是个老大难。</li>
<li>Memcached数据命中率低或down机,会导致大量访问直接穿透到数据库,导致MySQL无法支撑访问。</li>
<li>跨机房cache同步一致性问题。</li>
</ol>
<h4 id="redis在微博中的应用">redis在微博中的应用<a hidden class="anchor" aria-hidden="true" href="#redis在微博中的应用">¶</a></h4>
<ol>
<li>计数器：微博（评论、转发、阅读、赞等）</li>
<li>用户（粉丝、关注、收藏、双向关注等）</li>
</ol>
<h4 id="redis在短信中的应用">redis在短信中的应用<a hidden class="anchor" aria-hidden="true" href="#redis在短信中的应用">¶</a></h4>
<p>发送短信后存入redis中60秒过期。</p>
<h3 id="redis的最佳应用场景">redis的最佳应用场景<a hidden class="anchor" aria-hidden="true" href="#redis的最佳应用场景">¶</a></h3>
<ol>
<li>Redis最佳试用场景是全部数据in-memory。</li>
<li>Redis更多场景是作为Memcached的替代品来使用。</li>
<li>当需要除key/value之外的更多数据类型支持时,使用Redis更合适。</li>
<li>数据比较重要，对数据一致性有一定要求的业务。</li>
<li>当存储的数据不能被剔除时,使用Redis更合适。</li>
<li>更多</li>
</ol>
<ul>
<li><font color=#2b01fe size=2>Redis作者谈Redis应用场景</font>
<a href="http://blog.nosglfan.com/html/2235.html" target="_blank"
   rel="noopener nofollow noreferrer" >http://blog.nosglfan.com/html/2235.html</a></li>
<li><font color=#2b01fe size=2>使用redis bitmap进行活跃用户统计</font>
<a href="http://blog.nosqlfun.com/html/3501.html" target="_blank"
   rel="noopener nofollow noreferrer" >http://blog.nosqlfun.com/html/3501.html</a></li>
</ul>
<p>计数、cache服务、展示最近、最热、点击率最高、活跃度最高等等条件的top list、用户最近访问记录表、relation list/Message Queue、粉丝列表</p>
<p>Key-Value Store更加注重对海量数据存取的性能、分布式、扩展性支持上，并不需要传统关系数据库的一些特征。例如：Schema事务、完整SQL查询支持等等，因此在布式环境下的性能相对于传统的关系数据库有较大的提升。</p>
<h3 id="redis的生产经验教训">redis的生产经验教训<a hidden class="anchor" aria-hidden="true" href="#redis的生产经验教训">¶</a></h3>
<ol>
<li>要进行Master-slave主从同步配置，在出现服务故障时可以切换。</li>
<li>在master禁用数据据持久化只需在slave上配置数据持久化。</li>
<li>物理内存+虚拟内存不足，这个时候dump一直死着，时间久了机器挂掉。这个情就是灾难。</li>
<li>当Redis物理内存使用超过内存总容量的3/5时就会开始比较危险了，就开始做swap，内存碎片大！</li>
<li>当达到最大内存时，会清空带有过期时间的如</li>
<li>redis与DB同步写的问题，先写DB，后写redis，因为写内存基本上没有问题。</li>
</ol>
<h3 id="业务场景">业务场景<a hidden class="anchor" aria-hidden="true" href="#业务场景">¶</a></h3>
<ol>
<li>提高了DB的可扩展性,只需要将新加的数据放到新加的服务器上就可以了。</li>
<li>提高了DB的可用性,只影响到需要访问的shard服务器上的数据的用户。</li>
<li>提高了DB的可维护性,对系统的升级和配里可以按shard一个个来搞,对服务产生的影响小。</li>
<li>小的数据库存的查询压力小,查询更快,性能更好。</li>
</ol>
<blockquote>
<p><strong>使用过程中的一些经验与教训,做个小结</strong>：</p>
</blockquote>
<ol>
<li>要进行Master-slave配置,出现服务故障时可以支持切换。</li>
<li>在master侧禁用数据持久化,只需在slave上配置数据持久化。</li>
<li>物理内存+虚拟内存不足时,这个时候dump已知死着,时间久了机器挂掉。这个情况就是灾难。</li>
<li>当Redis物理内存使用超过内存总容量的3/5时就会开始比较危险了,就开始做swap,内存碎片大。</li>
<li>当达到最大内存时,会清空带有过期时间的key,即使key未到过期时间。</li>
<li>redis与DB同步写的问题,先写DB,后写redis,因为写内存基本上没有问题。</li>
</ol>
<h2 id="安装配置redis">安装配置Redis<a hidden class="anchor" aria-hidden="true" href="#安装配置redis">¶</a></h2>
<h3 id="下载安装redis">下载安装Redis<a hidden class="anchor" aria-hidden="true" href="#下载安装redis">¶</a></h3>
<p>redis官方网站：www.redis.io</p>
<pre><code class="language-bash">make
make PREFIX=/app/redis-3.2.8 install 
</code></pre>
<p>命令执行完成后,会在/app/redis-3.2.8/bin/目录下生成5个可执行文件</p>
<pre><code class="language-bash">/app/redis-3.2.8/
└── bin
   ├── redis-benchmark #← redis性能测试工具,测试redis在你的系统及你的配置下读写性能
   ├── redis-check-aof #← 更新日志检查
   ├── redis-check-rdb 
   ├── redis-cli      #← redis命令行操作工具。当然也可用telnet根据其纯文本协议来操作
   └── redis-server   #←redis服务器的daemon启动服务
</code></pre>
<h3 id="配置并启动redis服务">配置并启动Redis服务<a hidden class="anchor" aria-hidden="true" href="#配置并启动redis服务">¶</a></h3>
<h4 id="文件头部分">文件头部分<a hidden class="anchor" aria-hidden="true" href="#文件头部分">¶</a></h4>
<p>操作命令：</p>
<pre><code class="language-bash">echo 'PATH=&quot;/app/redis/bin:$PATH&quot;' &gt;&gt;/etc/profile
. /etc/profile
</code></pre>
<h4 id="查看命令帮助">查看命令帮助<a hidden class="anchor" aria-hidden="true" href="#查看命令帮助">¶</a></h4>
<pre><code class="language-bash">Usage: ./redis-server [/path/to/redis.conf] [options]
       ./redis-server - (read config from stdin)
       ./redis-server -v or --version
       ./redis-server -h or --help
       ./redis-server --test-memory &lt;megabytes&gt; 

Examples:
       ./redis-server (run the server with default conf)
       ./redis-server /etc/redis/6379.conf
       ./redis-server --port 7777 #&lt;==指定端口
       ./redis-server --port 7777 --slaveof 127.0.0.1 8888 
       ./redis-server /etc/myredis.conf --loglevel verbose #&lt;==指定配置文件

Sentinel mode:
       ./redis-server /etc/sentinel.conf --sentinel
</code></pre>
<h3 id="启动redis服务">启动redis服务<a hidden class="anchor" aria-hidden="true" href="#启动redis服务">¶</a></h3>
<p>创建配置文件,redis的配置文件在二进制安装包解压目录下的 redis.conf</p>
<pre><code class="language-bash">mkdir /app/redis-3.2.8/conf
cp /root/tools/redis-3.2.8/redis.conf /app/redis-3.2.8/conf/
</code></pre>
<p>启动命令</p>
<pre><code class="language-bash">redis-server /app/redis-3.2.8/conf/redis.conf &amp;
</code></pre>
<h3 id="启动错误">启动错误<a hidden class="anchor" aria-hidden="true" href="#启动错误">¶</a></h3>
<pre><code class="language-bash">WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
</code></pre>
<p>原因：此参数确定了TCP连接中已完成队列(完成三次握手之后)的长度, 当然此值必须不大于Linux系统定义的/proc/sys/net/core/somaxconn值,默认是511,而Linux的默认参数值是128。当系统并发量大并且客户端速度缓慢的时候,可以将这二个参数一起参考设定。</p>
<p>暂时解决：redis.conf中 tcp backlog=128</p>
<pre><code class="language-bash">WARNING overcommit_memory is set to 0! Background save may fail under low memory condition.To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
</code></pre>
<p>原因：</p>
<p><strong>overcommit_memory参数说明</strong>：</p>
<p>设置内存分配策略（可选,根据服务器的实际情况进行设置）/proc/sys/vm/overcommit_memory可选值：0、1、2。</p>
<p>0：当用户空间请求更多的内存时，内核尝试估算出剩余可用的内存。</p>
<p>1：设这个参数值为1时，内核允许超量舒勇内存直到用完为止,主要用于科学计算。(最大限度的使用内存)</p>
<p>2：当设这个参数值为2时，内核会使用一个决不过量使用内存的算法，即系统整个内存地址空间不能超过swap+50%的RAM值，50%参数的设定是在overcommit_ratio中设定。</p>
<p><strong>解决：sysctl vm.overcommit_memory=1</strong>*</p>
<pre><code class="language-bash">WARNING you have Transparent Huge Pages (THP) support enabled in your kernel.
This will create latency and memory usage issues with Redis. 
To fix this issue run the command 
'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' 
as root, 
and add it to your /etc/rc.local in order to retain the setting after a reboot.
Redis must be restarted after THP is disabled.
</code></pre>
<p>原因</p>
<p>临时解决方法：</p>
<pre><code class="language-bash">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre>
<p>参考文档：http://blog.csdn.net/a491857321/article/details/52006376</p>
<h3 id="客户端测试redis服务">客户端测试redis服务<a hidden class="anchor" aria-hidden="true" href="#客户端测试redis服务">¶</a></h3>
<h4 id="redis-cli客户端帮助">redis-cli客户端帮助<a hidden class="anchor" aria-hidden="true" href="#redis-cli客户端帮助">¶</a></h4>
<pre><code class="language-bash">redis-cli -help
</code></pre>
<h4 id="使用redis-cli客户端连接redis">使用redis-cli客户端连接redis<a hidden class="anchor" aria-hidden="true" href="#使用redis-cli客户端连接redis">¶</a></h4>
<p><strong>指定密码 ip 端口登陆</strong></p>
<pre><code class="language-bash">redis-cli -h 10.0.0.10 -p 3307 -a '111'
Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]
  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).
  -p &lt;port&gt;          Server port (default: 6379).
  -s &lt;socket&gt;        Server socket (overrides hostname and port).
</code></pre>
<p><strong>在Linux命令行操作redis</strong></p>
<pre><code class="language-bash">$ redis-cli set zhangsan 10-10
OK
$ redis-cli get zhangsan
&quot;10-10&quot;
</code></pre>
<h4 id="使用telnet连接redis">使用telnet连接redis<a hidden class="anchor" aria-hidden="true" href="#使用telnet连接redis">¶</a></h4>
<pre><code class="language-bash">$ telnet 127.0.0.1 6379
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
get name
$2
45
</code></pre>
<h4 id="通过nc连接redis">通过NC连接redis<a hidden class="anchor" aria-hidden="true" href="#通过nc连接redis">¶</a></h4>
<pre><code class="language-bash">$ echo &quot;set three-world 刘备&quot;|nc 127.0.0.1 6379
+OK
$ echo &quot;get three-world&quot;|nc 127.0.0.1 6379
$6
刘备
</code></pre>
<h3 id="关闭redis服务">关闭redis服务<a hidden class="anchor" aria-hidden="true" href="#关闭redis服务">¶</a></h3>
<pre><code class="language-bash">redis-cli shutdown
</code></pre>
<p>通过客户端测试redis服务</p>
<h3 id="php安装redis扩展">PHP安装Redis扩展<a hidden class="anchor" aria-hidden="true" href="#php安装redis扩展">¶</a></h3>
<p><strong>源码地址</strong>：</p>
<p><a href="https://github.com/phpredis/phpredis" target="_blank"
   rel="noopener nofollow noreferrer" >https://github.com/phpredis/phpredis</a></p>
<p><a href="http://pecl.php.net/package/redis" target="_blank"
   rel="noopener nofollow noreferrer" >http://pecl.php.net/package/redis</a></p>
<p><strong>安装</strong></p>
<pre><code class="language-bash">/app/php/bin/phpize
./configure --with-php-config=/app/php/bin/php-config
</code></pre>
<p><strong>修改php.ini设置</strong></p>
<pre><code class="language-bash">extension=redis.so
</code></pre>
<p><strong>查看结果</strong></p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed//img/image-20221214204900666.png" alt="image-20221214204900666" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h2 id="redis配置文件注解">Redis配置文件注解<a hidden class="anchor" aria-hidden="true" href="#redis配置文件注解">¶</a></h2>
<pre><code class="language-bash"># 是否在后台执行,yes：后台运行；no：不是后台运行（老版本默认）
daemonize yes

# 此参数确定了TCP连接中已完成队列(完成三次握手之后)的长度, 当然此值必须不大于Linux系统定义的/proc/sys/net/core/somaxconn值,默认是511,而Linux的默认参数值是128。当系统并发量大并且客户端速度缓慢的时候,可以将这二个参数一起参考设定。该内核参数默认值一般是128,对于负载很大的服务程序来说大大的不够。一般会将它修改为2048或者更大。在/etc/sysctl.conf中添加:net.core.somaxconn = 2048,然后在终端中执行sysctl -p。
tcp-backlog 511

# 指定 redis 只接收来自于该 IP 地址的请求,如果不进行设置,那么将处理所有请求
bind 127.0.0.1

# 此参数为设置客户端空闲超过timeout,服务端会断开连接,为0则服务端不会主动断开连接,不能小于0。
timeout 0

# 指定了服务端日志的级别。级别包括：debug（很多信息,方便开发、测试）,verbose（许多有用的信息,但是没有debug级别信息多）,notice（适当的日志级别,适合生产环境）,warn（只有非常重要的信息）	
loglevel notice
# 指定了记录日志的文件。空字符串的话,日志会打印到标准输出设备。后台运行的redis标准输出是/dev/null。
logfile /var/log/redis/redis-server.log

# 注释掉&quot;save&quot;这一行配置项就可以让保存数据库功能失效
# 设置sedis进行数据库镜像的频率。
# 900秒（15分钟）内至少1个key值改变（则进行数据库保存--持久化） 
# 300秒（5分钟）内至少10个key值改变（则进行数据库保存--持久化） 
# 60秒（1分钟）内至少10000个key值改变（则进行数据库保存--持久化）
save 900 1
save 300 10
save 60 10000
</code></pre>
<p>更多配置详情：http://www.cnblogs.com/zhang-ke/p/5981108.html</p>


    
    


<div class="copyrightBlock" >
    <div class="articleSuffix-bg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <p>链接：<a href="https://www.oomkill.com/2016/11/redis-install/" target="_blank">https://www.oomkill.com/2016/11/redis-install/</a></p>
    <p style="margin-bottom: 0px;">版权：本作品采用<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">「署名-非商业性使用-相同方式共享 4.0 国际」</a> 许可协议进行许可。</p>
    </div>
</div>
  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://www.oomkill.com/2016/11/redis-security/">
    <span class="title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline>
      </polyline></svg>&nbsp; </span>
    
    <span>redis安全相关配置</span>
  </a>
  <a class="next" href="https://www.oomkill.com/2016/11/redis-subscribe-and-transaction/" >
    <span class="title"> </span>
    
    <span>redis事务与发布订阅&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg></span>
  </a>
</nav>

  </footer>

  
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
  </div>
  
  
  
  
    <div class="comments-separator"></div>
    

<h3 class="relatedContentTitle" >相关阅读</h3>
<ul class="relatedContent">
	
	<li><a href="/2016/11/redis-replication/"><span>redis主从复制工作原理</span></a></li>
	
	<li><a href="/2016/11/redis-subscribe-and-transaction/"><span>redis事务与发布订阅</span></a></li>
	
	<li><a href="/2016/11/redis-security/"><span>redis安全相关配置</span></a></li>
	
	<li><a href="/2016/11/redis-persist/"><span>redis数据持久化</span></a></li>
	
	<li><a href="/2016/11/redis-datatype/"><span>redis数据类型</span></a></li>
	
</ul>

  

  
    
      <div class="comments-separator"></div>
<div class="comments">
    <script>
    function loadComment() {
        let theme = localStorage.getItem('pref-theme') === 'dark' ? 'dark' : 'light';
        let s = document.createElement('script');
        s.src = 'https://giscus.app/client.js';
        s.setAttribute('data-repo', 'cylonchau\/cylonchau.github.io');
        s.setAttribute('data-repo-id', 'R_kgDOIRlNSQ');
        s.setAttribute('data-category', 'Announcements');
        s.setAttribute('data-category-id', 'DIC_kwDOIRlNSc4CXy1U');
        s.setAttribute('data-mapping', 'title');
        s.setAttribute('data-reactions-enabled', '1');
        s.setAttribute('data-emit-metadata', '1');
        s.setAttribute('data-input-position', 'top');
        s.setAttribute('data-lang', 'zh-TW');
        s.setAttribute('data-theme', theme);
        s.setAttribute('crossorigin', 'anonymous');
        s.setAttribute('async', '');
        document.querySelector('div.comments').innerHTML = '';
        document.querySelector('div.comments').appendChild(s);
    }
    loadComment();
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
  <p>
  Copyright
  <span>&copy; 2024 <a href="https://www.oomkill.com">Cylon&#39;s Collection</a></span></p>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> on github-page & Theme
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

<script>
  document.addEventListener('scroll', function (e) {
      const readProgress = document.getElementById("read_progress");
      const scrollHeight = document.documentElement.scrollHeight;
      const clientHeight = document.documentElement.clientHeight;
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
  })
</script>

<script>
  var menu = document.getElementById('menu')
  if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                  behavior: "smooth"
              });
          } else {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
          }
          if (id === "top") {
              history.replaceState(null, null, " ");
          } else {
              history.pushState(null, null, `#${id}`);
          }
      });
  });
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
      } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
      }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.6.0/mermaid.min.js" crossorigin="anonymous"></script>
<script>
    mermaid.init(undefined, '.language-mermaid');
</script>
</body>

</html>
