<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ch08 文件处理 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="C"><meta name=description content="文件类型 文件是指以字节的形式存储的数据源，使用C语言将文件数据以输出输出的形式处理叫做文件处理。
文件在C语言中以两种形式存在：
文本文件：文本文件是简单的文件类型，这些文件内容以 ASCII 字符格式存储信息。 二进制文件：二进制文件以 0 和 1 的二进制格式存储数据，不是人类可读的文件 文件指针 文件指针 (FILE) 是一种数据类型，是被定义在 stdio.h 中的一种结构体，包含了文件的一些信息
c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 typedef struct { // fill/empty level of buffer int level; // File status flags unsigned flags; // File descripter char fd; // ungetc char if no buffer unsigned char hold; // buffer size int bsize; // data transfer buffer unsigned char *buffer; // Current active pointer unsigned char *curp; //Temporary file indicator unsigned istemp; //Used for validity checking short token; } FILE; // This is FILE object 文件指针通常被用于处理正在访问的文件，fopen() 是用于打开文件并返回文件的 FILE 指针，而后通过文件只恨进行I/O操作。fopen() 会发生下列事件："><meta name=author content="cylon"><link rel=canonical href=http://localhost:1313/2022/09/ch08-file-handling/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/favicon.ico><link rel=mask-icon href=http://localhost:1313/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/2022/09/ch08-file-handling/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NP3JNCPR")</script><meta property="og:title" content="ch08 文件处理"><meta property="og:description" content="文件类型 文件是指以字节的形式存储的数据源，使用C语言将文件数据以输出输出的形式处理叫做文件处理。
文件在C语言中以两种形式存在：
文本文件：文本文件是简单的文件类型，这些文件内容以 ASCII 字符格式存储信息。 二进制文件：二进制文件以 0 和 1 的二进制格式存储数据，不是人类可读的文件 文件指针 文件指针 (FILE) 是一种数据类型，是被定义在 stdio.h 中的一种结构体，包含了文件的一些信息
c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 typedef struct { // fill/empty level of buffer int level; // File status flags unsigned flags; // File descripter char fd; // ungetc char if no buffer unsigned char hold; // buffer size int bsize; // data transfer buffer unsigned char *buffer; // Current active pointer unsigned char *curp; //Temporary file indicator unsigned istemp; //Used for validity checking short token; } FILE; // This is FILE object 文件指针通常被用于处理正在访问的文件，fopen() 是用于打开文件并返回文件的 FILE 指针，而后通过文件只恨进行I/O操作。fopen() 会发生下列事件："><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/2022/09/ch08-file-handling/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-28T00:00:00+00:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="ch08 文件处理"><meta name=twitter:description content="文件类型 文件是指以字节的形式存储的数据源，使用C语言将文件数据以输出输出的形式处理叫做文件处理。
文件在C语言中以两种形式存在：
文本文件：文本文件是简单的文件类型，这些文件内容以 ASCII 字符格式存储信息。 二进制文件：二进制文件以 0 和 1 的二进制格式存储数据，不是人类可读的文件 文件指针 文件指针 (FILE) 是一种数据类型，是被定义在 stdio.h 中的一种结构体，包含了文件的一些信息
c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 typedef struct { // fill/empty level of buffer int level; // File status flags unsigned flags; // File descripter char fd; // ungetc char if no buffer unsigned char hold; // buffer size int bsize; // data transfer buffer unsigned char *buffer; // Current active pointer unsigned char *curp; //Temporary file indicator unsigned istemp; //Used for validity checking short token; } FILE; // This is FILE object 文件指针通常被用于处理正在访问的文件，fopen() 是用于打开文件并返回文件的 FILE 指针，而后通过文件只恨进行I/O操作。fopen() 会发生下列事件："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"ch08 文件处理","item":"http://localhost:1313/2022/09/ch08-file-handling/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ch08 文件处理","name":"ch08 文件处理","description":"文件类型 文件是指以字节的形式存储的数据源，使用C语言将文件数据以输出输出的形式处理叫做文件处理。\n文件在C语言中以两种形式存在：\n文本文件：文本文件是简单的文件类型，这些文件内容以 ASCII 字符格式存储信息。 二进制文件：二进制文件以 0 和 1 的二进制格式存储数据，不是人类可读的文件 文件指针 文件指针 (FILE) 是一种数据类型，是被定义在 stdio.h 中的一种结构体，包含了文件的一些信息\nc 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 typedef struct { // fill/empty level of buffer int level; // File status flags unsigned flags; // File descripter char fd; // ungetc char if no buffer unsigned char hold; // buffer size int bsize; // data transfer buffer unsigned char *buffer; // Current active pointer unsigned char *curp; //Temporary file indicator unsigned istemp; //Used for validity checking short token; } FILE; // This is FILE object 文件指针通常被用于处理正在访问的文件，fopen() 是用于打开文件并返回文件的 FILE 指针，而后通过文件只恨进行I/O操作。fopen() 会发生下列事件：","keywords":["C"],"articleBody":"文件类型 文件是指以字节的形式存储的数据源，使用C语言将文件数据以输出输出的形式处理叫做文件处理。\n文件在C语言中以两种形式存在：\n文本文件：文本文件是简单的文件类型，这些文件内容以 ASCII 字符格式存储信息。 二进制文件：二进制文件以 0 和 1 的二进制格式存储数据，不是人类可读的文件 文件指针 文件指针 (FILE) 是一种数据类型，是被定义在 stdio.h 中的一种结构体，包含了文件的一些信息\nc 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 typedef struct { // fill/empty level of buffer int level; // File status flags unsigned flags; // File descripter char fd; // ungetc char if no buffer unsigned char hold; // buffer size int bsize; // data transfer buffer unsigned char *buffer; // Current active pointer unsigned char *curp; //Temporary file indicator unsigned istemp; //Used for validity checking short token; } FILE; // This is FILE object 文件指针通常被用于处理正在访问的文件，fopen() 是用于打开文件并返回文件的 FILE 指针，而后通过文件只恨进行I/O操作。fopen() 会发生下列事件：\n文件的内容被加载到缓冲区（操作系统层面） 在内存中创建 FILE 的数据结构体，并返回这个结构体指针 文件处理函数 函数 功能 fopen() 打开现有文件或新文件 fprintf() 将数据写入打开的文件 fscanf() 读取文件中数据 fputc() 向文件写入一个字符 fgetc() 从文件中读取一个字符 fclose() 关闭打开的文件 fseek() 设置文件指针的位置 fputw() 将一个整数写入到文件 fgetw() 从文件中读取一个整数 ftell() 文件指针的当前位置 rewind() 设置文件指针位置为初始位置 fread() 读取文件内容（二进制与文本） fwrite() 向文件写入内容（二进制与文本） feof() 是否到达文件结尾\n非0 True 到达文件结尾\n0 False 没有到达文件结尾 fscanf VS fgets fscanf读取的是字符，fgets读取的是字符串 fgets读取换行符结束，fscanf读取到空白就结束，不用换行符 fgets以行为单位，fscanf以字符为单位（参数2匹配的模式） fscanf每次会判断是否匹配，如不匹配则提前退出读取 c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #include #include void main() {\tFILE *fp; fp = fopen(\"./k8s restart.txt\", \"r\"); if (fp == NULL) { printf(\"Error! opening file\"); exit(1); } char buf[1024]; while( feof(fp) == 0 ){ printf(\"i=%d\\n\", i); // fscanf(fp, \"%s\", \u0026buf); fgets(buf, 1024, fp); printf(\"%s\\n\", buf); } fclose(fp); } 文件的打开模式 模式 含义 当文件不存在时处理方法 r 只读方式打开文件 当文件路径不存在时fopen()返回NULL rb 以只读方式打开二进制文件 当文件路径不存在时fopen()返回NULL w 写入方式 如果文件存在则覆盖，如果不存在则创建新文件 wb 写入方式（二进制模式） 如果文件存在则覆盖，如果不存在则创建新文件 a 打开文件并向结尾追加内容 如果文件路径不存在则创建新文件 ab 打开文件并向结尾追加内容（二进制模式） 如果文件路径不存在则创建新文件 r+ 读写方式打开文件 当文件路径不存在时fopen()返回NULL rb+ 读写方式打开文件（二进制模式） 当文件路径不存在时fopen()返回NULL w+ 读写方式打开文件 如果文件存在则覆盖，如果不存在则创建新文件 wb+ 读写方式打开文件（二进制模式） 如果文件存在则覆盖，如果不存在则创建新文件 a+ 追加和读取 如果文件路径不存在则创建新文件 ab+ 追加和读取（二进制模式） 如果文件路径不存在则创建新文件 文件操作的步骤 打开文件 fopen() （ FILE *Pointer）\n读写文件 fputc , fgetc, fputs, fgets, fread, fwrite ….\n关闭文件 fclose()\n打开文件 c 1 2 FILE * ptr ptr = fopen(\"file dir\",\"mode\"); 例如\nc 1 fopen(\"/etc/hosts\",\"rb\"); 关闭文件 c 1 fclose(fptr); 读/写文件 向文本文件中写入数据\nc 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #include #include int main() { int num; FILE *fptr; fptr = fopen(\"~/1.txt\",\"w\"); if(fptr == NULL) { printf(\"Error!\"); exit(1); } printf(\"Enter num: \"); scanf(\"%d\",\u0026num); fputc(str[i], fptr); // fputc向文件写入数据 fputs(\"fputs向文件写入数据\\n\", fptr); fprintf(fptr, \"fprintf向文件写入数据\\n\"); fclose(fptr); return 0; } 从文本文件中读取内容\nc 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include #include int main() { int num; FILE *fptr; if ((fptr = fopen(\"~/1.txt\",\"r\")) == NULL){ printf(\"Error! opening file\"); exit(1); } fscanf(fptr,\"%d\", \u0026num); printf(\"Value of n=%d\", num); fclose(fptr); return 0; } 写入二进制文件 二进制文件的读取使用，fwrite()/fread()函数，通常情况下二进制文件读取没有意义，只是做类似文件拷贝的操作。\nfwrite(addressData, sizeData, numbersData, pointerToFile);\naddressData：写入磁盘的数据的地址 sizeData：要写入磁盘的数据大小 numbersData：写出的数据个数 pointerToFile：FILE指针 return： 成功：参数3的大小 失败：0 Notes：通常参数2为1，参数3为写入的总大小。 参2 * 参3 = 写入的总大小\nc 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include #include struct threeNum { int n1, n2, n3; }; int main() { int n; struct threeNum num; FILE *fptr; if ((fptr = fopen(\"C:\\\\program.bin\",\"wb\")) == NULL){ printf(\"Error! opening file\"); // Program exits if the file pointer returns NULL. exit(1); } for(n = 1; n \u003c 5; ++n) { num.n1 = n; num.n2 = 5*n; num.n3 = 5*n + 1; fwrite(\u0026num, sizeof(struct threeNum), 1, fptr); } fclose(fptr); return 0; } 从二进制文件读取数据 fread(addressData, sizeData, numbersData, pointerToFile);：\naddressData：读取到的数据存储的位置 sizeData：一次读取的字节数 numbersData：读取次数 pointerToFile：文件指针 return： 成功：参数3的大小 失败：0 到达文件结尾：feof(fp)为真 c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #include #include struct threeNum { int n1, n2, n3; }; int main() { int n; struct threeNum num; FILE *fptr; if ((fptr = fopen(\"C:\\\\program.bin\",\"rb\")) == NULL){ printf(\"Error! opening file\"); // Program exits if the file pointer returns NULL. exit(1); } for(n = 1; n \u003c 5; ++n) { fread(\u0026num, sizeof(struct threeNum), 1, fptr); printf(\"n1: %d\\tn2: %d\\tn3: %d\\n\", num.n1, num.n2, num.n3); } fclose(fptr); return 0; } 缓冲区 缓冲区是操作系统的内存空间中的一部分。操作系统在内存空间中预留了一定的存储空间，在输入或输出达到一定量后进行I/O操作，这部分空间就叫做缓冲区。\n程序在启动时，预定义了三种缓冲区，不需要显式开启：\n标准输入 (stdin)： 标准输出 (stdout)： 标准错误 (stderr)：标准错误是一个无缓冲 stdio.h 库中提供了三种缓冲模式 [1]：\n无缓冲 (unbuffered)：写入到无缓冲的数据会立即被写入到文件 行缓冲 (line buffered)：当遇到换行符，此类缓冲区内容会被写入到文件 全缓冲 (fully buffered)：缓冲区满或以任意大小的块被写入到文件 可以通过库函数setvbuf(), setbuffer(), setbuf() 三者之一设置 stdio 的缓冲模式，例如\nc 1 2 3 4 5 6 7 #define BUF_SIZE 4096 static char buf[BUF_SIZE]; FILE *fp; fp = fopen(\"test.txt\", 'w'); if(setvbuf(fp, buf, _IOFBF, BUF_SIZE) !=0 ) exit(EXIT_FAILURE); 可以使用库函数 fflush() 手动刷新缓冲区 [2]，例如\nc 1 2 3 4 5 6 fp = fopen(\"test.txt\", 'w'); fputs(\"fputs向文件写入数据\\n\", fptr); fflush(fp); fputs(\"fputs向文件写入数据\\n\", fptr); fflush(fp); 如果，全缓冲模式下，缓冲区没满也没刷新，那么只有在文件关闭时， 缓冲区会被自动刷新（写入到文件）\nTips：内存的隐式回收：关闭文件、刷新缓冲区、释放malloc\nReference [1] IO cache\n[2] Controlling Buffering\n","wordCount":"739","inLanguage":"zh","datePublished":"2022-09-28T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/2022/09/ch08-file-handling/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/><img src=http://localhost:1313/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives><span>归档</span></a></li><li><a href=http://localhost:1313/tags><span>标签</span></a></li><li><a href=http://localhost:1313/search><span>搜索</span></a></li><li><a href=http://localhost:1313/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ch08 文件处理</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2022-09-28</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>739 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>4 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=http://localhost:1313/tags/c/>#C</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b aria-label=文件类型>文件类型</a><li><a href=#%e6%96%87%e4%bb%b6%e6%8c%87%e9%92%88 aria-label=文件指针>文件指针</a><li><a href=#%e6%96%87%e4%bb%b6%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0 aria-label=文件处理函数>文件处理函数</a><ul><li><a href=#fscanf-vs-fgets aria-label="fscanf VS fgets">fscanf VS fgets</a><li><a href=#%e6%96%87%e4%bb%b6%e7%9a%84%e6%89%93%e5%bc%80%e6%a8%a1%e5%bc%8f aria-label=文件的打开模式>文件的打开模式</a></ul><li><a href=#%e6%96%87%e4%bb%b6%e6%93%8d%e4%bd%9c%e7%9a%84%e6%ad%a5%e9%aa%a4 aria-label=文件操作的步骤>文件操作的步骤</a><ul><li><a href=#%e6%89%93%e5%bc%80%e6%96%87%e4%bb%b6 aria-label=打开文件>打开文件</a><li><a href=#%e5%85%b3%e9%97%ad%e6%96%87%e4%bb%b6 aria-label=关闭文件>关闭文件</a><li><a href=#%e8%af%bb%e5%86%99%e6%96%87%e4%bb%b6 aria-label=读/写文件>读/写文件</a><li><a href=#%e5%86%99%e5%85%a5%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6 aria-label=写入二进制文件>写入二进制文件</a><li><a href=#%e4%bb%8e%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96%e6%95%b0%e6%8d%ae aria-label=从二进制文件读取数据>从二进制文件读取数据</a></ul><li><a href=#%e7%bc%93%e5%86%b2%e5%8c%ba aria-label=缓冲区>缓冲区</a><li><a href=#reference aria-label=Reference>Reference</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=文件类型>文件类型<a hidden class=anchor aria-hidden=true href=#文件类型>#</a></h2><p>文件是指以字节的形式存储的数据源，使用C语言将文件数据以输出输出的形式处理叫做文件处理。</p><p>文件在C语言中以两种形式存在：</p><ul><li>文本文件：文本文件是简单的文件类型，这些文件内容以 ASCII 字符格式存储信息。</li><li>二进制文件：二进制文件以 0 和 1 的二进制格式存储数据，不是人类可读的文件</li></ul><h2 id=文件指针>文件指针<a hidden class=anchor aria-hidden=true href=#文件指针>#</a></h2><p>文件指针 (<code>FILE</code>) 是一种数据类型，是被定义在 <code>stdio.h</code> 中的一种结构体，包含了文件的一些信息</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// fill/empty level of buffer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span>    <span class=n>level</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// File status flags
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=n>flags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// File descripter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=n>fd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ungetc char if no buffer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>hold</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// buffer size
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>bsize</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// data transfer buffer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=n>buffer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Current active pointer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=n>curp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Temporary file indicator
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=n>istemp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Used for validity checking
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>short</span> <span class=n>token</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>FILE</span><span class=p>;</span> <span class=c1>// This is FILE object    
</span></span></span></code></pre></td></tr></table></div></div></div></div><p>文件指针通常被用于处理正在访问的文件，<code>fopen()</code> 是用于打开文件并返回文件的 FILE 指针，而后通过文件只恨进行I/O操作。<code>fopen()</code> 会发生下列事件：</p><ul><li>文件的内容被加载到缓冲区（操作系统层面）</li><li>在内存中创建 FILE 的数据结构体，并返回这个结构体指针</li></ul><h2 id=文件处理函数>文件处理函数<a hidden class=anchor aria-hidden=true href=#文件处理函数>#</a></h2><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>fopen()</td><td>打开现有文件或新文件</td></tr><tr><td>fprintf()</td><td>将数据写入打开的文件</td></tr><tr><td>fscanf()</td><td>读取文件中数据</td></tr><tr><td>fputc()</td><td>向文件写入一个字符</td></tr><tr><td>fgetc()</td><td>从文件中读取一个字符</td></tr><tr><td>fclose()</td><td>关闭打开的文件</td></tr><tr><td>fseek()</td><td>设置文件指针的位置</td></tr><tr><td>fputw()</td><td>将一个整数写入到文件</td></tr><tr><td>fgetw()</td><td>从文件中读取一个整数</td></tr><tr><td>ftell()</td><td>文件指针的当前位置</td></tr><tr><td>rewind()</td><td>设置文件指针位置为初始位置</td></tr><tr><td>fread()</td><td>读取文件内容（二进制与文本）</td></tr><tr><td>fwrite()</td><td>向文件写入内容（二进制与文本）</td></tr><tr><td>feof()</td><td>是否到达文件结尾<br>非0 True 到达文件结尾<br>0 False 没有到达文件结尾</td></tr></tbody></table><h3 id=fscanf-vs-fgets>fscanf VS fgets<a hidden class=anchor aria-hidden=true href=#fscanf-vs-fgets>#</a></h3><ul><li>fscanf读取的是字符，fgets读取的是字符串</li><li>fgets读取换行符结束，fscanf读取到空白就结束，不用换行符</li><li>fgets以行为单位，fscanf以字符为单位（参数2匹配的模式）</li><li>fscanf每次会判断是否匹配，如不匹配则提前退出读取</li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>	
</span></span><span class=line><span class=cl>    <span class=n>FILE</span> <span class=o>*</span><span class=n>fp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>fp</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;./k8s restart.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>fp</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error! opening file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span><span class=p>(</span> <span class=nf>feof</span><span class=p>(</span><span class=n>fp</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;i=%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// fscanf(fp, &#34;%s&#34;, &amp;buf);
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>fgets</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=mi>1024</span><span class=p>,</span> <span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>fclose</span><span class=p>(</span><span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=文件的打开模式>文件的打开模式<a hidden class=anchor aria-hidden=true href=#文件的打开模式>#</a></h3><table><thead><tr><th>模式</th><th>含义</th><th>当文件不存在时处理方法</th></tr></thead><tbody><tr><td>r</td><td>只读方式打开文件</td><td>当文件路径不存在时fopen()返回NULL</td></tr><tr><td>rb</td><td>以只读方式打开二进制文件</td><td>当文件路径不存在时fopen()返回NULL</td></tr><tr><td>w</td><td>写入方式</td><td>如果文件存在则覆盖，如果不存在则创建新文件</td></tr><tr><td>wb</td><td>写入方式（二进制模式）</td><td>如果文件存在则覆盖，如果不存在则创建新文件</td></tr><tr><td>a</td><td>打开文件并向结尾追加内容</td><td>如果文件路径不存在则创建新文件</td></tr><tr><td>ab</td><td>打开文件并向结尾追加内容（二进制模式）</td><td>如果文件路径不存在则创建新文件</td></tr><tr><td>r+</td><td>读写方式打开文件</td><td>当文件路径不存在时fopen()返回NULL</td></tr><tr><td>rb+</td><td>读写方式打开文件（二进制模式）</td><td>当文件路径不存在时fopen()返回NULL</td></tr><tr><td>w+</td><td>读写方式打开文件</td><td>如果文件存在则覆盖，如果不存在则创建新文件</td></tr><tr><td>wb+</td><td>读写方式打开文件（二进制模式）</td><td>如果文件存在则覆盖，如果不存在则创建新文件</td></tr><tr><td>a+</td><td>追加和读取</td><td>如果文件路径不存在则创建新文件</td></tr><tr><td>ab+</td><td>追加和读取（二进制模式）</td><td>如果文件路径不存在则创建新文件</td></tr></tbody></table><h2 id=文件操作的步骤>文件操作的步骤<a hidden class=anchor aria-hidden=true href=#文件操作的步骤>#</a></h2><ol><li><p>打开文件 <code>fopen()</code> （ FILE *Pointer）</p></li><li><p>读写文件 <code>fputc</code> , <code>fgetc</code>, <code>fputs</code>, <code>fgets</code>, <code>fread</code>, <code>fwrite</code> &mldr;.</p></li><li><p>关闭文件 fclose()</p></li></ol><h3 id=打开文件>打开文件<a hidden class=anchor aria-hidden=true href=#打开文件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>FILE</span> <span class=o>*</span> <span class=n>ptr</span>
</span></span><span class=line><span class=cl><span class=n>ptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;file dir&#34;</span><span class=p>,</span><span class=s>&#34;mode&#34;</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><p>例如</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;/etc/hosts&#34;</span><span class=p>,</span><span class=s>&#34;rb&#34;</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=关闭文件>关闭文件<a hidden class=anchor aria-hidden=true href=#关闭文件>#</a></h3><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=读写文件>读/写文件<a hidden class=anchor aria-hidden=true href=#读写文件>#</a></h3><p>向文本文件中写入数据</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>FILE</span> <span class=o>*</span><span class=n>fptr</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>   <span class=n>fptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;~/1.txt&#34;</span><span class=p>,</span><span class=s>&#34;w&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>if</span><span class=p>(</span><span class=n>fptr</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error!&#34;</span><span class=p>);</span>   
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>             
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter num: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>num</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>   <span class=nf>fputc</span><span class=p>(</span><span class=n>str</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>fptr</span><span class=p>);</span> <span class=c1>// fputc向文件写入数据
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=nf>fputs</span><span class=p>(</span><span class=s>&#34;fputs向文件写入数据</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nf>fprintf</span><span class=p>(</span><span class=n>fptr</span><span class=p>,</span> <span class=s>&#34;fprintf向文件写入数据</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>从文本文件中读取内容</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>FILE</span> <span class=o>*</span><span class=n>fptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>((</span><span class=n>fptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;~/1.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>       <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error! opening file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nf>fscanf</span><span class=p>(</span><span class=n>fptr</span><span class=p>,</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>num</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Value of n=%d&#34;</span><span class=p>,</span> <span class=n>num</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=写入二进制文件>写入二进制文件<a hidden class=anchor aria-hidden=true href=#写入二进制文件>#</a></h3><p>二进制文件的读取使用，<code>fwrite()</code>/<code>fread()</code>函数，通常情况下二进制文件读取没有意义，只是做类似文件拷贝的操作。</p><p><code>fwrite(addressData, sizeData, numbersData, pointerToFile);</code></p><ul><li>addressData：写入磁盘的数据的地址</li><li>sizeData：要写入磁盘的数据大小</li><li>numbersData：写出的数据个数</li><li>pointerToFile：FILE指针</li><li>return：<ul><li>成功：参数3的大小</li><li>失败：0</li></ul></li></ul><blockquote><p>Notes：通常参数2为1，参数3为写入的总大小。 参2 * 参3 = 写入的总大小</p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>threeNum</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>n1</span><span class=p>,</span> <span class=n>n2</span><span class=p>,</span> <span class=n>n3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=k>struct</span> <span class=n>threeNum</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>FILE</span> <span class=o>*</span><span class=n>fptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>((</span><span class=n>fptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;C:</span><span class=se>\\</span><span class=s>program.bin&#34;</span><span class=p>,</span><span class=s>&#34;wb&#34;</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>       <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error! opening file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=c1>// Program exits if the file pointer returns NULL.
</span></span></span><span class=line><span class=cl><span class=c1></span>       <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>for</span><span class=p>(</span><span class=n>n</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=o>++</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>num</span><span class=p>.</span><span class=n>n1</span> <span class=o>=</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>num</span><span class=p>.</span><span class=n>n2</span> <span class=o>=</span> <span class=mi>5</span><span class=o>*</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>num</span><span class=p>.</span><span class=n>n3</span> <span class=o>=</span> <span class=mi>5</span><span class=o>*</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nf>fwrite</span><span class=p>(</span><span class=o>&amp;</span><span class=n>num</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span> <span class=n>threeNum</span><span class=p>),</span> <span class=mi>1</span><span class=p>,</span> <span class=n>fptr</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=从二进制文件读取数据>从二进制文件读取数据<a hidden class=anchor aria-hidden=true href=#从二进制文件读取数据>#</a></h3><p><code>fread(addressData, sizeData, numbersData, pointerToFile);</code>：</p><ul><li>addressData：读取到的数据存储的位置</li><li>sizeData：一次读取的字节数</li><li>numbersData：读取次数</li><li>pointerToFile：文件指针</li><li>return：<ul><li>成功：参数3的大小</li><li>失败：0</li><li>到达文件结尾：feof(fp)为真</li></ul></li></ul><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>threeNum</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>n1</span><span class=p>,</span> <span class=n>n2</span><span class=p>,</span> <span class=n>n3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=k>struct</span> <span class=n>threeNum</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>FILE</span> <span class=o>*</span><span class=n>fptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>((</span><span class=n>fptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;C:</span><span class=se>\\</span><span class=s>program.bin&#34;</span><span class=p>,</span><span class=s>&#34;rb&#34;</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>       <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error! opening file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=c1>// Program exits if the file pointer returns NULL.
</span></span></span><span class=line><span class=cl><span class=c1></span>       <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>for</span><span class=p>(</span><span class=n>n</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=o>++</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>fread</span><span class=p>(</span><span class=o>&amp;</span><span class=n>num</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span> <span class=n>threeNum</span><span class=p>),</span> <span class=mi>1</span><span class=p>,</span> <span class=n>fptr</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;n1: %d</span><span class=se>\t</span><span class=s>n2: %d</span><span class=se>\t</span><span class=s>n3: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>num</span><span class=p>.</span><span class=n>n1</span><span class=p>,</span> <span class=n>num</span><span class=p>.</span><span class=n>n2</span><span class=p>,</span> <span class=n>num</span><span class=p>.</span><span class=n>n3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=缓冲区>缓冲区<a hidden class=anchor aria-hidden=true href=#缓冲区>#</a></h2><p>缓冲区是操作系统的内存空间中的一部分。操作系统在内存空间中预留了一定的存储空间，在输入或输出达到一定量后进行I/O操作，这部分空间就叫做缓冲区。</p><p>程序在启动时，预定义了三种缓冲区，不需要显式开启：</p><ul><li>标准输入 (<em><strong>stdin</strong></em>)：</li><li>标准输出 (<em><strong>stdout</strong></em>)：</li><li>标准错误 (<em><strong>stderr</strong></em>)：标准错误是一个无缓冲</li></ul><p>stdio.h 库中提供了三种缓冲模式 <sup><a href=#1>[1]</a></sup>：</p><ul><li>无缓冲 (<em><strong>unbuffered</strong></em>)：写入到无缓冲的数据会立即被写入到文件</li><li>行缓冲 (<em><strong>line buffered</strong></em>)：当遇到换行符，此类缓冲区内容会被写入到文件</li><li>全缓冲 (<em><strong>fully buffered</strong></em>)：缓冲区满或以任意大小的块被写入到文件</li></ul><p>可以通过库函数<code>setvbuf()</code>, <code>setbuffer()</code>, <code>setbuf()</code> 三者之一设置 <code>stdio</code> 的缓冲模式，例如</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define BUF_SIZE 4096
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>static</span> <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUF_SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>FILE</span> <span class=o>*</span><span class=n>fp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fp</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;test.txt&#34;</span><span class=p>,</span> <span class=sc>&#39;w&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nf>setvbuf</span><span class=p>(</span><span class=n>fp</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=n>_IOFBF</span><span class=p>,</span> <span class=n>BUF_SIZE</span><span class=p>)</span> <span class=o>!=</span><span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=n>EXIT_FAILURE</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><p>可以使用库函数 <code>fflush()</code> 手动刷新缓冲区 <sup><a href=#2>[2]</a></sup>，例如</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>c</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>fp</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;test.txt&#34;</span><span class=p>,</span> <span class=sc>&#39;w&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>fputs</span><span class=p>(</span><span class=s>&#34;fputs向文件写入数据</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>fflush</span><span class=p>(</span><span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>fputs</span><span class=p>(</span><span class=s>&#34;fputs向文件写入数据</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>fflush</span><span class=p>(</span><span class=n>fp</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><p>如果，全缓冲模式下，缓冲区没满也没刷新，那么只有在文件关闭时， 缓冲区会被自动刷新（写入到文件）</p><blockquote><p>Tips：内存的隐式回收：关闭文件、刷新缓冲区、释放malloc</p></blockquote><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><blockquote><p><sup id=1>[1]</sup> <a href=https://www.litreily.top/2018/10/25/io-cache/ target=_blank rel="noopener nofollow noreferrer">IO cache</a></p><p><sup id=2>[2]</sup> <a href=https://www.gnu.org/software/libc/manual/html_node/Controlling-Buffering.html target=_blank rel="noopener nofollow noreferrer">Controlling Buffering</a></p></blockquote></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：ch08 文件处理</p><p>文章链接：<a href=http://localhost:1313/2022/09/ch08-file-handling/ target=_blank>http://localhost:1313/2022/09/ch08-file-handling/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2022/09/ch0-ide/><span>ch0 ide</span></a></li><li><a href=/2022/09/ch01-parmeter-and-data-structrue/><span>ch01 变量和数据类型</span></a></li><li><a href=/2022/09/ch02-control-statements-and-format/><span>ch02 格式化与流程控制</span></a></li><li><a href=/2022/09/ch03-array/><span>ch03 数组</span></a></li><li><a href=/2022/09/ch04-function/><span>ch04 函数</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/c/>C</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/2022/09/ch07-composite-type/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>ch07 复合类型</span>
</a><a class=next href=http://localhost:1313/2022/08/ch10-token-bucket-algorithm/><span class=title></span>
<span>漏桶算法与令牌桶算法&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/cylonchau.github.io","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/ch08 file handling","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>