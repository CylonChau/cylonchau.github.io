<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ch13 file system | Cylon&#39;s Collection</title>
<meta name="keywords" content="文件系统, 操作系统">
<meta name="description" content="ch13 file system - Cylon&#39;s Collection">
<meta name="author" content="cylon">
<link rel="canonical" href="https://www.oomkill.com/2022/05/ch13-file-system/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.41a8706089174fae1769fc26da4d1d354fa88083db604a95688ff58852dd9006.css" integrity="sha256-QahwYIkXT64Xafwm2k0dNU&#43;ogIPbYEqVaI/1iFLdkAY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.oomkill.com/favicon.ico">
<link rel="apple-touch-icon" href="https://www.oomkill.com/apple-touch-icon.png">

<meta name="twitter:title" content="ch13 file system | Cylon&#39;s Collection" />
<meta name="twitter:description" content="" />
<meta property="og:title" content="ch13 file system | Cylon&#39;s Collection" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.oomkill.com/2022/05/ch13-file-system/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2022-05-03T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2023-03-22T23:00:36&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.oomkill.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ch13 file system",
      "item": "https://www.oomkill.com/2022/05/ch13-file-system/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ch13 file system | Cylon's Collection",
  "name": "ch13 file system",
  "description": "",
  "keywords": [
    "文件系统", "操作系统"
  ],
  "wordCount" : "7817",
  "inLanguage": "zh",
  "datePublished": "2022-05-03T00:00:00Z",
  "dateModified": "2023-03-22T23:00:36+08:00",
  "author":{
    "@type": "Person",
    "name": "cylon"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.oomkill.com/2022/05/ch13-file-system/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cylon's Collection",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.oomkill.com/favicon.ico"
    }
  }
}
</script><script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.oomkill.com" accesskey="h" title="Cylon&#39;s Collection (Alt + H)">Cylon&#39;s Collection</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.oomkill.com/archives/" title="归档"
                >归档
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/tags/" title="标签"
                >标签
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/search/" title="搜索 (Alt &#43; /)"data-no-instant accesskey=/
                >搜索
                </a>
            </li>
            <li>
                <a href="https://www.oomkill.com/about/" title="关于"
                >关于
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header"><h1 class="post-title">ch13 file system</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2022-05-03</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>Edited on 2023-03-22</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="https://www.oomkill.com/tags/os/">OS</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>16 分钟</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#overview" aria-label="Overview">Overview</a><ul>
                        
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%92%8c%e6%96%87%e4%bb%b6" aria-label="文件系统和文件">文件系统和文件</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%b1%9e%e6%80%a7" aria-label="文件属性">文件属性</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e6%8f%8f%e8%bf%b0%e7%ac%a6" aria-label="文件描述符">文件描述符</a></li>
                <li>
                    <a href="#%e7%a9%ba%e9%97%b4%e7%ae%a1%e7%90%86" aria-label="空间管理">空间管理</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6" aria-label="文件访问控制">文件访问控制</a></li>
                <li>
                    <a href="#%e7%9b%ae%e5%bd%95" aria-label="目录">目录</a><ul>
                        
                <li>
                    <a href="#%e5%8d%95%e7%ba%a7%e7%9b%ae%e5%bd%95" aria-label="单级目录">单级目录</a></li>
                <li>
                    <a href="#%e4%b8%a4%e7%ba%a7%e7%9b%ae%e5%bd%95" aria-label="两级目录">两级目录</a></li>
                <li>
                    <a href="#%e6%a0%91%e5%bd%a2%e7%9b%ae%e5%bd%95" aria-label="树形目录">树形目录</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%88%ab%e5%90%8d" aria-label="文件别名">文件别名</a><ul>
                        
                <li>
                    <a href="#%e6%97%a0%e7%8e%af%e5%9b%be%e7%9b%ae%e5%bd%95" aria-label="无环图目录">无环图目录</a></li>
                <li>
                    <a href="#%e9%80%9a%e7%94%a8%e5%9b%be%e7%9b%ae%e5%bd%95" aria-label="通用图目录">通用图目录</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%8c%82%e8%bd%bd" aria-label="文件系统挂载">文件系统挂载</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%a7%8d%e7%b1%bb" aria-label="文件系统种类">文件系统种类</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%99%9a%e6%8b%9f%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" aria-label="虚拟文件系统">虚拟文件系统</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%9d%97%e7%bc%93%e5%ad%98" aria-label="数据块缓存">数据块缓存</a></li>
                <li>
                    <a href="#%e6%89%93%e5%bc%80%e6%96%87%e4%bb%b6%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="打开文件的数据结构">打开文件的数据结构</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%88%86%e9%85%8d" aria-label="文件分配">文件分配</a><ul>
                        
                <li>
                    <a href="#%e8%bf%9e%e7%bb%ad%e5%88%86%e9%85%8d" aria-label="连续分配">连续分配</a></li>
                <li>
                    <a href="#%e9%93%be%e5%bc%8f%e5%88%86%e9%85%8d" aria-label="链式分配">链式分配</a></li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e5%88%86%e9%85%8d" aria-label="索引分配">索引分配</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%a9%ba%e9%97%b2%e7%a9%ba%e9%97%b4%e7%ae%a1%e7%90%86" aria-label="空闲空间管理">空闲空间管理</a></li>
                <li>
                    <a href="#%e5%a4%9a%e7%a3%81%e7%9b%98%e7%ae%a1%e7%90%86-raid" aria-label="多磁盘管理 RAID">多磁盘管理 RAID</a><ul>
                        
                <li>
                    <a href="#raid%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" aria-label="RAID的工作原理">RAID的工作原理</a></li>
                <li>
                    <a href="#raid-controller" aria-label="RAID Controller">RAID Controller</a></li>
                <li>
                    <a href="#raid%e7%ba%a7%e5%88%ab" aria-label="RAID级别">RAID级别</a><ul>
                        
                <li>
                    <a href="#raid0" aria-label="RAID0">RAID0</a></li>
                <li>
                    <a href="#raid1" aria-label="RAID1">RAID1</a></li>
                <li>
                    <a href="#raid5" aria-label="RAID5">RAID5</a></li>
                <li>
                    <a href="#raid-10" aria-label="RAID 10">RAID 10</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e7%a3%81%e7%9b%98%e8%b0%83%e5%ba%a6" aria-label="磁盘调度">磁盘调度</a><ul>
                        
                <li>
                    <a href="#%e7%a3%81%e7%9b%98%e8%b0%83%e5%ba%a6%e7%ae%97%e6%b3%95" aria-label="磁盘调度算法">磁盘调度算法</a><ul>
                        
                <li>
                    <a href="#fcfs" aria-label="FCFS">FCFS</a></li>
                <li>
                    <a href="#sstf" aria-label="SSTF">SSTF</a></li>
                <li>
                    <a href="#scan" aria-label="SCAN">SCAN</a></li>
                <li>
                    <a href="#c-scan" aria-label="C-SCAN">C-SCAN</a></li>
                <li>
                    <a href="#look" aria-label="LOOK">LOOK</a></li>
                <li>
                    <a href="#n-step-look-or-n-step-scan" aria-label="N-Step LOOK or N-Step-SCAN">N-Step LOOK or N-Step-SCAN</a></li>
                <li>
                    <a href="#fscan" aria-label="FSCAN">FSCAN</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    





<div class="copyrightTopBlock">
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <div class="articleSuffix-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
</div>
<br><h2 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">¶</a></h2>
<h3 id="文件系统和文件">文件系统和文件<a hidden class="anchor" aria-hidden="true" href="#文件系统和文件">¶</a></h3>
<p>文件系统: 一种用于持久性存储的系统抽象，决定了辅存中的内容如何组织与存储的抽象概念</p>
<p>文件：文件系统中的一个单元的相关数据在操作系统中的抽象，展现给用户的抽象概念</p>
<p><strong>文件系统的功能</strong>：</p>
<ul>
<li>分配文件磁盘空间
<ul>
<li>管理文件块(哪一块属于哪一个文件)</li>
<li>管理空闲空间(哪一块是空闲的)</li>
<li>分配算法(策略)</li>
</ul>
</li>
<li>管理文件集合
<ul>
<li>定位文件及其内容</li>
<li>命名：通过名字找到文件的接口</li>
<li>最常见：分层文件系统</li>
<li>文件系统类型(组织文件的不同方式)</li>
</ul>
</li>
<li>提供的便利及特征
<ul>
<li>保护：分层来保护数据安全</li>
<li>可靠性，持久性：保持文件的持久即使发生崩溃,媒体错误,攻击等</li>
</ul>
</li>
</ul>
<p><strong>为什么需要文件系统</strong>：</p>
<p>如果将文件放入一个房间中，整个房间都是堆积的文件</p>
<center><img src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/pexels-photo-6571015-1.jpg" alt="pexels-照片-6571015-1" style="zoom:40%;" /></center>
<p>有了文件系统的存在将会改变一切</p>
<center><img src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/pexels-photo-6571015-2.jpg" alt="pexels-照片-6571015-2" style="zoom:40%;" /></center>
<p>空间管理、元数据、数据加密、文件访问控制和数据完整性等等都是文件系统的职责。</p>
<h3 id="文件属性">文件属性<a hidden class="anchor" aria-hidden="true" href="#文件属性">¶</a></h3>
<p>文件具有名称和数据，还存储文件创建日期和时间、当前大小、上次修改日期等元信息。所有这些信息都称为文件系统的属性。常见的文件属性有</p>
<ul>
<li><strong>名称</strong>：它是以人类可理解的形式。</li>
<li><strong>标识符</strong>：每个文件都由文件系统中的唯一标记号标识，称为标识符。</li>
<li><strong>位置</strong>：设备上的文件位置。</li>
<li><strong>类型</strong>：支持各种类型文件的系统需要此属性。</li>
<li><strong>大小</strong>：当前文件大小的属性。</li>
<li><strong>保护</strong>：分配和控制读、写和执行文件的访问权限。</li>
<li><strong>时间、日期和安全</strong>：用于对文件的保护、安全，也用于监控</li>
</ul>
<h3 id="文件描述符">文件描述符<a hidden class="anchor" aria-hidden="true" href="#文件描述符">¶</a></h3>
<p>文件头 <code>File Header</code>；类似于Unix的 <code>inode</code>，在存储元数据中保存了每个文件的信息，保存文件的属性，跟踪哪一块存储块属于逻辑上文件结构的哪个偏移</p>
<p><strong>文件描述符</strong> （<code>file-descriptor</code>）；是唯一标识操作系统中打开文件的数字（整形），用于用户和内核空间之间的接口，以识别 文件/Socket 资源。因此，当使用 <code>open()</code> 或 <code>socket()</code>（与内核接口的系统调用）时，会得到一个文件描述符，一个整数。因此，如果直接与内核交互，使用系统调用 <code>read()</code>, <code>write()</code> 等 <code>close()</code>。使用的是一个文件描述符句柄。</p>
<p>在 C 语言中 <code>stdin</code>，<code>stdout</code>、 和 <code>stderr</code> ，在 UNIX 中分别映射到文件描述符 <code>0</code>  <code>1</code> <code>2</code></p>
<pre><code>f = open(name, flag);
...
... = read(f, ...);
...
close(f);
</code></pre>
<p>内核跟踪每个进程打开的文件：</p>
<ul>
<li>操作系统为每个进程维护一个打开文件表</li>
<li>一个打开文件描述符是这个表中的索引</li>
<li>描述符由唯一的非负整数表示，例如 0、12 或 567。系统上每个打开的文件至少存在一个文件描述符</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/file-descriptor.jpg" alt="png" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<p>如果对文件需要更好的管理，就需要元数据来管理打开文件:</p>
<ul>
<li>
<p>文件指针：指向最近的一次读写位置，每个打开了这个文件的进程都这个指针</p>
</li>
<li>
<p>文件打开计数：记录文件打开的次数； 当最后一个进程关闭了文件时，允许将其从打开文件表中移除</p>
</li>
<li>
<p>文件磁盘位置：缓存数据访问信息</p>
</li>
<li>
<p>访问权限：每个程序访问模式信息</p>
</li>
</ul>
<p><strong>从用户角度来看</strong>：文件是持久的数据结构</p>
<ul>
<li>系统访问接口:
<ul>
<li>字节的集合(UNIX)</li>
<li>系统不会关心你想存储在磁盘上的任何的数据结构</li>
</ul>
</li>
<li>操作系统内部视角：
<ul>
<li>块的集合（块是逻辑转换单元，而扇区是物理转换单元）</li>
<li>块大小&lt;&gt; 扇区大小：在UNIX中，块的大小是 4KB</li>
</ul>
</li>
</ul>
<h3 id="空间管理">空间管理<a hidden class="anchor" aria-hidden="true" href="#空间管理">¶</a></h3>
<p>在系统层面上来看，存储设备在被划分为称为<strong>扇区</strong>的固定大小的块；扇区是存储设备上的<strong>最小存储单元</strong> ，介于 512 bytes 和 4096bytes 之间；所有的操作都是操作磁盘块，读写1bytes也是对整个磁盘块的读写。</p>
<p>文件系统使用的是<strong>块</strong>，块是物理扇区的抽象</p>
<p><strong>用户怎么访问文件：在系统层面需要知道用户的访问模式</strong></p>
<ul>
<li>顺序访问：按字节依次读取
<ul>
<li>几乎所有的访问都是这种方式</li>
</ul>
</li>
<li>随机访问：从中间读写
<ul>
<li>不常用,但是仍然重要，如：虚拟内存支持文件，内存页存储在文件中；</li>
<li>更加快速，不希望获取文件中间的内容的时候也必须先获取块内所有字节</li>
</ul>
</li>
<li>内容访问：通过特征（索引）
<ul>
<li>更多是数据库形式的存在；通过index，找到包含关系的文件</li>
</ul>
</li>
</ul>
<h3 id="文件访问控制">文件访问控制<a hidden class="anchor" aria-hidden="true" href="#文件访问控制">¶</a></h3>
<p>多用户操作系统中的文件共享是很必要的，不是每个人都能够删除或修改他们没有权限的文件。</p>
<p>有关用户权限和文件所有权的数据在不同的操作系统上有不同的格式：</p>
<ul>
<li>类 Unix被存储为访问控制列表 ；<code>Access-Control List</code> <strong>（ACL）</strong></li>
<li>Windows 上被存储为访问控制条目；<code>Access-Control Entries </code> <strong>(ACE)</strong></li>
</ul>
<p>谁能够获得哪些文件的哪些访问权限</p>
<ul>
<li>访问模式: 读,写,执行,删除,列举等</li>
</ul>
<p>文件访问控制列表(ACL)：</p>
<ul>
<li>&lt;文件实体, 权限&gt;</li>
</ul>
<p>UNIX模式：</p>
<ul>
<li>&lt;用户|组|物主,读|写|可执行&gt;</li>
<li>用户ID识别用户；表明每个用户所允许的权限及保护模式</li>
<li>组ID允许用户组成组，并指定了组访问权限</li>
</ul>
<p><strong>多用户下，如何同时访问共享文件</strong>：</p>
<ul>
<li>
<p>和进程同步算法相似</p>
</li>
<li>
<p>因磁盘IO和网络延迟而设计简单</p>
</li>
<li>
<p>文件共享的一致性语义 <code>Consistency Semantics</code></p>
<ul>
<li>
<p>UNIX文件系统语义 <code>Unix Semantics</code> ：</p>
<ul>
<li>
<p>对打开文件的写入内容立即对其他打开同一文件的其他用户可见</p>
</li>
<li>
<p>共享文件指针允许多用户同时读取和写入文件</p>
</li>
</ul>
</li>
<li>
<p>会话语义 <code>Session Semantics</code>：</p>
<ul>
<li>用户对文件的写入对其他用户不可见。</li>
<li>文件关闭后，更改仅对新会话可见。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>锁:</p>
<ul>
<li>一些操作系统和文件系统提供该功能</li>
</ul>
</li>
</ul>
<h3 id="目录">目录<a hidden class="anchor" aria-hidden="true" href="#目录">¶</a></h3>
<p>目录是磁盘上的一个位置，是一种特殊的文件；用于对文件分层。文件夹和目录是可互换的术语。</p>
<p>目录的特点：</p>
<ul>
<li>
<p>目录是一类特殊的文件：每个目录都包含了一张表 <code>&lt;name, pointer to file header&gt;</code></p>
</li>
<li>
<p>目录和文件的树形结构：早期的文件系统是扁平的(只有一层目录)</p>
</li>
<li>
<p>层次名称空间：</p>
<ul>
<li><left><img src="../../images/ch13 file system/image-20220422230459824.png" alt="image-20220422230459824" style="zoom:55%;" /></left></li>
</ul>
</li>
</ul>
<p>名字解析：逻辑名字转换成物理资源（如文件）的过程:</p>
<ul>
<li>在文件系统中：到实际文件的文件名(路径)</li>
<li>遍历文件目录直到找到目标文件</li>
<li>举例：解析 <code>/bin/ls</code>
<ul>
<li>读取root的文件头(在磁盘固定位置)</li>
<li>读取root的数据块: 搜索bin项</li>
<li>读取bin的文件头</li>
<li>读取bin的数据块: 搜索ls项</li>
<li>读取ls的文件头</li>
</ul>
</li>
</ul>
<p>当前工作目录：当前目录的内容存储在内存中可以快速的指向一个目录</p>
<ul>
<li>每个进程都会指向一个文件目录用于解析文件名</li>
<li>允许用户指定相对路径来代替绝对路径</li>
</ul>
<h4 id="单级目录">单级目录<a hidden class="anchor" aria-hidden="true" href="#单级目录">¶</a></h4>
<p>单级目录 <code>Single-Level Directory</code>；单级目录理解起来比较简单，单级目录中所有文件都包含在同一目录中，必须具有唯一的名称</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/11_09_SingleLevel.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="两级目录">两级目录<a hidden class="anchor" aria-hidden="true" href="#两级目录">¶</a></h4>
<p>两级目录 <code>Two-Level Directory</code>；两级目录通常为不同用户的自己的目录 User File Director UDF，文件名只需在指定目录下唯一即可。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/11_10_TwoLevelStructure.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="树形目录">树形目录<a hidden class="anchor" aria-hidden="true" href="#树形目录">¶</a></h4>
<p>树形目录 <code>Tree-Structured Directories</code>；通常是指深度大于<strong>2</strong>的目录，在此结构中，每个文件都有一个唯一的路径</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/11_11_TreeStructure.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="文件别名">文件别名<a hidden class="anchor" aria-hidden="true" href="#文件别名">¶</a></h4>
<h5 id="无环图目录">无环图目录<a hidden class="anchor" aria-hidden="true" href="#无环图目录">¶</a></h5>
<p>无环图目录 <code>Acyclic-Graph Directories</code>；也被称作为<strong>别名</strong> <code>Alias</code>，是指在目录结构中一个文件有多个绝对位置（绝对路径）。UNIX中提供了两种类型的<strong>链接</strong>来实现该类型：</p>
<ul>
<li><strong>硬链接</strong> <code>hard link</code>：硬链接会创建新的文件，指向同一个inode；在删除一个文件时，会删除一个指向底层 inode的链接。当所有指向该 inode 的链接都被删除，inode才会被删除（同一文件系统中的普通文件）
<ul>
<li>每个文件都有引用计数器，以跟踪当前有多少文件引用该文件。每当删除其中一个引用（有别名的文件）时，计数器就会减少，当它达到零时，可以回收磁盘空间。</li>
</ul>
</li>
<li><strong>符号链接</strong> <code>symbolic link</code>；也称软连接，是一个特殊文件，包含被链接文件的信息，可以是目录或文件。
<ul>
<li>符号链接在删除或被移动时
<ul>
<li>找到所有链接并同时修改</li>
<li>符号链接悬空，<code>Dangling Pointer</code>；不在有效</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Windows中仅支持符号链接，称为快捷方式</p>
</blockquote>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/11_12_AcyclicGraph.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h5 id="通用图目录">通用图目录<a hidden class="anchor" aria-hidden="true" href="#通用图目录">¶</a></h5>
<p>通用图目录 <code>General Graph Directory</code> ；是一种允许循环的目录；上述无环目录中是会进入无限循环</p>
<p>通用图目录比其他类型目录更佳灵活，最大问题是计算大小时的难度。通用图目录实现常见的是通过线性列表或哈希表：</p>
<ul>
<li>线性列表：将所有文件保存在一个目录中，类似一个单链表。每个文件都包含一个数据块指向指针和目录中的下一个文件。
<ul>
<li><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/image-129.png" alt="操作系统中的目录结构" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></li>
</ul>
</li>
<li>哈希表：目录中对于每个文件，都会生成一个键值对，将其存入哈希表中。借助文件名的哈希函数，我们可以确定存储在目录中的各个文件 key 和其指针 <code>key points</code>
<ul>
<li><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/image-130.png" alt="操作系统中的目录结构" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></li>
</ul>
</li>
</ul>
<p>图：通用图目录结构</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/11_13_GeneralGraph.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h3 id="文件系统挂载">文件系统挂载<a hidden class="anchor" aria-hidden="true" href="#文件系统挂载">¶</a></h3>
<p>在类Unix系统中，VFS 会为每个分区或可移动存储设备分配一个<strong>设备 ID</strong> 如 <code>dev/disk1s1</code>；然后，创建一个<strong>虚拟目录树</strong> ，并将每个设备的内容作为单独的目录放在该目录树下。</p>
<p>将目录分配给存储设备的行为称为<strong>挂载</strong> <code>mount</code>，被分配的目录称为<strong>挂载点</strong></p>
<ul>
<li>一个文件系统需要先挂载才能被访问</li>
<li>一个未挂载的文件系统被挂载在挂载点上</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/11_14_MountVolumes.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h3 id="文件系统种类">文件系统种类<a hidden class="anchor" aria-hidden="true" href="#文件系统种类">¶</a></h3>
<ul>
<li>
<p>磁盘文件系统：文件存储在数据存储设备上,如磁盘; 例如: FAT，NTFS，ext2 3， ISO9660等</p>
</li>
<li>
<p>数据库文件系统：文件根据其特征是可被寻址的; 例如: WinFS</p>
</li>
<li>
<p>日志文件系统: 记录文件系统的修改,事件; 例如: journaling file system</p>
</li>
<li>
<p>网络，分布式文件系统：例如：NFS，SMB，AFS，GFS</p>
</li>
<li>
<p>虚拟文件系统</p>
</li>
</ul>
<h2 id="虚拟文件系统">虚拟文件系统<a hidden class="anchor" aria-hidden="true" href="#虚拟文件系统">¶</a></h2>
<p>虚拟文件系统 <code>Virtual File Systems</code> <strong>VFS</strong>；是对多种类型文件系统提供统一的通用API，使得在上层软件中，可以用单一的方式实现不同底层的文件系统。</p>
<p>虚拟文件系统的功能：</p>
<ul>
<li>提供相同的文件和文件系统接口</li>
<li>管理所有文件和文件系统关联的数据结构</li>
<li>高效查询例程，遍历文件系统</li>
<li>与特定文件系统模块的交互</li>
</ul>
<p>VFS除了统一的API外，还提供了唯一标识符 <code>vnode</code>；对于类UNIX操作系统中，inode是惟一的，并不会跨网络</p>
<p>Linux中虚拟文件系统的对象类型：</p>
<ul>
<li><strong>inode</strong>：代表单个文件
<ul>
<li>存储文件的元信息（许可，拥有者，大小，数据库位置等）</li>
<li>一个文件对应一个inode，每个inode都由一个inode编号唯一标识</li>
<li>一个inode通常对应于存储在磁盘上的一个文件控制块</li>
</ul>
</li>
<li><strong>file</strong>：代表一个打开的文件
<ul>
<li>存储进程和打开文件之间交互的信息。这个信息只存在于内核空间，不保存在磁盘上。</li>
</ul>
</li>
<li><strong>superblock</strong>：卷控制块代表一个文件系统
<ul>
<li>每个文件系统一个</li>
<li>文件系统详细信息</li>
<li>块，块大小，空余块，计数，指针等</li>
</ul>
</li>
<li><strong>dentry</strong>：代表目录项 <code>dirctory entry</code>
<ul>
<li>用于将一个inode（文件）与一个目录关联</li>
<li>将目录项数据结构及树形布局编码成树形数据结构</li>
<li>指向文件控制块，父节点，项目列表等</li>
</ul>
</li>
</ul>
<h2 id="数据块缓存">数据块缓存<a hidden class="anchor" aria-hidden="true" href="#数据块缓存">¶</a></h2>
<h2 id="打开文件的数据结构">打开文件的数据结构<a hidden class="anchor" aria-hidden="true" href="#打开文件的数据结构">¶</a></h2>
<center><img src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/12_03_FileSystemStructures.jpg" alt="img" style="zoom:90%;" /></center>
<center>内存中文件系统结构。(a) 文件打开 &nbsp;&nbsp;&nbsp;(b) 文件读取</center>
<p>由图可知，当一个文件在程序中被访问时（创建、打开），<code>open()</code> 系统调用从磁盘读入FCB信息，并将其存储在系统打开文件表中。一个条目被添加到每个进程的打开文件表中，这个索引引用的是系统范围的打开文件表，并且进程表的索引由 <code>open()</code> 这个系统调用返回。这个索引称为<strong>文件描述符</strong>， Windows中为<strong>文件句柄</strong>。</p>
<p>如果有多个进程打开同一个文件，此时系统表中的计数器会递增。对应打开文件表条目会引用到系统表中</p>
<p>文件被关闭时，每个进程的打开文件表的条目被释放，系统表中的计数器递减。如果计数器到零，则系统表也被释放。</p>
<p><strong>打开文件描述</strong>：</p>
<ul>
<li>
<p>每个被打开的文件一个</p>
</li>
<li>
<p>文件状态信息</p>
</li>
<li>
<p>FCB：目录项，当前文件指针，文件操作设置等</p>
</li>
</ul>
<p><strong>打开文件表</strong>：</p>
<ul>
<li>
<p>一个进程一个</p>
</li>
<li>
<p>一个系统级的</p>
</li>
<li>
<p>每个卷控制块也会保存一个列表</p>
</li>
<li>
<p>所以如果有文件被打开将不能被卸载</p>
</li>
<li>
<p>一些操作系统和文件系统提供该功能</p>
</li>
</ul>
<p><strong>调节对文件的访问</strong></p>
<ul>
<li>强制 - 根据锁保持情况和需求拒绝访问</li>
<li>劝告 - 进程可以查找锁的状态来决定怎么做</li>
</ul>
<h2 id="文件分配">文件分配<a hidden class="anchor" aria-hidden="true" href="#文件分配">¶</a></h2>
<p>在文件分配中，存在一些问题</p>
<p>大多数文件很小</p>
<ul>
<li>需要对小文件支持</li>
<li>块的空间不能设置太小</li>
</ul>
<p>一些文件却很大</p>
<ul>
<li>必须支持大文件</li>
<li>大文件需要高效访问</li>
</ul>
<p>磁盘的分配主要有三种方式：连续 <code>contiguous</code>、链式 <code>linked</code> 、索引 <code>indexed</code> ；分配指标必须遵循 高效的存储利用，与访问速度的表现</p>
<h3 id="连续分配">连续分配<a hidden class="anchor" aria-hidden="true" href="#连续分配">¶</a></h3>
<p>连续分配  （<code>Contiguous Allocation</code>）是指文件的所有块连续地保存在一起</p>
<p>连续分配的特点：</p>
<ul>
<li>
<p>只需要一个起始块，与长度</p>
</li>
<li>
<p>性能非常快，读取同一文件的连续块不需要移动磁头；或仅需要移动一小块到达相邻柱面</p>
</li>
</ul>
<p>连续分配存在的问题：固定递归存储时不会出现问题，当文件增长或创建时文件的确切大小未知，会出现问题：</p>
<ul>
<li>
<p>碎片：</p>
<ul>
<li>
<p>过高估计文件最终的大小会增加外部碎片从而浪费浪费磁盘空间</p>
</li>
<li>
<p>文件增长超出其最初分配的空间，过低预估则可能需要移动文件位置或中止进程</p>
</li>
</ul>
</li>
<li>
<p>文件增长问题：</p>
<ul>
<li>如果一个文件初始分配大小很大，并长期没有写入，在文件填满时，很多空间将变得不可用</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/12_05_ContiguousAllocation.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h3 id="链式分配">链式分配<a hidden class="anchor" aria-hidden="true" href="#链式分配">¶</a></h3>
<p>链式分配（ <code>Linked Allocation</code> ）是指文件按照数据链表方式存储，并以每个链接消耗的存储空间为代价</p>
<p>链式分配的特点：</p>
<ul>
<li>无外部碎片，无需预先知道文件大小，并支持文件的动态增长</li>
</ul>
<p>链式分配的不足：</p>
<ul>
<li>无法实现高效的随机访问；链式访问仅可以串行访问文件，必须从每个位置的列表头开始</li>
<li>可靠性：指针丢失或损坏</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/12_06_LinkedAllocation.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h3 id="索引分配">索引分配<a hidden class="anchor" aria-hidden="true" href="#索引分配">¶</a></h3>
<p>索引分配（<code>Indexed Allocation</code>）是指将每个文件的索引组合在一个公共块上，每个索引项指向了一个数据块</p>
<p>索引分配的特点：基本包含链式分配和连续分配的所有优点</p>
<p>索引分配的不足：会浪费一部分磁盘空间</p>
<ul>
<li>无论文件大小，存储索引都有一定开销（文件大小&lt;索引大小）</li>
<li>单个索引块不能保存大文件的所有指针</li>
</ul>
<p>对于单个索引块不能保存大文件的所有指针这个问题，一般情况下有下述解决方案</p>
<ul>
<li>链式索引块模式 <code>Linked Scheme</code>：索引块为一个磁盘块，第一个索引块包含一些头信息、前 N 个块地址；还包含指向其他链接索引块的指针</li>
<li>多级索引 <code>Multi-Level Index</code>：类似于多级页表，第一个索引块包含一组指向二级索引块的指针，而二级索引块又包含指向实际数据块的指针</li>
<li>联合模式 <code>Combined Scheme</code>：</li>
</ul>
<center><img src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/12_08_IndexedAllocation.jpg" alt="img" style="zoom:80%;" /></center>
<center>图：索引分配</center>
<center><img src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/chp11_11.png" alt="Figure 11.11" style="zoom:80%;" /></center>
<center>图：多级索引</center>
<blockquote>
<p>Reference</p>
<p><a href="https://www.cs.uct.ac.za/mit_notes/database/htmls/chp11.html#multilevel-indexes" target="_blank"
   rel="noopener nofollow noreferrer" >multilevel-indexes</a></p>
</blockquote>
<h2 id="空闲空间管理">空闲空间管理<a hidden class="anchor" aria-hidden="true" href="#空闲空间管理">¶</a></h2>
<p>空闲空间管理只是磁盘管理中，需要追踪和分配对空闲空间部分的管理，对于空闲空间的管理的表现是位图 <code>bitmap</code>；即通过位向量来标记数据块的使用情况</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/image-20220425184448442.png" alt="image-20220425184448442" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<p><strong>其他管理空闲空间的方式</strong>：</p>
<ul>
<li>链表：链表也可以作为管理空闲块的一种方式</li>
<li>分组：将空闲块存储在第一个空闲块中，前 <code>n-1</code> 个空闲块是空闲的，最后一个包含下一个分组</li>
<li>计数：存储一个磁盘块的地址和之后n个空闲块的数量</li>
</ul>
<blockquote>
<p>Reference</p>
<p><a href="https://testbook.com/objective-questions/mcq-on-free-space-management--5eea6a1439140f30f369f304" target="_blank"
   rel="noopener nofollow noreferrer" >一些空闲空间管理的测试题</a></p>
</blockquote>
<h2 id="多磁盘管理-raid">多磁盘管理 RAID<a hidden class="anchor" aria-hidden="true" href="#多磁盘管理-raid">¶</a></h2>
<p>冗余磁盘阵列 **RAID **（<code>redundant array of independent disks</code>）；是一种小磁盘分区组成大分区的一种解决方案，一种磁盘管理技术</p>
<h3 id="raid的工作原理">RAID的工作原理<a hidden class="anchor" aria-hidden="true" href="#raid的工作原理">¶</a></h3>
<p>RAID 的工作原理是将数据分别放置在多个磁盘上，并允许I/O操作以平衡的方式，从而提高磁盘性能</p>
<h3 id="raid-controller">RAID Controller<a hidden class="anchor" aria-hidden="true" href="#raid-controller">¶</a></h3>
<p>RAID 控制器是用于管理存储阵列中的硬盘驱动器的设备，是操作系统和物理磁盘中间的一个抽象层，将磁盘表示为逻辑单元。</p>
<p>RAID控制器分为软RAID和硬RAID</p>
<ul>
<li>硬RAID <code>Hardware RAID</code>：物理控制器管理整个磁盘阵列；如主板或RAID卡</li>
<li>软RAID <code>Software RAID</code>：使用硬件资源来管理磁盘阵列；如CPU、内存；软RAID可能无法实现性能提升，反而影响性能</li>
</ul>
<h3 id="raid级别">RAID级别<a hidden class="anchor" aria-hidden="true" href="#raid级别">¶</a></h3>
<h4 id="raid0">RAID0<a hidden class="anchor" aria-hidden="true" href="#raid0">¶</a></h4>
<p>RAID0（无容错的条带化磁盘阵列），是将数据体划分为块并将数据块分布在独立磁盘冗余阵列中的多个存储设备中，但不提供容错。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/8b11.png" alt="RAID 0" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="raid1">RAID1<a hidden class="anchor" aria-hidden="true" href="#raid1">¶</a></h4>
<p>RAID1又称为磁盘镜像 <code>mirroring</code>，将数据复制到两个或更多磁盘，由至少两个数据存储驱动器组成，读性能提升，写性能与单磁盘相同。RAID1提供了全面的数据保护</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/8b111.png" alt="RAID 1" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="raid5">RAID5<a hidden class="anchor" aria-hidden="true" href="#raid5">¶</a></h4>
<p>RAID0（基于奇偶校验块的条带化磁盘阵列）；它使用类似于 RAID0 的分布式数据存储，但通过包含写入不同阵列磁盘的冗余信息（奇偶校验码）来提高数据存储的可靠性。RAID 5 至少需要三个磁盘，但出于性能原因，通常建议使用至少五个磁盘。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/8b115.png" alt="RAID 5" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="raid-10">RAID 10<a hidden class="anchor" aria-hidden="true" href="#raid-10">¶</a></h4>
<p>RAID 0+1是结合 RAID 1 和 RAID 0的一种模式，通常称为 RAID 10；RAID10需要至少四个磁盘；通过跨镜像的条带化保存数据，只要每个镜像对中的一个磁盘正常，那么数据就正常</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/raid10-165089735841849.png" alt="raid10" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h2 id="磁盘调度">磁盘调度<a hidden class="anchor" aria-hidden="true" href="#磁盘调度">¶</a></h2>
<p>磁盘调度是指在操作系统层面重新组织IO请求的顺序，来有效的减少磁盘访问开销。</p>
<p>在传统磁盘中由多个盘面组成，每个盘面被臂组件上的磁盘头来通过旋转读取，通过所希望的扇区开始</p>
<img src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/10_01_DiskMechanism.jpg" alt="img" style="zoom:80%;" />
<p>在操作中，磁盘会告诉旋转例如 7200RPM（<code>revolutions per minute</code>）（实际读写速度120 MB/s ）。数据从磁盘传输到计算机的速率由几个步骤组成：</p>
<ul>
<li>寻道时间 <code>seek time</code>：是将磁头从一个柱面移动到另一个柱面所需的时间，以及磁头在移动后稳定下来所需的时间。是过程中最慢的步骤，也是整体传输速率的主要瓶颈。</li>
<li>旋转延迟 <code>rotational latency</code>：扇区从开始处到目的处所需时间</li>
<li>传输速率 <code>transfer rate</code>：数据从磁盘移动到计算机所需的时间</li>
</ul>
<p>$access\ time=SK+RL+TR$</p>
<ul>
<li>$T_a$ access time 访问时间</li>
<li>$T_s$ seek time 寻址时间</li>
<li>$T_r$ rotational latency 旋转延迟</li>
<li>$T$ transfer time 传输速率</li>
<li>$b$  transfer b bytes 传输位</li>
<li>$N $ bytes per track 每轨存多少字节</li>
<li>$r$ Rotational speed</li>
<li>$\frac{1}{r}$ 旋转一周的时间</li>
<li>$\frac{1}{2r}$ 平均旋转延迟，旋转一周时间再取一半</li>
<li>$\frac{b}{rN}$ 数据访问时间</li>
</ul>
<p>那么 传输速率 $T = \frac{b}{rN}$</p>
<p>平均访问时间为 $T_a = T_s + \frac{1}{2r} + \frac{b}{rN}$</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/image-20220425225845651.png" alt="image-20220425225845651" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<p>如：$T_s = 2ms$，$r=10000rpm$，512B扇区大小，每轨320个扇区， 1.3 MB的文件大小</p>
<ul>
<li>
<p>转一圈的时间：RPM=10000时，每6毫秒转一圈：$\frac{1}{r} = \frac{60}{10000}=0.006s = 6ms$</p>
</li>
<li>
<p>一个文件有多少扇区：$\frac{1.3MB}{512} = \frac{1300000}{512}=2540$</p>
</li>
<li>
<p>一共多少轨道：$2540\div320=8$</p>
</li>
</ul>
<p><strong>通过磁道 <code>tracks</code> 访问需要耗时多少？</strong></p>
<ul>
<li>
<p>一个磁道要传输的数据大小：$b=512\times320$</p>
</li>
<li>
<p>每轨有多少字节：$N=512\times320$</p>
</li>
<li>
<p>$\frac{1}{r}=6$，$\frac{1}{2r} = 3$</p>
</li>
<li>
<p>$\frac{b}{rN}=6$ ；因$b=N$ 故$\frac{b}{rN}=6$</p>
</li>
<li>
<p>因 $T_s=2$，$Average T_r=3$，$\frac{b}{rN}=6$ ；那么 $T_a = T_s + \frac{1}{2r} + \frac{b}{rN}=2+3+6=11$</p>
</li>
<li>
<p>那么按轨寻址访问的总时间为：$8*11=88ms$</p>
</li>
</ul>
<p><strong>通过扇区 <code>sectors</code> 访问需要耗时多少？</strong></p>
<ul>
<li>每轨多少字节 $N=512\times320$</li>
<li>因磁轨转一圈多少时间 $\frac{1}{r} = 6$，$\frac{1}{2r} = 3$；每磁道耗时 $\frac{1}{r} = \frac{6}{320} = 0.01875ms$</li>
<li>因 $\frac{1}{r} = \frac{6}{320}$ ；$b=512$；$N=512\times320$；那么 $\frac{b}{rN}=0.01875$</li>
<li>那么一个扇区的时间为：
<ul>
<li>因 $T_s=2$，$Average T_r=3$，$\frac{b}{rN}=0.01875$
<ul>
<li>b=512，N=512，$\frac{1}{r} = 0.01875$，那么，$\frac{b}{rN}=0.01875$</li>
</ul>
</li>
<li>那么 $T_a = T_s + aT_r + \frac{n}{rN} = 2+3+0.01875 = 5.01875$</li>
<li>那么总共时间为 $2540*5.01875=12748ms$</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>那么就可以得出结论</strong>：</p>
<ul>
<li>寻道方式是性能上区别的原因
<ul>
<li>如果来回寻道，会导致性能急剧下降</li>
</ul>
</li>
<li>对单个磁盘，会有一个IO请求数目</li>
<li>如果请求是随机的，那么会表现很差</li>
</ul>
</blockquote>
<h3 id="磁盘调度算法">磁盘调度算法<a hidden class="anchor" aria-hidden="true" href="#磁盘调度算法">¶</a></h3>
<ul>
<li>
<p>磁盘传输速度主要受<strong>寻道时间</strong>和<strong>旋转延迟的限制</strong>。当要处理多个请求时，在等待其他请求被处理时也会有一些固有的延迟。</p>
</li>
<li>
<p><strong>带宽</strong>是通过传输的数据量除以从发出第一个请求到完成最后一次传输的总时间量来衡量的</p>
</li>
<li>
<p>通过以良好的顺序处理请求，可以提高带宽和访问时间。</p>
</li>
<li>
<p>磁盘请求包括磁盘地址、内存地址、要传输的扇区数以及请求是读还是写。</p>
</li>
</ul>
<h4 id="fcfs">FCFS<a hidden class="anchor" aria-hidden="true" href="#fcfs">¶</a></h4>
<p>先来先服务 <code>First-Come First-Serve</code>：</p>
<ul>
<li>按顺序处理请求</li>
<li>公平对待所有进程</li>
<li>在有很多进程的情况下，接近随机调度的性能</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/10_04_FCFS.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<p>可以看到柱面 cylinder从122 到 14 在回到124摆动很巨大：</p>
<h4 id="sstf">SSTF<a hidden class="anchor" aria-hidden="true" href="#sstf">¶</a></h4>
<p>最短寻道优先 <strong>Shortest Seek Time First</strong></p>
<ul>
<li>选择从磁臂当前位置需要移动最少的IO请求</li>
<li>总是选择最短寻道时间</li>
<li>可能会导致饥饿</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/10_05_SSTF.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<p>由图可以看出相同的情况下<strong>SSTF</strong>将柱面移动数减少到 236 个柱面，低于**FCFS **所需的 640 个柱面。</p>
<h4 id="scan">SCAN<a hidden class="anchor" aria-hidden="true" href="#scan">¶</a></h4>
<p><strong>SCAN</strong>算法，又称<strong>电梯</strong>算法，磁臂在一个方向上移动，满足所有为完成的请求，直到磁臂到达该方向上最后的磁道，类似于在高层建筑中处理请求的电梯。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/10_06_SCAN.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="c-scan">C-SCAN<a hidden class="anchor" aria-hidden="true" href="#c-scan">¶</a></h4>
<p><code>Circular-SCAN</code>，通过循环队列方式来改进 SCAN ：一旦磁臂到达磁盘的末端，它会返回到另一端而不处理任何请求，然后从磁盘的开头重新开始：</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/10_07_C_SCAN.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="look">LOOK<a hidden class="anchor" aria-hidden="true" href="#look">¶</a></h4>
<p>LOOK是通过待处理请求的队列来改进SCAN，而不是磁盘序列，并且不会将磁头移向磁盘末端的距离超过必要的位置。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/10_08_C_LOOK.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<h4 id="n-step-look-or-n-step-scan">N-Step LOOK or N-Step-SCAN<a hidden class="anchor" aria-hidden="true" href="#n-step-look-or-n-step-scan">¶</a></h4>
<p>N-Step-SCAN是将请求队列分为成长度为<em>N</em>的子队列，使用SCAN算法进行处理；当在一个队列的处理过程中，如果有一些新的请求到达，那么它们必须被放置在另一个队列中。</p>
<p>设有从 0 到 199 编号为 200 磁道；请求顺序为， 122、90、160、24、102、89、143、18、67；$N=2$</p>
<p>子队列有：</p>
<ul>
<li>
<p>1 = {122, 90}</p>
</li>
<li>
<p>2 = {160, 24}</p>
</li>
<li>
<p>3 = {102, 89}</p>
</li>
<li>
<p>4 = {143, 18}</p>
</li>
<li>
<p>5 = {67}</p>
</li>
</ul>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/image-20220717124809354.png" alt="image-20220717124809354" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>
<p><code>N-step-SCAN</code> 磁盘调度算法的吞吐量高，平均响应时间低。</p>
<blockquote>
<p>Reference</p>
<p><a href="https://www.electronicsmind.com/2022/01/n-step-scan-disk-scheduling-algorithm.html" target="_blank"
   rel="noopener nofollow noreferrer" >n-step-scan disk scheduling algorithm</a></p>
</blockquote>
<h4 id="fscan">FSCAN<a hidden class="anchor" aria-hidden="true" href="#fscan">¶</a></h4>
<p>FSCAN <code>Fixed period SCAN</code>，是 <code>N-step-SCAN</code> 的简化版本，FSCAN将磁盘请求队列分成两个子队列，一个是由当前所有请求磁盘I/O的进程所形成的队列，由磁盘调度按SCAN算法进行处理，在扫描期间，将新出现的请求磁盘I/O的进程放入另一个等待处理的请求队列。这样，所有的新请求都被推迟到下一次扫描时处理。</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/CylonChau/imgbed/img/finalFSCAN.jpg" alt="img" onerror="this.onerror=null;this.src='/placeholder.svg';this.className='pe-image-placeholder'" /></p>


    
    


<div class="copyrightBlock" >
    <div class="articleSuffix-bg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.78 155.96"> <path d="M10.5,99.81a1.9,1.9,0,0,0-.53-.09,1.66,1.66,0,0,0-1.64,1.65A1.64,1.64,0,0,0,10,103a1.57,1.57,0,0,0,.87-.25l26.76,26.82.45-1.08L11.52,101.91A1.65,1.65,0,0,0,10.5,99.81Zm-.13,2a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.58.58,0,0,1,.57-.57h0a.57.57,0,0,1,.56.58A.55.55,0,0,1,10.37,101.77Z" style="fill:#c5c9e0"></path><path d="M56.15,117.58H39.06l0-.09a1.65,1.65,0,0,0-1.36-1H37.5a1.65,1.65,0,1,0,1.56,2.19H55.7L92.92,156h41.44v-1.08h-41Zm-18.25.94a.56.56,0,0,1-.79,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h0a.58.58,0,0,1,.57.58A.54.54,0,0,1,37.9,118.52Z" style="fill:#c5c9e0"></path><path d="M23.52,50.32a1.65,1.65,0,0,0,1.55-1.11H55.28l48-48.13h31.06V0H102.85l-48,48.13H25.07a1.64,1.64,0,0,0-2.09-1,1.64,1.64,0,0,0,.54,3.2Zm0-2.21a.57.57,0,0,1,0,1.13.57.57,0,1,1,0-1.13Z" style="fill:#c5c9e0"></path><polygon points="102.86 0 102.86 0 102.86 0 102.86 0" style="fill:#c5c9e0"></polygon><path d="M107.72,12.14h26.64V11.07H107.27L57.4,61H3.09a1.66,1.66,0,0,0-1.45-.86H1.52A1.65,1.65,0,1,0,2.81,63a1.59,1.59,0,0,0,.45-.87H57.85ZM2.05,62.23a.57.57,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.56-.57h.09a.57.57,0,0,1,.32,1Z" style="fill:#c5c9e0"></path><path d="M134.36,43.22V42.14h-22.3l-9.62,9.63a1.64,1.64,0,0,0-2.19.77,1.61,1.61,0,0,0-.17.71,1.65,1.65,0,1,0,3.29,0,1.61,1.61,0,0,0-.16-.72l9.3-9.32Zm-32.64,10.6a.57.57,0,0,1,0-1.13.57.57,0,0,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M147,52.3l-9,9H111.48a1.64,1.64,0,0,0-1.61-1.33h-.14a1.65,1.65,0,1,0,1.6,2.41h27.19l9.26-9.29L147,52.3Zm-37.15,9.85a.56.56,0,0,1-.56-.57h0a.56.56,0,0,1,.56-.56h0a.57.57,0,1,1,0,1.13Z" style="fill:#c5c9e0"></path><path d="M66.79,75.35l11,11.06h56.53V85.33H78.27l-11-11.06H49.49L37.12,86.67a1.64,1.64,0,0,0-2.09,1,1.61,1.61,0,0,0-.09.54,1.65,1.65,0,0,0,3.29,0,1.68,1.68,0,0,0-.26-.89l12-12ZM36.58,88.79a.57.57,0,1,1,.57-.56A.57.57,0,0,1,36.58,88.79Z" style="fill:#c5c9e0"></path><path d="M110.61,95.55,92.8,113.4a1.62,1.62,0,1,0,.77.76l17.49-17.53h23.31V95.55ZM92.49,115.28a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,.57-.57h0a.58.58,0,0,1,.56.58A.55.55,0,0,1,92.49,115.28Z" style="fill:#c5c9e0"></path><path d="M97.89,122.3H76.62L64.2,109.85a1.65,1.65,0,0,0-.77-2.2,1.77,1.77,0,0,0-.72-.17h-.14a1.65,1.65,0,0,0,.15,3.29,1.58,1.58,0,0,0,.71-.17l12.74,12.77H98.34l17.48-17.52h18.54v-1.08h-19ZM63.12,109.53a.56.56,0,0,1-.8,0,.58.58,0,0,1-.17-.41.57.57,0,0,1,1.14,0A.54.54,0,0,1,63.12,109.53Z" style="fill:#c5c9e0"></path> </svg> </div>
    <p>本文发布于<a href="https://www.oomkill.com/about" target="_blank">Cylon的收藏册</a>，转载请著名原文链接~</p>
    <p>链接：<a href="https://www.oomkill.com/2022/05/ch13-file-system/" target="_blank">https://www.oomkill.com/2022/05/ch13-file-system/</a></p>
    <p style="margin-bottom: 0px;">版权：本作品采用<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">「署名-非商业性使用-相同方式共享 4.0 国际」</a> 许可协议进行许可。</p>
    </div>
</div>
  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://www.oomkill.com/2022/05/ch12-ipc/">
    <span class="title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline>
      </polyline></svg>&nbsp; </span>
    
    <span>ch12 进程间通讯</span>
  </a>
  <a class="next" href="https://www.oomkill.com/2022/05/ch11-deadlock/" >
    <span class="title"> </span>
    
    <span>ch11 死锁&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg></span>
  </a>
</nav>

  </footer>

  
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
  </div>
  
  
  
  
    <div class="comments-separator"></div>
    

<h3 class="relatedContentTitle" >相关阅读</h3>
<ul class="relatedContent">
	
	<li><a href="/2022/05/ch12-ipc/"><span>ch12 进程间通讯</span></a></li>
	
	<li><a href="/2022/05/ch11-deadlock/"><span>ch11 死锁</span></a></li>
	
	<li><a href="/2022/05/ch10-semaphore-and-monitors/"><span>ch10 信号量和监视器</span></a></li>
	
	<li><a href="/2022/04/ch8-cpu-scheduling-algorithms/"><span>ch8 CPU调度算法</span></a></li>
	
	<li><a href="/2022/04/ch9-synchronization/"><span>ch9 同步</span></a></li>
	
</ul>

  

  
    
      <div class="comments-separator"></div>
<div class="comments">
    <script>
    function loadComment() {
        let theme = localStorage.getItem('pref-theme') === 'dark' ? 'dark' : 'light';
        let s = document.createElement('script');
        s.src = 'https://giscus.app/client.js';
        s.setAttribute('data-repo', 'cylonchau\/cylonchau.github.io');
        s.setAttribute('data-repo-id', 'R_kgDOIRlNSQ');
        s.setAttribute('data-category', 'Announcements');
        s.setAttribute('data-category-id', 'DIC_kwDOIRlNSc4CXy1U');
        s.setAttribute('data-mapping', 'title');
        s.setAttribute('data-reactions-enabled', '1');
        s.setAttribute('data-emit-metadata', '1');
        s.setAttribute('data-input-position', 'top');
        s.setAttribute('data-lang', 'zh-TW');
        s.setAttribute('data-theme', theme);
        s.setAttribute('crossorigin', 'anonymous');
        s.setAttribute('async', '');
        document.querySelector('div.comments').innerHTML = '';
        document.querySelector('div.comments').appendChild(s);
    }
    loadComment();
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
  <p>
  Copyright
  <span>&copy; 2024 <a href="https://www.oomkill.com">Cylon&#39;s Collection</a></span></p>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> on github-page & Theme
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>

<script>
  document.addEventListener('scroll', function (e) {
      const readProgress = document.getElementById("read_progress");
      const scrollHeight = document.documentElement.scrollHeight;
      const clientHeight = document.documentElement.clientHeight;
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
  })
</script>

<script>
  var menu = document.getElementById('menu')
  if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                  behavior: "smooth"
              });
          } else {
              document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
          }
          if (id === "top") {
              history.replaceState(null, null, " ");
          } else {
              history.pushState(null, null, `#${id}`);
          }
      });
  });
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
      } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
      }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.6.0/mermaid.min.js" crossorigin="anonymous"></script>
<script>
    mermaid.init(undefined, '.language-mermaid');
</script>
</body>

</html>
